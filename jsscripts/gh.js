"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("app",["tmh.dynamicLocale","jm.i18next","720kb.datepicker","angular-click-outside","angular-clipboard","angular-loading-bar","angular-google-analytics","angular-sortable-view","tandibar/ng-rollbar","perfect_scrollbar","colorpicker.module","currencyMask","ngAnimate","ngDialog","ngFileUpload","ngSanitize","ngStorage","restangular","toaster","ui.bootstrap","ui.paging","ui.directives","ui.gravatar","ui.router","ui.select","ui.load","app.localService","app.localeService","app.historyService","app.authService","app.notificationService","app.uploadService","app.topupService","app.bankService","app.addressService","app.countryService","app.timezoneService","app.roleService","app.urlService","app.refunds","app.settlementService","app.amplitudeService","app.dateService","app.preferencesService","app.apiFactories","app.utilities","app.access","app.home","app.onboarding","app.transactions","app.transaction-splits","app.charges","app.customers","app.pages","app.products","app.orders","app.plans","app.storefronts","app.subscriptions","app.subscribers","app.payouts","app.transfers","app.transfer-recipients","app.invoices","app.audit-logs","app.search","app.settings","app.compliance","app.setup","app.sessions","app.subaccounts","app.customer-insights","app.balance-history","app.disputes","app.direct-debit","app.terminals","app.zendeskService","modal.controllers","app.support","app.file-view","app.fileService","app.consent","app.campaignService","app.mandates"]).constant("DEFAULTS",{baseURL:settings.baseApiUrl,liveURL:settings.liveApiUrl,mockURL:settings.mockApiUrl,legacyURL:settings.coreAPIUrl,inlineURL:settings.inlineURL,environment:settings.environment,landingPage:settings.landingPage,baseStorefrontURL:settings.baseStorefrontURL,pusherKey:settings.pusherKey,externalLinks:settings.externalLinks||{},goLiveTimeInHours:settings.goLiveTimeInHours,rollbarAccessToken:settings.rollbarAccessToken,datadog:settings.datadog,minimumPayment:{NGN:100,GHS:2,USD:1,ZAR:1},minimumTransfer:{NGN:100,GHS:1}}).config(["tmhDynamicLocaleProvider","$urlRouterProvider","$httpProvider","RestangularProvider","$locationProvider","$stateProvider","ngDialogProvider","gravatarServiceProvider","$provide","AnalyticsProvider","RollbarProvider","DEFAULTS",function(e,t,n,r,o,a,i,s,c,u,l,d){e.localeLocationPattern("/assets/angular-locales/{{locale}}.js");t.when(/^\/$|^$/,["$state",function(e){e.go("access.login")}]).when("/balance-history",["$state",function(e){e.go("balance-history.list")}]).when("/settings/request-go-live",["$state",function(e){e.go("app.settings.activate")}]).when("/income",["$state",function(e){e.go("payouts.list")}]).when("/income/:id",["$state","$match",function(e,t){e.go("payouts.one",t)}]).otherwise(function(e){e.get("$state").go("app.404")}),i.setDefaults({className:"ngdialog-theme-plain",showClose:!1}),s.defaults={size:100,default:"404",secure:!0},n.defaults.useXDomain=!0,delete n.defaults.headers.common["X-Requested-With"],r.addResponseInterceptor(function(e,t,n,r,o,a){if(e&&e.response){var i=e.response.data;return e.response.meta&&(i.meta=e.response.meta),i}return e}),a.state("app",{abstract:!0,templateUrl:"components/layout/base.html",data:{authenticable:!0}}).state("app.downloads",{title:"Downloads",url:"/downloads/*path",pageTrack:"/downloads",resolve:{downloadPath:["$state","$stateParams","API","Notification",function(t,e,n,r){return n.all("download_url").post({storage_key:e.path}).then(function(e){return e.data&&e.data.path}).catch(function(e){r.error("Could not download file",e),t.go("app.404")})}]},controller:["$state","downloadPath",function(e,t){var n=document.createElement("a");n.download=window.name,n.href=t,n.click(),e.go("app.home",{},{location:"replace"})}]}).state("app.permissions",{title:"Your Permissions",url:"/permissions?denied",pageTrack:"/permissions",templateUrl:"/modules/access/permissions.html",controller:"PermissionsCtrl"}).state("app.404",{title:"404",url:"/404",templateUrl:"/modules/access/404.html"});var p=Date.now().toString();c.decorator("$templateFactory",["$delegate",function(e){var n=angular.bind(e,e.fromUrl);return e.fromUrl=function(e,t){return null!==e&&angular.isDefined(e)&&angular.isString(e)&&(e+=-1===e.indexOf("?")?"?":"&",e+="v="+p),n(e,t)},e}]),c.factory("setTimezone",[function(){return function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"UTC";return c.decorator("dateFilter",["$delegate",function(r){return function(e,t,n){return r(e,t,n||o)}}])}}]),u.setAccount(settings.trackingID).ignoreFirstPageLoad(!0).setPageEvent("$stateChangeSuccess").trackPages(settings.liveDeployment);var f="production"===d.environment,m=["localhost","127.0.0.1"].includes(window.location.hostname);f&&l.init({accessToken:d.rollbarAccessToken,captureUncaught:!1,captureUnhandledRejections:!1,scrubTelemetryInputs:!0,payload:{environment:d.environment,javascript:{source_map_enabled:!0}}}),m||DD_RUM.onReady(function(){DD_RUM.init({clientToken:d.datadog.clientToken,applicationId:d.datadog.applicationId,site:"datadoghq.eu",env:d.datadog.env,service:"merchant-dashboard",sampleRate:10,trackInteractions:!0})})}]).run(["$rootScope","$location","$state","$timeout","$stateParams","DEFAULTS","toaster","Auth","Session","ngDialog","Analytics","PendingDisputes","SettlementAccountData","LocalService","AmplitudeService",function(i,n,s,e,c,t,u,l,d,r,o,a,p,f,m){i.$state=s,i.$stateParams=c,i.Date=Date,i.DEFAULTS=t,i.moment=moment;var g=m.setActiveUser,h=m.logEvent;function y(e,t){return!(t||{}).name&&_.isEmpty(e)?_.extend(e,n.search()):e}var b=function(e){var t=f.get(e,{parse:!1});return t?"(".concat(t,")"):""};i.routes={transactions:"transactions.list".concat(b("default_transaction_filters")||"({ status: 'success' })"),transfers:"transfers.list".concat(b("default_transfer_filters"))},i.openHelpDesk=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i.$broadcast("helpdesk:open",e)},i.closeHelpDesk=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i.$broadcast("helpdesk:close",e)},i.$on("$stateChangeStart",function(t,n,r,e,o){if(i.showLoadingIcon=!0,i.sidebarVisible=!1,i.closeHelpDesk(),h("page_load",{pageName:s.current.name,state:"started"}),n.redirectTo)return t.preventDefault(),void s.go(n.redirectTo,y(r,e),{reload:!0,inherit:!0,notify:!0});if((a=n).data&&a.data.authenticable)d.validate(n,t).then(function(e){if(!e.account){if("setup.new"===n.name)return;return t.preventDefault(),void s.go("setup.new")}}).catch(function(e){return"Token Expired"==e?l.refreshToken().then(function(){s.go(n,r)}):"No User Information"===e||"No Account Information"===e?l.refreshSession().then(function(){var e=d.get("account"),t=d.get("user");g(t,e),s.go(n,r)}):"No Businesses Available"===e?(t.preventDefault(),void s.go("setup.new")):"Session Timed Out"===e?l.reauthenticate().then(function(){s.go(n,r)}):"Permission Denied"===e?(t.preventDefault(),void s.go(n.fallback||"app.permissions",{denied:n.title})):Promise.reject()}).catch(function(e){d.end(),f.set("redirectParams",y(r)),s.go("access.login",{next:n.name})});else{var a;e.name;n.requiresLogout&&d.isActive(),0}}),i.$on("$stateChangeSuccess",function(e,t,n,r,o){i.showLoadingIcon=!1;var a=_.omit(c,"page");i.$state.activeParams=_.some(_.values(a)),i.onSuccess&&(i.onSuccess(),i.onSuccess=null),r.name!==t.name&&h("Page load complete")}),i.$on("$stateChangeError",function(e,t,n,r,o,a){var i=navigator.onLine?a.data&&a.data.message:"Your computer seems to be offline, please reconnect and try again.";u.error({title:"An error occurred",body:i}),h("Page load failed",{Error:i})}),i.$on("ngDialog.templateLoading",function(){i.showDialogLoader=!0}),i.$on("ngDialog.templateLoaded",function(){i.showDialogLoader=!1}),i.listenWithPusher=function(e){(e=new Pusher(t.pusherKey,{cluster:"eu"}).subscribe(e)).bind("pusher:subscription_succeeded",function(e){console.log("listening to pusher")})}}]).controller("AppCtrl",["$scope","tmhDynamicLocale","$location","$state","$stateParams","$rootScope","Auth","Session","API","Notification","AmplitudeService","$timeout","OrderFactory","setTimezone","TimezoneService","MicroFrontendService","CampaignService",function(o,n,t,a,i,s,c,r,e,u,l,d,p,f,m,g,h){var y=h.marketingCampaigns;o.getMarketingCampaign=function(){return y[i.ref]},window.addEventListener("message",function(e){"MFA_NON_COMPLIANT_USER"===e.data.message&&a.go("access.access-denied",{reason:"no-mfa"})}),o.integrationSearch={},o.clearSearch=function(){o.integrationSearch.business_name=""};var b=l.setActiveUser,v=l.logEvent;o.logEvent=function(e,t){v(e,t)},window.isMfeRoot=!0,g.load().then(function(){d(function(){o.mfeServiceReady=!0})}).catch(function(e){console.error(e),d(function(){o.mfeServiceReady=!1})});var S,P=window.location.hostname.split(".")[0];(o.isAggregator=!["studio","dashboard","localhost"].includes(P),s.$on("sessionUpdated",function(){if(window.postMessage({message:"MFE_ROOT_SESSION_UPDATED"}),s.User){var r=s.User.dashboard_preferences&&s.User.dashboard_preferences.timezone;f(r),m.getTimezones().then(function(){var e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=m.getTimezoneDetailsByRegion(e)||{abbreviation:null},n="browser"===r;o.currentTimezone=n?t.abbreviation:r})}}),s.$on("$stateChangeSuccess",function(e,t){var n=o.Business&&o.Business.attributes&&o.Business.attributes.is_terminal_integration,r=o.Business&&o.Business.attributes&&o.Business.email.endsWith("@paystack.com");o.isTerminalFeatureAccessible=n||r}),window.zE(function(){window.zE.hide()}),o.isLoggedIn=function(){return r.isActive()},o.isAggregator)&&(S||e.one("organization",P).get().then(function(e){S=e.data,o.organizationData=e.data}).catch(function(){}));if(o.app={name:"Paystack Dashboard",version:"1.0.0",slogan:"Paylater Dashboard"},window.i18next){var w=settings.I18N_ENABLED?void 0:settings.I18N_DEFAULT_LOCALE||"en";window.i18next.use(window.i18nextXHRBackend).use(window.i18nextBrowserLanguageDetector).init({lng:w,fallbackLng:[settings.I18N_DEFAULT_LOCALE],load:"languageOnly",nsSeparator:"|",detection:{order:["navigator","localStorage"],caches:["localStorage"]},interpolation:{format:function(e,t,n){return(e instanceof Date||moment(e).isValid())&&"number"!==t?moment(e).format(t):"number"===t?new Intl.NumberFormat(n).format(e):e}},backend:{loadPath:"api/locales/{{lng}}/translations.json"}},function(e,t){console.log("resources loaded")}),o.i18nextReady=!1,window.i18next.on("languageChanged",function(e){var t=e.startsWith("en")?"en":e;n.set(t),moment.locale(t),o.i18nextReady=!0})}function C(){var e="/"+t.path().split("/")[1];t.path()===e?(s.$broadcast("integration:switched"),a.reload()):t.path(e)}o.Notification=u,o._=_,o.clearFilters=function(){a.go(a.current,{},{reload:!0,inherit:!1})},o.filter=function(e,t,n){n=n||{};var r=_.clone(i)||{};e&&t&&(n.date&&(t=new Date(t).toISOString()),r[e]=t),e&&!t&&(r[e]=void 0),r.page=null,a.go(a.current,r,{reload:!0,inherit:!0,notify:!0})},o.filterSearch=function(e){a.go("app.search",e||{}),v("Used search",{params:e})},o.reloadWithParams=function(e){var t=_objectSpread(_objectSpread(_objectSpread({},a.params),e),{},{next:null,previous:null});a.go(a.current,t,{reload:!0,inherit:!1,notify:!0}),v("Used filter",{params:t})},o.goToPage=function(e){var t=_.clone(i)||{};t.page=e,a.go(a.current,t,{reload:!0,inherit:!0,notify:!0}),v("Used pagination",{params:t})},o.queryActiveFilters=function(n){var e=_.map(n,function(e){return"object"===_typeof(e)?e.key:e}),t=_.pick(i,e),r=_.pick(t,_.identity),o=_.keys(r);o=_.map(o,function(t){var e=_.find(n,function(e){return"object"===_typeof(e)&&e.key===t});return e?e.name:t});var a=Object.keys(r).map(function(e){return{key:e,value:r[e]}});s.$state.activeFilters=o,s.$state.activeFilterValues=a},o.queryProductFilters=function(n){"true"===i.active&&(i.active=void 0);var e=_.map(n,function(e){return"object"===_typeof(e)?e.key:e}),t=_.pick(i,e),r=_.pick(t,_.identity),o=_.keys(r);o=_.map(o,function(t){var e=_.find(n,function(e){return"object"===_typeof(e)&&e.key===t});return e?e.name:t});var a=Object.keys(r).map(function(e){return{key:e,value:r[e]}});s.$state.activeFilters=o,s.$state.activeFilterValues=a},s.queryActiveFilters=o.queryActiveFilters,s.queryProductFilters=o.queryProductFilters,o.supportsCurrency=function(e){return _.contains(s.Business.allowed_currencies,e)},s.logout=function(){s.history=[],r.end(),a.go("access.login"),v("Logged out")},s.switchState=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=s.User.display_state,r="live"==n?"test":"live";return c.switchState(n,r).then(function(){u.success("Switched Integration","You're now working in the "+r+" state"),e?a.go(e.state,e.params,{reload:t}):C()})},s.switchIntegration=function(n){c.switchIntegration(n).then(function(){u.success("Accounts Switched","You are now using the "+n.business_name+" account"),s.switchingAccount=null,s.showLoadingIcon=!1;var e=r.get("account"),t=r.get("user");v("Switched integration"),b(t,e),C()})},s.getPendingOrdersCount=function(){s.User&&s.User.hasPermission("product-view")&&p.fetchPendingOrdersCount().then(function(e){s.pendingOrdersCount=e})}}]).controller("PermissionsCtrl",["LocalAPI","Session","$scope","$i18next",function(e,n,r,t){r.articleLink=settings.externalLinks?settings.externalLinks.newPermissions:"",e.all("permissions").getList().then(function(e){r.availablePermissions=[],r.unavailablePermissions=[],_.each(e,function(e){_.each(e.permissions,function(e){var t=i18next.t("permissions.".concat(e.key));n.hasPermission(e.key)?r.availablePermissions.push(t):r.unavailablePermissions.push(t)})})})}]),angular.module("app").constant("PopularDomains",["aol.com","att.net","comcast.net","facebook.com","gmail.com","gmx.com","googlemail.com","google.com","hotmail.com","hotmail.co.uk","mac.com","me.com","mail.com","msn.com","live.com","sbcglobal.net","verizon.net","yahoo.com","yahoo.co.uk","email.com","fastmail.fm","games.com","gmx.net","hush.com","hushmail.com","icloud.com","iname.com","inbox.com","lavabit.com","love.com","outlook.com","pobox.com","protonmail.com","rocketmail.com","safe-mail.net","wow.com","ygm.com","ymail.com","zoho.com","yandex.com","bellsouth.net","charter.net","cox.net","earthlink.net","juno.com","btinternet.com","virginmedia.com","blueyonder.co.uk","freeserve.co.uk","live.co.uk","ntlworld.com","o2.co.uk","orange.net","sky.com","talktalk.co.uk","tiscali.co.uk","virgin.net","wanadoo.co.uk","bt.com","sina.com","qq.com","naver.com","hanmail.net","daum.net","nate.com","yahoo.co.jp","yahoo.co.kr","yahoo.co.id","yahoo.co.in","yahoo.com.sg","yahoo.com.ph","hotmail.fr","live.fr","laposte.net","yahoo.fr","wanadoo.fr","orange.fr","gmx.fr","sfr.fr","neuf.fr","free.fr","gmx.de","hotmail.de","live.de","online.de","t-online.de","web.de","yahoo.de","libero.it","virgilio.it","hotmail.it","aol.it","tiscali.it","alice.it","live.it","yahoo.it","email.it","tin.it","poste.it","teletu.it","mail.ru","rambler.ru","yandex.ru","ya.ru","list.ru","hotmail.be","live.be","skynet.be","voo.be","tvcablenet.be","telenet.be","hotmail.com.ar","live.com.ar","yahoo.com.ar","fibertel.com.ar","speedy.com.ar","arnet.com.ar","yahoo.com.mx","live.com.mx","hotmail.es","hotmail.com.mx","prodigy.net.mx","yahoo.com.br","hotmail.com.br","outlook.com.br","uol.com.br","bol.com.br","terra.com.br","ig.com.br","itelefonica.com.br","r7.com","zipmail.com.br","globo.com","globomail.com","oi.com.br"]),angular.module("app").constant("InlineIcons",{edit:'\n    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M11.3334 2.00004C11.5085 1.82494 11.7163 1.68605 11.9451 1.59129C12.1739 1.49653 12.4191 1.44775 12.6667 1.44775C12.9143 1.44775 13.1595 1.49653 13.3883 1.59129C13.6171 1.68605 13.8249 1.82494 14 2.00004C14.1751 2.17513 14.314 2.383 14.4088 2.61178C14.5036 2.84055 14.5523 3.08575 14.5523 3.33337C14.5523 3.58099 14.5036 3.82619 14.4088 4.05497C14.314 4.28374 14.1751 4.49161 14 4.66671L5.00004 13.6667L1.33337 14.6667L2.33337 11L11.3334 2.00004Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',delete:'\n    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M2 4H3.33333H14" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M5.3335 3.99992V2.66659C5.3335 2.31296 5.47397 1.97382 5.72402 1.72378C5.97407 1.47373 6.31321 1.33325 6.66683 1.33325H9.3335C9.68712 1.33325 10.0263 1.47373 10.2763 1.72378C10.5264 1.97382 10.6668 2.31296 10.6668 2.66659V3.99992M12.6668 3.99992V13.3333C12.6668 13.6869 12.5264 14.026 12.2763 14.2761C12.0263 14.5261 11.6871 14.6666 11.3335 14.6666H4.66683C4.31321 14.6666 3.97407 14.5261 3.72402 14.2761C3.47397 14.026 3.3335 13.6869 3.3335 13.3333V3.99992H12.6668Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M6.6665 7.33325V11.3333" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M9.3335 7.33325V11.3333" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',cancel:'\n    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M12 4L4 12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M4 4L12 12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',save:'\n    <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M12.3332 1L4.99984 8.33333L1.6665 5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',eye:'\n    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>\n      <circle cx="12" cy="12" r="3"></circle>\n    </svg>\n  ',eyeOff:'\n    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n      <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>\n      <line x1="1" y1="1" x2="23" y2="23"></line>\n    </svg>\n  ',cog:'\n    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <title> settings </title>\n      <path d="M8.00002 9.99999C9.10459 9.99999 10 9.10456 10 7.99999C10 6.89542 9.10459 5.99999 8.00002 5.99999C6.89545 5.99999 6.00002 6.89542 6.00002 7.99999C6.00002 9.10456 6.89545 9.99999 8.00002 9.99999Z" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M12.9334 9.99999C12.8446 10.2011 12.8181 10.4241 12.8574 10.6404C12.8966 10.8566 12.9997 11.0562 13.1534 11.2133L13.1934 11.2533C13.3173 11.3772 13.4157 11.5242 13.4828 11.6861C13.5499 11.8479 13.5844 12.0214 13.5844 12.1967C13.5844 12.3719 13.5499 12.5454 13.4828 12.7072C13.4157 12.8691 13.3173 13.0162 13.1934 13.14C13.0695 13.264 12.9225 13.3623 12.7606 13.4294C12.5987 13.4965 12.4252 13.531 12.25 13.531C12.0748 13.531 11.9013 13.4965 11.7394 13.4294C11.5776 13.3623 11.4305 13.264 11.3067 13.14L11.2667 13.1C11.1096 12.9463 10.91 12.8432 10.6937 12.804C10.4775 12.7648 10.2544 12.7912 10.0534 12.88C9.85617 12.9645 9.68801 13.1048 9.56956 13.2837C9.45111 13.4625 9.38754 13.6721 9.38669 13.8867V14C9.38669 14.3536 9.24621 14.6927 8.99616 14.9428C8.74611 15.1928 8.40698 15.3333 8.05335 15.3333C7.69973 15.3333 7.36059 15.1928 7.11054 14.9428C6.8605 14.6927 6.72002 14.3536 6.72002 14V13.94C6.71486 13.7193 6.64343 13.5053 6.51503 13.3258C6.38662 13.1463 6.20718 13.0095 6.00002 12.9333C5.79894 12.8446 5.57589 12.8181 5.35963 12.8573C5.14336 12.8965 4.94381 12.9996 4.78669 13.1533L4.74669 13.1933C4.62286 13.3173 4.4758 13.4156 4.31394 13.4827C4.15208 13.5498 3.97857 13.5844 3.80335 13.5844C3.62813 13.5844 3.45463 13.5498 3.29277 13.4827C3.1309 13.4156 2.98385 13.3173 2.86002 13.1933C2.73605 13.0695 2.63771 12.9224 2.57061 12.7606C2.50351 12.5987 2.46897 12.4252 2.46897 12.25C2.46897 12.0748 2.50351 11.9013 2.57061 11.7394C2.63771 11.5775 2.73605 11.4305 2.86002 11.3067L2.90002 11.2667C3.05371 11.1095 3.15681 10.91 3.19602 10.6937C3.23524 10.4775 3.20876 10.2544 3.12002 10.0533C3.03551 9.85614 2.89519 9.68798 2.71633 9.56953C2.53747 9.45108 2.32788 9.38751 2.11335 9.38666H2.00002C1.6464 9.38666 1.30726 9.24618 1.05721 8.99613C0.807163 8.74608 0.666687 8.40694 0.666687 8.05332C0.666687 7.6997 0.807163 7.36056 1.05721 7.11051C1.30726 6.86047 1.6464 6.71999 2.00002 6.71999H2.06002C2.28068 6.71483 2.49469 6.6434 2.67422 6.515C2.85375 6.38659 2.9905 6.20715 3.06669 5.99999C3.15543 5.79891 3.1819 5.57586 3.14269 5.3596C3.10348 5.14333 3.00038 4.94378 2.84669 4.78666L2.80669 4.74666C2.68272 4.62283 2.58437 4.47577 2.51727 4.31391C2.45017 4.15205 2.41564 3.97854 2.41564 3.80332C2.41564 3.6281 2.45017 3.4546 2.51727 3.29274C2.58437 3.13087 2.68272 2.98382 2.80669 2.85999C2.93052 2.73602 3.07757 2.63768 3.23943 2.57058C3.4013 2.50348 3.5748 2.46894 3.75002 2.46894C3.92524 2.46894 4.09874 2.50348 4.26061 2.57058C4.42247 2.63768 4.56952 2.73602 4.69335 2.85999L4.73335 2.89999C4.89047 3.05368 5.09003 3.15678 5.30629 3.19599C5.52256 3.23521 5.74561 3.20873 5.94669 3.11999H6.00002C6.1972 3.03548 6.36536 2.89516 6.48382 2.7163C6.60227 2.53744 6.66583 2.32785 6.66669 2.11332V1.99999C6.66669 1.64637 6.80716 1.30723 7.05721 1.05718C7.30726 0.807132 7.6464 0.666656 8.00002 0.666656C8.35364 0.666656 8.69278 0.807132 8.94283 1.05718C9.19288 1.30723 9.33335 1.64637 9.33335 1.99999V2.05999C9.33421 2.27451 9.39777 2.48411 9.51622 2.66297C9.63468 2.84183 9.80284 2.98215 10 3.06666C10.2011 3.1554 10.4241 3.18187 10.6404 3.14266C10.8567 3.10345 11.0562 3.00035 11.2134 2.84666L11.2534 2.80666C11.3772 2.68269 11.5242 2.58434 11.6861 2.51724C11.848 2.45014 12.0215 2.41561 12.1967 2.41561C12.3719 2.41561 12.5454 2.45014 12.7073 2.51724C12.8691 2.58434 13.0162 2.68269 13.14 2.80666C13.264 2.93049 13.3623 3.07754 13.4294 3.2394C13.4965 3.40127 13.5311 3.57477 13.5311 3.74999C13.5311 3.92521 13.4965 4.09871 13.4294 4.26058C13.3623 4.42244 13.264 4.56949 13.14 4.69332L13.1 4.73332C12.9463 4.89044 12.8432 5.09 12.804 5.30626C12.7648 5.52253 12.7913 5.74558 12.88 5.94666V5.99999C12.9645 6.19717 13.1048 6.36533 13.2837 6.48378C13.4626 6.60224 13.6722 6.6658 13.8867 6.66666H14C14.3536 6.66666 14.6928 6.80713 14.9428 7.05718C15.1929 7.30723 15.3334 7.64637 15.3334 7.99999C15.3334 8.35361 15.1929 8.69275 14.9428 8.9428C14.6928 9.19285 14.3536 9.33332 14 9.33332H13.94C13.7255 9.33418 13.5159 9.39774 13.337 9.51619C13.1582 9.63464 13.0179 9.80281 12.9334 9.99999Z" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',send:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M12.8334 1.16663L6.41675 7.58329" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M12.8334 1.16663L8.75008 12.8333L6.41675 7.58329L1.16675 5.24996L12.8334 1.16663Z" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',download:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <title> download </title>\n      <path d="M12.25 8.75V11.0833C12.25 11.3928 12.1271 11.6895 11.9083 11.9083C11.6895 12.1271 11.3928 12.25 11.0833 12.25H2.91667C2.60725 12.25 2.3105 12.1271 2.09171 11.9083C1.87292 11.6895 1.75 11.3928 1.75 11.0833V8.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M4.08325 5.83337L6.99992 8.75004L9.91659 5.83337" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M7 8.75V1.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',upload:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <title> upload </title>\n      <path d="M12.25 8.75V11.0833C12.25 11.3928 12.1271 11.6895 11.9083 11.9083C11.6895 12.1271 11.3928 12.25 11.0833 12.25H2.91667C2.60725 12.25 2.3105 12.1271 2.09171 11.9083C1.87292 11.6895 1.75 11.3928 1.75 11.0833V8.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M9.91659 4.66667L6.99992 1.75L4.08325 4.66667" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M7 1.75V8.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',layers:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M7.00008 1.16675L1.16675 4.08341L7.00008 7.00008L12.8334 4.08341L7.00008 1.16675Z" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M1.16675 9.91675L7.00008 12.8334L12.8334 9.91675" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M1.16675 7L7.00008 9.91667L12.8334 7" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',user:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M11.6666 12.25V11.0833C11.6666 10.4645 11.4208 9.871 10.9832 9.43342C10.5456 8.99583 9.95215 8.75 9.33331 8.75H4.66665C4.04781 8.75 3.45432 8.99583 3.01673 9.43342C2.57915 9.871 2.33331 10.4645 2.33331 11.0833V12.25" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M7.00002 6.41667C8.28869 6.41667 9.33335 5.372 9.33335 4.08333C9.33335 2.79467 8.28869 1.75 7.00002 1.75C5.71136 1.75 4.66669 2.79467 4.66669 4.08333C4.66669 5.372 5.71136 6.41667 7.00002 6.41667Z" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',userCheck:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <g clip-path="url(#clip0)">\n      <path d="M9.33331 12.25V11.0833C9.33331 10.4645 9.08748 9.871 8.6499 9.43342C8.21231 8.99583 7.61882 8.75 6.99998 8.75H2.91665C2.29781 8.75 1.70432 8.99583 1.26673 9.43342C0.829146 9.871 0.583313 10.4645 0.583313 11.0833V12.25" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M4.95833 6.41667C6.247 6.41667 7.29167 5.372 7.29167 4.08333C7.29167 2.79467 6.247 1.75 4.95833 1.75C3.66967 1.75 2.625 2.79467 2.625 4.08333C2.625 5.372 3.66967 6.41667 4.95833 6.41667Z" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M9.91669 6.41667L11.0834 7.58333L13.4167 5.25" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      </g>\n      <defs>\n      <clipPath id="clip0">\n      <rect width="14" height="14" fill="white"/>\n      </clipPath>\n      </defs>\n    </svg>\n  ',sliders:'\n    <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <g clip-path="url(#clip0)">\n      <path d="M2.83331 12.25V8.16669" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M2.83331 5.83333V1.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M7.5 12.25V7" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M7.5 4.66667V1.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M12.1667 12.25V9.33331" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M12.1667 7V1.75" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M1.08331 8.16669H4.58331" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M5.75 4.66669H9.25" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M10.4167 9.33331H13.9167" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      </g>\n      <defs>\n      <clipPath id="clip0">\n      <rect width="14" height="14" fill="white" transform="translate(0.5)"/>\n      </clipPath>\n      </defs>\n    </svg>\n  ',message:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M12.25 8.75C12.25 9.05942 12.1271 9.35616 11.9083 9.57496C11.6895 9.79375 11.3928 9.91667 11.0833 9.91667H4.08333L1.75 12.25V2.91667C1.75 2.60725 1.87292 2.3105 2.09171 2.09171C2.3105 1.87292 2.60725 1.75 2.91667 1.75H11.0833C11.3928 1.75 11.6895 1.87292 11.9083 2.09171C12.1271 2.3105 12.25 2.60725 12.25 2.91667V8.75Z" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',logout:'\n    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M5.25 12.25H2.91667C2.60725 12.25 2.3105 12.1271 2.09171 11.9083C1.87292 11.6895 1.75 11.3928 1.75 11.0833V2.91667C1.75 2.60725 1.87292 2.3105 2.09171 2.09171C2.3105 1.87292 2.60725 1.75 2.91667 1.75H5.25" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M9.33331 9.91665L12.25 6.99998L9.33331 4.08331" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n      <path d="M12.25 7H5.25" stroke="#57584E" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  ',fileText:'\n    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n      <polyline points="14 2 14 8 20 8"></polyline>\n      <line x1="16" y1="13" x2="8" y2="13"></line>\n      <line x1="16" y1="17" x2="8" y2="17"></line>\n      <polyline points="10 9 9 9 8 9"></polyline>\n    </svg>\n  '}),angular.module("modal.controllers",[]).controller("HeaderCtrl",["$state","$scope","$rootScope","API","LocalService","ngDialog",function(e,t,n,r,o,a){t.toggleSidebar=function(){n.sidebarVisible=!n.sidebarVisible}}]);var UIDirectives=angular.module("ui.directives",[]);function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("app.accessService",[]).constant("AccessLevel",{anon:0,user:1,admin:2}),angular.module("app.addressService",[]).service("AddressService",["API","Session",function(e,t){return{stringifyAddress:function(n){if(!n)return"";return["lineOne","lineTwo","city","state","country"].reduce(function(e,t){return n[t]?[].concat(_toConsumableArray(e),[n[t]]):e},[]).join(", ")},formatAddress:function(e){if(!e)return"";var t=e.lineOne,n=e.lineTwo,r=e.city,o=e.state,a=e.country;return"\n        ".concat(n?"".concat(n," "):"").concat(t,"<br/>\n        ").concat(r,", ".concat(o),"<br/>\n        ").concat(a,"\n      ")}}}]),angular.module("app.amplitudeService",[]).service("AmplitudeService",["$rootScope","utils",function(o,a){var e=settings.amplitudeKeys,t=e.productInstanceKey,n=e.marketingInstanceKey;amplitude.getInstance("productInstance").init(t,{},{includeReferrer:!0,includeUtm:!0});var c=function(e){var t=new amplitude.Identify;return t.set("First Name",e.first_name),t.set("Last Name",e.last_name),t},u=function(e){var t=new amplitude.Identify;return t.set("Business_Name",e.business_name),t.set("Category",e.business_category),t.set("Size",e.business_size),t.set("Type",e.business_type),t.set("Is_Live",e.is_live),t.set("Organization",e.organization),t},l=function(e){var t=new amplitude.Identify;return t.set("Name",e.name),t.set("Description",e.description),t.set("Permissions",e.permissions),t.set("Is_Custom_Role",e.is_custom),t};return{initializeMarketingInstance:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};amplitude.getInstance("marketingInstance").init(n,{},e)},setActiveUser:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"productInstance";if(t){var r=amplitude.getInstance(n),o=e.id.toString(),a="".concat(e.id,"_").concat(t.id);r.setUserId(a),r.identify(c(e)),r.setGroup("User",o),r.groupIdentify("User",o,c(e));var i=t.id.toString();if(r.setGroup("Integration",i),r.groupIdentify("Integration",i,u(t)),e.role){var s=e.role.id.toString();r.setGroup("Role",s),r.groupIdentify("Role",s,l(e.role))}}},logEvent:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"productInstance",r=o.$state.params;amplitude.getInstance(n).logEvent(e,_objectSpread(_objectSpread({Mode:o.User&&o.User.display_state,Page:o.$state.current.name},a.capitalizeObjectKeys(t)),a.capitalizeObjectKeys(r)))}}}]),angular.module("app.apiFactories",["restangular"]).factory("LocalAPI",["Restangular","DEFAULTS",function(e,t){return e.withConfig(function(e){e.setBaseUrl(t.baseURL)})}]).factory("API",["Restangular","DEFAULTS","LocalService","Session","$state",function(e,t,n,s,c){return e.withConfig(function(e){var i;e.setBaseUrl(t.liveURL),e.addFullRequestInterceptor(function(e,t,n,r,o,a,i){return s.isActive()&&(o.Authorization="Bearer "+s.get("token"),o["jwt-auth"]=!0),{element:e,headers:o,params:a,httpConfig:i}}),e.setErrorInterceptor(function(e,t,n){var r=e.status,o=e.data;if(401===r&&o&&"Invalid token"===o.message)return i||(i=c.current.name),s.end(),t.reject(),c.go("access.login",{next:i}),!1;if(403===r&&o&&o.data&&o.data.enable_mfa){var a=!["access.login","access.access-denied","access.business-switcher"].includes(c.current.name);return c.go("access.access-denied",_objectSpread({reason:"no-mfa"},a&&{next:c.current.name})),!1}return!0})})}]).factory("MockAPI",["Restangular","DEFAULTS","LocalService","Session",function(e,t,n,s){return e.withConfig(function(e){e.setBaseUrl(t.mockURL),e.addFullRequestInterceptor(function(e,t,n,r,o,a,i){return s.isActive()&&(o.Authorization="Bearer "+s.get("token"),o["jwt-auth"]=!0),{element:e,headers:o,params:a,httpConfig:i}})})}]).factory("LegacyAPI",["Restangular","DEFAULTS","$rootScope",function(e,t,n){return e.withConfig(function(e){e.setBaseUrl(t.legacyURL)})}]).factory("ZendeskAPI",["Restangular","DEFAULTS","$rootScope",function(e,t,n){return e.withConfig(function(e){e.setBaseUrl("https://paystack.zendesk.com/api/v2/"),e.addFullRequestInterceptor(function(e,t,n,r,o,a,i){return{element:e,headers:o,params:a,httpConfig:i}})})}]).factory("FeedbackAPI",["Restangular",function(e){return e.withConfig(function(e){e.setBaseUrl(settings.FEEDBACK_API_URL),e.addFullRequestInterceptor(function(e,t,n,r,o,a,i){return{element:e,headers:o,params:a,httpConfig:i}})})}]);var _excluded=["id","truecaller_verified","is_primary_user","display_state"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}angular.module("app.authService",[]).run(["$rootScope","$state","Notification","LocalService","ngDialog",function(e,t,n,r,o){}]).service("Auth",["LocalService","$q","$state","$rootScope","LocalAPI","API","Notification","Session","SessionTimer","ngDialog",function(o,e,t,n,r,a,i,s,c,u){function l(){a.one("feature-flags").get().then(function(e){s.saveFeatures(e.data)})}function d(e){s.saveToken(e.token,e.expiry);var t,n,r=e.user;if(0===r.integrations.length)return Promise.resolve(s.saveUser(r));return t=r,n=_.pluck(t.integrations,"id"),_.contains(n,t.current_integration)||(r.current_integration=r.integrations[0].id,a.all("user/switch_integration").post({integration:r.current_integration})),s.saveUser(r),l(),a.one("integration",r.current_integration).get({include:"top-up"}).then(function(e){s.saveBusiness(e.data)})}function p(e){return a.all("login").post(e).then(function(e){return e.data.mfa_required?(s.saveToken(e.data.token),e.data):d(e.data)})}function f(){return a.one("user","profile").get().then(function(e){s.saveUser(e.data)})}function m(){return a.one("integration",s.get("account").id).get({include:"top-up"}).then(function(e){s.saveBusiness(e.data)})}return{login:p,refreshToken:function(){var e=s.get("token");return a.all("refresh_token").post({token:e}).then(function(e){var t=e.data;s.saveToken(t.token,t.expiry)})},refreshSession:function(){return s.isActive()?a.one("session").get().then(function(e){return d(e.data)}):Promise.reject()},refreshBusiness:m,save:d,update:function(e,t){var n,r=null===t?"refresh":"update";return"user"==e&&"refresh"==r?f():"user"==e&&"update"==r?function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.id,e.truecaller_verified,e.is_primary_user,e.display_state,_objectWithoutProperties(e,_excluded));return a.all("user/profile").customPUT(t).then(function(e){s.saveUser(e.data)})}(t):"account"==e&&"refresh"==r?m():"account"==e&&"update"==r?(n=t,a.all("integration/"+s.get("account").id).customPUT(n).then(function(e){return s.saveBusiness(e.data),e})):void 0},switchState:function(e,t){if("live"!=t||s.get("account").is_live)return c.stop(),a.all("user/switch_state").post({display_state:t}).then(function(){var e=Object.assign({},s.get("user"),{display_state:t});s.saveUser(e)}).catch(function(e){c.reset(),i.error("Could not switch to live state",e)});u.open({template:"components/modals/activate.html"})},switchIntegration:function(e){return c.stop(),n.switchingAccount=e,n.showLoadingIcon=!0,a.all("user/switch_integration").post({integration:e.id}).then(l).then(f).then(function(){return a.one("integration",e.id).get({include:"top-up"})}).then(function(e){return s.saveBusiness(e.data)}).then(function(){n.switchingAccount=null,n.showLoadingIcon=!1})},reauthenticate:function(){var r={email:s.get("user").email};return u.openConfirm({template:"modules/access/modals/re-authenticate.html",closeByEscape:!1,closeByNavigation:!1,closeByDocument:!1,controller:["$scope","$state","Session",function(t,e,n){t.credentials=r,t.logout=function(){n.end(),e.go("access.login",{next:e.current.name})},t.login=function(){p(t.credentials).then(function(e){o.set("current_session_timed_out",!1),t.confirm()}).catch(function(e){t.credentials.password="",t.$broadcast("reauthenticated",!1),i.error("Could not authenticate your account",e)})}}]})}}}]),angular.module("app.bankService",[]).service("BankService",["API","Session",function(r,t){var n,o;function a(t){return t?_.find(n,function(e){return _.contains([e.name,e.code,e.id],t)}).code:null}return{init:function(e){return e.currency||(e.currency=t.get("account").default_currency),["GBP"].includes(e.currency)&&(e.currency="NGN"),e.transferRecipient||(e.transferRecipient=!1),o=r.one("bank").get(e).then(function(e){return n=e.data})},getBanks:function(){return o},getBank:function(t){return _.find(n,function(e){return-1<[e.slug,e.code].indexOf(t)})},validate:function(e,t){return o||Promise.reject("Bank Service not initialized"),o.then(function(){return e?t?a(t)?Promise.resolve():Promise.reject("Invalid Bank"):Promise.reject("No Bank Provided"):Promise.reject("No Account Number")})},resolve:function(e,t,n){return r.one("bank","resolve").get({bank_code:a(t),account_number:e,currency:n}).then(function(e){return e.data}).catch(function(){return"unconfirmed"})},resolveBvn:function(e){return r.one("dashboard/resolve_bvn",e).get().then(function(e){return e.data}).catch(function(){return"unconfirmed"})}}}]),angular.module("app.campaignService",[]).service("CampaignService",function(){return{marketingCampaigns:{artwork:{name:"Artwork",pageStyle:{background:"#111111"},getDescription:function(){return"".concat(this.name," is proudly brought to you by Paystack. Create your FREE account to get all the business tools you need to grow your creative practice.")}},begtodiffer:{name:"I Beg to Differ",pageStyle:{background:"#07130e"},getDescription:function(){return"".concat(this.name," is proudly supported by Paystack. Create your FREE account to get all the tools you need to start and scale your business.")}},wiicreate:{name:"WiiCreate",getDescription:function(){return"WiiCreate's â€œTech Changed my Lifeâ€ is proudly powered by Paystack. Create your FREE account to get all the tools you need to start and scale your business."}},mit2022:{name:"MIT",getDescription:function(){return"The MIT Africa Innovate Conference is proudly supported by Paystack. Create your FREE account to accept payments for your Africa-focused business quickly and securely."}},devconf:{name:"DevConf",getDescription:function(){return"DevConf 2022 is proudly sponsored by Paystack. Sign up for FREE to get your API Keys and build amazing payment experiences."}},ilikegirls:{name:"I Like Girls",getDescription:function(){return'"'.concat(this.name,'" podcast is proudly sponsored by Paystack. Create your FREE account to get all the tools you need to start and scale your business.')}},xeroroadshow:{name:"Xero",getDescription:function(){return"Paystack is a proud partner of ".concat(this.name,". Create your FREE account to get all the tools you need to start and scale your business.")}}}}}),angular.module("app.countryService",[]).service("CountryService",["LocalAPI",function(e){var n,r={NG:{bankType:"nuban",country:"Nigeria",countryCode:"NG",defaultCurrency:"NGN",accountNumberPattern:{exactMatch:!0,pattern:/^(\d){10}$/},features:[],phoneNumberPattern:"^[0-9]{10}$",placeholder:"802 123 4567"},GH:{bankType:"ghipss",country:"Ghana",countryCode:"GH",defaultCurrency:"GHS",accountNumberPattern:{exactMatch:!1,pattern:/^(\d){7}/},features:["mobile_money"],phoneNumberPattern:"^[0-9]{10}$",placeholder:"050 123 456"},US:{countryCode:"US",country:"United States of America",defaultCurrency:"USD",accountNumberPattern:{exactMatch:!0,pattern:/^(\d){10}$/},features:[],phoneNumberPattern:"^[0-9]{10}$",placeholder:"832 123 4567"},ZA:{bankType:"basa",country:"South Africa",countryCode:"ZA",defaultCurrency:"ZAR",accountNumberPattern:{exactMatch:!1,pattern:/^[0-9][0-9]{8,14}$/},features:["eft"],phoneNumberPattern:"^[0-9]{10}$",placeholder:"050 123 456"},KE:{bankType:"kepss",country:"Kenya",countryCode:"KE",defaultCurrency:"KES",accountNumberPattern:{exactMatch:!1,pattern:/^[0-9][0-9]{8,15}$/},features:["mobile_money"],phoneNumberPattern:"^[0-9]{10}$",placeholder:"070 123 456"}},o={NGN:{bankType:"nuban",country:"Nigeria",countryCode:"NG",defaultCurrency:"NGN",accountNumberPattern:{exactMatch:!0,pattern:/^(\d){10}$/},features:[],phoneNumberPattern:"^[0-9]{10}$",placeholder:"802 123 4567"},GHS:{bankType:"ghipss",country:"Ghana",countryCode:"GH",defaultCurrency:"GHS",accountNumberPattern:{exactMatch:!1,pattern:/^(\d){7}/},features:["mobile_money"],phoneNumberPattern:"^[0-9]{10}$",placeholder:"050 123 456"},USD:{countryCode:"US",country:"United States of America",defaultCurrency:"USD",accountNumberPattern:{exactMatch:!0,pattern:/^(\d){10}$/},features:[],phoneNumberPattern:"^[0-9]{10}$",placeholder:"832 123 4567"},ZAR:{bankType:"basa",country:"South Africa",countryCode:"ZA",defaultCurrency:"ZAR",accountNumberPattern:{exactMatch:!1,pattern:/^[0-9][0-9]{8,14}$/},features:["eft"],phoneNumberPattern:"^[0-9]{10}$",placeholder:"050 123 456"},KES:{bankType:"kepss",country:"Kenya",countryCode:"KE",defaultCurrency:"KES",accountNumberPattern:{exactMatch:!1,pattern:/^[0-9][0-9]{8,15}$/},features:["mobile_money"],phoneNumberPattern:"^[0-9]{10}$",placeholder:"070 123 456"}};return{getCountries:function(){return n?Promise.resolve(n):e.one("countries.json").get().then(function(e){return n=e.map(function(e){return Object.keys(r).includes(e.countryCode)&&(e.metadata=r[e.countryCode]),e})})},getCurrencyData:function(e){return o[e]},getCountryData:function(e){return r[e]},currencyHasFeature:function(e,t){return o[e].features.includes(t)},countryHasFeature:function(e,t){return r[e].features.includes(t)},getCountryByName:function(t){return n.find(function(e){return e.name===t})},getCountryByISOCode:function(t){return n.find(function(e){return e.countryCode===t})},getCountryByCallingCode:function(t){return n.find(function(e){return e.callingCodes[0]===t})},getCountryByPhoneNumber:function(t){return n.find(function(e){return 1<e.callingCodes[0].length&&String(t).startsWith(e.callingCodes[0])})}}}]),angular.module("app.dateService",[]).service("DateService",[function(){return{format:function(e){var t=angular.copy(e);if("today"===t.period&&(t.from=moment().startOf("day").format(),t.to=null),"day"===t.period){var n=new Date(t.for);t.from=moment(n).startOf("day").format(),t.to=moment(n).endOf("day").format()}if("range"===t.period){if(t.from){var r=new Date(t.from);t.from=moment(r).startOf("day").format()}if(t.to){var o=new Date(t.to);t.to=moment(o).endOf("day").format()}}return t}}}]),angular.module("app.deviceService",[]).service("DeviceService",[function(){return{isMobile:function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}}}]),angular.module("app.fileService",[]).service("FileService",function(){var t=function(e){return e?e.split("/").slice(-1)[0]:""};return{extractFileNameFromDocumentLocation:t,formatDocumentLocationsForFileUploader:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e?e.map(function(e){return{path:e,name:t(e)}}):[]},extractFilePathFromUploader:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e?e.map(function(e){return e.path}):[]}}}),angular.module("app.historyService",[]).run(["$rootScope","$location","$state","$stateParams","DEFAULTS","toaster",function(i,e,s,t,n,r){i.$on("$stateChangeStart",function(e,t,n,r,o){if(i.history=i.history||[],i.lastState=i.fromState,t!=r&&r.name)if(i.usedBackButton)i.usedBackButton=!1;else{var a=_.last(i.history);a&&a.state==r||i.history.push({state:r,params:o}),10<i.history.length&&i.history.shift()}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}),i.previousState=function(e){i.usedBackButton=!0;var t,n,r=angular.copy(i.history);if(r.length){var o=_.last(r);t=o.state.name,n=o.params,i.history=_.without(r,o)}else if(e)t=e;else{var a=s.current.name.split(".");t=_.first(a,2).join(".")}s.go(t,n)}}]),angular.module("app.introService",[]).factory("IntroService",[function(){var n;if("function"!=typeof introJs)throw new function(){this.message="Intro.js is not available. Make sure it is properly loaded.",this.name="IntroJsNotAvailable"};return{setup:function(e){(n=new introJs).addSteps(e.steps);var t=_.omit(e,"steps");n.setOptions(t)},start:function(){n.start()}}}]).factory("IntroSteps",["Session",function(e){return[{element:"#nav-home",intro:'<div class="introjs-title">Home</div><div class="introjs-body">View metrics and charts to know how your business is performing.</div>',position:"right",permissions:["metrics-*"]},{element:"#nav-payments",intro:'<div class="introjs-title">Payments</div><div class="introjs-body">Configure, browse and manage payments from customers.</div>',position:"right",permissions:["transaction-view"]},"registered"===e.get("account").business_type&&{element:"#nav-transfers",intro:'<div class="introjs-title">Transfers</div><div class="introjs-body">Send money to people and manage your Paystack balance.</div>',position:"right",permissions:["transfer-view","balance-view"]},{element:"#nav-commerce",intro:'<div class="introjs-title">Commerce</div><div class="introjs-body">Make use of these simple, powerful tools to start selling quickly.</div>',position:"right",permissions:["page-view","invoice-view","product-view"]},{element:"#nav-admin",intro:'<div class="introjs-title">Admin</div><div class="introjs-body">Finally, manage your Paystack account settings and activity from here.</div>',position:"right"}]}]),angular.module("app.localService",[]).factory("LocalService",function(){return{set:function(e,t){return localStorage.setItem(e,JSON.stringify(t))},get:function(e){if(!(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{parse:!0}).parse)return localStorage.getItem(e);try{return JSON.parse(localStorage.getItem(e))}catch(e){return null}},unset:function(e){return localStorage.removeItem(e)}}}),angular.module("app.localeService",[]).service("LocaleService",["API","Session",function(t,n){return{fetch:function(){var e=n.get("account").id;return t.one("integration/locale/"+e).get().then(function(e){return e.data.locale})}}}]),angular.module("app").service("MicroFrontendService",["uiLoad",function(n){return{load:function(){var t="".concat(settings.dashboardNextURL,"/"),e=(new Date).getTime();return window.chunkURL=t,fetch("".concat(t,"static/manifest.json?v=").concat(e)).then(function(e){return e.json()}).then(function(e){return n.load(e.entrypoints.map(function(e){return"".concat(t).concat(e)}))}).catch(function(e){return Promise.reject(e)})}}}]),angular.module("app.notificationService",["toaster"]).factory("Notification",["toaster",function(s){return{pop:function(e){s.pop(e)},success:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:5e3;s.pop({type:"success",title:e||"Action completed succesfully",body:t,timeout:n})},error:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:5e3;if(t){var r;if("string"==typeof t)switch(t){case"Networking Error":r="Could not connect to the upload server";break;default:r=t}else if(t.data){var o=t.data;if(o.errors){o.message&&(e=o.message);var a=_.values(o.errors)[0],i=_.findWhere(a,{rule:"required"});r=i?i.message:a[0].message}!r&&o.message&&(r=o.message),!r&&o.data&&(r=o.data.summary),r||(r="Unknown error occured")}else r=t.message?t.message:"Could not connect to the server. Please check your connection and try again";s.pop({type:"error",title:e||"Action could not be perfomed",body:r,timeout:n})}},clear:function(){s.clear()}}}]),angular.module("app.preferencesService",[]).run(["$rootScope","$state","$stateParams",function(u,e,t){u.$on("$stateChangeStart",function(e,t,n,r,o){var a=u.User,i=a&&a.dashboard_preferences,s=i&&i.pagination,c=Object.keys(n).includes("use_cursor");s&&s.use_cursor&&c&&angular.extend(n,{use_cursor:!0})})}]).service("PreferencesService",["API","$rootScope",function(t,n){return{getPaginationPreferences:function(){var e=n.User,t=e&&e.dashboard_preferences;return t&&t.pagination},updateTimezonePreference:function(e){return t.one("user/dashboard_preferences").customPUT(e)},updatePaginationPreferences:function(e){return t.one("user/dashboard_preferences").customPUT(e)}}}]),angular.module("app.roleService",[]).service("RoleService",["API","LocalAPI",function(e,t){var n,r={fetch:function(){return e.one("integration/roles").get().then(function(e){return n=_.map(e.data,function(e){switch(e.full_name=e.name.split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" "),e.name){case"admin":e.priority=0;break;case"operations":e.priority=1;break;case"developer-support":e.priority=2;break;case"customer-support":e.priority=3;break;default:e.priority=4}return e}),e})},data:function(){return _.sortBy(n,"priority")},id:function(e){return(_.findWhere(n,{is_custom:0,name:e})||{}).id},permissions:[]};return t.all("permissions").getList().then(function(e){r.permissions=e}),r}]),angular.module("app.sessions",[]).run(["$rootScope","$state","Notification","LocalService","Session","SessionTimer","Auth","ngDialog",function(n,a,e,t,i,s,r,o){n.$on("sessionUpdated",function(e,t){n.currentSession=t,n.User=t.user,n.Business=t.account,n.FeatureFlags=t.features}),n.$on("sessionTimedOut",function(){t.set("current_session_timed_out",!0),a.current.validateTimeout&&r.reauthenticate().then(function(){s.reset()})}),n.$on("sessionEnded",function(e,t){n.currentSession&&(n.currentSession.token=null,n.currentSession.expiry=null),o.closeAll()}),n.$on("$stateChangeSuccess",function(e,t,n,r,o){a.includes("app")&&!i.timedOut()?s.reset():s.stop()})}]).service("SessionTimer",["$rootScope","$timeout","LocalService",function(e,t,n){var r=null;function o(){r=t(i,36e5)}function a(){r&&t.cancel(r)}function i(){a(),e.$broadcast("sessionTimedOut")}return{start:o,stop:a,reset:function(){a(),o()}}}]).factory("SessionData",[function(){return{user:null,account:null,token:null,expiry:null,features:null}}]).service("Session",["$rootScope","$q","LocalService","SessionData","SessionTimer",function(r,e,n,o,t){function a(){return n.get("current_session_timed_out")}function i(){var e=new Date,t=n.get("current_session_expiry");return(t=new Date(1e3*t))<e}function s(e){return!!o.user&&o.user.hasPermission(e)}function c(e,t){angular.extend(this,e),this.is_primary_user=!1,this.roleName=function(){return this.role.name.split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")},this.setPrimary=function(e){this.is_primary_user=this.id===e},this.permissions=e.permissions,this.hasPermission=function(e){var t=this.permissions||[],n=_.isArray(e)?e:[e];return _.filter(n,function(e){return _.contains(t,e)}).length},t&&this.setPrimary(t.primary_user),this.isDemoUser=function(){return this.email===settings.demoUser}}function u(e){angular.extend(this,e),_.isObject(e.primary_user)&&(this.primary_user=e.primary_user.id),this.default_currency=this.default_currency||"NGN",this.starterintegration&&this.starterintegration.length&&(this.starter_integration=_.last(this.starterintegration).id,this.business_upgrade_requested=_.last(this.starterintegration).business_upgrade_requested,this.business_upgrade_requested_at=_.last(this.starterintegration).business_upgrade_requested_at),"starter"===this.business_type&&(this.can_transfer=!1,this.registration_document_type="bn")}return o.token=n.get("current_session"),o.expiry=n.get("current_session_expiry"),{saveUser:function(e){var t=e.permissions||e.role&&e.role.permissions||[];if(e.email===settings.demoUser){var n=["settings-view","accounts-view","user-view","api-key-view","settings-*"];t=t.filter(function(e){return!n.includes(e)})}else t.push("onboarding-*");e.permissions=t,o.user?o.user=angular.extend(o.user,e):o.user=new c(e,o.account),r.$broadcast("sessionUpdated",o)},saveBusiness:function(e){o.account&&o.account.id===e.id?o.account=angular.extend(o.account,e):o.account=new u(e),o.user.setPrimary(o.account.primary_user),r.$broadcast("sessionUpdated",o)},saveFeatures:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o.features=e||angular.extend(o.features||{},e)},saveToken:function(e,t){n.set("current_session",e),n.set("current_session_expiry",t),o.token=e,o.expiry=t,r.$broadcast("sessionUpdated",o)},isActive:function(){return null!=o.token},timedOut:a,isExpired:i,validate:function(e,t){return(e=angular.copy(e)).data=e.data||{},e.permissions=_.compact([e.permission,e.data.permission]),null===o.token?(t.preventDefault(),Promise.reject("Not Logged In")):i()?(t.preventDefault(),Promise.reject("Token Expired")):o.user?e.isSetup?Promise.resolve(o):o.account?e.validateTimeout&&a()?(t.preventDefault(),Promise.reject("Session Timed Out")):e.permissions.length&&!s(e.permissions)?(t.preventDefault(),Promise.reject("Permission Denied")):Promise.resolve(o):(t.preventDefault(),o.user.integrations.length?Promise.reject("No Account Information"):Promise.reject("No Businesses Available")):(t.preventDefault(),Promise.reject("No User Information"))},hasPermission:s,validatePermission:function(e){return _.contains(o.user.permissions,e)?Promise.resolve():Promise.reject()},canAccessCurrentBusiness:function(){if(o.user){var e=_.pluck(o.user.integrations,"id");return _.contains(e,o.user.current_integration)}return!1},defaultCurrency:function(){return o.account.default_currency},data:function(){return o},get:function(e){return o[e]},end:function(){n.unset("current_session"),n.unset("current_session_expiry"),n.unset("current_session_timed_out"),t.stop(),o={},r.$broadcast("sessionEnded")}}}]),angular.module("app.settlementService",[]).service("SettlementService",["LocalAPI",function(t){return{getNextBusinessDay:function(e){var i=e.country;return t.one("public_holidays").get().then(function(e){var a=e.data,t=moment().day();return function e(t){return 6===(o=t)||7===o||function(e){if(i&&i.iso_code){var t=i&&i.iso_code,n=a[t];if(n)return n[moment().day(e).format("YYYY-MM-DD")]||n["YYYY-".concat(moment().day(e).format("MM-DD"))]}}(t)||(n=t,(r=a["*"])[moment().day(n).format("YYYY-MM-DD")]||r["YYYY-".concat(moment().day(n).format("MM-DD"))])?e(t+1):t;var n,r,o}(t+1)})}}}]),angular.module("app.timezoneService",[]).service("TimezoneService",["LocalAPI",function(e){var t=[];return{getTimezones:function(){return t.length?Promise.resolve(t):e.one("timezones.json").get().then(function(e){return t=e})},getTimezoneDetailsByRegion:function(n){return t.find(function(e){var t=e.timezone;return n===t})}}}]),angular.module("app.topupService",["oc.lazyLoad"]).service("TopupService",["ngDialog","$rootScope","API","TopupCharge","utils",function(e,f,m,o,g){return{checkEligibility:function(){return new Promise(function(e,t){return f.Business.is_live?e():t()})},topup:function(){return new Promise(function(d,p){e.openConfirm({template:"/modules/transfers/modals/topup.html",resolve:{balances:["API",function(e){return e.one("balance").get()}],inlineJS:["$ocLazyLoad","DEFAULTS",function(e,t){return e.load(t.inlineURL)}]},controller:["$scope","balances",function(r,e){r.balances=e.data,r.activeBalance=r.balances[0],r.integrationCountry=f.Business.attributes.country&&f.Business.attributes.country.iso_code,r.getTopupCharge=function(){var e=r.topup,t=e.currency,n=e.amount;r.isFetchingTopupCharge=!0,o.fetch({currency:t,amount:n}).then(function(e){var t=e.topup_fees,n=e.final_amount;r.topupFees=t,r.finalAmount=n}).finally(function(){r.isFetchingTopupCharge=!1})}}]}).then(function(e){var t=e.topup,s=t.currency,c=t.amount,n=e.topupFees,u=void 0===n?0:n,l=e.finalAmount;m.one("balance/funding_settings",s).get().then(function(e){var t=e.data,n=f.User.display_state,r=t&&t.public_keys[n],o=new PaystackPop,a={onError:function(e){p(new Error("Error occured: ".concat(e.message)))},onSuccess:function(e){var t=e.reference;m.all("balance/update_from_dashboard").post({reference:t,currency:s}).then(function(){d()}).catch(function(e){p(e)})},onCancel:function(){p(new Error("Payment was abandoned"))}},i=_objectSpread({currency:s,key:r,email:f.User.email,amount:100*(l||c),metadata:{integration:f.Business.id,topup_fees:g.currencyBaseUnitToSubUnit(u)}},a);o.newTransaction(i)}).catch(function(e){p(e)})})})},requery:function(e,t){return m.one("automated_top_up_account/requery").get({account_number:e,bank_slug:t})}}}]).factory("TopupCharge",["API",function(t){return{fetch:function(e){return t.one("balance/topupfees").get(e).then(function(e){return e&&e.message})}}}]),angular.module("ui.load",[]).service("uiLoad",["$document","$q","$timeout",function(r,o,a){var i=[],n=!1,s=o.defer();this.load=function(e){e=angular.isArray(e)?e:e.split(/\s+/);var t=this;return n||(n=s.promise),angular.forEach(e,function(e){n=n.then(function(){return 0<=e.indexOf(".css")?t.loadCSS(e):t.loadScript(e)})}),s.resolve(),n},this.loadScript=function(e){if(i[e])return i[e].promise;var t=o.defer(),n=r[0].createElement("script");return n.src=e,n.onload=function(e){a(function(){t.resolve(e)})},n.onerror=function(e){a(function(){t.reject(e)})},r[0].body.appendChild(n),(i[e]=t).promise},this.loadCSS=function(e){if(i[e])return i[e].promise;var t=o.defer(),n=r[0].createElement("link");return n.rel="stylesheet",n.type="text/css",n.href=e,n.onload=function(e){a(function(){t.resolve(e)})},n.onerror=function(e){a(function(){t.reject(e)})},r[0].head.appendChild(n),(i[e]=t).promise}}]);var uploadModule=angular.module("app.uploadService",[]);uploadModule.service("validateService",["$i18next",function(o){return{process:function(e,r){var t=_.map(e,function(t){var n={is_extension_valid:!1,is_size_valid:!0,error:null};(r.formats.forEach(function(e){if(t.type.match(e))n.is_extension_valid=!0;else{".".concat(/(?:\.([^.]+))?$/.exec(t.name)[1]).match(e)?n.is_extension_valid=!0:n.error=o.t("digitalProducts.fileExtensionNotSupported")}}),r.maxSize)&&((t.size/1024).toFixed(2)>r.maxSize&&(n.is_size_valid=!1,n.error="File size is too large. Please choose a file less than "+r.maxSize+"kb"));return n.is_valid=n.is_extension_valid&&n.is_size_valid,n});if(1===e.length)return t[0];var n=_.every(t,"is_valid");return{is_valid:n,error:n?null:"One of the files is not valid. Please review"}}}}]),uploadModule.directive("upload",["API","$timeout","validateService","$q","$http","Session","FileService","AmplitudeService",function(u,l,d,p,f,m,g,h){return{restrict:"AE",require:"ngModel",transclude:!0,replace:!0,templateUrl:"components/directives/upload.html",scope:{preset:"=",multiple:"=",ngModel:"=",onUpload:"&",required:"@?",buttonText:"="},link:function(a,e,t,i){var n,r,o,s=h.logEvent;a.uploader={id:uuidv4(),preset:(n=a.preset,r=m.get("account"),o={logo:{bucketName:"/integration-logos",formats:["image/*"],maxSize:512},image:{bucketName:"pstk-integration-docs",formats:["image/*"]},document:{bucketName:"pstk-integration-docs",formats:["image/*","application/pdf"]},csv:{bucketName:"pstk-integration-docs",formats:[".csv"]},paymentPageSEOImage:{bucketName:"/payment-page-url-previews",formats:["image/*"]},compliance:{bucketName:"compliance-docs/".concat(r.id),formats:["image/*","application/pdf"]}},o[n]||o.document),processing:!1,error:null,value:a.ngModel,progress:0,queue:[]};var c=p.defer();a.multiple&&(a.uploader.value=a.uploader.value||[]),a.$on("reset",function(){a.uploader.error=null,a.uploader.file=null}),a.$on("value",function(e,t){var n=d.process(t,a.uploader.preset);if(n.is_valid){if(a.uploader.progress=0,a.uploader.processing=!0,a.normalizeProgressBarMovement(),a.multiple)a.uploadMultiple(t);else{var r=t[0];a.fileName=r.name,a.uploadSingle(r)}a.$apply()}else a.showError(n.error)}),a.setProgressBar=function(e){a.uploader.progress=Math.max(a.uploader.progress,e)},a.normalizeProgressBarMovement=function(){var r=0;!function t(n){l(function(){if(!(95<r)){var e=10*Math.random();r+=e,r=Math.max(r,a.uploader.progress),a.setProgressBar(r),t(n+500)}},n)}(0)},a.uploadMultiple=function(e){var o=e.length;a.uploader.queue=[];Array.from(e).forEach(function(e){s("multiple-file-upload_upload-files",{uploadPreset:a.preset,state:"started"}),a.queueFile(e,function(e,t){var n,r;e?(s("multiple-file-upload_upload-files",{uploadPreset:a.preset,state:"failed"}),a.uploader.error="Some files could not be uploaded"):(s("multiple-file-upload_upload-files",{uploadPreset:a.preset,state:"succeeded"}),a.uploader.value.push({name:g.extractFileNameFromDocumentLocation(t.key),path:t.path}),i.$setViewValue(a.uploader.value)),n=a.uploader.queue.length,r=(o-n)/o*100,a.setProgressBar(r),n||(a.uploader.processing=!1)})})},a.remove=function(t){a.uploader.value=a.uploader.value.filter(function(e){return e!==t}),i.$setViewValue(a.uploader.value)},a.$watch("ngModel",function(e){a.uploader.value=a.multiple&&!e?[]:e}),a.uploadSingle=function(e){s("single-file-upload_upload-file",{uploadPreset:a.preset,state:"started"}),a.queueFile(e,function(e,t){a.uploader.processing=!1,e?(s("single-file-upload_upload-file",{uploadPreset:a.preset,state:"failed"}),a.showError(e.message),a.uploader.progress=0):(s("single-file-upload_upload-file",{uploadPreset:a.preset,state:"succeeded"}),a.uploader.progress=100,a.uploader.value=t.path,i.$setViewValue(t.path),a.onUpload&&a.onUpload())}),a.normalizeProgressBarMovement()},a.queueFile=function(n,r){a.uploader.queue=[].concat(_toConsumableArray(a.uploader.queue),[n]);var o=function(){a.uploader.queue=a.uploader.queue.filter(function(e){return e!==n})};u.all("upload_url").post({upload_path:a.uploader.preset.bucketName,upload_filename:n.name}).then(function(e){var t;t=e.data,f.put(t.signed_url,n,{headers:{"Content-Type":n.type}}).then(function(){o(),r(null,t)}).catch(function(e){o(),r(e,null)})}).catch(function(e){o(),r(e,null)})},a.cancel=function(){c.resolve(),l(function(){c=p.defer(),a.uploader.progress=0,a.uploader.processing=!1,a.uploader.queue=[]},0)},a.showError=function(e){l(function(){a.uploader.error=e},100)},a.getfileName=function(){if(!a.uploader.value)return null;if(a.fileName)return a.fileName;var e=_.last(a.uploader.value.split("/"));return decodeURI(e)}}}}]),uploadModule.directive("fileUploader",["$rootScope","$timeout","$q",function(i,s,c){return{restrict:"E",replace:!0,require:"ngModel",scope:{id:"=",preset:"=",multiple:"=",ngModel:"=",formField:"=",onUpload:"&",onDelete:"&"},template:'\n      <div class="c-uploader c-uploader--document">\n        <div class="c-uploader__preview">\n          <div class="c-uploader__document" ng-show="file.path" ng-repeat="file in uploader.value">\n            <div class="c-uploader__document-icon">\n                <i class="icon-doc"></i>\n            </div>\n            <div class="c-uploader__document-name text-ellipsis">{{file.userFileName || file.fileName || file.path}}</div>\n            <div class="c-uploader__document-link">\n                <a ng-href="{{file.url}}" rel="noreferrer" target="_blank">View</a>\n            </div>\n            <a data-testid="file-uploader-remove-button" ng-click="removeFile(file)" class="text-danger pull-right m-l" ng-if="multiple">\n              <i class="fa fa-minus-circle"></i>\n            </a>\n          </div>\n        </div>\n        <div class="c-uploader__body">\n          <div class="c-uploader__trigger">\n              <input required ng-if="multiple" multiple="true" class="c-uploader__input" id="{{uploader.id}}" accept="{{accept}}" type="file" placeholder="+ Change Files" file-pick />\n              <input required ng-if="!multiple" class="c-uploader__input" id="{{uploader.id}}" accept="{{accept}}" type="file" placeholder="+ Choose File" file-pick />\n              <label ng-if="multiple" for="{{uploader.id}}" class="c-uploader__label">{{ uploader.value.length === 0 ? \'+ Choose Files\' : \'+ Add Files\' }}</label>\n              <label ng-if="!multiple" for="{{uploader.id}}" class="c-uploader__label">+ Choose File</label>\n              <div class="c-uploader__progress" ng-if="uploader.processing">\n                  <div class="c-uploader__progress-level" ng-style="{ \'width\': uploader.progress + \'%\' }"></div>\n                  <a class="c-uploader__cancel" ng-click="cancel()" ng-if="uploader.progress < 100">Cancel</a>\n              </div>\n          </div>\n          <div class="c-uploader__message">\n              <span class="text-muted" ng-if="uploader.processing">\n                  Upload Progress: {{ uploader.progress | number:0 }}%\n              </span>\n              <span class="text-danger" ng-if="uploader.error">\n                  <i class="fa fa-warning m-r-xs"></i> {{ uploader.error }}\n              </span>\n          </div>\n        </div>\n      </div>\n    ',link:function(r,e,t,n){r.uploader={id:r.id||uuidv4(),value:r.ngModel,progress:0,error:null,processing:!1},r.accept={document:"image/*, application/pdf"}[r.preset];var o,a=c.defer();r.$on("value",function(e,t){!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5242880;return _toConsumableArray(e).some(function(e){return e.size>t})}(t)?(i.$emit("fileUploadQueue",t),i.$emit("deferFileUpload",a),r.uploader.processing=!0,r.normalizeProgressBarMovement(),r.onUpload&&r.onUpload()):r.uploader.error=r.multiple?"One or more files exceeds the maximum size limit of 5 MB":"File size exceeds 5 MB"}),r.cancel=function(){a.resolve(),s(function(){a=c.defer(),r.uploader.progress=0,r.uploader.processing=!1},0)},r.$on("fileUploaded".concat(r.id),function(e,t){t&&0!==t.length?r.uploader.value=t:r.uploader.error=r.multiple?"Some files could not be uploaded":"File could not be uploaded",n.$setViewValue(r.uploader.value),r.uploader.processing=!1}),r.$on("fileDeleted",function(e,t){r.uploader.value=r.uploader.value.filter(function(e){return e!==t})}),r.normalizeProgressBarMovement=function(){var n=0;s.cancel(o),(o=function(t){s(function(){if(!(95<n)){var e=10*Math.random();n+=e,n=Math.max(n,r.uploader.progress),r.uploader.progress=n,o(t+500)}},t)})(0)},r.removeFile=function(e){r.onDelete&&r.onDelete({file:e})},r.$on("reset",function(){r.uploader.value=[],r.uploader.progress=0,r.uploader.error=null}),n.$setValidity("fileUploader",!1),r.$watch("ngModel",function(){r.ngModel&&Array.isArray(r.ngModel)&&0<r.ngModel.length?(r.uploader.value=r.ngModel,n.$setViewValue(r.uploader.value),n.$setValidity("fileUploader",!0)):(n.$setValidity("fileUploader",!1),r.uploader.value=[])})}}}]),uploadModule.directive("filePick",function(){return function(t,e){e.bind("click",function(){e.val(null),t.$emit("reset")}),e.bind("change",function(e){t.$emit("value",e.target.files)})}}),angular.module("app.urlService",[]).service("URLService",["$stateParams","Session",function(i,s){var a={format:function(e,t){e=e||i;switch(_.contains(["today","week","month","30","90","year","all","custom"],e.period)||(e.period="30"),e.period){case"today":e={from:moment().startOf("day"),to:moment().endOf("day")};break;case"week":e={from:moment().startOf("week").startOf("day"),to:moment().endOf("day")};break;case"month":e={from:moment().startOf("month").startOf("day"),to:moment().endOf("day")};break;case"30":e={from:moment().subtract(29,"days").startOf("day"),to:moment().endOf("day")};break;case"90":e={from:moment().subtract(89,"days").startOf("day"),to:moment().endOf("day")};break;case"year":e={from:moment().startOf("year").startOf("day"),to:moment().endOf("day")};break;case"all":e={from:moment(s.get("account").createdAt),to:moment().endOf("day")};break;case"custom":e={from:moment(new Date(e.from)).startOf("day"),to:moment(new Date(e.to)).endOf("day")}}var n=moment.duration(e.to.diff(e.from)).asMonths(),r=moment.duration(e.to.diff(e.from)).asDays(),o=moment.duration(e.to.diff(e.from)).asHours(),a=moment.duration(e.to.diff(e.from)).asWeeks();return 90<r?(e.period="month",e.period_count=n.toFixed(2)):2<r&&r<=30?(e.period="day",e.period_count=r.toFixed(2)):30<r&&r<=90?(e.period="week",e.period_count=a.toFixed(2)):(e.period="hour",e.period_count=o.toFixed(2)),t||(e.from=e.from.format("l LT"),e.to=e.to.format("l LT")),e},formatMoment:function(e){return a.format(e,!0)},getDurations:function(e){var t=a.format(e,!0),n=[];do{var r=angular.copy(t.from).startOf(t.period);t.from.add(1,t.period);var o=angular.copy(r).endOf(t.period);o.isAfter(t.to)&&(o=t.to),n.push({from:r,to:o})}while(t.from.isBefore(t.to));return n},getQuery:function(){var e=angular.copy(i);if("today"===e.period&&(e.from=moment().startOf("day").format(),e.to=null),"day"===e.period){var t=new Date(e.for);e.from=moment(t).startOf("day").format(),e.to=moment(t).endOf("day").format()}if("range"===e.period){if(e.from){var n=new Date(e.from);e.from=moment(n).startOf("day").format()}if(e.to){var r=new Date(e.to);e.to=moment(r).endOf("day").format()}}return e}};return a}]);_excluded=["amount"];var _excluded2=["amount"];function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}angular.module("app.utilities",[]).service("utils",["$filter",function(t){var o=function(e){return"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1))};return{toKobo:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.amount,n=_objectWithoutProperties(e,_excluded);return _objectSpread(_objectSpread({},n),{},{amount:Math.round(100*t)})},toNaira:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.amount,n=_objectWithoutProperties(e,_excluded2);return _objectSpread(_objectSpread({},n),{},{amount:t/100})},currencyBaseUnitToSubUnit:function(e){return Math.round(100*e)},currencySubUnitToBaseUnit:function(e){return e/100},firstNthWords:function(e,t){return e.split(" ").slice(0,t).join(" ")},toTitleCase:function(e){return e&&"string"==typeof e?e.toLowerCase().trim().split(" ").reduce(function(e,t){return"".concat(e," ").concat(t[0]?t[0].toUpperCase():"").concat(t.substring(1,t.length))},""):null},format:function(e){return e?t("date")(new Date(e),"MM-dd-yyyy"):null},jsonParse:function(e,t){return"string"==typeof e&&e.trim()?JSON.parse(e):t},stripPropertiesWithoutValues:function(r){return Object.keys(r).reduce(function(e,t){var n=r[t];return n&&(e=_objectSpread(_objectSpread({},e),{},_defineProperty({},t,n))),e},{})},isEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},arrayIntersection:function(e,t){var n,r=new Set,o=new Set(e),a=_createForOfIteratorHelper(new Set(t));try{for(a.s();!(n=a.n()).done;){var i=n.value;o.has(i)&&r.add(i)}}catch(e){a.e(e)}finally{a.f()}return _toConsumableArray(r)},isObject:function(e){return e&&!Array.isArray(e)&&"object"===_typeof(e)},formatPhoneNumber:function(e,t){var n=this.isObject(e)?e.subscriber_number:e;if(n){return"".concat(t||""," ").concat(n.replace(/^(\d{3})(\d{3})(\d+)$/g,"$1 $2 $3"))}},compose:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}},composeAsync:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight(function(e,t){return e.then(t)},Promise.resolve(e))}},pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce(function(e,t){return t(e)},e)}},pipeAsync:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}},trace:function(){return function(e){return console.log({value:e}),e}},sideEffect:function(t){return function(e){return t(e),e}},capitalize:o,capitalizeObjectKeys:function(e){return Object.entries(e).map(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[o(n),r]}).reduce(function(e,t){var n=_slicedToArray(t,2),r=n[0],o=n[1];return e[r]=o,e},{})},concatenateObjectValues:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=angular.copy(e),t=Object.keys(n).reduce(function(e,t){return n[t]?_objectSpread(_objectSpread({},e),{},_defineProperty({},t,n[t])):e},{});return Object.values(t).join(", ")},getElementOffset:function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+r,left:t.left+n}},respondOnTimeout:function(e,t){var n=setTimeout(function(){e()},t);return{resolve:function(){clearTimeout(n)}}}}}]).filter("money",["$filter",function(r){return function(e,t){t=t?t+" ":"";var n=e?e/100:0;return r("currency")(n,t,2)}}]).filter("seconds",[function(){return function(e){return new Date(1970,0,1).setSeconds(e)}}]).filter("percentage",["$filter",function(n){return function(e,t){return n("number")(100*e,t)+"%"}}]);var zendeskModule=angular.module("app.zendeskService",[]);function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}zendeskModule.service("ZendeskService",["ZendeskAPI",function(r){return{zendeskDefaults:{webWidget:{color:{theme:"#1a3d5d"},offset:{horizontal:"-10px",vertical:"25px"},contactOptions:{enabled:!0,chatLabelOnline:{"*":"Live Chat"},chatLabelOffline:{"*":"Chat is unavailable"}},contactForm:{subject:!0}}},zendeskWebWidgets:{chat:{suppress:!0},contactForm:{suppress:!0},helpCenter:{suppress:!0},talk:{suppress:!0},answerBot:{suppress:!0}},openZendeskWidget:function(){window.zE("webWidget","open"),window.zE.activate()},selectZendeskWidget:function(e){var t=_objectSpread({},this.zendeskWebWidgets),n=(t[e],_objectWithoutProperties(t,[e].map(_toPropertyKey)));window.zE("webWidget","updateSettings",{webWidget:_objectSpread(_objectSpread({},n),{},_defineProperty({},e,{suppress:!1}))})},fetchArticleById:function(e){return r.one("help_center/articles/".concat(e,".json")).get().then(function(e){return e.article})},fetchTopArticles:function(){return r.one("help_center/articles.json").get({per_page:5}).then(function(e){return{data:e.articles,nextPage:e.next_page}})},fetchSearchedArticles:function(e){return r.one("help_center/articles/embeddable_search.json").get({per_page:5,query:e}).then(function(e){return{data:e.results,nextPage:e.next_page}})},fetchMoreArticles:function(e){return r.one((t=e,n="https://paystack.zendesk.com/api/v2/",t.startsWith(n)?t.split(n)[1].trim():t)).get().then(function(e){return e.results?{data:e.results,nextPage:e.next_page}:{data:e.articles,nextPage:e.next_page}});var t,n}}}]),UIDirectives.directive("announcements",["AmplitudeService","$rootScope","ngDialog","LocalService","$state",function(h,y,b,v,_){return{restrict:"AE",link:function(e){var n=v.get("shown_announcements",{parse:!0})||{},t=h.logEvent;e.logEvent=t;var r=y.Business,o=y.User,a=r.is_live&&r.agreements&&r.agreements.settlement_managed_account.visible&&r.agreements.settlement_managed_account.agreements&&!r.agreements.settlement_managed_account.agreements.length;e.userIntegrationsWithMFAEnforced=(o.integrations||[]).filter(function(e){var t=e.mfa;return t&&t.is_required});var i=e.userIntegrationsWithMFAEnforced.length&&!o.mfa_enabled&&!_.params.toggle_mfa,s=[{name:"Welcome",template:"modules/setup/welcome.html",isActive:!r.is_live,isPersistent:!0},{name:"DedicatedNuban",template:"modules/customers/modals/dedicated-nuban-announcement.html",isActive:!1},{name:"Consent",template:"components/modals/consent-announcement.html",isActive:a},{name:"EnableMFA",template:"components/modals/enable-mfa-for-defaulting-user.html",className:"ngdialog-theme-plain dialog-close-center-icon",isActive:i,isPersistent:!0,controller:["$scope",function(e){e.showBusinesses=!1,e.toggleShowBusinesses=function(){e.showBusinesses=!e.showBusinesses}}]}],c=Object.keys(n).reduce(function(e,t){return s.find(function(e){return e.name===t})&&(e=_objectSpread(_objectSpread({},e),{},_defineProperty({},t,n[t]))),e},{}),u=s.filter(function(e){var t=e.isActive,n=e.name;return t&&!c[n]})[0];if(u){var l=u.name,d=u.template,p=u.controller,f=u.showClose,m=void 0===f||f,g=u.className;t("Shown announcement",{name:l}),b.openConfirm(_objectSpread(_objectSpread({template:d,showClose:m,scope:e},g&&{className:g}),p&&{controller:p})).then(function(e){t("Dismissed announcement",{name:l,action:e})},function(){t("Dismissed announcement",{name:l})}).finally(function(){c[l]=!0,v.set("shown_announcements",c)})}y.$on("sessionEnded",function(){s.filter(function(e){return e.isPersistent}).forEach(function(e){var t=e.name;c[t]&&(c[t]=!1,v.set("shown_announcements",c))})})}}}]),UIDirectives.directive("warningBanner",["AmplitudeService","$rootScope","$state","PendingDisputes","SettlementAccountData",function(m,g,h,y,e){return{restrict:"AE",replace:!0,template:'\n      <a\n        ng-if="banner"\n        class="banner alert alert-danger text-center block"\n        ng-click="click(banner)"\n        uib-tooltip="{{banner.tooltip}}"\n        tooltip-placement="bottom"\n        data-testid="warningBanner"\n      >\n        <span ng-switch="banner.priority" class="m-r-xs">\n          <i ng-switch-when="3" class="fa fa-ban" />\n          <i ng-switch-when="2" class="fa fa-warning" />\n          <i ng-switch-default class="fa fa-info" />\n        </span>\n        <span data-testid="warningBannerText">\n          {{banner.text}}\n        </span>\n      </a>\n    ',link:function(t){var n,r=g.Business,o=g.User,i=m.logEvent,a=1,s=2,c=3,e=[],u=function(){return y.fetch().then(function(){n=y.meta.total}).catch(function(){})};e.push(u()),g.$on("$stateChangeStart",function(){return u()});var l=r.is_disabled&&"INCOMPLETE_COMPLIANCE_DOCUMENTS"===r.disable_reason,d=r.payouts_on_hold&&"INCOMPLETE_COMPLIANCE_DOCUMENTS"===r.payouts_on_hold_reason,p=r.is_disabled&&!l;Promise.all(e).then(function(){return f()}).catch(function(){}),g.$on("sessionUpdated",function(){f()});var f=function(){var e=[{active:l,text:"Your payments have been temporarily deactivated because you've not provided some of your KYC documents. Kindly click on 'Compliance' to submit them & get reactivated.",link:{to:"app.compliance"},priority:c},{active:p,text:"Payments are currently disabled for this business",tooltip:r.disable_reason,priority:c},{active:!1,text:"Payouts are currently disabled for this business",tooltip:r.payouts_on_hold_reason,priority:a},{active:n,text:"Please resolve pending transaction disputes",link:{to:"transactions.disputes"},priority:s},{active:d,text:"Payouts on Hold. Please update compliance documents for this business",link:{to:"app.compliance"},priority:s},{active:r.is_live&&r.agreements&&r.agreements.settlement_managed_account&&r.agreements.settlement_managed_account.visible&&r.agreements.settlement_managed_account.agreements&&!r.agreements.settlement_managed_account.agreements.length,text:"Click here to sign the consent letter",link:{to:"app.consent",params:{type:"settlement_managed_account",referrer:"manual_settlement"}},priority:s},{active:!o.mfa_enabled&&r.attributes.mfa_is_required,text:"This business requires you to enable 2FA on your account",link:{to:"app.settings"},priority:s},{active:!o.mfa_enabled&&!r.attributes.mfa_is_required,text:"Setup 2FA to further protect your account",link:{to:"app.settings"},priority:s}].filter(function(e){return e.active}).sort(function(e,t){return t.priority-e.priority});t.banner=e.length&&e[0],g.bannerIsVisible=Boolean(t.banner)};g.$on("$stateChangeSuccess",function(){return f()}),t.click=function(e){i("Clicked warning banner",{banner:e});var t=e.articleId,n=e.link;if(n){var r=n.to,o=n.params,a=void 0===o?{}:o;h.go(r,a)}else t&&g.openHelpDesk({id:t})}}}}]),UIDirectives.filter("capitalize",function(){return function(e){if(!e)return null;var t=e.toString().replace(/\s\s+/g," "),n=new RegExp("".concat("(^\\w{1})","|").concat("(\\s{1}\\w{1})","|").concat("(-{1}\\w{1})"),"g");return t.toLowerCase().replace(n,function(e){return e.toUpperCase()})}}),function(){function e(e,t,n){_.has(n,["ngDisabled","disabled"])&&(t.on("click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t.hasClass("button-disabled")||(t.addClass("button-disabled"),t.attr("disabled","true")))}UIDirectives.directive("psButton",function(){return{restrict:"E",templateUrl:"components/directives/button/button.html",replace:!0,transclude:!0,link:e}})}(),UIDirectives.directive("changelog",function(){return{restrict:"A",link:function(e,t,n,r){if(!window.HW_config){window.HW_config={selector:".changelog",account:"07qAN7",translations:{title:"What we've been up to",readMore:"Read more"}};var o=document.createElement("script");o.src="//cdn.headwayapp.co/widget.js",document.body.appendChild(o)}}}}),UIDirectives.directive("badge",function(){return{restrict:"E",replace:!0,template:'<span class="badge text-white text-capitalize" ng-class="labelClass">{{status.replace("-", " ")}}</span>',link:function(e,t,n,r){e.status=n.status?n.status.toLowerCase():"Unknown",e.labelClass=n.class||"";["verified","paid","active","success","subscribed","approved","complete","processed","available"].includes(e.status)?e.labelClass+=" btn-success":["failed","unpaid","inactive","unverified","unsubscribed","expired","archived","overdue"].includes(e.status)?e.labelClass+=" btn-danger":["reversed"].includes(e.status)?e.labelClass+=" btn-primary":["reversal-pending","processing"].includes(e.status)?e.labelClass+=" btn-warning-v2":["out of stock","pending"].includes(e.status)?e.labelClass+=" btn-muted":e.labelClass+=" btn-info"}}});_excluded=["next","previous"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}UIDirectives.directive("checkNewRecords",["AmplitudeService","$state","$rootScope","$interval",function(u,l,e,t){return{restrict:"E",replace:!0,scope:{label:"@",visible:"=",interval:"=",onInterval:"&",onClick:"&"},template:'\n    <div class="flex flex-justify--center">\n      <a class="button button--primary animated slideInDown m-t-sm m-b-sm" ui-sref="{{ newSref }}" ui-sref-opts="{ inherit: false }" ng-click="onClickHandler($event)" ng-if="visible">\n        <i class="fa fa-refresh m-r-sm"></i>\n        <span ng-if-"label">{{ label }}</span>\n        <span ng-if="!label">{{ \'pagination.reloadForNewRecords\' | i18next }}</span>\n      </a>\n    </div>\n  ',link:function(t,e,n){var r=u.logEvent,o=l.params,a=(o.next,o.previous,_objectWithoutProperties(o,_excluded)),i=function(e){return moment(new Date(e)).isSame(moment(),"day")},s=a.from||a.to||a.for,c=i(a.from)||i(a.to)||i(a.for);s&&!c||(t.newSref="".concat(l.current.name,"(").concat(JSON.stringify(a),")"),t.onClickHandler=function(e){e.metaKey||(e.preventDefault(),r("Used Load new button"),t.onClick())})}}}]),UIDirectives.directive("export",["API","Notification","AmplitudeService",function(c,u,l){return{restrict:"A",scope:{model:"=exportModel",api:"=exportApi",from:"=exportFrom",to:"=exportTo",status:"=exportStatus",page:"=exportPage",payment_page:"=exportPaymentPage",invoice:"=exportInvoice",settlement:"=exportSettlement",subaccount_settlement:"=exportSubaccountSettlement",amount:"=exportAmount",recipient:"=exportRecipient",error:"=exportError",exportSuccessCallback:"=exportSuccessCallback",subaccount:"=exportSubaccount",currency:"=exportCurrency",channel:"=exportChannel",customer:"=exportCustomer",timeout:"=exportTimeout",type:"=exportType",category:"=exportCategory",limit:"=exportLimit",limit_type:"=exportLimitType",exportScope:"=exportScope"},link:function(r,o,e,t){var a=l.logEvent;r.logEvent=a;var i=r.model||"transaction",n=r.api?c.one(r.api):c.one(i,"export");r.timeout&&(n=n.withHttpConfig({timeout:r.timeout}));var s={from:r.from,to:r.to,settlement:r.settlement,subaccount_settlement:r.subaccount_settlement,status:r.status,payment_page:r.payment_page,payment_request:r.invoice,amount:r.amount,recipient:r.recipient,error:r.error,subaccount:r.subaccount,currency:r.currency,channel:r.channel,customer:r.customer,page:r.page,type:r.type,model:r.model,category:r.category,limit:r.limit,limit_type:r.limit_type};"transaction statement"===r.exportScope&&(s.use_ledger=!0),s=_.pick(s,_.identity),HTMLElement.prototype.click=function(){var e=this.ownerDocument.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,this.ownerDocument.defaultView,1,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(e)},o.on("click",function(){a("Data Export started",{model:i}),o.attr("disabled",!0).addClass("disabled"),n.get(s).then(function(e){var t=document.createElement("a"),n=r.exportSuccessCallback;t.download=name,t.href=e.data.path,t.click(),o.attr("disabled",!1).removeClass("disabled"),a("Data Export completed",{model:i}),n&&"function"==typeof n&&n()}).catch(function(e){var t=e&&0===e.status;a("Data Export failed",{model:i,errorStatus:e&&e.status,errorMessage:t?"Export timed out":e&&e.data&&e.data.message}),"transaction"===i&&t?u.error("Export timed out",'Your download is taking longer than usual - please use the "Send CSV to email" option'):u.error("Error exporting data",e),o.attr("disabled",!1).removeClass("disabled")})})}}}]),UIDirectives.directive("loadMoreRecords",["AmplitudeService","$state",function(o,a){return{restrict:"E",replace:!0,scope:{pageCount:"=",perPage:"=",nextCursor:"=",recordCount:"=",onClick:"&",disabled:"="},template:'\n    <div class="flex flex-align--center" data-testid="load-more-records">\n      <div class="flex-item--fill">1 <span ng-if="lastRecord > 1">- {{ lastRecord }}</span></div>\n      <div class="flex-item--fill text-center">\n        <a class="button" ui-sref="{{ nextPageSref }}" ng-click="onClickHandler($event)" ng-if="nextCursor" ng-class="{disabled: disabled}">\n          <span ng-if="loading">{{ \'pagination.loading\' | i18next }}</span>\n          <span ng-if="!loading">{{ \'pagination.loadMoreRecords\' | i18next }}</span>\n        </a>\n      </div>\n      <div class="flex-item--fill text-right">\n        <span ng-if="!recordCount">{{ \'pagination.countingRecords\' | i18next }}</span>\n        <span ng-if="recordCount" ng-i18next="[html:i18next]({ count: recordCount })pagination.recordCount"></span>\n      </div>\n    </div>\n  ',link:function(t){var n=o.logEvent,r=function(){var e=parseInt(t.pageCount||1,10)*parseInt(t.perPage||50,10);t.lastRecord=t.total?Math.min(e,t.total):e},e=JSON.stringify(_objectSpread(_objectSpread({},a.params),{},{next:t.nextCursor}));t.nextPageSref="".concat(a.current.name,"(").concat(e,")"),t.$watch("total",function(){return r()}),t.$watch("pageCount",function(){return r()}),t.onClickHandler=function(e){n("Used Load more button"),e.metaKey||(e.preventDefault(),t.loading=!0,t.onClick().then(function(){r(),t.loading=!1}))}}}}]),UIDirectives.directive("noData",function(){return{restrict:"E",scope:{show:"=",showDescription:"=",mainText:"@",description:"@",imageSrc:"@",imageAlt:"@"},template:'\n      <div class="no-data text-center" ng-show="show">\n        <div class="m-b-md"><img ng-src="{{src}}" alt="{{alt}}"></div>\n        <h3 class="m-t-none">{{mainText}}</h3>\n        <p ng-show="showDescriptionText">{{description}}</p>\n      </div>\n    ',link:function(e,t,n,r){e.src=e.imageSrc||"assets/img/empty.svg",e.alt=e.imageAlt||"Empty Folder",e.showDescriptionText=void 0===e.showDescription||e.showDescription}}}),UIDirectives.directive("pageBookmark",["$rootScope",function(o){return{restrict:"E",replace:!0,scope:{page:"=",perPage:"=",recordCount:"="},template:'\n    <div class="page-bookmark" id="pageBookmark-{{page}}">\n      <div class="flex flex-align--center flex-justify--center">\n        <button class="button-icon" ng-click="scrollTo(\'previous\')">\n          <img src="assets/svg/16/arrow-up.svg" />\n        </button>\n        <div class="m-l-sm m-r-sm">\n          {{ first  }} - {{ last }}\n        </div>\n        <button class="button-icon" ng-click="scrollTo(\'next\')">\n          <img src="assets/svg/16/arrow-down.svg" />\n        </button>\n      </div>\n    </div>\n  ',link:function(r){var e=function(){var e=r.page*r.perPage,t=r.recordCount||0;r.last=Math.min(e,t),r.first=e-r.perPage+1};e(),r.$watch("total",function(){return e()}),r.scrollTo=function(e){var t="previous"===e?r.page-1:r.page+1,n=document.querySelector("#pageBookmark-".concat(t));o.$broadcast("scrollToPosition",{position:{previous:"top",next:"bottom"}[e],element:n})}}}}]),UIDirectives.directive("scrollToPosition",["$rootScope",function(n){return{restrict:"A",scope:{shiftJump:"=",shiftJumpDistance:"="},compile:function(e,t){return e.attr("id","scrollToPosition"),function(o){var a=function(){return document.querySelector("#scrollToPosition")};if(n.$on("scrollToPosition",function(e,t){var n=t.position,r=t.element;r?r.scrollIntoView({block:"center"}):"top"===n?a().scrollTop=0:"bottom"===n&&(a().scrollTop=a().scrollHeight)}),t.shiftJump&&a()){var e=function(e){if(e.shiftKey&&"ArrowUp"===e.key){var t=a().scrollTop-o.shiftJumpDistance;a().scrollTop=Math.max(t,0)}if(e.shiftKey&&"ArrowDown"===e.key){var n=a().scrollHeight,r=a().scrollTop+o.shiftJumpDistance;a().scrollTop=Math.min(n,r)}};document.addEventListener("keydown",e),n.$on("stateChangeStart",function(){document.removeEventListener("keydown",e)})}}}}}]),UIDirectives.directive("status",function(){return{restrict:"A",link:function(e,t,n){var r=n.status?n.status.toLowerCase():"Unknown";[!0,"verified","paid","active","success","subscribed","approved","complete","resolved","processed"].includes(r)?t.addClass("text-success"):[!1,"failed","unpaid","inactive","unverified","unsubscribed","expired","archived","overdue","reversed","cancelled"].includes(r)?t.addClass("text-danger"):["reversal-pending","processing","pending_update","pending_cancellation"].includes(r)?t.addClass("text-warning-v2"):t.addClass("text-muted")}}}),UIDirectives.directive("tableLink",function(){return{restrict:"A",scope:!0,compile:function(e,t){var r=t.tableLink;r&&(Array.from(e.find("td")).forEach(function(e){var t=angular.element(e);if(!t.hasClass("link-disabled")){var n=t.html();t.html('<a class="table-link" ui-sref="'.concat(r,'"></a>').concat(n))}}),e.addClass("is-clickable"));e.removeAttr("table-link")}}}),UIDirectives.directive("device",["DeviceService",function(n){return{restrict:"E",scope:!0,template:"<span>{{ platform }}</span>",link:function(e){var t=n.platform;e.platform=t}}}]),UIDirectives.directive("dropdownList",[function(){return{restrict:"E",scope:{listData:"=",listTextKey:"@",listSubTextKey:"@",onClickOutside:"&",onClickListItem:"=onClickListItem"},template:'\n    <div class="dropdown-list">\n      <ul click-outside="onClickOutside()">\n        <li class="flex" data-testid="dropdown-list-{{listItem.id}}" ng-repeat="listItem in listData" ng-click="onClickListItem(listItem)">\n            <div class="flex-item--fill">\n              <p class="text-bold m-b-none"> {{ listItem[listTextKey] }} </p>\n              <p class="text-muted-new m-b-none">{{ listItem[listSubTextKey] }}</p>\n            </div>\n            <div style="width: 25px;" class="flex flex-justify--center flex-align--center">\n              <p class="text-muted-new text-md m-b-none">\n                <svg width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 1v10M1 6h10" stroke="#C1C1C1" stroke-linecap="round" stroke-linejoin="round"></path></svg>\n              </p>\n            </div>\n        </li>\n      </ul>\n    </div>\n    '}}]),UIDirectives.directive("setWidth",[function(){return{restrict:"A",link:function(e,t,n){var r=JSON.parse(n.setWidth)||[],o=_.max(r,function(e){return e?e.length:0});o&&25<o.length&&t.css("width","auto")}}}]),UIDirectives.directive("checkFeatureFlag",["Session",function(r){return{restrict:"A",compile:function(e,t){return function(e,t,n){r.get("features")[n.checkFeatureFlag]||t.remove()}}}}]),UIDirectives.directive("addressInput",["Addresses","$rootScope",function(i,s){return{restrict:"AE",scope:{address:"=",country:"@"},template:'\n      <div>\n          <select name="country" class="form-control select-form-caret"\n              ng-options="country for country in countries track by country"\n              ng-model="address.country" data-testid="office-address-country"\n              ng-change="fetchStates()" required>\n          </select>\n          <input type="text" placeholder="{{\'address.street\' | i18next}}" data-testid="office-address-street"\n              class="form-control m-t-sm" ng-model="address.street_line_one" required>\n          <input type="text" placeholder="{{\'address.building\' | i18next}}" ng-model="address.street_line_two"\n              class="form-control m-t-sm">\n          <div class="row m-t-sm">\n              <div class="col-xs-6 padder-right-xs">\n                  <input type="text" placeholder="{{\'address.city\' | i18next}}" data-testid="office-address-city" ng-model="address.city" class="form-control" required>\n              </div>\n              <div class="col-xs-6 padder-left-xs">\n                  <input type="text" placeholder="{{\'address.postcode\' | i18next}}" ng-model="address.post_code" class="form-control">\n              </div>\n          </div>\n          <select name="state" class="form-control select-form-caret m-t-sm"\n            ng-model="address.state" data-testid="office-address-state"\n            ng-options="state for state in states track by state"\n            ng-required="states.length">\n          </select>\n      </div>\n    ',link:function(n,e,t,r){var o=s.currentSession.account.attributes.country,a=o&&"NG"===o.iso_code;n.fetchStates=function(e){var t=e||n.address.country;i.fetchStates(t).then(function(e){n.states=e.map(function(e){return e.name})}).catch(function(){n.states=[]})},n.country&&(n.address.country=n.country,n.fetchStates(n.country)),i.fetchCountries().then(function(e){return n.countries=a?["Nigeria"]:e.map(function(e){return e.name}),n.fetchStates()}).catch(function(){n.states=[]})}}}]),UIDirectives.directive("customFields",[function(){return{restrict:"E",scope:{customFields:"="},template:'\n      <div class="wrapper b-a r pos-rlt custom-fields m-b-sm" ng-repeat="field in customFields">\n        <div class="close-button" style="top: -10px; right: -6px" ng-click="removeField($index)" ng-if="customFields.length > 1">\n            <i class="fa fa-times-circle fa-2x"></i>\n        </div>\n        <span class="field m-b-xs">\n          <div class="single-select select-xs" style="width: 60%">\n            <select ng-model="field.type" class="form-control text-xs select">\n              <option value="" disabled>Field type</option>\n              <option value="text">Text field</option>\n              <option value="dropdown">Dropdown</option>\n              <option value="checkbox">Checkboxes</option>\n            </select>\n          </div>\n          <input type="text" class="form-control input" ng-model="field.display_name" placeholder="Field name">\n        </span>\n        <p class="m-b-sm info" ng-if="field.type === \'checkbox\'">Your customers will be able to choose <b>one or more</b> of the options you add below</p>\n        <p class="m-b-sm info" ng-if="field.type === \'dropdown\'">Your customers will be able to choose any <b>one</b> of the options you add below</p>\n        <div class="input-group m-b-xs" style="height: 28px" ng-repeat="option in field.options">\n          <span class="input-group-addon option-id">Option {{option.id}}</span>\n          <input id="slug" type="text" class="form-control" style="cursor: default; background: white; height: 29px" ng-model="field.options[$index].value">\n          <a class="input-group-addon clickable" ng-click="removeOption($parent.$index, $index)"><i class="fa fa-times"></i></a>\n        </div>\n        <div class="m-b-md" ng-if="[\'checkbox\', \'dropdown\'].includes(field.type)">\n          <a class="text-primary text-xs text-muted" ng-click="addOption($index)"><i class="fa fa-plus m-r-xs"></i> {{field.options.length >= 1 ? \'Add another option\': \'Add an option\'}}</a>\n        </div>\n        <label class="select-label">\n          <input type="checkbox" ng-model="field.required"> <span class="text-xs">This field is required<span/>\n        </label>\n      </div>\n      <div class="clear text-center text-xs">\n        <a class="text-primary text-sm" ng-click="addField()"><i class="fa fa-plus m-r-xs"></i> Add Another Field</a>\n      </div>      ',link:function(n,e,t,r){n.addField=function(){n.customFields.push({display_name:"",options:[],required:!1})},n.removeField=function(e){1<n.customFields.length&&n.customFields.splice(e,1)},n.addOption=function(e){var t=n.customFields[e].options;t.push({id:t.length+1})},n.removeOption=function(e,t){n.customFields[e].options.splice(t,1)},n.onTypeChange=function(e,t){n.customFields[t].options=[],["checkbox","dropdown"].includes(e)&&n.customFields[t].options.push({id:1,value:""})}}}}]),UIDirectives.directive("customSelect",[function(){return{restrict:"E",scope:{dropDownData:"=",displayField:"@",selectField:"@",ngModel:"=",onOptionChange:"&",placeholder:"@",required:"="},template:'\n      <div class="custom-dropdown-input">\n        <div\n          data-dropdown-group\n          uib-dropdown \n          uib-keyboard-nav\n          is-open="showDropdownInput"\n          on-toggle="handleDropdownToggle(open)"\n        >\n          <button\n            type="button"\n            uib-dropdown-toggle\n            class="flex flex-justify--space-between flex-align--center w-full bg-white form-control"\n            aria-haspopup="true"\n            aria-expanded="false"\n          >\n            <span>{{selectedItem ? selectedItem[displayField]: \'Choose an option\'}}</span>\n            <span class="caret" ng-style="{\'transform\': showDropdownInput ? \'rotate(180deg)\': \'rotate(0deg)\'}"></span>\n          </button>\n          <div class="search-container" ng-show="showDropdownInput" ng-click="preventClickPropagation($event)">\n            <input\n              class="form-control input-v2"\n              ng-model="searchValue"\n              ng-blur="handleBlur($event)"\n              type="text"\n              autocomplete="off"\n              placeholder="{{placeholder || defaultPlaceholder}}"\n              data-dropdown-input\n            />\n            <span class="no-bg search-icon">\n              <i class="icon-magnifier text-xs m-t-xxs text-muted"></i>\n            </span>\n          </div>\n          <div class="no-arrow" uib-dropdown-menu ng-if="dropDownData && dropDownData.length">\n              <ul class="searched-item padder">\n                <li class="list-unstyled item-container" role="menuitem" ng-repeat="item in dropDownData | filter: searchValue ">\n                  <a ng-click="handleOptionSelect(item)" class="flex flex-justify--space-between m-t-xs m-b-xs">\n                    <span class="flex-item--fill flex item-name">\n                      {{item[displayField]}}\n                    </span>\n                  </a>\n                </li>\n              </ul>\n            <div class="text-muted padder padder-v-sm" ng-if="!dropDownData || dropDownData.length === 0"> No options available</div>\n          </div>\n        </div>\n    </div>\n    ',link:function(n,r){n.defaultPlaceholder="Loading...",n.preventClickPropagation=function(e){e.preventDefault(),e.stopPropagation()};n.handleDropdownToggle=function(e){var t;e&&(t=angular.element(r[0].querySelector("[data-dropdown-input]"))[0])&&t.focus()};var o=function(e,t){return e&&t&&e.toString()===t.toString()};n.setSelection=function(e){n.ngModel===e[n.selectField]?t(n.ngModel):n.ngModel=e[n.selectField],n.selectedItem=e,n.searchValue=""};var t=function(t){if(""===t)n.selectedItem=null;else{var e=n.dropDownData&&n.dropDownData.find(function(e){return o(e[n.selectField],t)});e&&(n.searchValue=e[n.displayField||n.selectField])}};n.selectActiveDropdownItem=function(){var e=n.dropDownData&&n.dropDownData.find(function(e){return o(e[n.displayField],n.ngModel)||o(e[n.selectField],n.ngModel)});e&&n.setSelection(e)},n.handleOptionSelect=function(e){n.onOptionChange&&n.onOptionChange(e),n.setSelection(e)},n.handleBlur=function(e){var t=angular.element(r[0].querySelector("[data-dropdown-group]"))[0];t&&(null!=e.relatedTarget&&!t.contains(e.relatedTarget)&&(n.showDropdownInput=!1))},n.ngModel&&n.selectActiveDropdownItem(),n.$watch("dropDownData",function(e){null!==e&&(n.defaultPlaceholder="Search",t(n.ngModel)),n.ngModel&&n.selectActiveDropdownItem()}),n.toggleDropdown=function(){n.showDropdownInput=!n.showDropdownInput}}}}]),UIDirectives.directive("dateInput",[function(){return{restrict:"E",scope:{ngModel:"=",dateFormat:"@",form:"=?",maximumYear:"=",required:"="},template:'\n        <div class="dateInput form-validation">\n          <form name="dateForm">\n            <select class="form-control select-v2 select-v2-plain m-r-md" ng-model="months"\n              ng-options="month.value as month.name for month in allMonths" ng-required="required">\n              <option value="" disabled></option>\n            </select>\n            <input min="1" max="{{maximumNumberOfDaysInAMonth}}" class="form-control input-v2 m-r-md" type="number" ng-model="date" placeholder="Day"\n            name="date" ng-required="required">\n            <input min="1900" max="{{maximumYear}}" class="form-control input-v2" type="number" ng-model="years" placeholder="Year"\n            name="years" ng-required="required">\n          </form>\n        </div>\n      ',link:function(u){var l=function(e,t){return new Date(t,e+1,0).getDate()},e=function(){if(u.ngModel){var e=moment(u.ngModel,"YYYY-MM-DD").toObject(),t=e.years,n=e.months,r=e.date;u.years=t,u.months=n,u.date=r,u.maximumNumberOfDaysInAMonth=l(n,t)}};u.$watch("ngModel",function(){e()}),e();var t=function(e){var t={date:u.maximumNumberOfDaysInAMonth,years:u.maximumYear};u[e]>t[e]?u.form[e].$setValidity("required",!1):u.form[e].$setValidity("required",!0)},n=function(e,t){u.localDate||(u.localDate={}),u.localDate[e]=t;var n,r,o,a=u.localDate,i=a.date,s=a.months,c=a.years;(s||0===s)&&c&&(u.maximumNumberOfDaysInAMonth=l(s,c)),i&&(s||0===s)&&c&&(n=i,r=s,o=c,u.dateFormat?u.ngModel=moment({years:o,date:n,months:r}).format(u.dateFormat):u.ngModel=new Date(o,r,n))};u.$watch("months",function(e){(e||0===e)&&n("months",e)}),u.$watch("date",function(e){e&&(n("date",e),t("date"))}),u.$watch("years",function(e){e&&(n("years",e),t("years"))}),u.allMonths=[{value:0,name:"Jan"},{value:1,name:"Feb"},{value:2,name:"Mar"},{value:3,name:"Apr"},{value:4,name:"May"},{value:5,name:"Jun"},{value:6,name:"Jul"},{value:7,name:"Aug"},{value:8,name:"Sep"},{value:9,name:"Oct"},{value:10,name:"Nov"},{value:11,name:"Dec"}]}}}]),UIDirectives.directive("fileread",["$rootScope",function(r){return{link:function(e,t,n){t.bind("change",function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;r.$broadcast("uploaded_"+n.fileread,t)},t.readAsText(e.target.files[0])}),e.$watch(n.fileread,function(e){e||t.val("")})}}}]),UIDirectives.directive("focusIf",["$timeout",function(a){return{restrict:"A",link:function(t,e,n){var r=e[0];function o(e){e&&a(function(){r.focus()},t.$eval(n.focusDelay)||0)}n.focusIf?t.$watch(n.focusIf,o):o(!0)}}}]),UIDirectives.directive("multipleInput",["$timeout",function(o){return{restrict:"E",scope:{emails:"=model",placeholder:"@",type:"@",validationErrorMessage:"@"},template:'\n      <div class="m-t-sm multiple_input">\n          <div class="inner-addon right-addon m-b-xs" ng-repeat="datum in data track by $index" ng-class="{multiple_input_duplicate: $index === duplicate}">\n              <i class="icon fa fa-times text-muted clickable" ng-click="removeData($index)"></i>\n              <input type="{{type}}" class="form-control" ng-model="datum" ng-change="updateData(datum, $index)"/>\n          </div>\n          <div class="inner-addon right-addon" ng-class="{multiple_input_fade: fadeInput, multiple_input_error: foundDuplicate}">\n              <i class="icon fa fa-plus text-muted clickable" ng-click="addData(newData)"></i>\n              <input id="multiple_input_last_child" type="{{type}}" class="form-control" ng-model="newData" placeholder="{{inputPlaceholder}}" ng-focus="addFadeClass(\'focus\')" ng-blur="addFadeClass(\'blur\')" ng-change="clearValidationError()"/>\n              <p ng-if="foundDuplicate" class="multiple_input_validation_error">{{validationErrorMessage}}</p>\n          </div>\n      </div>\n    ',link:function(r,e,t,n){r.data=[],r.foundDuplicate=!1,r.inputPlaceholder=0<r.data.length?"Add another value":r.placeholder,r.addData=function(t){if(t){if(r.data.includes(t))return r.foundDuplicate=!0,void(r.duplicate=r.data.findIndex(function(e){return e===t}));r.data.push(t),r.newData=null,r.$broadcast("dataUpdated")}},r.removeData=function(e){r.data.splice(e,1),r.$broadcast("dataUpdated")},r.addFadeClass=function(e){r.fadeInput="focus"!==e&&0<r.data.length},r.updateData=function(e,t){var n=document.getElementById("multiple_input_last_child");r.removeData(t),r.newData=e,r.foundDuplicate=!1,r.duplicate=null,o(function(){n.focus()})},r.clearValidationError=function(){r.foundDuplicate=!1,r.duplicate=null},r.$on("dataUpdated",function(){r.inputPlaceholder=0<r.data.length?"Add another value":r.placeholder,r.addFadeClass()}),r.addFadeClass()}}}]),UIDirectives.directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){e.$watch(n.ngMin,function(){r.$setViewValue(r.$viewValue)});var o=function(e){var t=parseFloat(n.ngMin)||0;return null!=e&&parseFloat(e.replace(/,/g,""))<t?void r.$setValidity("ngMin",!1):(r.$setValidity("ngMin",!0),e)};r.$parsers.unshift(o),r.$formatters.unshift(o)}}}),UIDirectives.directive("onlyDigits",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,r){r.$parsers.push(function(e){if(null==e)return"";var t=e.replace(/[^0-9\-\+]/g,"");return t!==e&&(r.$setViewValue(t),r.$render()),t})}}}),UIDirectives.directive("phoneCodeDropdown",["CountryService","$timeout",function(r,o){return{restrict:"E",scope:{callingCode:"=?"},template:'\n    <form>\n    <div class="phone-code-input" uib-dropdown auto-close="outsideClick" is-open="isDropdownOpen">\n      <div role="menu" uib-dropdown-menu class="dropdown-menu-left phone-code-input-menu no-arrow">\n        <div class="padder padder-v-sm">\n          <div class="search-container">\n            <input id="countrySearch" class="form-control no-border input-v2" ng-model="searchCountries" type="text" placeholder="Search country" />\n            <span class="no-bg search-icon">\n              <i class="icon-magnifier text-xs m-t-xxs text-muted"></i>\n            </span>\n          </div>\n          <div class="searched-item">\n            <li class="list-unstyled item-container" ng-style="{\'border-bottom\': $last ? \'0px\': \'\'}" ng-repeat="country in countries | filter: searchCountries">\n              <a ng-click="setActiveCountry(country)" class="flex flex-justify--space-between m-t-xs m-b-xs">\n                <span class="flex-item--fill flex item-name">\n                  {{country.name}}\n                </span>\n                <span class="text-muted item-info"> {{country.callingCodes[0]}} </span>\n              </a>\n            </li>\n          </div>\n        </div>\n      </div>\n      <span class="field">\n        <div class="country-dropdown">\n          <div data-testid="phone-number-toggle" class="flex flex-align--center" style="padding: 0 12px;" uib-dropdown-toggle aria-haspopup="true" aria-expanded="true">\n            <span>{{callingCode}}</span>\n            <span class="caret"></span>\n          </div>\n        </div>\n      </span>\n    </div>\n    </form>\n    ',link:function(t){t.isDropdownOpen=!1,t.setActiveCountry=function(e){e&&(t.activeCountry=e,t.isDropdownOpen=!1,t.callingCode=e.callingCodes[0])},t.$watch("isDropdownOpen",function(e){e&&o(function(){var e=document.getElementById("countrySearch");e&&e.focus()})});var n=["NG","GH","ZA"];r.getCountries().then(function(e){t.countries=e.reduce(function(e,t){return n.includes(t.countryCode)?[t].concat(_toConsumableArray(e)):[].concat(_toConsumableArray(e),[t])},[]),t.$watch("callingCode",function(e){t.setActiveCountry(r.getCountryByCallingCode(e)||r.getCountryByCallingCode("+234"))})})}}}]),UIDirectives.directive("phoneInput",["Session","CountryService",function(e,a){return{restrict:"E",scope:{ngModel:"=",required:"@?"},template:'\n      <div class="flex">\n        <div class="flex" style="width: 100px; margin-right: 10px;">\n          <phone-code-dropdown calling-code="ngModel.calling_code" />\n        </div>\n        <div class="flex flex-grow--1" style="width: 100%;">\n          <input name="phone" type="tel" ng-model="number" ng-pattern="/^[0-9]{9,11}$/" placeholder={{placeholder}}\n            class="form-control input-v2 number-input" ng-required="required">\n        </div>\n      </div>\n    ',link:function(r){var o=e.get("account");r.number=r.ngModel&&r.ngModel.number,a.getCountries().then(function(){r.$watch("ngModel.calling_code",function(e){if(e){var t=a.getCountryByCallingCode(e).countryCode||o&&o.attributes&&o.attributes.country_code,n=a.getCountryData(t);r.placeholder=n&&n.placeholder||"8056020617"}})}),r.$watch("number",function(e){e&&(e.startsWith(0)?r.ngModel.number=e.replace(/^0+/,""):r.ngModel.number=e)})}}}]),UIDirectives.directive("phoneNumberInput",["CountryService","utils",function(o,a){return{restrict:"E",scope:{phoneNumber:"=",callingCode:"=?",formField:"=?",onInputEnter:"&?",required:"@?",defaultCountry:"=?"},template:'\n    <div class="phone-number-input" uib-dropdown auto-close="outsideClick" is-open="isDropdownOpen">\n      <div role="menu" uib-dropdown-menu class="dropdown-menu-left phone-number-input-menu no-arrow">\n        <div class="padder b-b grey-background padder-v-sm">\n          <li data-testid="phone-number-input-list-{{country.countryCode}}" class="list-unstyled b-b" ng-style="{\'border-bottom\': $last ? \'0px\': \'\'}" ng-repeat="country in countriesWithMetadata">\n            <a ng-click="setActiveCountry(country)" class="flex">\n              <span class="flex-item--fill">\n                <img ng-src="assets/img/flags/{{country.countryCode.toLowerCase()}}.svg" class="m-r-sm icon" />\n                <span> {{country.name}} </span>\n              </span>\n              <span class="text-muted"> {{country.callingCodes[0]}} </span>\n            </a>\n          </li>\n        </div>\n        <div class="padder padder-v-sm">\n          <div class="search-input input-group m-b-sm">\n            <span class="input-group-addon no-border no-bg" style="padding-right: 0">\n              <i class="icon-magnifier text-xs m-t-xxs text-muted"></i>\n            </span>\n            <input class="form-control no-border" ng-model="searchCountries" type="text" placeholder="Search your country" />\n          </div>\n          <div class="searched-item">\n            <li class="list-unstyled b-b" ng-style="{\'border-bottom\': $last ? \'0px\': \'\'}" ng-repeat="country in countriesWithoutMetadata | filter: searchCountries">\n              <a ng-click="setActiveCountry(country)" class="flex">\n                <span class="flex-item--fill flex">\n                  <span class="icon-container m-r-sm">\n                    <img ng-src="assets/img/flags/{{country.countryCode.toLowerCase()}}.svg" class="m-r-sm icon" />\n                  </span>\n                  <span> {{country.name}} </span>\n                </span>\n                <span class="text-muted"> {{country.callingCodes[0]}} </span>\n              </a>\n            </li>\n          </div>\n        </div>\n      </div>\n      <span class="field m-b-xs">\n        <div class="country-dropdown b">\n          <div data-testid="phone-number-input-toggle" class="flex flex-align--center" uib-dropdown-toggle aria-haspopup="true" aria-expanded="true">\n            <img ng-show="activeCountry" data-testid="phone-number-input-toggle-flag" class="icon" ng-src="assets/img/flags/{{activeCountry.countryCode.toLowerCase()}}.svg" alt="{{activeCountry.name}} flag">\n            <span ng-show="activeCountry">{{activeCountry.callingCodes[0]}}</span>\n            <span class="caret"></span>\n          </div>\n        </div>\n        <input name="phone" id="phone-number-input" data-testid="phone-number-input-input" type="tel" ng-enter="onInputEnter()" ng-required="required" ng-click="is-open" class="form-control input no-default-borders" ng-model="subscriberNumber" placeholder={{activeCountry.metadata.placeholder}} ng-pattern="activeCountry.metadata.phoneNumberPattern">\n      </span>\n    </div>\n    ',link:function(n,e,t,r){n.isDropdownOpen=!1,n.setActiveCountry=function(e){n.activeCountry=e,n.isDropdownOpen=!1,n.callingCode=e.callingCodes[0]},a.isObject(n.phoneNumber)?(n.subscriberNumber=n.phoneNumber.subscriber_number,n.callingCode=n.phoneNumber.calling_code):n.subscriberNumber=n.phoneNumber,n.phoneNumber={},o.getCountries().then(function(e){n.countriesWithMetadata=[],n.countriesWithoutMetadata=[],e.forEach(function(e){e.metadata?n.countriesWithMetadata=[].concat(_toConsumableArray(n.countriesWithMetadata),[e]):n.countriesWithoutMetadata=[].concat(_toConsumableArray(n.countriesWithoutMetadata),[e])}),n.defaultCountry&&n.setActiveCountry(o.getCountryByName(n.defaultCountry)),n.$watch("subscriberNumber",function(e){e&&(String(e).startsWith("+")?(n.callingCode=o.getCountryByPhoneNumber(e).callingCodes[0],n.subscriberNumber=e.replace(n.callingCode,"")):n.phoneNumber.subscriber_number=e)}),n.$watch("callingCode",function(e){n.phoneNumber.calling_code=e,n.setActiveCountry(o.getCountryByCallingCode(e)||o.getCountryByCallingCode("+234"))}),n.$watch("phoneNumber",function(e){if(n.formField&&n.formField.$setValidity("phoneInputDropdown",!1),e){var t=e.subscriber_number;t&&!Number.isNaN(Number(t))&&n.formField&&n.formField.$setValidity("phoneInputDropdown",!0)}},!0)})}}}]),UIDirectives.directive("pinInput",["$timeout",function(p){return{restrict:"E",scope:{length:"@",type:"@",width:"@",pin:"=",autofocus:"@",onEnterKeyPressed:"&"},template:'\n      <div class="pin-input" ng-style="{width: width || \'260px\'}">\n        <input id="pinInput-{{$index}}" type="{{type || \'tel\'}}" onclick="this.select()" ng-enter="onEnterKeyPressed()" autocomplete="off" ng-keydown="handleKeydown($event, $index)" ng-keyup="handleKeyup($event, $index)" ng-repeat="input in inputs">\n      </div>\n    ',link:function(o){o.pin="",o.inputs=Array.from(new Array(Number(o.length)),function(){return{}});var l=function(e){return document.getElementById("pinInput-".concat(e))};p(function(){var e=l(0);o.autofocus&&e&&e.focus()},100);o.handleKeyup=function(e,t){var n=e.key.match(/^\w{1}$/),r=l(t+1);n&&r&&(r.focus(),r.select()),o.pin=o.inputs.map(function(e,t){var n,r,o,a,i=l(t);return i?(r=(n={selector:i,index:t}).selector,o=n.index,1<(a=r.value).length&&(l(o+1)&&(l(o+1).value=a.slice(1),l(o+1).focus()),l(o).value=a[0]),i.value):""}).join("")};var d=null;o.handleKeydown=function(e,t){var n=l(t+1),r=l(t-1),o="Backspace"===e.key,a="ArrowLeft"===e.key,i="ArrowRight"===e.key,s="Tab"===e.key,c=["Ctrl","Meta"].includes(d),u=e.key.match(/^\w{1}$/);o||a||i||s?p(function(){o&&r?(r.focus(),r.select()):(s||i)&&n?(n.focus(),n.select()):a&&r&&r.select()}):u||c||e.preventDefault(),d=e.key}}}}]),UIDirectives.directive("showPassword",[function(){return{restrict:"A",scope:{showPassword:"="},link:function(e,t){e.$watch("showPassword",function(){e.showPassword?t.attr("type","password"):t.attr("type","text")})}}}]),UIDirectives.directive("validateSlug",["API","$timeout",function(u,l){return{restrict:"A",require:["^form","ngModel"],scope:{skip:"="},link:function(e,t,n,r){var o,a=r[0],i=r[1],s=e.skip,c=function(e){for(var t=0,n=e.length,r=!0;t<n;t++)e[t].data.isValid||(r=!1);i.$setValidity("validateSlug",r),i.$processing=i.$pending=a.$pending=!1};e.$watch(function(){return i.$viewValue},function(t){return void 0===t||""===t?(o&&l.cancel(o),i.$setPristine(),void i.$setValidity("validateSlug",!0)):function(e){var t=!1;for(var n in i.$error)if(i.$error[n]&&"validateSlug"!=n){t=!0;break}return!(i.$pristine||t||e==s)}(t)?(i.$pending||(i.$processing=i.$pending=a.$pending=!0),o&&l.cancel(o),void(o=l(function(){"page/check_slug_availability"==n.validateSlug&&"PRQ_"===t.substring(0,4)?c([{data:{isValid:!1,value:t}}]):u.one(n.validateSlug,t).get().then(function(e){c([{data:{isValid:!0,value:t}}])},function(e){c([{data:{isValid:!1,value:t}}])})},0))):c([{data:{isValid:!0,value:t}}])})}}}]),UIDirectives.filter("characters",function(){return function(e,t,n){if(isNaN(t))return e;if(t<=0)return"";if(e&&e.length>t){if(e=e.substring(0,t),n)for(;" "===e.charAt(e.length-1);)e=e.substr(0,e.length-1);else{var r=e.lastIndexOf(" ");-1!==r&&(e=e.substr(0,r))}return e+"â€¦"}return e}}),UIDirectives.filter("splitcharacters",function(){return function(e,t){return isNaN(t)?e:t<=0?"":e&&e.length>t?e.substring(0,t/2)+"..."+e.substring(e.length-t/2,e.length):e}}),UIDirectives.filter("words",function(){return function(e,t){if(isNaN(t))return e;if(t<=0)return"";if(e){var n=e.split(/\s+/);n.length>t&&(e=n.slice(0,t).join(" ")+"â€¦")}return e}}),UIDirectives.directive("gravatar",["$timeout",function(r){return{restrict:"E",scope:{email:"=",firstName:"=",lastName:"=",size:"="},template:'\n        <div class="gravatar">\n          <img ng-show="imageStatus === \'fetched\'" class="gravatar-img" gravatar-size="{{ size || 100 }}" gravatar-src="email" />\n          <span ng-show="imageStatus === \'error\'">{{firstName | limitTo: 1}}{{lastName | limitTo: 1}}</span>\n        </div>\n        ',link:function(t,e){t.imageStatus="idle";var n=function(e){r(function(){t.imageStatus=e})};e.find("img").bind("load",function(){n("fetched")}).bind("error",function(){n("error")})}}}]),UIDirectives.directive("infoIcon",function(){return{restrict:"E",replace:!0,template:'\n    <svg width="14" height="14" fill="none" xmlns="http://www.w3.org/2000/svg" style="padding-top: 1px;">\n      <path d="M5.136 5.083a1.75 1.75 0 013.4.584c0 1.166-1.75 1.75-1.75 1.75m.047 2.333h.006m5.828-2.917A5.833 5.833 0 111 6.833a5.833 5.833 0 0111.667 0z" stroke="#919191" stroke-linecap="round" stroke-linejoin="round"></path>\n    </svg>\n  '}}),UIDirectives.directive("icon",["InlineIcons","$sce",function(o,a){return{restrict:"A",scope:{icon:"@"},replace:!0,template:'<i ng:bind-html="renderedIcon" aria-label="{{ariaLabel}}"></i>',link:function(e,t,n){if(e.renderedIcon=a.trustAsHtml(o[e.icon]),n.ariaLabel||(e.ariaLabel="".concat(e.icon," icon")),!n.class){var r=t.parent()[0];r&&r.classList.contains("btn-success")?t.addClass("icon-white"):t.addClass("icon-grey")}}}}]),UIDirectives.directive("hiddenUntil",["$rootScope",function(i){return{transclude:"element",restrict:"A",link:function(e,t,n,r,o){var a=null;i.$on(n.hiddenUntil,function(){o(function(e){a&&a.remove(),a=e,t.parent().append(e)})})}}}]),UIDirectives.directive("loadingUntil",["$rootScope",function(e){return{transclude:"element",restrict:"A",link:function(e,t,n,r,o){var a=null,i=document.createElement("div");i.className="content-loader";var s=function(){a&&a.remove(),o(function(e){t.parent().append(i)})};s();e.$on(n.loadingUntil,function(){o(function(e){i.remove(),a&&a.remove(),a=e,t.parent().append(e)})}),e.$on(n.resetOn,s)}}}]),UIDirectives.directive("ngLoading",[function(){return{restrict:"AE",scope:!0,compile:function(e,t){e.addClass("loading-button");var n=e.html();return e.html('<span class="default-state">'+n+"</span>"),e.append('<div class="loading-state spinner">\r\n  <div class="b1 se"></div>\r\n  <div class="b2 se"></div>\r\n  <div class="b3 se"></div>\r\n  <div class="b4 se"></div>\r\n  <div class="b5 se"></div>\r\n  <div class="b6 se"></div>\r\n  <div class="b7 se"></div>\r\n  <div class="b8 se"></div>\r\n  <div class="b9 se"></div>\r\n  <div class="b10 se"></div>\r\n  <div class="b11 se"></div>\r\n  <div class="b12 se"></div>\r\n</div><span class="loading-success"><i class="fa fa-check animated fadeInUp"></i></span><span class="loading-failure"><i class="fa fa-times animated fadeInUp"></i></span>'),function(e,n,t){var r;e.$on(t.ngLoading,function(e,t){if(r){if(r=!1,n.removeClass("ng-loading"),null==t)return n.removeClass("ng-loading"),void n.attr("disabled",!1);1==t?n.addClass("ng-loading-success"):0==t&&n.addClass("ng-loading-failure"),setTimeout(function(){n.removeClass("ng-loading-success ng-loading-failure ng-loading"),n.attr("disabled",!1)},700)}}),n.on("click",function(){n.addClass("ng-loading"),n.addClass("ng-loading"),n.attr("disabled",!0),r=!0})}}}}]),UIDirectives.directive("logo",["$rootScope","API","$http","Auth","Notification","$state",function(t,r,a,i,s,c){return{restrict:"E",replace:!0,scope:{url:"=",alt:"="},template:'\n    <div class="c-logo">\n      <a ng-click="triggerUpload()">\n        <img class="c-img" src="{{logoUrl}}" alt="{{alt}}" />\n      </a>\n      <input id="logoFileInput" type="file" accept="image/*" style="visibility:hidden" file-pick />\n    </div>\n  ',link:function(e){e.logoUrl=t.Business&&t.Business.logo_path,e.triggerUpload=function(){document.getElementById("logoFileInput").click()};e.$on("value",function(e,t){var n,o=t&&t[0];(n=o,r.all("upload_url").post({upload_filename:n.name||"image-".concat(uuidv4()),upload_path:"/integration-logos"}).then(function(e){return e.data})).then(function(e){return n=o,r=(t=e).signed_url,a.put(r,n,{headers:{"Content-Type":n.type}}).then(function(){return t});var t,n,r}).then(function(e){return i.update("account",{logo_path:e.path})}).then(function(){c.reload()}).catch(function(e){s.error("Could not update logo",e)})})}}}]),UIDirectives.directive("breadcrumbs",["$state",function(s){return{restrict:"E",replace:!0,scope:{pageTitle:"="},template:'\n    <div class="breadcrumbs">\n      <a\n        ng-repeat-start="crumb in breadcrumbs"\n        class="breadcrumb-link"\n        ui-sref="{{crumb.link}}"\n        ui-sref-opts="{{crumb.params}}"\n        ng-if="!crumb.current"\n        data-testid="breadcrumb-link-{{$index}}"\n      >\n        {{crumb.title}}\n      </a>\n      <span ng-if="crumb.current" class="breadcrumb-page">{{crumb.title}}</span>\n      <span ng-repeat-end ng-if="!$last" class="breadcrumb-divider">\n        <svg width="5" height="7" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1l3 2.5L1 6" stroke="#B7C0C6" stroke-linecap="round" stroke-linejoin="round"/></svg>\n      </span>\n    </div>\n  ',link:function(e){for(var t=function(e){var t=e.self,n=e.url,r=t.title,o=t.name,a=t.redirectTo,i=n&&n.params&&n.params.id;return{link:a||o,title:i?s.params.id:r,params:i?s.params:null,current:o===s.current.name}},n=[],r=s.$current.parent;r&&r.data;)n.unshift(t(r)),r=r.parent;if(s.$current.title){var o=t(s.$current);o.title=e.pageTitle||o.title,n.push(o)}e.breadcrumbs=n}}}]),UIDirectives.directive("metricCard",["AmplitudeService",function(a){return{restrict:"E",scope:{textTitle:"@",textMain:"@",textSupporting:"@",testId:"@",buttonText:"@",buttonLink:"@",buttons:"="},templateUrl:"/components/directives/metric-card.html",link:function(e){var t=a.logEvent;e.logClick=function(e){return t("Clicked metric card button",{action:e})};var n=e.buttons,r=e.buttonLink,o=e.buttonText;e.actions=n||[],!n&&r&&o&&(e.actions=[{toState:r,text:o}])}}}]),UIDirectives.directive("metricsCurrencyPicker",["AmplitudeService","$state","$rootScope",function(r,o,a){return{restrict:"E",replace:!0,templateUrl:"/components/directives/metrics-currency-picker.html",scope:{currency:"=",defaultCurrencyOnly:"="},link:function(e){var t=r.logEvent,n=a.Business;e.currencies=e.defaultCurrencyOnly?[n.default_currency]:n.allowed_currencies,e.selectedCurrency=e.currency||n.default_currency,e.setCurrency=function(e){o.go(o.current,{currency:e}),t("Set metrics currency",{currency:e})}}}}]),UIDirectives.directive("disableWithoutPermission",["$filter","$parse","Session",function(e,t,o){return{restrict:"A",compile:function(e,t){return function(e,t,n){if(!o.hasPermission(n.disableWithoutPermission)){var r=t[0].tagName;_.contains(["A","BUTTON"],r)&&(t.addClass("btn-not-permitted"),t.find("i").remove(),t.prepend('<i class="fa fa-lock m-r-xs"></i>'),t.attr("disabled","disabled"),t.attr("title","Your current role ("+o.get("user").role.full_name+") does not have the permissions for this action.")),_.contains(["A"],r)&&(t.removeAttr("href"),t.removeAttr("ui-sref")),_.contains(["DIV","FORM"],r)&&(t.find("input").attr("disabled","disabled"),t.find("input").attr("placeholder","-"),t.find("select").attr("disabled","disabled"))}}}}}]),angular.module("app").directive("privateFileLink",function(){return{restrict:"E",template:'<a class="text-primary" ui-sref="files.view({ location: \'{{encodedPath}}\' })" target="_blank">{{displayText}}</a>',replace:!0,scope:{path:"=",displayText:"@"},controller:["$scope",function(e){e.encodedPath=encodeURI(e.path)}]}}),function(){function e(e,t){return _.has(t,"level")?n[t.level]:n.h6}UIDirectives.directive("psTitle",function(){return{restrict:"E",templateUrl:e,replace:!0,transclude:!0,scope:{}}});var n={h6:"components/directives/typography/h6.html",h5:"components/directives/typography/h5.html",h4:"components/directives/typography/h4.html"}}(),UIDirectives.directive("clickOutside",["$timeout",function(r){return{restrict:"A",scope:{clickOutside:"&"},link:function(t,n){var e=function(e){n&&!n[0].contains(e.target)&&r(function(){t.clickOutside()},0)};t.$on("$destroy",function(){document.removeEventListener("click",e)}),document.addEventListener("click",e)}}}]),UIDirectives.directive("ngEnter",function(){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ngEnter)}),e.preventDefault())})}}),UIDirectives.directive("zendeskLink",["$rootScope",function(a){return{restrict:"A",link:function(e,t,n){var r=n.zendeskLink,o=n.zendeskSearch;t.on("click",function(){window.zE&&a.$broadcast("helpdesk:open",{id:r,searchTerm:o})})}}}]),UIDirectives.directive("zendeskVisible",["$rootScope",function(e){return{restrict:"A",link:function(e,t,n){window.zE?t.removeClass("ng-hide"):t.addClass("ng-hide")}}}]),UIDirectives.directive("zendesk",["$rootScope","$timeout","AmplitudeService","ZendeskService","SnapcallService",function(r,o,d,p,f){return{restrict:"A",templateUrl:"/components/directives/zendesk.html",link:function(l){window.zE(function(){window.zE("webWidget","updateSettings",p.zendeskDefaults),l.$broadcast("zendeskReady");var e=r.User,t=r.Business,n=d.logEvent;e&&t&&(l.businessContextInfo={name:"".concat(e.first_name||""," ").concat(e.last_name||""),email:e.email,"User Phone Number":e.phone,Role:e.role&&e.role.name,"Business Name":t.business_name,"Business Email":t.email,"International Enabled":!t.international_toggle_disabled,"Category 4":4===t.isw_category,Integration:"https://watchtower.paystack.com/#/integrations/".concat(t.id),"Business Type":t.business_type,"Go Live Date":t.is_live?moment(t.go_live_date).format("DD MMMM YYYY"):"Business is not live"},window.zE.identify(l.businessContextInfo));var a=function(){var e=document.getElementById("helpdesk-body");e&&(e.scrollTop=0)};l.animationClass={};var i=function(e){var t="bottom-right"===e;l.animationClass={in:t?"fadeInRight":"fadeIn",out:t?"fadeOutRight":"fadeOut"}};i();var s="answers",c="center";l.zendeskIsOpen=!1,l.activeTab=s,l.position=c,l.fetchingData=!1,l.isAgentOnline=!1,f.init().then(function(e){l.snapcallSupported=e}),l.makeSnapCall=function(){l.zendeskIsOpen=!1,f.call(l.businessContextInfo)};l.article=null,l.articles={data:[],nextPage:null},window.$zopim&&window.$zopim.livechat&&window.$zopim.livechat.setOnStatus&&window.$zopim.livechat.setOnStatus(function(e){o(function(){l.isAgentOnline="online"===e},0)});var u=function(){return l.fetchingData=!0,p.fetchTopArticles().then(function(e){l.articles=e,l.fetchingData=!1}).catch(function(){l.articles={data:[],nextPage:null},l.fetchingData=!1})};l.loadTab=function(e){var t,n,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};a(),"answers"===(l.activeTab=e)&&(n=(t=o).id,r=t.searchTerm,n?l.loadArticle(n):r?l.searchHelpDesk(r):u())},l.removeArticle=function(){l.article=null,0===l.articles.data.length&&u()},l.openHelpDesk=function(e){var t=e||{},n=t.id,r=t.searchTerm,o=t.tab,a=t.position;l.position=a||c,i(a),l.loadTab(o||s,{id:n,searchTerm:r}),l.zendeskIsOpen=!0},l.getArticleDescription=function(e){return window.striptags(e).substring(0,200)+"..."},l.contactSupport=function(e){"chat"!==e||l.isAgentOnline?p.selectZendeskWidget(e):p.selectZendeskWidget("contactForm"),p.openZendeskWidget(),n("Contacted Support",{Channel:e}),l.hideContainer=!0},l.loadArticle=function(e){l.article={},l.fetchingData=!0,p.fetchArticleById(e).then(function(e){l.fetchingData=!1,l.openArticle(e)}).catch(function(){l.fetchingData=!1})},l.openArticle=function(e){l.article=e,a()},l.closeHelpDesk=function(){window.zE.hide(),l.hideContainer=!0,l.isClosing=!0,o(function(){l.zendeskIsOpen=!1,l.isClosing=!1,l.hideContainer=!1},300)},window.zE("webWidget:on","close",function(){o(function(){l.closeHelpDesk()}),window.zE("webWidget","updateSettings",{webWidget:p.zendeskWebWidgets})}),r.$on("helpdesk:open",function(e,t){return l.openHelpDesk(t)}),r.$on("helpdesk:close",function(e,t){return l.closeHelpDesk(t)}),l.searchHelpDesk=function(e){e?(l.articles={data:[],nextPage:null},l.fetchingData=!0,p.fetchSearchedArticles(e).then(function(e){l.articles=e,l.fetchingData=!1}).catch(function(){l.fetchingData=!1})):u()},l.fetchMoreArticles=function(){l.fetchingData=!0,p.fetchMoreArticles(l.articles.nextPage).then(function(e){l.fetchingData=!1,l.articles={data:[].concat(_toConsumableArray(l.articles.data),_toConsumableArray(e.data)),nextPage:e.nextPage}}).catch(function(){l.articles={data:[],nextPage:null},l.fetchingData=!1})}})}}}]),angular.module("app.utilities").service("DeviceService",function(){var e,t=navigator.userAgent.toLowerCase();return t.includes("iphone")&&(e="iOS"),t.includes("android")&&(e="Android"),{userAgent:t,platform:e}});_excluded=["phone","businessType"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var AccessModule=angular.module("app.access",[]);function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}AccessModule.config(["$stateProvider",function(e){e.state("access",{url:"",abstract:!0,templateUrl:"components/layout/access.html"}).state("access.login",{title:"Login",url:"/login?next&prefill",pageTrack:"/login",templateUrl:"/modules/access/login.html",controller:"LoginCtrl",requiresLogout:!0}).state("access.mfa",{title:"MFA",url:"/login/mfa?type",pageTrack:"/login/mfa",templateUrl:"/modules/access/mfa.html",controller:"LoginCtrl",requiresLogout:!0}).state("access.signup",{title:"Signup",url:"/signup?email&_id&pilot&ref",pageTrack:"/signup",templateUrl:"/modules/access/signup.html",controller:"SignupCtrl",requiresLogout:!0,resolve:{userIp:["API",function(e){return e.one("decision/ip").get()}],signUpOptions:["API",function(e){return e.one("create_business/options").get()}]}}).state("access.request-password-reset",{title:"Request Password",url:"/request-password-reset",pageTrack:"/request-password-reset",templateUrl:"/modules/access/request-password-reset.html",controller:"RequestPasswordResetCtrl",requiresLogout:!0}).state("access.set-password",{title:"Set Password",url:"/set-password/:hash/:integration",pageTrack:"/set-password",templateUrl:"/modules/access/set-password.html",controller:"ResetPasswordCtrl",resolve:{verification:["$state","$stateParams","$rootScope","API","Notification",function(t,e,n,r,o){return r.all("verify_reset_hash").post({hash:e.hash,integration:e.integration,is_invite:!1}).then(function(e){return e}).catch(function(e){t.go("access.login"),o.error("Failed to set password",e)})}]},requiresLogout:!0}).state("access.reset-password",{title:"Reset Password",url:"/reset-password/:hash",pageTrack:"/reset-password",templateUrl:"/modules/access/reset-password.html",controller:"ResetPasswordCtrl",resolve:{verification:["$state","$stateParams","$rootScope","API","Notification",function(t,e,n,r,o){return r.all("verify_reset_hash").post({hash:e.hash,is_invite:!1}).then(function(e){return e}).catch(function(e){t.go("access.login"),o.error("Failed to reset password",e)})}]},requiresLogout:!0}).state("access.join-team",{title:"Join Team",url:"/join-team/:hash",pageTrack:"/join-team",templateUrl:"/modules/access/join-team.html",controller:"JoinTeamCtrl",resolve:{verification:["$state","$stateParams","$rootScope","API","Notification",function(t,e,n,r,o){return r.all("verify_reset_hash").post({hash:e.hash,is_invite:!0}).then(function(e){return e}).catch(function(e){t.go("access.login"),e.data&&"Password reset hash not found"==e.data.message&&(e.data.message="Verification hash was not found"),o.error("There was a problem with your invitation link",e)})}]},requiresLogout:!0}).state("access.business-switcher-home",{title:"Paystack",url:"/business/:id",redirectTo:"access.business-switcher"}).state("access.business-switcher",{title:"Paystack",url:"/business/:id/*path",pageTrack:"/business",templateUrl:"/modules/access/switch-business.html",controller:"BusinessSwitcherCtrl",resolve:{currentBusiness:["Auth","$state","$stateParams","$rootScope","LocalService",function(e,t,n,r,o){return e.refreshSession().catch(function(){o.set("redirectParams",n),t.go("access.login",{next:"access.business-switcher"})})}],destinationBusiness:["$stateParams","currentBusiness","Session","Notification",function(t,e,n,r){var o=n.get("user"),a=_.pluck(o.integrations,"id"),i={id:t.id};return o.current_integration==i.id?(i.sameAsCurrent=!0,Promise.resolve(i)):_.contains(a,parseInt(i.id))?(i=_.find(o.integrations,function(e){return e.id==t.id}),Promise.resolve(i)):Promise.resolve(null)}]}}).state("access.access-denied",{title:"Paystack",url:"/access-denied?reason&next",templateUrl:"/modules/access/access-denied.html",controller:"AccessDeniedCtrl",onExit:["ngDialog",function(e){return e.closeAll()}],resolve:{currentUser:["API","$state","$stateParams",function(e,n,o){return e.one("session").get().then(function(e){var r=e.data.user,t=!!r.integrations.find(function(e){var t=e.id,n=e.mfa;return t===r.current_integration&&n&&n.is_required});if("no-mfa"===o.reason&&t&&!r.mfa_enabled)return r;n.go(n.current.name||"app.home")})}]}}).state("access.confirm-signup-email",{title:"Confirm Signup Email Address",url:"/confirm-email/:hash",pageTrack:"/confirm-email",resolve:{verification:["$state","$stateParams","API","Notification","LocalService","AmplitudeService",function(t,e,n,r,o,a){var i=a.logEvent;return n.all("confirm_email").post({hash:e.hash}).then(function(){i("Signup email confirmation successful"),o.unset("userSignupEmail"),t.go("access.login"),r.success("Your email address was confirmed successfully","You may login to your account now")}).catch(function(e){i("Signup email confirmation failed"),t.go("access.login"),r.error("There was a problem with your email confirmation link",e)})}]},requiresLogout:!0}).state("access.verify-signup-email",{title:"Verify Email Address",url:"/verify-email-address",pageTrack:"/verify-email-address",templateUrl:"/modules/access/verify-signup-email.html",controller:["$scope","LocalService","$state","API","Notification",function(e,t,n,r,o){e.email=t.get("userSignupEmail"),e.resendVerificationEmail=function(){logEvent("signup_send-verify-email",{state:"started"}),r.all("send-signup-verification-email").post().then(function(){logEvent("signup_send-verify-email",{state:"succeeded"}),o.success("Verification email request sent","Verification email resent successfully")}).catch(function(e){logEvent("signup_send-verify-email",{state:"failed"}),o.error("Could not resend signup verification email",e)})},e.email||n.go("access.login")}]}).state("404",{title:"404",url:"/404",templateUrl:"/modules/access/404.html",resolve:{loggedIn:["Session","$state",function(e,t){if(e.isActive())return Promise.reject().catch(function(){return t.go("app.404")})}]}})}]).controller("LoginCtrl",["$scope","$rootScope","$state","Auth","API","Notification","Session","LocalService","$stateParams","$i18next","AmplitudeService","ngDialog",function(n,a,i,t,e,r,s,c,o,u,l,d){n.credentials={},n.mfa={};var p=l.setActiveUser,f=l.logEvent,m=function(){var e,t=a.Business&&a.Business.is_live;e=t||a.User.isDemoUser()?"app.home":t?"app.onboarding":"app.compliance";var n=a.Business&&"direct_debit"===a.Business.business_type,r=s.get("account"),o=s.get("user");p(o,r),f("Login complete"),i.params.next?(i.go(i.params.next,c.get("redirectParams")).then(null,function(){i.go(e)}),c.set("redirectParams",null)):n?i.go("direct-debit.accounts"):i.go(e)};n.verifyTotp=function(){n.verifyingMFA=!0,e.all("verify-mfa").post(n.mfa).then(function(e){n.verifyingMFA=!1,t.save(e.data).then(function(){m()})}).catch(function(e){n.verifyingMFA=!1,r.error("Could not verify Two Factor Authentication code",e),e&&e.data&&"Authentication token expired"===e.data.message&&a.logout()})},n.login=function(){r.clear(),f("Login started");var e=_objectSpread(_objectSpread({},n.credentials),n.organizationData&&{organization:n.organizationData.id});t.login(e).then(function(e){e&&e.mfa_required?i.go("access.mfa"):m()}).catch(function(e){n.$broadcast("loggedIn",!1),n.loginFailed=!0;var t=e&&e.data&&e.data.message;"object"===_typeof(t)&&(t=t.text)&&t.includes("Your password has expired")&&i.go("access.reset-password",{hash:e.data.message.hash}),f("Login failed",{Error:t}),r.error("Could not login to your account",t)})},"demo"===o.prefill&&(n.credentials.email="dashboarddemo@paystack.com",n.credentials.password="Da$boardDem0",n.login())}]).controller("SignupCtrl",["$scope","$rootScope","$state","API","Notification","PasswordValidator","AmplitudeService","userIp","LocalService","CountryService","Session","signUpOptions",function(a,e,i,s,c,t,n,r,u,o,l,d){var p=n.initializeMarketingInstance,f=n.logEvent;p({deviceId:i.params._id}),f("Signup started",{},"marketingInstance");var m={NG:"https://paystack.com/privacy/merchant?localeUpdate=true",GH:"https://paystack.com/gh/privacy/merchant?localeUpdate=true",ZA:"https://paystack.com/za/privacy/merchant?localeUpdate=true"};a.getPrivacyPolicyUrl=function(e){return m[e]||m.NG},a.countries=d.data.countries.filter(function(e){return!settings.pilotCountriesForNewBusinesses.includes(e.value)||e.value===i.params.pilot}),a.businessTypes=d.data.businessTypes,a.emailSuggestion=null;var g=r.data.ip_address,h=i.params.ref;a.marketingCampaign=a.getMarketingCampaign(),a.credentials=_objectSpread({email:i.params.email},h&&{campaign:h}),s.one("decision/resolve_ip/".concat(g)).get().then(function(e){if(e&&e.data){var t=e.data.countryCode;a.credentials.country_code=t,a.setBusinessTypes(),o.getCountries().then(function(){var e=o.getCountryByISOCode(t);a.credentials.phone={calling_code:e&&e.callingCodes[0]}})}});a.setBusinessTypes=function(){var t,e,n;a.supportedBusinessTypes=(t=a.credentials.country_code,e=a.countries,n=a.businessTypes,((e.find(function(e){return e.value===t})||{}).businessTypes||["starter","registered"]).map(function(e){return _objectSpread(_objectSpread({},n[e]),{},{value:e})})),a.credentials.businessType=void 0},a.validatePassword=function(e){a.passwordChecker=t.validate(a.credentials.password),e.$setValidity(e.$name,a.passwordChecker.isValid)},a.signup=function(){c.clear(),f("Signup started");var e=a.credentials,t=e.phone,n=e.businessType,r=_objectWithoutProperties(e,_excluded),o=_objectSpread(_objectSpread(_objectSpread({},r),a.organizationData&&{organization:a.organizationData.id}),{},{phone:{subscriber_number:t.number,calling_code:t.calling_code},business_type:n});s.all("register").post(o).then(function(e){var t=e.data;f("Signup complete",{},"marketingInstance"),l.saveToken(t.token),u.set("userSignupEmail",o.email),f("Signup complete"),i.go("access.verify-signup-email")},function(e){a.$broadcast("accountCreated",!1),c.error("Account could not be created",e)})}}]).controller("RequestPasswordResetCtrl",["$scope","$rootScope","$state","Auth","API","Notification","$i18next","AmplitudeService",function(t,e,n,r,o,a,i,s){var c=s.logEvent;t.request=function(){o.all("reset_password").post({email:t.email}).then(function(e){c("Password reset requested"),n.reload(),a.success("Reset Link Sent",e.message)},function(e){t.$broadcast("requested",!1),a.error("Could not initiate a password reset",e)})}}]).controller("ResetPasswordCtrl",["$scope","$rootScope","$state","Auth","API","Notification","verification","PasswordValidator","$i18next","AmplitudeService",function(t,e,n,r,o,a,i,s,c,u){t.user=i.data,t.organization=i.data.organization,t.validatePassword=function(e){t.passwordChecker=s.validate(t.new_password),e.$setValidity(e.$name,t.passwordChecker.isValid)};var l=u.logEvent;t.reset=function(){o.all("set_new_password").post({hash:n.params.hash,is_invite:!1,password:t.new_password}).then(function(e){l("Password reset complete"),a.success("Password reset successful",e.message),n.go("access.login")},function(e){l("Password reset failed",{Error:e}),t.$broadcast("reset",!1),a.error("Password could not be reset",e)})}}]).controller("JoinTeamCtrl",["$scope","$rootScope","$state","Auth","API","Notification","verification","PasswordValidator","$i18next",function(t,n,r,o,e,a,i,s,c){t.validatePassword=function(e){t.passwordChecker=s.validate(t.user.password),e.$setValidity(e.$name,t.passwordChecker.isValid)},t.user=i.data,t.join=function(){e.all("set_new_password").post({hash:r.params.hash,is_invite:!0,first_name:t.user.first_name,last_name:t.user.last_name,job_title:t.user.job_title,is_developer:t.user.is_developer,phone:t.user.phone,password:t.user.password}).then(function(e){return o.save(e.data)}).then(function(){var e=t.user.phone?"".concat(t.user.phone.calling_code).concat(t.user.phone.subscriber_number):"";return n.Business.users.filter(function(e){return"admin"===e.role}).length||o.update("account",{primary_contact_name:t.user.first_name+" "+t.user.last_name,primary_contact_email:t.user.email,primary_contact_phone:e}),Promise.resolve()}).then(function(){var e=n.Business;r.go(e.is_live?"app.home":"app.onboarding"),a.success("Welcome to Paystack","Your account was completed successfully")}).catch(function(e){t.$broadcast("joined",!1),a.error("Account could not be completed",e)})}}]).controller("BusinessSwitcherCtrl",["$scope","$rootScope","$state","$location","Auth","API","Notification","Session","destinationBusiness","$i18next",function(e,t,n,r,o,a,i,s,c,u){var l=s.get("user");new Promise(function(e,t){c&&c.sameAsCurrent?e():c?o.switchIntegration(c).then(function(){i.success("Accounts Switched","You are now using the "+c.business_name+" account"),e()}):t()}).then(function(){r.path(n.params.path||"dashboard"),t.switchingAccount=null,t.showLoadingIcon=!1}).catch(function(){e.unauthorized=!0}),e.salutation=l.first_name||l.last_name||i18next.t("switchBusiness.there")}]).controller("AccessDeniedCtrl",["$scope","$rootScope","$state","Auth","Notification","currentUser","ngDialog",function(c,e,t,n,r,o,a){c.user=o,c.userIntegrationsExcludingCurrentIntegration=c.user.integrations.filter(function(e){return e.id!==c.user.current_integration}),c.mfaEnabled=o.mfa_enabled,c.currentIntegration=c.user.integrations.find(function(e){return e.id===c.user.current_integration}),c.userShouldEnableMFA="no-mfa"===t.params.reason&&c.currentIntegration.mfa.is_required&&!c.mfaEnabled;var u=function(){n.refreshSession().then(function(){t.go(t.params.next||"app.home"),e.switchingAccount=null})};c.goToDashboard=u,c.switchIntegration=function(e){n.switchIntegration(e).then(function(){u(),r.success("Accounts Switched","You are now using the "+e.business_name+" account")}).catch(function(e){r.error("Could not switch business",e)})},c.showEnableMFAModal=function(){a.open({closeByEscape:!1,className:"ngdialog-theme-plain dialog-close-center-icon",template:"enableMFA",scope:c,resolve:{mfaRequest:["API",function(e){return e.one("request-mfa").get()}]},controller:["$scope","$state","mfaRequest","Notification","AmplitudeService","Auth","API",function(r,e,t,n,o,a,i){r.mfaRequest=t.data;var s=o.logEvent;r.enableMFA=function(e){r.enablingMFA=!0,i.all("enable-mfa").post({totp:e}).then(function(e){var t;t=!1,c.userShouldEnableMFA=t,s("Enabled 2FA from access-denied page"),function(e){r.mfaEnabled=!0,r.backupCodes=e;var t=r.backupCodes.join("\n"),n=new Blob([t],{type:"text/plain"});r.backupCodeLink=URL.createObjectURL(n),r.showProceedButton=!0,r.proceedButtonText="Go to dashboard",r.proceedToNextStep=function(){u()}}(e.data.backup_codes),a.update("user")}).catch(function(e){n.error("Could not enable Two Factor Authentication",e),s("Could not enable 2FA from access-denied page",{errorStatus:e&&e.statusCode,errorMessage:e&&e.data&&e.data.message})})}}]})}}]),angular.module("app.audit-logs",["ui.router"]).config(["$stateProvider",function(e){e.state("audit-logs",{abstract:!0,url:"/audit-logs",templateUrl:"components/layout/base.html",redirectTo:"audit-logs.list",title:"Audit Logs",data:{permission:"settings-*",authenticable:!0}}).state("audit-logs.list",{templateUrl:"/modules/audit-logs/views/index.html",pageTrack:"/audit-logs",url:"?from&to&performed_by&action&page",controller:"AuditLogsCtrl"})}]);var BalanceHistoryModule=angular.module("app.balance-history",[]);function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}BalanceHistoryModule.config(["$stateProvider",function(e){e.state("balance-history",{abstract:!0,url:"/balance",templateUrl:"components/layout/base.html",redirectTo:"balance-history.list",data:{permission:"balance-view",authenticable:!0}}).state("balance-history.list",{url:"?page&type&currency&from&to&period&for&use_cursor&next&previous&per_page",pageTrack:"/balance",templateUrl:"/modules/balance-history/list.html",controller:"BalanceHistoryCtrl",title:"Balance"})}]).factory("BalanceHistoryData",["API","Session","URLService",function(r,e,t){return{getBalances:function(){return e.hasPermission("balance-view")?r.one("balance").get():Promise.reject()},getRevenueForToday:function(){var e={from:moment().startOf("day").format(),to:moment().endOf("day").format()};return r.one("transaction/totals").get(e)},fetch:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=angular.copy(e);if("today"===t.period&&(t.from=moment().startOf("day").format(),t.to=null),"day"===t.period){var n=new Date(t.for);t.from=moment(n).startOf("day").format(),t.to=moment(n).endOf("day").format()}return"range"===t.period&&(t.from=moment(t.from).startOf("day").format(),t.to=moment(t.to).endOf("day").format()),r.one("balance","ledger").withHttpConfig({ignoreLoadingBar:!0}).get(t)},getTotalBalanceHistoryCount:function(){var e=t.getQuery();return r.one("balance","ledger").get(_objectSpread(_objectSpread({},e),{},{perPage:1,next:null,previous:null,use_cursor:!1})).then(function(e){return e&&e.meta&&e.meta.total})},exportBalance:function(){var e=t.getQuery();return r.one("balance","export").get(_objectSpread(_objectSpread({},e),{},{destination:"email"}))}}}]).controller("BalanceHistoryCtrl",["$state","$stateParams","$rootScope","$scope","TopupService","$i18next","DateService","Notification","Session","AmplitudeService","BalanceHistoryData","$q","clipboard","ngDialog","utils","BalanceHistoryTypesFilterConstants",function(t,r,e,a,n,o,i,s,c,u,l,d,p,f,m,g){var h=e.User,y=e.Business;a.history=[],a.meta={},a.balances=[],a.balanceHistoryPages=[],a.allRevenueForToday={};var b=1<y.allowed_currencies.length?["period","currency","type"]:["period","type"];e.queryActiveFilters(b),a.stateParameters=i.format(r),a.query=angular.copy(r),a.selectedCurrency=t.params.currency||y.default_currency,a.exportBalance=function(){l.exportBalance().then(function(){f.open({template:"/modules/balance-history/modals/email-export-success.html",scope:a,showClose:!0,width:500})}).catch(function(e){return s.error("Could not export your balance history",e)})},a.showQuickExportSuccess=function(){f.open({template:"/modules/balance-history/modals/quick-export-success.html",scope:a,showClose:!0,width:450})};var v=u.logEvent;a.logEvent=function(e,t){v(e,t)};var _=[{isActive:h.hasPermission("transfer-*")&&y.is_live,text:o.t("balanceHistory.list.sidebar.withdraw"),toState:"transfers.new({ withdraw: true, currency: '".concat(a.selectedCurrency,"' })")},{isActive:!0,text:o.t("balanceHistory.list.sidebar.topup",{count:1}),onClick:function(){n.topup().catch(function(e){return s.error("Could not topup your account",e)}).finally(function(){t.reload()})}}];a.balanceButtons=_.filter(function(e){return e.isActive});var S=c.get("account");a.topupAccounts=S.top_up_accounts||[],a.copyAccountNumber=function(e){p.copyText(e),s.success(o.t("balanceHistory.list.sidebar.topupAccount.copied"))},a.requeryAccount=function(e){n.requery(e.account_number,e.bank.slug).then(function(e){s.success("Request successful",e.message,0),a.$broadcast("accountRequeried",!0)}).catch(function(e){s.error("Request failed",e,0),a.$broadcast("accountRequeried",!1)})};var P=c.get("account")&&c.get("account").attributes&&c.get("account").attributes.country_code;a.typesFilters="ZA"===P?g.ZA_AVAILABLE_FILTERS:g.DEFAULT_AVAILABLE_FILTERS;var w=!1,C=function(e,t){var n=r.use_cursor?"cursor":"paging";w||v(e,_objectSpread({"Pagination type":n},t))},O=function(e){C("Balance History List endpoint request started");var t=m.respondOnTimeout(function(){a.isBalanceHistoryAPITakingTimeToRespond=!0},3e4);return l.fetch(e).then(function(e){return C("Balance History List endpoint request complete"),w=!0,t.resolve(),e}).catch(function(e){C("Balance History List endpoint request complete",{"Error code":e.status}),w=!0,s.error("Could not fetch Balance history",e),a.$broadcast("fetchedBalanceHistory",!1)})},A=null;O(r).then(function(e){var t=e.data,n=e.meta;a.balanceHistoryPages=[].concat(_toConsumableArray(a.balanceHistoryPages),[t]),a.history=t,a.meta=n,A=n.next,r.use_cursor&&(t.length>=n.perPage?l.getTotalBalanceHistoryCount().then(function(e){a.meta.total=e}):a.meta.total=t.length),a.$broadcast("fetchedBalanceHistory")}),a.fetchingMoreBalanceHistory=!1;var T=!(a.fetchMoreBalanceHistory=function(e){var t=e.next;return a.fetchingMoreBalanceHistory=!0,O(_objectSpread(_objectSpread({},r),{},{next:t})).then(function(e){var t=e.data,n=e.meta;a.meta.next=n.next,a.balanceHistoryPages=[].concat(_toConsumableArray(a.balanceHistoryPages),[t]),a.fetchingMoreBalanceHistory=!1})});a.checkForNewBalanceHistory=function(){T||(T=!0,O(_objectSpread(_objectSpread({},r),{},{prev:A})).then(function(){T=!1}))};var k=t.activeFilters.map(function(e){return o.t("balanceHistory.list.filterParams.".concat(e))});a.filterText=t.activeFilters.length?o.t("balanceHistory.list.filteredBy",{params:k.join(", ")}):o.t("balanceHistory.list.filter"),a.modelMapping={Transaction:o.t("transaction"),Transfer:o.t("transfer"),Transfer_R:o.t("reversal"),Transfer_Charge:o.t("charge"),Settlement:o.t("payout"),Refund:o.t("refund"),Refund_R:o.t("reversal"),Auto_Topup:o.t("topup"),BVN_Charge:o.t("charge"),BVN_Charge_R:o.t("reversal"),BVN_Match_Charge:o.t("charge"),BVN_Resolve_2_Charge:o.t("charge"),BVN_Resolve_2_Charge_R:o.t("reversal"),External:o.t("update"),Transfer_Charge_R:o.t("reversal"),Payout_Request:o.t("payout"),Payout_Request_Charge:o.t("charge"),AccountValidationFee:o.t("charge"),Account_Validation_Charge_R:o.t("reversal")},a.getLink=function(e){return{Transaction:"transactions.one",Transfer:"transfers.one",Transfer_R:"transfers.one",Transfer_Charge:"transfers.one",Settlement:"payouts.one",Refund:"refunds",Refund_R:"refunds",Transfer_Charge_R:"transfers.one",Payout_Request:"payouts.one",Payout_Request_Charge:"payouts.one"}[e.model_responsible]},a.viewBalanceDetail=function(e){a.getLink(e)&&(t.go(a.getLink(e),{id:e.model_row}),v("Clicked activity",{activity:a.modelMapping[e.model_responsible]}))},d.all([l.getBalances(),l.getRevenueForToday()]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];a.balance=n.data.find(function(e){return e.currency===a.selectedCurrency});var o=r.data.pending_transfers_by_currency;a.pendingBalance=o.find(function(e){return e.currency===a.selectedCurrency}),a.$broadcast("fetchedBalanceAndRevenue")}).catch(function(e){s.error("Could not fetch balance data",e),a.$broadcast("fetchedBalanceAndRevenue",!1)}),a.onPeriodChanged=function(e){switch(e){case"day":a.query.from=null,a.query.to=null;break;case"range":a.query.for=null;default:a.query.from=null,a.query.to=null,a.query.for=null}}}]),angular.module("app.charges",["ui.router"]).config(["$stateProvider",function(e){e.state("app.charges",{url:"/charges?status",pageTrack:"/charges",title:"Bulk Charges",templateUrl:"modules/charges/list.html",controller:"ChargeListCtrl",redirectTo:"transactions.list",permission:"customer-*",resolve:{charges:["API","$stateParams",function(e,t){return e.one("bulkcharge").get(t)}]}}).state("app.charges.one",{url:"/:id",title:"charges",templateUrl:"modules/charges/one.html",controller:"ChargeCtrl",resolve:{charge:["API","$stateParams",function(e,t){return e.one("bulkcharge",t.id).get()}]}})}]).controller("ChargeListCtrl",["$state","$scope","$stateParams","$filter","charges","ngDialog",function(e,t,n,r,o,a){t.meta=o.meta,t.charges=o.data,t.createCharge=function(){a.open({template:"newCharge",controller:"NewChargeCtrl",trapFocus:!1})}}]).controller("ChargeCtrl",["$state","$scope","$stateParams","API","charge","ngDialog","Notification",function(t,n,r,o,e,a,i){n.charge=e.data,n.update=function(){o.one("bulkcharge",n.charge.batch_code).customPUT([]).then(function(){i.success("Charge paused","The rest of the transactions will not be charged"),t.reload()},function(e){n.$broadcast("chargeUpdated",!1),i.error("Could not update this charge",e)})},n.fetchTransactions=function(e){o.one("bulkcharge/"+r.id,"charges").get().then(function(e){n.transactions=e.data,n.meta=e.meta,n.loading=!1},function(){n.loading=!1})},n.pause=function(){o.all("bulkcharge/pause/"+r.id).post().then(function(e){i.success("Charge paused","The rest of the transactions will not be charged"),t.reload()},function(){n.$broadcast("chargePaused",!1),i.error("Could not pause this charge",error)})},n.resume=function(){o.all("bulkcharge/resume/"+r.id).post().then(function(e){i.success("Charge resume","The rest of the transactions will now be charged"),t.reload()},function(){n.$broadcast("chargeResumed",!1),i.error("Could not resume this charge",error)})}}]).controller("NewChargeCtrl",["$state","$scope","API","ngDialog","Notification",function(t,r,n,e,o){r.$on("uploaded_charges",function(e,t){r.charges=a(t),i(r.charges),r.$apply()});var a=function(e){for(var t=e.split(/\r\n|\n/),n=t[0].split(","),r=[],o=0;o<t.length;o++){var a=t[o].split(",");if(a.length==n.length){for(var i=[],s=0;s<n.length;s++)i.push(a[s]);r.push(i)}}return r},i=function(e){var t=[],n=[];try{_.each(e,function(e){(e.length<2||2<e.length)&&t.push("Extra rows found."),"string"!=typeof e[0]&&t.push("Invalid authorization code found."),isNaN(e[1])&&t.push("Invalid amount found."),n.push({authorization:e[0],amount:e[1]})})}catch(e){t=["Unknown problem while parsing."]}t.length?(r.charges=null,o.error("Error: "+t[0],"Please check your csv and try again")):r.sendCharge(n)};r.sendCharge=function(e){n.all("bulkcharge").post(e).then(function(e){t.go("app.charges",{},{reload:!0}).then(function(){r.closeThisDialog(),t.go("app.charges.one",{id:e.data.batch_code}),o.success("Bulk upload successful","The authorizations will now be charged")})},function(e){r.$broadcast("chargeCreated",!1),o.error("Could not perform this charge",e)})}}]),angular.module("app.compliance",["ui.router"]).config(["$stateProvider",function(e){e.state("app.compliance",{url:"/compliance",pageTrack:"/compliance",templateUrl:"/modules/compliance/views/index.html",resolve:{complianceStatusData:["ComplianceStatus",function(e){return e.getComplianceStatus()}]},redirectTo:"app.compliance.profile",controller:["$state","$scope","$rootScope","complianceStatusData",function(e,t,n,r){t.complianceStatusData=r;var o,a,i,s,c=n.Business||{attributes:{}},u=c.is_live,l=c.primary_contact_email,d=c.attributes,p=d.compliance_documents_submitted,f=d.duplicated_from_integration,m=d.compliance_status,g=e.params&&e.params.edit,h=f&&!u&&"NEW"===m,y=[[p&&!g&&!u,l?i18next.t("activateBusiness.statusMessage",{email:l}):i18next.t("activateBusiness.statusMessageNoEmail")],[h,i18next.t("activateBusiness.duplicateBusinessMessage")]];o=y.find(function(e){return e[0]})||[!1,""],a=_slicedToArray(o,2),i=a[0],s=a[1],t.showStatusMessage=i,t.statusMessage=s}]}).state("app.compliance.profile",{url:"/profile?edit",pageTrack:"/profile",templateUrl:"/modules/compliance/views/profile/index.html",controller:"ComplianceProfileController"}).state("app.compliance.contact",{url:"/contact?edit",pageTrack:"/contact",templateUrl:"/modules/compliance/views/contact/index.html",controller:"ComplianceContactController"}).state("app.compliance.owner",{url:"/owner?edit",pageTrack:"/owner",templateUrl:"/modules/compliance/views/owner/index.html",controller:"ComplianceOwnerController"}).state("app.compliance.account",{url:"/account?edit",pageTrack:"/account",templateUrl:"/modules/compliance/views/account/index.html",controller:"ComplianceAccountController"}).state("app.compliance.documents",{url:"/documents?edit",pageTrack:"/documents",templateUrl:"/modules/compliance/views/documents/index.html",controller:"ComplianceDocumentsController"})}]);var ConsentModule=angular.module("app.consent",["ui.router"]);function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ConsentModule.config(["$stateProvider",function(e){e.state("app.consent",{url:"/consent?type&referrer",templateUrl:"modules/consent/views/index.html",controller:"ConsentCtrl",title:"Consent",data:{authenticable:!0}})}]),angular.module("app.customer-insights",["ui.router","rzModule"]).config(["$stateProvider",function(e){e.state("customer-insights",{abstract:!0,url:"/customers-insights",templateUrl:"components/layout/base.html",redirectTo:"customer-insights.list",title:"Customers Insights",data:{permission:"customer-insights",authenticable:!0}}).state("customer-insights.list",{templateUrl:"/modules/customer-insights/views/index.html",pageTrack:"/customer-insights",url:"?period&from&to",resolve:{config:["$stateParams",function(e){"custom"!=e.period&&(e.from=e.to=null),_.contains(["today","week","month","30","90","year","all","custom"],e.period)||(e.period="30")}]},controller:"CustomerInsightsCtrl"})}]),angular.module("app.customers",["ui.router"]).config(["$stateProvider",function(e){e.state("customers",{abstract:!0,url:"/customers",templateUrl:"components/layout/base.html",redirectTo:"customers.list",title:"Customers",data:{permission:"customer-view",authenticable:!0}}).state("customers.list",{url:"?period&for&from&to&page&category&status&limit&limit_type&use_cursor&next&previous&per_page",pageTrack:"/customers",title:"Customers",templateUrl:"modules/customers/list.html",controller:"CustomerListCtrl"}).state("customers.one",{url:"/:id",pageTrack:"/customers",title:"Customers",templateUrl:"modules/customers/one.html",controller:"SingleCustomerCtrl",resolve:{customer:["API","$stateParams",function(e,t){return e.one("customer",t.id).get({cache:!1})}]},redirectTo:"customers.one.transactions"}).state("customers.one.cards",{url:"/cards",pageTrack:"/customers",templateUrl:"modules/customers/one/cards.html",showBackButton:!0}).state("customers.one.transactions",{url:"/transactions?plan",pageTrack:"/customers",templateUrl:"modules/customers/one/transactions.html",showBackButton:!0}).state("customers.one.subscriptions",{url:"/subscriptions",pageTrack:"/customers",templateUrl:"modules/customers/one/subscriptions.html",showBackButton:!0}).state("customers.one.mandates",{url:"/mandates",pageTrack:"/customers",templateUrl:"modules/customers/one/mandates.html",showBackButton:!0}).state("customers.one.invoices",{url:"/invoices",pageTrack:"/customers",templateUrl:"modules/customers/one/invoices.html",showBackButton:!0}).state("customers.one.account",{url:"/account",pageTrack:"/customers",templateUrl:"modules/customers/one/account.html",showBackButton:!0})}]).factory("CustomerData",["URLService","CustomerQueryService","API",function(t,n,r){return{fetch:function(e){var t=n.getQueryParams();return r.one(t.model).get(_objectSpread(_objectSpread({},t),e))},getTotalCustomersCount:function(){var e=t.getQuery();return r.one("customer").get(_objectSpread(_objectSpread({},e),{},{perPage:1,next:null,previous:null,use_cursor:!1})).then(function(e){return e&&e.meta&&e.meta.total})}}}]).service("CustomerQueryService",["$stateParams",function(r){return{getQueryParams:function(){var e={status:r.status,from:r.from,to:r.to,category:r.category,limit:r.limit,limit_type:r.limit_type};if(r.period||(e.from=null,e.to=null),"today"===r.period&&(e.from=moment().startOf("day").format(),e.to=null),"day"===r.period){var t=new Date(r.for);e.from=moment(t).startOf("day").format(),e.to=moment(t).endOf("day").format()}"range"===r.period&&(e.from=moment(new Date(e.from)).startOf("day").format(),e.to=moment(new Date(e.to)).endOf("day").format());var n=Object.values(e).some(function(e){return!!e});return e.model=n?"insights/customer":"customer",e.page=r.page,e}}}]).controller("CustomerListCtrl",["$state","$scope","$stateParams","CustomerQueryService","CustomerData","utils","Notification","AmplitudeService",function(e,r,o,t,a,n,i,s){r.query=angular.copy(o),r.queryParams=t.getQueryParams(),r.customerPages=[],r.customers=[],r.formatPhoneNumber=function(e,t){return n.formatPhoneNumber(e,t&&t.calling_code)};var c=s.logEvent,u=!1,l=function(e,t){var n=o.use_cursor?"cursor":"paging";u||c(e,_objectSpread({"Pagination type":n},t))},d=function(e){return l("Customer List endpoint request started"),a.fetch(_objectSpread(_objectSpread({},e),{},{use_cursor:o.use_cursor})).then(function(e){return l("Customer List endpoint request complete"),u=!0,e}).catch(function(e){l("Customer List endpoint request complete",{"Error code":e.status}),u=!0,i.error("Could not fetch customers",e),r.$broadcast("fetchedCustomers",!1)})};d().then(function(e){var t=e.data,n=e.meta;r.customerPages=[].concat(_toConsumableArray(r.customerPages),[t]),r.customers=t,r.meta=n,o.use_cursor&&(t.length>=n.perPage?a.getTotalCustomersCount().then(function(e){r.meta.total=e}):r.meta.total=t.length),r.$broadcast("fetchedCustomers")}),r.fetchingMoreCustomers=!1;var p=!(r.fetchMoreCustomers=function(e){var t=e.next;return r.fetchingMoreCustomers=!0,d({next:t}).then(function(e){var t=e.data,n=e.meta;r.meta.next=n.next,r.customerPages=[].concat(_toConsumableArray(r.customerPages),[t]),r.fetchingMoreCustomers=!1})});r.checkForNewCustomers=function(){p||(p=!0,d({prev:r.meta.next}).then(function(){p=!1}))}}]).controller("SingleCustomerCtrl",["$state","$scope","$rootScope","$stateParams","API","ngDialog","customer","Notification","Session","utils","AmplitudeService","TransactionSplitsData",function(o,a,i,e,s,t,n,c,u,r,l,d){var p=_objectSpread(_objectSpread({},n.data),{},{phone:_objectSpread({subscriber_number:n.data.phone},n.data.metadata&&n.data.metadata.calling_code&&{calling_code:n.data.metadata.calling_code})});a.customer=_objectSpread({},p),a.setView=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=a["".concat(e,"View")];n.mouseEvent&&"inputValue"===r||(a["".concat(e,"View")]=t)};var f=l.logEvent;a.resetCustomerData=function(){a.customer=_objectSpread({},p)},a.logEvent=function(e){return f(e)},s.one("customer/totals",e.id).get().then(function(t){a.customerTotals=t.data;var n=u.get("account")&&u.get("account").default_currency;a.customerTotals.spend=function(){var e=t.data.total_transaction_value.find(function(e){return e.currency===n});return e&&e.amount||0}}),a.setRiskAction=function(e){s.all("customer/set_risk_action").post({customer:a.customer.customer_code,risk_action:e}).then(function(){["allow","deny"].includes(e)&&f("deny"===e?"Blacklisted customer":"Whitelisted customer"),c.success("Updated successfully","Customer has been updated successfully"),o.reload()}).catch(function(e){c.error("Could not set risk action",e)})},a.hasExistingName=!(!n.data.first_name&&!n.data.last_name),a.updateCustomerName=function(){var e=a.customer,t={first_name:e.first_name,last_name:e.last_name};s.one("customer",a.customer.customer_code).customPUT(t).then(function(){var e="".concat(a.hasExistingName?"Updated":"Added"," customer name");f(e),c.success("Customer name updated"),o.reload()}).catch(function(e){c.error("Could not update customer name",e)})};var m=!!n.data.phone;a.updateCustomerPhoneNumber=function(){var e={phone:a.customer.phone};s.one("customer",a.customer.customer_code).customPUT(e).then(function(){var e="".concat(m?"Updated":"Added"," phone number");f(e),c.success("Customer phone number updated"),o.reload()}).catch(function(e){c.error("Could not update customer phone number",e)})},a.showCards=function(){var e=_.where(n.data.authorizations,{channel:"card"});a.authorizations=_.map(e,function(e){if(e.exp_month&&e.exp_year){var t=moment().year(e.exp_year);t.month(e.exp_month),e.status=t.isAfter(moment())?"active":"expired"}return e})},a.dedicatedNubanEnabled="registered"===i.Business.business_type&&i.Business.is_live&&"NG"===i.Business.attributes.country_code&&!i.Business.is_disabled,a.generateAccountNumber=function(){f("Clicked Generate Dedicated NUBAN",{"Needs Phone Number":!!a.customer.phone,"Needs Full Name":!(a.customer.first_name&&a.customer.last_name)}),t.open({template:"modules/customers/modals/generate-nuban.html",controller:"CustomerNUBANCtrl",showClose:!0,width:500,closeByDocument:!1,data:{customer:n.data}})},a.deleteAccountNumber=function(){t.open({template:"modules/customers/modals/delete-nuban.html",controller:"CustomerNUBANCtrl",showClose:!0,closeByDocument:!1,data:{customer:n.data}})},a.transactionSplits=[],a.customer.dedicated_account&&d.fetch().then(function(e){a.transactionSplits=e.data}),a.addingSplitConfig=!1,a.addSplitConfig=function(e){a.addingSplitConfig=!0;var t={account_number:a.customer.dedicated_account.account_number,split_code:e.split_code};s.all("dedicated_account/split").post(t).then(function(){c.success("Dedicated account split added"),o.reload()}).catch(function(e){c.error("Could not add dedicated account split",e)}).finally(function(){a.addingSplitConfig=!1})},a.removeSplitConfig=function(){s.all("dedicated_account/split").customOperation("remove","",null,"",{account_number:a.customer.dedicated_account.account_number}).then(function(){c.success("Dedicated account split removed"),a.$broadcast("splitConfigRemoved"),o.reload()}).catch(function(e){c.error("Could not remove dedicated account split",e),a.splitToggleActive=!0,a.$broadcast("splitConfigRemoved",!1)})};var g=a.customer.dedicated_account&&a.customer.dedicated_account.split_config||{},h=g.split_code||g.subaccount_code;a.totalSubaccountShare=(g.subaccounts||[]).reduce(function(e,t){return e+t.share},0),a.splitData=g,a.splitToggleActive=!!h||!1,a.toggleSplitConfig=function(){a.splitToggleActive?(a.splitToggleActive=!1,h&&a.removeSplitConfig()):a.splitToggleActive=!0},a.blacklistCustomer=function(){t.open({template:"modules/customers/modals/blacklist-customer.html",showClose:!0,closeByDocument:!1,width:500,scope:a})},a.whitelistCustomer=function(){t.open({template:"modules/customers/modals/whitelist-customer.html",showClose:!0,closeByDocument:!1,width:500,scope:a})},a.formattedPhoneNumber=r.formatPhoneNumber(a.customer.phone,a.customer.metadata&&a.customer.metadata.calling_code),a.postCharge=function(t,n){t.is_being_charged=!0;var e=[{display_name:"Note",variable_name:"note",value:n.note}],r={authorization_code:t.authorization_code,email:a.customer.email,amount:100*n.amount,currency:n.currency||u.get("account").default_currency,metadata:JSON.stringify({charged_from:"dashboard",charged_by:i.User.id,custom_fields:n.note?e:null})};s.all("transaction/charge_authorization").post(r).then(function(e){e.data&&"success"==e.data.status?(c.success("Charge successful","Customer has been charged "+r.currency+" "+n.amount),o.reload()):(t.is_being_charged=!1,c.error("Could not charge the customer / card",e.data.gateway_response))},function(e){t.is_being_charged=!1,c.error("Could not charge the customer / card",e)})},a.delete=function(){t.openConfirm({template:"/components/modals/delete.html",scope:a,controller:"CustomerPopupCtrl"}).then(function(){c.success("Deleted successfully","Customer account "+a.customer.email+" has been removed"),o.go("customers.list")})},a.fetchData=function(t,e,n){a.loading=!0;var r={status:e,customer:a.customer.id,page:n,use_cursor:"transaction"===t,perPage:10};s.one(t).get(r).then(function(e){a[t+"s"]=e.data,a.meta=e.meta,a.$broadcast("fetchedData")},function(){a.$broadcast("fetchedData")})},a.fetchSubscriptions=function(){var t={customer:a.customer.id,perPage:5},e=["active","complete"].map(function(e){return s.one("subscription").get(_objectSpread(_objectSpread({},t),{},{status:e}))});Promise.all(e).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];a.activeSubscriptions=n.data,a.completedSubscriptions=r.data,a.totalSubscriptions=a.activeSubscriptions.length+a.completedSubscriptions.length,a.$broadcast("fetchedSubscriptions")}).catch(function(e){a.$broadcast("fetchedSubscriptions",!1),c.error("Failed to fetch ".concat(status," subcriptions"),e)})},a.fetchMandates=function(){s.one("debit-order/mandate?email_search=".concat(a.customer.email,"&perPage=5")).get().then(function(e){a.mandates=e.data,a.$broadcast("fetchedMandates")}).catch(function(e){a.$broadcast("fetchedMandates",!1),c.error("Failed to fetch mandates",e)})},a.getMandateStatus=function(e){return{suspended:"paused",created:"processing"}[e]||e},a.subscriptionIntervals={hourly:"hour",daily:"day",weekly:"week",monthly:"month",quarterly:"quarter",biannually:"6 months",annually:"year"}}]).controller("CustomerPopupCtrl",["$state","$scope","API","ngDialog","Notification",function(e,t,n,r,o){t.create=function(){n.all("customer").post(t.newCustomer).then(function(){o.success("Created successfully","Customer has been created successfully"),e.reload(),t.closeThisDialog()},function(e){t.$broadcast("customerCreated",!1),o.error("Could not create the customer",e)})},t.customer=_.clone(t.customer),t.update=function(){var e=_.pick(t.customer,["first_name","last_name","phone"]);n.one("customer",t.customer.customer_code).customPUT(e).then(function(){n.all("customer/set_risk_action").post({customer:t.customer.customer_code,risk_action:t.customer.risk_action}).then(function(){o.success("Updated successfully","Customer has been updated successfully"),t.confirm()})},function(e){t.$broadcast("customerUpdated",!1),o.error("Could not complete customer update",e)})},t.itemToDelete="customer",t.delete=function(){n.one("customer",t.customer.customer_code).remove().then(function(){t.confirm()}).catch(function(e){t.$broadcast("deleteSuccessful",!1),o.error("Could not delete this customer",e)})}}]).controller("CustomerNUBANCtrl",["$scope","API","Notification","$state","AmplitudeService","utils",function(t,n,r,o,e,a){t.customer=t.ngDialogData.customer;var i=a.formatPhoneNumber(t.customer.phone,t.customer.metadata&&t.customer.metadata.calling_code);t.hasFullName=t.customer.first_name&&t.customer.last_name,t.view=i&&t.hasFullName?"choose_bank":"customer_details_input";var s=t.customer,c=s.first_name,u=s.last_name,l=s.phone;t.customerDetails={first_name:c,last_name:u,phone:l},t.nuban={};var d=e.logEvent;t.updateCustomerDetails=function(){n.one("customer",t.customer.customer_code).customPUT(t.customerDetails).then(function(){t.$broadcast("customerUpdated"),t.hasFullName?d("Add phone for Dedicated NUBAN"):d("Add name and phone for Dedicated NUBAN"),t.view="choose_bank"}).catch(function(e){t.$broadcast("customerUpdated",!1),r.error("Could not complete customer update",e)})},t.generateAccountNumber=function(){var e=_objectSpread({customer:t.customer.customer_code},t.nuban.preferred_bank&&{preferred_bank:t.nuban.preferred_bank});d("Confirmed Generate Dedicated NUBAN",{"Preferred Bank":t.nuban.preferred_bank||""}),n.all("dedicated_account").post(e).then(function(){t.$broadcast("accountGenerated"),d("Generated Dedicated NUBAN"),r.success("Success","Account number generated successfully"),o.reload(),t.closeThisDialog()}).catch(function(e){t.$broadcast("accountGenerated",!1),r.error("Could not generate account number",e)})},t.deleteAccountNumber=function(){d("Confirmed Deactivate Dedicated NUBAN"),n.one("dedicated_account",t.customer.dedicated_account.id).customDELETE().then(function(){t.$broadcast("accountDeactivated"),d("Deactivated Dedicated NUBAN"),r.success("Success","Account number deactivated successfully"),t.closeThisDialog(),o.reload()}).catch(function(e){t.$broadcast("accountDeactivated",!1),r.error("Could not deactivate account number",e)})},t.fetchProviders=function(){t.providers=[],t.loadingProviders=!0,n.one("dedicated_account/available_providers").get().then(function(e){t.providers=e.data,t.loadingProviders=!1}).catch(function(){t.loadingProviders=!1})}}]),angular.module("app.direct-debit",["ui.router"]).config(["$stateProvider",function(e){e.state("direct-debit",{abstract:!0,url:"/direct-debit",templateUrl:"components/layout/base.html",redirectTo:"direct-debit.accounts",data:{permission:"directdebit-*",authenticable:!0}}).state("direct-debit.accounts",{title:"Accounts",url:"/accounts",pageTrack:"/direct-debit-accounts",templateUrl:"modules/direct-debit/views/accounts/list.html",controller:"AccountsListCtrl"}).state("direct-debit.payments",{template:"<ui-view></ui-view>",redirectTo:"direct-debit.payments.list"}).state("direct-debit.payments.list",{title:"Payments",url:"/payments",pageTrack:"/direct-debit-accounts",templateUrl:"modules/direct-debit/views/payments/list.html",controller:"PaymentsListCtrl"}).state("direct-debit.payments.one",{title:"Payments",url:"/payments/:id",pageTrack:"/payments",templateUrl:"modules/direct-debit/views/payments/one.html",showBackButton:!0,controller:"SinglePaymentCtrl",resolve:{payment:["API","$stateParams",function(e,t){return e.one("transaction",t.id).get()}]}})}]),angular.module("app.disputes",["ui.router","chart.js"]).config(["$stateProvider",function(e){e.state("disputes",{abstract:!0,url:"/disputes",templateUrl:"components/layout/base.html",redirectTo:"disputes.list",data:{permission:"transaction-dispute",authenticable:!0}}).state("disputes.list",{title:"Disputes",url:"?status&from&to&page&period&for&transaction&category&resolution&use_cursor&next&previous&per_page",pageTrack:"/disputes",templateUrl:"modules/disputes/list.html",controller:"DisputesCtrl"})}]).controller("DisputesCtrl",["$scope","$stateParams","Session","Notification","API","LocalAPI","DisputesData","AmplitudeService","ngDialog","URLService",function(r,o,e,t,n,a,i,s,c,u){r.query=_.clone(o),r.disputes=[],r.disputeStatuses=[],r.disputeResolutions=[],r.disputePages=[],r.params=u.getQuery();var l=s.logEvent;i.getDefaults().then(function(e){var t=e.statuses,n=e.resolutions;r.disputeStatuses=t,r.disputeResolutions=n});var d=!1,p=function(e,t){var n=o.use_cursor?"cursor":"paging";d||l(e,_objectSpread({"Pagination type":n},t))},f=function(e){return p("Dispute List endpoint request started"),i.fetch(e).then(function(e){return p("Dispute List endpoint request complete"),d=!0,e}).catch(function(e){p("Dispute List endpoint request complete",{"Error code":e.status}),d=!0,r.$broadcast("fetchedDisputes",!1),t.error("Couldn't fetch disputes",e)})},m=null;f(o).then(function(e){var t=e.data,n=e.meta;r.disputePages=[].concat(_toConsumableArray(r.disputePages),[t]),r.disputes=t,r.meta=n,m=n.next,o.use_cursor&&(t.length>=n.perPage?i.getTotalDisputesCount().then(function(e){r.meta.total=e}):r.meta.total=t.length),r.$broadcast("fetchedDisputes")}),r.exportDisputesToEmail=function(){i.exportDisputesToEmail().then(function(){c.open({template:"/modules/disputes/modals/email-export-success.html",scope:r,showClose:!0,width:450})}).catch(function(e){return t.error("Could not export your disputes",e)})},r.showQuickExportSuccess=function(){c.open({template:"/modules/disputes/modals/quick-export-success.html",scope:r,showClose:!0,width:450})},r.fetchingMoreDisputes=!1;var g=!(r.fetchMoreDisputes=function(e){var t=e.next;return r.fetchingMoreDisputes=!0,f(_objectSpread(_objectSpread({},o),{},{next:t})).then(function(e){var t=e.data,n=e.meta;r.meta.next=n.next,r.disputePages=[].concat(_toConsumableArray(r.disputePages),[t]),r.fetchingMoreDisputes=!1})});r.checkForNewDisputes=function(){g||(g=!0,f(_objectSpread(_objectSpread({},o),{},{prev:m})).then(function(){g=!1}))},r.getStatusDescription=function(t){var e=r.disputeStatuses.find(function(e){return e.slug===t});return e?e.description:t},r.getResolutionDescription=function(t){var e=r.disputeResolutions.find(function(e){return e.slug===t});return e?e.short:t}}]).factory("DisputesData",["LocalAPI","API","URLService",function(e,r,t){var n=[],o=[];return{getDefaults:function(){return Promise.all([1<n.length?Promise.resolve(n):e.all("dispute_statuses").getList().then(function(e){return n=e}),1<o.length?Promise.resolve(o):e.all("dispute_resolutions").getList().then(function(e){return o=e})]).then(function(e){var t=_slicedToArray(e,2);return{statuses:t[0],resolutions:t[1]}})},fetch:function(e){var t=angular.copy(e);if("today"===t.period&&(t.from=moment().startOf("day").format(),t.to=null),"day"===t.period){var n=new Date(t.for);t.from=moment(n).startOf("day").format(),t.to=moment(n).endOf("day").format()}return"range"===t.period&&(t.from=moment(t.from).startOf("day").format(),t.to=moment(t.to).endOf("day").format()),r.one("dispute").withHttpConfig({ignoreLoadingBar:!0}).get(t)},getTotalDisputesCount:function(){var e=t.getQuery();return r.one("dispute").get(_objectSpread(_objectSpread({},e),{},{perPage:1,next:null,previous:null,use_cursor:!1})).then(function(e){return e&&e.meta&&e.meta.total})},exportDisputesToEmail:function(){var e=t.getQuery();return r.one("dispute","export").get(_objectSpread(_objectSpread({},e),{},{destination:"email"}))}}}]).factory("PendingDisputes",["API","Session",function(t,n){var r={data:[],meta:{},promise:null,fetching:!1,fetch:function(){if(!n.get("account"))return Promise.reject();if(!n.hasPermission("transaction-dispute"))return Promise.reject();if(!r.fetching){var e=moment(new Date("January 29 2018"));r.fetching=!0,r.promise=t.one("dispute").get({status:"awaiting-merchant-feedback",ignore_resolved:"yes",from:e.format("DD MMM Y")}).then(function(e){r.data=e.data,r.meta=e.meta,r.fetching=!1}).catch(function(){r.fetching=!1})}return r.promise}};return r}]);var FilesModule=angular.module("app.file-view",["ui.router"]);FilesModule.config(["$stateProvider",function(e){e.state("files",{abstract:!0,url:"/files",templateUrl:"components/layout/base.html",data:{authenticable:!0}})}]),angular.module("app.home",["ui.router"]).config(["$stateProvider",function(e){e.state("app.home",{template:"<ui-view></ui-view>",redirectTo:"app.home.dashboard",pageTrack:"/dashboard",url:"/dashboard"}).state("app.home.dashboard",{title:"Dashboard",url:"?period&from&to&currency",templateUrl:"modules/home/index.html",controller:"DashboardCtrl",permission:"metrics-*",fallback:"transactions.list",resolve:{config:["$stateParams",function(e){"custom"!=e.period&&(e.from=e.to=null),_.contains(["today","week","month","30","90","year","all","custom"],e.period)||(e.period="30")}]}})}]).factory("DashboardTrend",["API","URLService",function(e,n){return{fetch:function(){var t=n.format();return e.one("transaction/trend").get(t).then(function(e){return{data:e.data,params:t}})}}}]).factory("DashboardTotals",["API","URLService",function(t,n){return{fetch:function(){var e=n.format();return t.one("transaction/totals").get(e)}}}]).factory("DashboardPerformance",["API","URLService",function(t,n){return{fetch:function(){var e=n.format();return t.one("transaction/performance").get(e)}}}]).factory("DashboardBalances",["API","Session",function(e,t){return{fetch:function(){return t.hasPermission("balance-view")?e.one("balance").get():Promise.reject()}}}]).factory("DashboardLimit",["API","Session",function(e,t){return{fetch:function(){return e.one("starter_integration/limit",t.get("account").starter_integration).get()}}}]).controller("DashboardCtrl",["$state","$scope","$rootScope","Notification","Session","$filter","DashboardTrend","DashboardTotals","DashboardPerformance","DashboardBalances","TopupService","URLService","DashboardLimit","SettlementService","utils","$i18next","clipboard",function(e,t,n,r,o,a,i,s,c,u,l,d,p,f,m,g,h){t.period=e.params.period,t.startDate=e.params.from?a("date")(e.params.from,"DD MMM YYYY"):"",t.endDate=e.params.to?a("date")(e.params.to,"DD MMM YYYY"):"";var y=d.formatMoment();t.params={from:y.from.format("DD MMM YYYY"),to:y.to.format("DD MMM YYYY")},t.periodMapping={today:g.t("home.periodFilter.today"),all:g.t("home.periodFilter.all"),custom:g.t("home.periodFilter.custom"),week:g.t("home.periodFilter.week"),month:g.t("home.periodFilter.month"),year:g.t("home.periodFilter.year"),30:g.t("home.periodFilter.30"),90:g.t("home.periodFilter.90")};var b=n.User,v=n.Business;t.selectedCurrency=e.params.currency||v.default_currency;var S=b.hasPermission("transfer-*")&&v.is_live,P=[{isActive:S,text:g.t("home.metrics.balance.withdraw"),toState:"transfers.new({ withdraw: true, currency: '".concat(t.selectedCurrency,"' })")},{isActive:!S,text:g.t("home.metrics.balance.viewHistory"),toState:"balance-history.list"},{isActive:!0,text:g.t("home.metrics.balance.topup"),onClick:function(){l.topup().catch(function(e){return r.error("Could not topup your account",e)}).finally(function(){e.reload()})}}];t.balanceButtons=P.filter(function(e){return e.isActive});var w=o.get("account");t.topupAccounts=w.top_up_accounts||[],t.copyAccountNumber=function(e){h.copyText(e),r.success(g.t("home.topupAccount.copied"))},t.requeryAccount=function(e){l.requery(e.account_number,e.bank.slug).then(function(e){r.success("Request successful",e.message,0),t.$broadcast("accountRequeried",!0)}).catch(function(e){r.error("Request failed",e,0),t.$broadcast("accountRequeried",!1)})},u.fetch().then(function(e){t.balances=e.data.reduce(function(e,t){return 0<t.balance&&(e[t.currency]=t),e},{}),t.balanceCurrencies=Object.keys(t.balances),t.$broadcast("fetchedBalance")}).catch(function(){t.balances=[]}),t.totalVolumeByCurrency=[],s.fetch().then(function(e){t.totals=e.data,t.totalVolumeByCurrency=e.data.total_volume_by_currency.filter(function(e){return 0<e.amount}),f.getNextBusinessDay({country:v.attributes.country}).then(function(e){t.next_payout_date=moment().day(e).calendar(null,{nextDay:"[Tomorrow], MMMM D",nextWeek:"dddd, MMMM D",sameElse:"dddd, MMMM D YYYY"})}),t.pendingPayout=e.data.pending_transfers_by_currency.reduce(function(e,t){return 0<t.amount&&(e[t.currency]=t),e},{}),t.payoutCurrencies=Object.keys(t.pendingPayout),t.$broadcast("fetchedTotals"),t.trend&&t.$broadcast("fetchedAllMetrics")}),i.fetch().then(function(e){t.trend=_.map(e.data,function(e){return e.total_transactions=e.transactions,e.transactions=e.successful_transactions+e.failed_transactions,e.failure_rate=e.failed_transactions/e.transactions||0,e.abandonment=e.abandoned_transactions/e.total_transactions||0,e}),t.totals&&t.$broadcast("fetchedAllMetrics")}),c.fetch().then(function(e){t.performance=e.data,t.$broadcast("fetchedPerformance")}),t.customPeriod=function(e){e.period="custom",t.reloadWithParams(e)},t.payoutLimitPercentage=0,v.is_live&&"starter"===v.business_type&&p.fetch().then(function(e){t.payoutLimit={usage:e.data.total_transactions,total:e.data.limit},t.payoutLimitPercentage=Math.round(t.payoutLimit.usage/t.payoutLimit.total*100)}),t.payoutAmountFormatter=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=Math.round(m.toNaira({amount:e}).amount),n=String(t),r=n[0];return 6===n.substring(1,n.length).length?"".concat(r,"m"):n||0}}]).controller("TrendCtrl",["$scope","$state","URLService","$rootScope","DashboardTotals",function(n,e,t,r,o){var a=r.Business,i=_.map(n.trend,function(e){return e.volume=_.filter(e.volume,"amount"),e}),s=_.pluck(i,"volume"),c=_.reduce(s,function(e,t){return e.concat(t)},[]),u=_.uniq(_.pluck(c,"currency"));n.currencies=u,n.series=u;var l=[];_.each(u,function(n){var e=_.map(i,function(e){var t=_.find(e.volume,function(e){return e.currency==n});return t?parseInt(t.amount/100):0});l.push(e)}),n.data=_.clone(l);var d=[{fillColor:"rgba(17, 160, 78, 0.1)",strokeColor:"rgba(17, 160, 78, 0.8)",pointColor:"rgb(16, 186, 87)"},{fillColor:"rgba(54, 118, 200, 0.1)",strokeColor:"rgba(54, 118, 200, 0.8)",pointColor:"rgb(54, 118, 200)"},{fillColor:"rgba(231, 76, 60, 0.1)",strokeColor:"rgba(231, 76, 60, 0.8)",pointColor:"rgb(231, 76, 60)"}];n.colors=d,n.filterCurrency=function(e){if(e){var t=_.indexOf(u,e);-1===t?n.data=[]:(n.data=[l[t]],n.activeCurrency=e,n.series=[e],n.colors=[d[t]])}else n.data=_.clone(l),n.activeCurrency=null,n.series=u,n.colors=d},n.selectedRevenueCurrency=a.default_currency,n.setSelectedRevenueCurrency=function(e){n.selectedRevenueCurrency=e,n.filterCurrency(e)},n.filterCurrency(n.selectedRevenueCurrency),n.getSelectedCurrencyRevenueVolume=function(t){return(n.totalVolumeByCurrency.find(function(e){return e.currency===t})||{}).amount};var p=t.formatMoment(),f=p.from.year()===p.to.year();n.labels=_.map(i,function(e,t){switch(p.period){case"hour":return moment(e.to).format("hh A");case"month":return moment(e.to).format(f?"MMM":"MMM YY");case"week":return moment(e.from).format("MMM D")+" - "+moment(e.to).format("D");default:return moment(e.from).format("MMM D")}}),n.fullLabels=_.map(i,function(e,t){switch(p.period){case"week":return{short:moment(e.to).format("MMM D"),long:moment(e.from).format("MMM D")+" - "+moment(e.to).format("MMM D"),range:moment(e.from).format("MMM D")+" - "+moment(e.to).format("D")};case"month":return{short:moment(e.to).format(f?"MMM":"MMM YY"),long:moment(e.to).format("MMMM YYYY")};default:return{}}});var m='-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif';n.options={scaleShowVerticalLines:!1,scaleFontFamily:m,scaleLineColor:"transparent",tooltipTemplate:function(e){return function(t,e){switch(p.period){case"month":return _.find(n.fullLabels,function(e){return t==e.short}).long;case"week":return _.find(n.fullLabels,function(e){return t==e.range}).long;default:return t}}(e.label,e.datasetLabel)+": "+e.datasetLabel+" "+e.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},multiTooltipTemplate:function(e){return e.datasetLabel+": "+e.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},tooltipTitleFontFamily:m,tooltipFontFamily:m,tooltipFontStyle:"normal",tooltipFontSize:12,tooltipTitleFontSize:12,tooltipCornerRadius:3,tooltipXPadding:10,tooltipYPadding:10,tooltipCaretSize:4,barStrokeWidth:1,pointHitDetectionRadius:i.length<15?20:i.length<=30?14:30<i.length?8:void 0}}]).controller("PerformanceCtrl",["$scope","$state","URLService","$i18next",function(e,t,n,r){var o=e.performance||{count:{},errors:{}},a=n.formatMoment();e.params={from:a.from.format("DD MMM YYYY"),to:a.to.format("DD MMM YYYY")};var i={min:20,max:30};var s,c,u,l;e.successful_transactions=o.count.success,e.failed_transactions=o.count.failed,e.abandoned_transactions=o.count.abandoned,e.attempted_transactions=o.count.success+o.count.failed,e.total_transactions=e.attempted_transactions+o.count.abandoned,e.abandonment_rate=(s=o.count.success+o.count.failed+o.count.abandoned,{value:c=o.count.abandoned/s*100,verdict:i.max<c?"high":c<i.min?"low":"average"}),e.errors=(u=o.count.success+o.count.failed,{customer:(l=o.errors||{}).customer,customer_percentage:l.customer/u*100,bank:l.bank,bank_percentage:l.bank/u*100,paystack:l.paystack,paystack_percentage:l.paystack/u*100,fraudulent:l.fraudulent,fraudulent_percentage:l.fraudulent/u*100}),e.valid_transactions=e.attempted_transactions-e.errors.customer-e.errors.fraudulent;var d=e.errors.bank+e.errors.paystack;e.success_rate=0===e.valid_transactions?0:o.count.success/(o.count.success+d)*100,e.paystack_abandonment_rate=i,e.successRateCollection=[{label:r.t("home.metrics.successful"),color:"#5cb85c",link:"transactions.list({ status: 'success', period: 'range', from: '".concat(e.params.from,"', to: '").concat(e.params.to,"' })"),data:e.successful_transactions},{label:r.t("home.metrics.processingErrors"),color:"#E5E5E5",data:d}],e.getSuccessRateValuesByKey=function(t){return e.successRateCollection.map(function(e){return e[t]})},e.successRateLabels=e.getSuccessRateValuesByKey("label"),e.successRateData=e.getSuccessRateValuesByKey("data"),e.successRateColors=e.getSuccessRateValuesByKey("color"),e.paymentIssuesCollection=[{label:r.t("home.metrics.customerErrors"),color:"#FFAA22",link:"transactions.list({ status: 'failed', error: 'customer', period: 'range', from: '".concat(e.params.from,"', to: '").concat(e.params.to,"' })"),data:e.errors.customer},{label:r.t("home.metrics.fraudBlocks"),color:"#B1320A",link:"transactions.list({ status: 'failed', error: 'fraudulent', period: 'range', from: '".concat(e.params.from,"', to: '").concat(e.params.to,"' })"),data:e.errors.fraudulent},{label:r.t("home.metrics.bankErrors"),color:"#D48C00",link:"transactions.list({ status: 'failed', error: 'bank', period: 'range', from: '".concat(e.params.from,"', to: '").concat(e.params.to,"' })"),data:e.errors.bank},{label:r.t("home.metrics.systemErrors"),color:"#F05051",link:"transactions.list({ status: 'failed', error: 'processing', period: 'range', from: '".concat(e.params.from,"', to: '").concat(e.params.to,"' })"),data:e.errors.paystack}],e.getPaymentIssuesValuesByKey=function(t){return e.paymentIssuesCollection.map(function(e){return e[t]})},e.paymentIssuesLabels=e.getPaymentIssuesValuesByKey("label"),e.paymentIssuesData=e.getPaymentIssuesValuesByKey("data"),e.paymentIssuesColors=e.getPaymentIssuesValuesByKey("color"),e.paymentIssuesCount=e.paymentIssuesData.reduce(function(e,t){return e+t},0),e.options={showTooltips:!1,percentageInnerCutout:93,animateRotate:!1},e.labels_abandoned=["Attempted","Abandoned"],e.data_abandoned=[o.count.abandoned,o.count.success+o.count.failed],e.colors_abandoned=["#fad733","#E5E5E5"]}]),angular.module("app.invoices",["ui.router","autocomplete"]).config(["$stateProvider",function(e){e.state("invoices",{abstract:!0,url:"/invoices",title:"Invoices",templateUrl:"components/layout/base.html",redirectTo:"invoices.list",data:{permission:"paymentrequest-view",authenticable:!0}}).state("invoices.list",{url:"?page&search&customer&status&id&from&to&type",pageTrack:"/invoices",title:"Invoices",templateUrl:"modules/invoices/list.html",controller:"PaymentRequestsCtrl",resolve:{requests:["API","$stateParams",function(e,t){var n=angular.extend(t,{has_invoice:"has_invoice"===t.type||("no_invoice"===t.type?"false":null)});return e.one("paymentrequest").get(n)}],totals:["API","$stateParams",function(e,t){return e.one("paymentrequest/totals").get(t)}]}}).state("invoices.one",{url:"/:id",pageTrack:"/invoices",title:"Invoices",templateUrl:"modules/invoices/one.html",controller:"PaymentRequestCtrl",resolve:{request:["API","$stateParams",function(e,t){return e.one("paymentrequest",t.id).get()}],isInvoice:["request","$state","ngDialog",function(e,t,n){return!0===e.status&&e.data?e.data.has_invoice?Promise.resolve():(n.open({template:"/modules/invoices/modals/view-request.html",resolve:{request:[function(){return e.data}]},trapFocus:!1,showClose:!0,closeByDocument:!1,controller:"ViewRequestCtrl",width:550}),t.go("invoices.list"),Promise.reject()):(t.go("invoices.list"),void Promise.reject())}]}}).state("invoices.edit",{url:"/edit/:id",pageTrack:"/invoices",title:"Invoices",templateUrl:"modules/invoices/edit.html",controller:"EditRequestCtrl",permission:"paymentrequest-*",resolve:{customers:["API",function(e){return e.one("customer").get()}],request:["API","$stateParams",function(e,t){return e.one("paymentrequest",t.id).get()}]}})}]).controller("PaymentRequestsCtrl",["$state","$stateParams","$filter","$scope","$rootScope","ngDialog","requests","totals","API","DEFAULTS","Notification",function(t,e,n,r,o,a,i,s,c,u,l){r.requests=_.map(i.data,function(e){return e.paid=_.reduce(e.transactions,function(e,t){return e+t.amount},0),e.overdue=moment().isAfter(e.due_date)&&"pending"==e.status,e}),r.meta=i.meta,r.currencies=_.pluck(s.data.pending,"currency"),r.activeCurrency=0,r.totals=s.data,r.setCurrency=function(e){r.activeCurrency=e},r.startDate=e.from?n("date")(e.from,"dd MMM yyyy"):"",r.endDate=e.to?n("date")(e.to,"dd MMM yyyy"):"",r.search=e.search,r.status=e.status,r.type=e.type,r.reload=function(){t.go(t.current,t.params,{reload:!0,inherit:!0,notify:!0})},r.loadNewRequest=function(){a.open({template:"/modules/invoices/modals/new-request.html",resolve:{customers:["API",function(e){return e.one("customer").get()}]},trapFocus:!1,showClose:!0,controller:"NewRequestCtrl",width:500})},r.viewRequest=function(e){e.has_invoice?t.go("invoices.one",{id:e.id}):a.open({template:"/modules/invoices/modals/view-request.html",resolve:{request:[function(){return angular.copy(e)}]},trapFocus:!1,showClose:!0,closeByDocument:!1,controller:"ViewRequestCtrl",width:550}).closePromise.then(function(){t.reload()})}}]).controller("PaymentRequestCtrl",["$scope","$state","API","Notification","request","ngDialog","TaxDiscountService",function(r,o,a,i,e,t,n){r.request=e.data,r.request.url=settings.landingPage+"/pay/"+e.data.request_code,r.request.overdue=moment().isAfter(r.request.due_date)&&"success"!=r.request.status;var s=r.request.line_items||[],c=_.reduce(s,function(e,t){return e+t.amount},0),u=(c=n.getSubtotal(s,!0),n.getDiscountValue(c,r.request.discount,!0));r.taxes=_.map(r.request.tax,function(e){return{percentage:e.amount/(c-u)*100,amount:e.amount,name:e.name}}),r.totals=n.calculateTotals(r.request.line_items,r.taxes,r.request.discount,!0),r.currentDate=moment().format("DD MMM YYYY"),r.send=function(){a.one("paymentrequest/finalize",r.request.id).post().then(function(){o.reload()}).catch(function(e){r.$broadcast("sentRequest",!1),i.error("Your request was not sent",e)})},r.notify=function(t){a.one("paymentrequest/notify",r.request.id).post().then(function(e){t(),o.reload(),i.success("Reminder sent",r.request.customer.email+" has been reminded about this request")}).catch(function(e){r.$broadcast("notificationSent",!1),i.error("Your reminder was not sent",e)})},r.markPaid=function(e,t){var n=angular.copy(e);if(n.amount_paid=100*n.amount_paid,moment(new Date(e.payment_date)).isAfter(moment()))return r.$broadcast("markedPaid",!1),void i.error("Payment date is invalid","Please use a date in the past");a.all("paymentrequest/mark_as_paid/"+r.request.id).post(n).then(function(e){t(),o.reload(),i.success("Marked as paid","This invoice has been marked as paid")}).catch(function(e){r.$broadcast("markedPaid",!1),i.error("Your invoice could not be marked as paid",e)})},r.duplicate=function(){var e=angular.copy(r.request),t={currency:e.currency,customer:e.customer.customer_code,tax:e.tax,line_items:e.line_items,due_date:e.due_date,description:e.description,draft:!0};a.all("paymentrequest").post(t).then(function(e){o.go("invoices.edit",{id:e.data.id})},function(e){r.$broadcast("duplicateSuccessful",!1),i.error("Could not duplicate this request",e)})},r.delete=function(e){a.one("paymentrequest/archive",r.request.id).post().then(function(){e(),o.go("invoices.list")},function(e){r.$broadcast("deleteSuccessful",!1),i.error("Could not delete this request",e)})}}]).controller("NewRequestCtrl",["$state","$scope","$rootScope","$q","API","Notification","Session","customers","DEFAULTS",function(n,r,e,o,a,i,t,s,c){r.today=moment().subtract(1,"day").format(),r.ngDialogData=r.ngDialogData||{},r.request=r.ngDialogData.request||{currency:t.get("account").default_currency,has_invoice:!0},r.customers=s.data,r.meta=s.meta,r.upToMinimum=function(){return!c.minimumPayment[r.request.currency]||r.request.amount>=c.minimumPayment[r.request.currency]},r.customerSet=function(){return r.request.customer||r.request._customer||r.request._newCustomer};r.sendRequest=function(){var t;(t=o.defer(),r.request._customer?(r.request._customerUpdate?a.one("customer",r.request._customer.customer_code).customPUT(r.request._customerUpdate).then(function(e){t.resolve()},function(e){t.reject(e)}):t.resolve(),t.promise):a.all("customer").post(r.request._newCustomer).then(function(e){r.request.customer=e.data.customer_code,t.resolve()},function(e){t.reject(e)})).then(function(){return a.all("paymentrequest").post(e.formatRequest())}).then(function(e){var t=e.data;t.has_invoice?(n.go("invoices.edit",{id:t.id}),r.closeThisDialog()):(n.reload(),r.closeThisDialog(),i.success("Request sent","We have requested your payment"))}).catch(function(e){r.$broadcast("requestCreated",!1),i.error("Your request was not created",e)})}}]).controller("EditRequestCtrl",["$state","$scope","$rootScope","$filter","$q","API","Notification","customers","request","TaxDiscountService","TransactionSplitsData",function(a,i,e,t,s,c,u,n,r,o,l){i.today=moment().subtract(1,"day").format(),i.request=r.data,i.request._customer=i.request.customer,i.request.customer=i.request.customer.customer_code,i.request.due_date=i.request.due_date?t("date")(i.request.due_date,"dd MMM yyyy"):null,i.customers=n.data,i.meta=n.meta,i.transactionSplits=[];var d=i.request.line_items||[];i.line_items=_.map(d,function(e){return e.amount=e.amount/100,e});var p=!1;if(l.fetch().then(function(e){i.transactionSplits=e.data,p=1===e.meta.pageCount}),i.updateTransactionSplits=function(e){e&&!p&&l.fetch({search:e}).then(function(e){i.transactionSplits=e.data}).catch(function(e){u.error("Could not search for transaction split",e)})},i.request.tax.length){var f=o.getSubtotal(i.line_items),m=o.getDiscountValue(f,i.request.discount,!0);i.taxes=_.map(i.request.tax,function(e){return{percentage:e.amount/(f-m)*100,amount:e.amount,name:e.name}})}else i.taxes=[{name:"Tax",amount:0,percentage:0}];i.discount=i.request.discount||{type:"percentage",amount:0},"flat_amount"===i.discount.type&&(i.discount.amount=i.discount.amount/100),i.resetDiscount=function(){i.discount.amount=0,i.updateTotals()},i.updateTotals=function(){i.totals=o.calculateTotals(i.line_items,i.taxes,i.discount)},i.updateTotals(),i.save=function(n){if(!i.line_items[0]||!i.totals.subtotal)return u.error("No Line Items","Please review your invoice"),void i.$broadcast("requestUpdated",!1);var e=angular.copy(i.request),t=angular.copy(i.line_items);e.line_items=_.map(t,function(e){return e.amount=100*e.amount,e.quantity=e.quantity||1,e});var r=_.map(i.taxes,function(e){return{amount:e.percentage/100*(i.totals.subtotal-i.totals.discount),name:e.name}});e.tax=_.filter(r,function(e){return 0<e.amount}),i.discount.amount?(e.discount=angular.copy(i.discount),"flat_amount"===e.discount.type&&(e.discount.amount=100*e.discount.amount)):e.discount=null,e.amount=i.totals.amount_due,e.customer=e.customer||angular.copy(i.request._email),e.due_date=e.due_date?e.due_date=moment(new Date(e.due_date)).endOf("day").toISOString():null,e.send_notification=n.send&&"draft"!=i.request.status;var o;(o=s.defer(),i.request._customer?(i.request._customerUpdate?c.one("customer",i.request._customer.customer_code).customPUT(i.request._customerUpdate).then(function(e){o.resolve()},function(e){o.reject(e)}):o.resolve(),o.promise):c.all("customer").post(i.request._newCustomer).then(function(e){i.request.customer=e.data.customer_code,o.resolve()},function(e){o.reject(e)})).then(function(){return c.one("paymentrequest",i.request.id).customPUT(e)}).then(function(e){var t=s.defer();return"draft"==i.request.status&&n.send?c.one("paymentrequest/finalize",i.request.id).post():(t.resolve(),t.promise)}).then(function(e){n.send?u.success("Request Sent","Your request has been updated and sent"):u.success("Request Updated","Your request has been updated successfully"),a.go("invoices.one",{id:i.request.id})}).catch(function(e){i.$broadcast("requestUpdated",!1),u.error("Your request was not updated",e)})}}]).service("TaxDiscountService",[function(){return{getSubtotal:function(e,t){var n=_.reduce(e,function(e,t){return e+t.amount*t.quantity},0);return t?n:100*n},getSumOfTaxes:function(e,t,n,r){var o=_.reduce(t,function(e,t){return e+(t.percentage<100?t.percentage:0)},0);return{percentage:o,amount:(e-(n=this.getDiscountValue(e,n,r)))*o/100}},getDiscountValue:function(e,t,n){return t?"percentage"!==t.type?n?t.amount:100*t.amount:e*(t.amount<100?t.amount:0)/100:0},calculateTotals:function(e,t,n,r){var o=this.getSubtotal(e,r),a=this.getSumOfTaxes(o,t,n,r),i=this.getDiscountValue(o,n,r);return{subtotal:o,tax:a,discount:i,amount_due:o-i+a.amount}}}}]).controller("ViewRequestCtrl",["$state","$scope","API","Notification","request",function(e,r,o,a,t){r.request=t,r.request.url=settings.landingPage+"/pay/"+t.request_code,r.Notification=a,r.currentDate=moment().format("DD MMM YYYY"),r.isAmountPaidInvalid=function(e){return Math.floor(100*e)>r.request.amount},r.save=function(t){o.one("paymentrequest",r.request.id).customPUT({amount:100*t.amount}).then(function(e){r.request.amount=100*t.amount,r.$broadcast("requestUpdated",!0),a.success("Request Sent","Your request has been updated and sent")}).catch(function(e){r.$broadcast("requestUpdated",!1),a.error("Your request was not updated",e)})},r.notify=function(){o.one("paymentrequest/notify",r.request.id).post().then(function(e){r.$broadcast("notificationSent",!0),a.success("Reminder sent",r.request.customer.email+" has been reminded about this request")}).catch(function(e){r.$broadcast("notificationSent",!1),a.error("Your reminder was not sent",e)})},r.delete=function(){o.one("paymentrequest/archive",r.request.id).post().then(function(){r.closeThisDialog(),e.go("invoices.list")},function(e){r.$broadcast("requestDeleted",!1),a.error("Could not delete this request",e)})},r.markPaid=function(t,e){var n=angular.copy(t);if(n.amount_paid=100*n.amount_paid,moment(new Date(t.payment_date)).isAfter(moment()))return r.$broadcast("markedPaid",!1),void a.error("Payment date is invalid","Please use a date in the past");o.all("paymentrequest/mark_as_paid/"+r.request.id).post(n).then(function(e){r.request.status="success",r.request.paid_off_platform=!0,r.request.paid=!0,r.request.paid_at=new Date,r.request.additional_parameters=t,a.success("Marked as paid","This request has been marked as paid")}).catch(function(e){r.$broadcast("markedPaid",!1),a.error("Your request could not be marked as paid",e)})}}]).controller("RequestHelpers",["$state","$scope","$timeout","$rootScope","API",function(e,n,t,r,o){n.customersPromise=null,n.updateCustomers=function(e){n.request._email=e,n.request._newCustomer={email:e},1<n.meta.pageCount&&(n.searching=!0,n.customersPromise=null,n.customersPromise=t(function(){o.one("customer").get({search:e}).then(function(e){n.searching=!1,n.customers=e.data}).catch(function(){n.searching=!1})},1e3))},n.setCustomer=function(e){n.resetCustomer(),n.request._customer=e,n.request.customer=e.customer_code},n.resetCustomer=function(){n.request._customer=null,n.request.customer=null,n.request._customerUpdate=null,n.request._newCustomer=null},n.createCustomer=function(e){n.request._newCustomer.update=!0},r.formatRequest=function(){var t=angular.copy(n.request);return(t=_.pick(t,["customer","due_date","currency","description","has_invoice","amount"])).customer=t.customer||angular.copy(n.request._email),t.due_date&&(t.due_date=moment(new Date(t.due_date)).endOf("day").toISOString()),Object.keys(t).forEach(function(e){null==t[e]&&delete t[e]}),t.has_invoice?(t.send_notification=!1,t.draft=!0):(t.send_notification=!0,t.draft=!1,t.amount=100*t.amount),t}}]),angular.module("app.mandates",["ui.router"]).config(["$stateProvider",function(e){e.state("mandates",{abstract:!0,title:"Mandates",url:"/mandates",templateUrl:"/components/layout/base.html",redirectTo:"mandates.list",data:{authenticable:!0},onExit:function(){return window.cleanupMicroFrontend&&window.cleanupMicroFrontend("mandates-root")}}).state("mandates.list",{title:"Mandates",url:"",pageTrack:"/mandates",templateUrl:"/modules/mandates/list.html",controller:"MandatesCtrl"}).state("mandates.list.one",{url:"/:code",title:"Mandates",pageTrack:"/mandates",templateUrl:"modules/mandates/list.html",controller:"MandatesCtrl"}).state("mandates.amend",{url:"/:code/edit",title:"Mandates",pageTrack:"/mandates",templateUrl:"modules/mandates/list.html",controller:"MandatesCtrl"})}]).controller("MandatesCtrl",["$scope","$state","$rootScope",function(e,t,n){e.$watch("mfeServiceReady",function(e){n.FeatureFlags.debit_orders_enabled||t.go("app.404"),e&&window.postMessage({message:"RENDER_DEBIT_ORDERS_MICROFRONTEND"})})}]),angular.module("app.onboarding",["ui.router","app.introService"]).config(["$stateProvider",function(e){e.state("app.onboarding",{url:"/get-started",template:"<ui-view></ui-view>",redirectTo:"app.onboarding.home",data:{permission:"onboarding-*"}}).state("app.onboarding.home",{title:"Get Started",url:"",pageTrack:"/get-started",templateUrl:"modules/onboarding/index.html",controller:"OnboardingHomeCtrl"}).state("app.onboarding.setup",{title:"How to Use",url:"/setup?active&framework&library",pageTrack:"/setup",templateUrl:"modules/onboarding/setup.html",controller:"OnboardingSetupCtrl"}).state("old-activation-page",{url:"/onboarding/activate",redirectTo:"app.compliance"}).state("old-setup-page",{url:"/onboarding/setup",redirectTo:"app.onboarding.setup"})}]).controller("OnboardingHomeCtrl",["$state","$scope","$rootScope","API","Session","ngDialog","Notification","Auth","IntroService","IntroSteps","AmplitudeService",function(e,n,t,r,o,a,i,s,c,u,l){var d=l.logEvent;n.logAction=function(e){return d("Clicked onboarding card",{action:e})},o.hasPermission("api-key-view")&&r.one("integration/keys").get().then(function(e){var t=e.data;n.secret_key=_.findWhere(t,{type:"secret",domain:"test"}).key,n.public_key=_.findWhere(t,{type:"public",domain:"test"}).key});var p=u.filter(function(e){return!e.permissions||o.hasPermission(e.permissions)});n.options={steps:p,showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"Next",prevLabel:"Back",skipLabel:"Close",doneLabel:"End Tour"},n.startTour=function(){c.setup(n.options),c.start()}}]).controller("OnboardingTruecallerCtrl",["$state","$scope","$window","$rootScope","$interval","API","Auth","Notification",function(e,t,n,r,o,a,i,s){t.phone=angular.copy(r.User.phone),t.callingCode=r.User.calling_code,t.error={message:"",visible:!1,showTip:!0},t.starterIntegrationLimits={NG:{limit:"2,000,000",extraLimit:"3,000,000"},GH:{limit:"30,000",extraLimit:"45,000"}},t.countryCode=r.Business.attributes.country.iso_code,t.countryCurrencyCode=r.Business.attributes.country.default_currency_code,t.refresh=function(){n.location.reload()},t.verify=function(){t.error.message="",t.error.visible=!1;var e="".concat(t.phone.calling_code).concat(t.phone.subscriber_number);i.update("user",{phone:t.phone.subscriber_number,calling_code:t.phone.calling_code}).then(function(){return a.all("user/verifications").post({verification_type:"truecaller",phone:e})}).then(function(){t.verificationStarted=!0,t.countdown=30;var e=o(function(){t.countdown-=1,0===t.countdown&&o.cancel(e)},1e3)}).catch(function(e){t.error.message=e.data.message,t.error.visible=!0,r.$broadcast("verificationStarted",!1)})}}]).controller("OnboardingSetupCtrl",["$state","$stateParams","$scope","$rootScope","API","LocalAPI",function(n,e,t,r,o,a){a.one("options").get().then(function(e){t.options=e});var i={slug:"eCommerce",title:"E-Commerce Plugins",description:"For sites built on platforms such as WordPress, Shopify, etc",expanded:"eCommerce"==e.active},s={slug:"api",title:"API, Libraries and SDKs",description:"Integrate Paystack with a custom website or app",expanded:"api"==e.active},c={slug:"paymentPages",title:"Get paid without a website",description:"Simple tools to start selling quickly",expanded:"paymentPages"==e.active};r.User.is_developer?t.tabs=[s,i,c]:t.tabs=[c,i,s],t.select=function(e){var t=e.slug===n.params.active?null:e.slug;n.go(n.current,{active:t},{reload:!1})}}]).controller("OnboardingNoWebsiteCtrl",["$state","$scope","$rootScope","API","Notification","ngDialog",function(e,n,t,r,o,a){n.init=function(){r.one("page").get({perPage:1}).then(function(e){return n.hasPaymentPage=e.data.length,r.one("paymentrequest").get({perPage:1})}).then(function(e){return n.hasInvoice=e.data.length,r.one("transaction").get({perPage:1})})},n.choosePage=function(){a.open({templateUrl:"/modules/pages/modals/choose-new-page.html",width:550,scope:n})},n.createPage=function(e){var t={template:"createPageFromOnboarding",controller:"NewPageCtrl",showClose:!0,closeByDocument:!1,data:{type:e},resolve:{plans:["API","$stateParams",function(e,t){return e.one("plan").get(t)}],products:["API",function(e){return e.one("product").get().then(function(e){return e})}]}};a.open(t).closePromise.then(function(e){n.init()})},n.loadNewRequest=function(){a.open({template:"/modules/invoices/modals/new-request.html",resolve:{customers:["API",function(e){return e.one("customer").get()}]},trapFocus:!1,showClose:!0,controller:"NewRequestCtrl",width:500})}}]).controller("OnboardingAPIeCommerceCtrl",["$state","$stateParams","$scope","$rootScope","API","Notification","Session",function(t,e,n,r,o,a,i){n.Notification=a,i.hasPermission("user-view")&&o.one("integration/users").get().then(function(e){var t=e.data;n.developersInvited=t.filter(function(e){return e.is_developer}).map(function(e){return e.email})}),n.select=function(e){n.frameworkSelected=e,t.go(t.current,{framework:e?e.slug:null},{reload:!1})},n.frameworks=[{name:"WordPress",slug:"wordpress"},{name:"Magento",slug:"magento"},{name:"Shopify",slug:"shopify"},{name:"OpenCart",slug:"opencart"},{name:"Drupal",slug:"drupal"},{name:"Joomla",slug:"joomla"},{name:"Custom",slug:"custom"}],n.frameworkSelected=e.framework?_.findWhere(n.frameworks,{slug:e.framework}):null,r.User.is_developer||n.frameworks.push({name:"I don't know",slug:"other"}),n.libraries=[{name:"PHP",slug:"php",url:"https://github.com/yabacon/paystack-php"},{name:"Laravel",slug:"laravel",url:"https://github.com/unicodeveloper/laravel-paystack"},{name:"Node JS",slug:"nodejs",url:"https://github.com/kehers/paystack"},{name:"Python",slug:"python",url:"https://github.com/edwardpopoola/pypaystack"},{name:"Ruby",slug:"ruby",url:"https://github.com/ojengwa/paystackr"},{name:"Java",slug:"java",url:"https://github.com/SeunAdelekan/PaystackJava"},{name:"Android",slug:"android",url:"https://github.com/PaystackHQ/paystack-android"},{name:"iOS",slug:"ios",url:"https://github.com/PaystackHQ/paystack-ios"},{name:"Angular",slug:"angular",url:"https://libraries.io/bower/angular-paystack"},{name:"React",slug:"react",url:"https://github.com/iamraphson/react-paystack"},{name:"All Libraries",slug:"more",url:"https://developers.paystack.co/docs/libraries-and-plugins"}]}]).controller("OnboardingUserInviteCtrl",["$state","$scope","$rootScope","API","Auth","Notification","RoleService",function(n,r,o,a,i,s,t){function c(e,t){r._payload=e,a.all("integration/add_user").post(e).then(function(e){return i.update("account")}).then(function(){o.Business;s.success("User Invited",e.email+" has been sent instructions to join your business on Paystack"),t&&t(),n.reload()}).catch(function(e){r.$broadcast("userInvited",!1),s.error("Could not add invite to account",e)})}t.fetch().then(function(){r.roles=t.data(),r.developer={role:t.id("developer-support")}}),r.users=[],a.one("integration/users").get().then(function(e){r.users=e.data}),r.isAlreadyInvited=function(e){return _.findWhere(r.users,{email:e})},r.inviteDeveloper=function(){c({integration:o.Business.id,email:r.developer.email,role:r.developer.role,is_developer:!0,onboarding:!0})},r.admin={},r.inviteAdmin=function(e){c({integration:o.Business.id,email:r.admin.email,is_developer:r.admin.is_developer,role:t.id("admin"),onboarding:!0},e)}}]);var OrderModule=angular.module("app.orders",["ui.router"]);function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}OrderModule.config(["$stateProvider",function(e){e.state("orders",{url:"/orders",templateUrl:"components/layout/base.html",redirectTo:"orders.list",data:{permission:"product-view",authenticable:!0},onEnter:function(){window.scrollTo(0,0),document.body.style.overflow="hidden"},onExit:function(){document.body.style.overflow=null}}).state("orders.list",{url:"?email&region&from&to&status&delivered&refunded&delivered_at&current&page&index&products&search&is_viewed",pageTrack:"/orders",templateUrl:"modules/orders/views/list.html",controller:"OrdersCtrl",resolve:{ordersList:["API","$stateParams",function(e,t){return e.one("order").get(t)}]}}).state("orders.list.one",{url:"/:id",pageTrack:"/orders",templateUrl:"modules/orders/views/one/one.html",redirectTo:"orders.list.one.overview",controller:"OrdersCtrl",resolve:{activeOrder:["API","$stateParams",function(e,t){return e.one("order",t.id).get()}]}}).state("orders.list.one.overview",{url:"/overview",pageTrack:"/orders",controller:"OrdersOverviewCtrl",templateUrl:"modules/orders/views/one/overview.html"}).state("orders.list.one.shipping",{url:"/shipping",pageTrack:"/orders",controller:"OrdersShippingCtrl",templateUrl:"modules/orders/views/one/shipping.html",resolve:{availableShippingRegions:["activeOrder","OrderFactory",function(e,t){var n=e.data.items;if(n&&n.length){var r=n.map(function(e){return e.product_id});return Promise.all(r.map(function(e){return t.fetchProductById(e)})).then(function(e){return(t=e)&&t.length?t.map(function(e){if(e.data.shipping_fields&&e.data.shipping_fields.shipping_fees&&e.data.shipping_fields.shipping_fees.length)return e.data.shipping_fields.shipping_fees}).filter(function(e){return null!=e}):[];var t})}}]}})}]),angular.module("app.pages",["ui.router"]).config(["$stateProvider",function(e){e.state("pages",{abstract:!0,url:"/pages",title:"Pages",templateUrl:"components/layout/base.html",redirectTo:"pages.list",data:{permission:"page-view",authenticable:!0}}).state("pages.list",{url:"?from&to&inactive&page&query",pageTrack:"/pages",title:"Pages",templateUrl:"modules/pages/list.html",controller:"PageListCtrl",resolve:{pages:["API","$stateParams",function(e,t){var n=angular.extend(t,{active:t.inactive?"false":null,search:t.query});return e.one("page").get(n)}],plans:["API","$stateParams",function(e,t){return e.one("plan").get(t).catch(function(){return[]})}]}}).state("pages.one",{url:"/:id?edit",pageTrack:"/pages",title:"Pages",templateUrl:"modules/pages/one.html",controller:"PageCtrl",resolve:{page:["API","$stateParams",function(e,t){return e.one("page",t.id).get().then(function(t){return t.data&&t.data.metadata&&t.data.metadata.subaccount?e.one("subaccount",t.data.metadata.subaccount).get().then(function(e){return t.data.subaccount=e.data,t}).catch(function(){return t}):t})}],products:["API","page",function(r,e){return"product"===e.data.type?r.one("product").get().then(function(e){var t=e.data,n=e.meta;return n.pageCount<=1?t:r.one("product").get({perPage:n.total}).then(function(e){return e.data})}):null}],transactionSplit:["TransactionSplitsData","page","$filter",function(e,t,i){var n=t.data.split_code;if(n&&n.startsWith("SPL"))return e.fetchSingleSplit(n).then(function(e){var a=e.data,t=a.subaccounts.map(function(e){var t=e.share,n=e.subaccount,r=n.business_name,o=n.currency;return{businessName:r,share:"percentage"===a.type?"".concat(t,"%"):i("money")(t,o)}});return _objectSpread(_objectSpread({},a),{},{subaccounts:t})})}]}})}]).controller("PageListCtrl",["$state","$scope","$stateParams","LocalService","$filter","pages","plans","ngDialog","$rootScope",function(n,e,t,r,o,a,i,s,c){e.startDate=t.from?o("date")(t.from,"dd MMM yyyy"):"",e.endDate=t.to?o("date")(t.to,"dd MMM yyyy"):"",e.query=t.query;var u=c.Business.attributes;e.countryCode=u.country.iso_code,e.subscriptionFeatureAvailable=["NG","GH","ZA"].includes(e.countryCode),e.isSubscriptionModalOpen=!1,e.openSubscriptionModal=function(){e.isSubscriptionModalOpen=!0},e.closeSubscriptionModal=function(){e.isSubscriptionModalOpen=!1},e.choosePage=function(){s.open({templateUrl:"/modules/pages/modals/choose-new-page.html",width:550,scope:e})},e.createPage=function(e){var t={template:"newPage",controller:"NewPageCtrl",showClose:!0,closeByDocument:!1,data:{type:e},resolve:{plans:["API","$stateParams",function(e,t){return e.one("plan").get(t)}],products:["API",function(e){return e.one("product").get().then(function(e){return e})}]}};s.open(t).closePromise.then(function(e){n.go(n.current,n.params,{reload:!0,inherit:!1})})},e.pages=_.map(a.data,function(t){return t.plan&&(t.plan=_.find(i.data,function(e){return e.id==t.plan})),t.url=settings.landingPage+"/pay/"+t.slug,t}),e.meta=a.meta}]).controller("PageCtrl",["$state","$scope","$rootScope","$stateParams","API","ngDialog","page","Notification","products","transactionSplit",function(t,n,r,e,o,a,i,s,c,u){n.page=i.data,n.allProducts=c,n.page.url=settings.landingPage+"/pay/"+i.data.slug,n.products=n.page.products||null,n.transactionSplit=u,n.hidePublishSwitch=!n.page.published&&"product"===n.page.type&&0===n.products.length,n.fetchTransactions=function(e){n.loading=!0;var t={payment_page:n.page.id,perPage:10,status:"success"};o.one("transaction").get(t).then(function(e){n.transactions=e.data,n.meta=e.meta,n.$broadcast("fetchedTransactions")},function(){n.$broadcast("fetchedTransactions")})},n.toggleState=function(e){o.one("page",i.data.id).customPUT({published:e})},n.removeProduct=function(e){a.openConfirm({template:"modules/pages/modals/remove-page-product.html",scope:n,controller:"PageProductsCtrl",showClose:!0,closeByDocument:!1,data:{product:n.products[e]}}).then(function(){t.reload()})},n.addProducts=function(){a.openConfirm({template:"modules/pages/modals/add-page-products.html",scope:n,controller:"PageProductsCtrl",showClose:!0,closeByDocument:!1}).then(function(){t.reload()})},n.update=function(){a.openConfirm({template:"updatePage",scope:n,controller:"EditPageCtrl",showClose:!0,closeByDocument:!1,resolve:{plans:["API","$stateParams",function(e,t){return e.one("plan").get(t)}]}}).then(function(){t.reload()})},n.archive=function(){a.openConfirm({template:"archivePage",scope:n,controller:"RemovePageCtrl",showClose:!0,closeByDocument:!1}).then(function(){t.go("pages.list")})},n.publish=function(){a.openConfirm({template:"publishPage",scope:n,showClose:!0,closeByDocument:!1}).then(function(){o.one("page/migrate",i.data.id).post().then(function(e){s.success("Published successfully","Your page is now in live mode"),r.switchState({state:"pages.one",params:{id:e.data.id}})}).catch(function(e){n.$broadcast("publishSuccessful",!1),s.error("Could not publish this page",e)})})},n.duplicate=function(){var e=_.omit(i.data,["active","createdAt","domain","id","integration","published","slug","updatedAt","migrate","custom_fields"]);i.data.custom_fields&&i.data.custom_fields.length&&(e.custom_fields=i.data.custom_fields),a.open({template:"newPage",controller:"NewPageCtrl",showClose:!0,closeByDocument:!1,data:{type:e.type,prefill:e},resolve:{plans:["API","$stateParams",function(e,t){return e.one("plan").get(t)}],products:function(){return null}}})},n.restore=function(){o.one("page",n.page.id).customPUT({active:!0}).then(function(){s.success("Restored successfully","Page will now be accesible"),t.reload()},function(e){n.$broadcast("pageRestored",!1),s.error("Could not restore this page",e)})},e.edit&&n.update()}]).controller("NewPageCtrl",["$state","$scope","$rootScope","API","ngDialog","Notification","Session","utils","plans","products","$stateParams","PlansData","TransactionSplitsData",function(a,i,e,s,t,c,u,l,d,n,r,o,p){i.addedProducts=[],i.Notification=c,i.plans=d.data,i.page={type:i.ngDialogData.type||"",migrate:"test"==e.User.display_state,currency:u.get("account").default_currency,metadata:{}},i.formatBusinessName=function(e){return e?l.firstNthWords(e,2):e},i.pageType="product"===i.page.type?"Product":"payment"===i.page.type?"Payment":"Subscription",i.subaccounts=[],i.all_subaccounts_fetched=!1;var f=r||{};s.one("subaccount").get(f).then(function(e){i.subaccounts=e.data,i.all_subaccounts_fetched=1===e.meta.pageCount});var m=!(i.transactionSplits=[]);if(p.fetch({active:!0}).then(function(e){i.transactionSplits=e.data,m=1===e.meta.pageCount}),i.updateTransactionSplits=function(e){e&&!m&&p.fetch({search:e,active:!0}).then(function(e){i.transactionSplits=e.data}).catch(function(e){c.error("Could not search for transaction split",e)})},i.planSearchStatus="idle",i.setPlanSearchStatus=function(e){i.planSearchStatus=e},i.searchPlans=function(e){i.page.plan={},i.planSearchStatus="searching",e.searchPlans.$setValidity("required",!1),o.search(i.page.searchInput).then(function(e){i.plans=e.data,i.planSearchStatus="searched"}).catch(function(e){i.planSearchStatus="idle",c.error("Could not search plans",e)})},i.updateSubaccounts=function(e){if(!i.all_subaccounts_fetched)return s.one("subaccount").get({search:e}).then(function(e){i.subaccounts=e.data})},i.setPlan=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i.page.plan=e,i.page.searchInput=e.name,i.planSearchStatus="idle",i.page.plan.amount=l.currencySubUnitToBaseUnit(e.amount)},i.ngDialogData.prefill){i.page=i.ngDialogData.prefill,i.page.searchInput=i.page.plan&&i.page.plan.name,i.page.name=i.page.name+=" (Copy)",i.addedProducts=i.page.products||[],i.page.amount&&(i.page.amount=l.currencySubUnitToBaseUnit(i.page.amount)),i.page.fixed_amount=0<i.page.amount,"subscription"===i.page.type&&(i.page.type="existing-plan");var g=_.values(_.pick(i.ngDialogData.prefill,["success_message","redirect_url","notification_email","subaccount"]));i.advanced_is_visible=_.some(g)||i.page.custom_fields,i.advanced_is_visible&&(i.custom_fields=i.page.custom_fields?i.page.custom_fields:[{display_name:""}],delete i.page.custom_fields)}i.newPlan={currency:i.page.currency},i.planFrequencyOptions=[{slug:"hourly",name:"Hourly"},{slug:"daily",name:"Daily"},{slug:"weekly",name:"Weekly"},{slug:"monthly",name:"Monthly"},{slug:"quarterly",name:"Quarterly"},{slug:"biannually",name:"Biannually"},{slug:"annually",name:"Annually"}],i.toggleAdvanced=function(){i.advanced_is_visible=!i.advanced_is_visible,i.page.slug=null,i.page.redirect_url=null,i.custom_fields=[{display_name:""}]},i.$on("uploadCompleted",function(e,t){i.page.metadata.image_path=t.uploadPath,i.page_image=null}),i.addProducts=function(){t.openConfirm({template:"modules/pages/modals/add-page-products.html",controller:"PageProductsCtrl",data:{allProducts:n.data,page:i.createdPage},showClose:!0,closeByDocument:!1}).then(function(){a.reload()})},i.create=function(){var e,t=l.toKobo(angular.copy(i.page));if(t.custom_fields=[],!t.name&&t.plan_id){_.find(d.data,function(e){return i.page.plan_id==e.id});t.plan=t.plan_id}if(_.each(i.custom_fields,function(e){e.display_name&&t.custom_fields.push({display_name:e.display_name,variable_name:e.display_name.replace(/-|\s/g,"_").toLowerCase()})}),t.metadata.transaction_charge){var n=i.page.plan?i.page.plan.amount:i.page.amount;if(t.metadata.transaction_charge>n)return i.$broadcast("pageCreated",!1),void c.error("Flat Fee Split Error","Your flat fee split cannot be more than the "+(i.page.plan?"plan":"page")+"amount")}switch(i.page.type){case"payment":e=s.all("page").post(t);break;case"new-plan":var r=l.toKobo(i.newPlan),o=Object.keys(r).reduce(function(e,t){return null!=r[t]&&(e[t]=r[t]),e},{});e=s.all("plan").post(o).then(function(e){return t.type="subscription",t.name="Subscribe to plan: "+e.data.name,t.plan=e.data.id,t.currency=e.data.currency,s.all("page").post(t)});break;case"custom-plan":t.type="plan",e=s.all("page").post(t);break;case"product":e=s.all("page").post(t);break;default:t.currency=t.plan?t.plan.currency:u.get("account").default_currency,t.type="subscription",e=s.all("page").post(t)}e.then(function(e){a.go("pages.one",{id:e.data.id}),i.createdPage=e.data,i.createdPage.url=settings.landingPage+"/pay/"+e.data.slug},function(e){i.$broadcast("pageCreated",!1),c.error("Could not create this page",e)})}}]).controller("EditPageCtrl",["$state","$scope","API","ngDialog","Notification","utils","plans","$stateParams","PlansData","TransactionSplitsData","$i18next",function(n,r,o,e,a,i,t,s,c,u,l){r.Notification=a,r.plans=t.data,r.page=i.toNaira(angular.copy(r.page)),r.pageCopy=i.toNaira(angular.copy(r.page)),r.addedProducts=r.page.products||[],r.subaccounts=[],r.formatBusinessName=function(e){return e?i.firstNthWords(e,2):e};var d=null!=r.page.custom_fields&&0<r.page.custom_fields.length;r.custom_fields=d?r.page.custom_fields:[{display_name:""}];var p=_.values(_.pick(r.page,["success_message","redirect_url","notification_email","subaccount"]));r.advanced_is_visible=_.some(p)||r.page.custom_fields,r.page.metadata=r.page.metadata||{};var f=s||{};o.one("subaccount").get(f).then(function(e){r.subaccounts=e.data,r.all_subaccounts_fetched=1===e.meta.pageCount});var m=!(r.transactionSplits=[]);(u.fetch({active:!0}).then(function(e){r.transactionSplits=e.data,m=1===e.meta.pageCount}),r.updateTransactionSplits=function(e){e&&!m&&u.fetch({search:e,active:!0}).then(function(e){r.transactionSplits=e.data}).catch(function(e){a.error("Could not search for transaction split",e)})},r.page.metadata.subaccount)&&(!_.findWhere(r.subaccounts,{subaccount_code:r.page.metadata.subaccount})&&r.page.subaccount&&r.subaccounts.push(r.page.subaccount));if(r.updateSubaccounts=function(e){if(!r.all_subaccounts_fetched)return o.one("subaccount").get({search:e}).then(function(e){r.subaccounts=e.data})},r.page.metadata&&r.page.metadata.subaccount){var g=function(){return _.findWhere(r.subaccounts,{subaccount_code:r.page.metadata.subaccount})};g()?r.page.metadata.subaccount=g():r.updateSubaccounts(r.page.metadata.subaccount).then(function(){r.page.metadata.subaccount=g()})}r.$on("uploadCompleted",function(e,t){o.one("page",r.page.id).customPUT({metadata:r.page.metadata}),r.page.metadata.image_path=t.uploadPath,r.page_image=null}),r.removeImage=function(){r.page.metadata.image_path=null,o.one("page",r.page.id).customPUT({metadata:r.page.metadata})},r.planSearchStatus="idle",r.setPlanSearchStatus=function(e){r.planSearchStatus=e},r.searchPlans=function(e){r.page.plan={},r.planSearchStatus="searching",e.searchPlans.$setValidity("required",!1),c.search(r.page.searchInput).then(function(e){r.plans=e.data,r.planSearchStatus="searched"}).catch(function(e){r.planSearchStatus="idle",a.error("Could not search plans",e)})},r.setPlan=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r.page.plan=e,r.page.searchInput=e.name,r.planSearchStatus="idle",r.page.currency=e.currency,r.page.plan.amount=i.currencySubUnitToBaseUnit(e.amount)},r.page.plan&&r.setPlan(r.page.plan),r.toggleAdvanced=function(){r.advanced_is_visible=!r.advanced_is_visible},r.onSplitCodeSelect=function(e){r.pageCopy.split_code!==e.split_code?(r.page.split_policy="update_subscriptions",r.activeSubscriptionError=l.t("pages.advanced.activeSubscriptionError",{splitGroupName:e.name})):(r.page.split_policy=null,r.activeSubscriptionError=null)},r.update=function(){var t=i.toKobo(angular.copy(r.page));if(t.custom_fields=[],_.each(r.custom_fields,function(e){e.display_name&&t.custom_fields.push({display_name:e.display_name,variable_name:e.display_name.replace(/-|\s/g,"_").toLowerCase()})}),t.metadata.subaccount&&_.isObject(t.metadata.subaccount)&&(t.metadata.subaccount=t.metadata.subaccount.subaccount_code),r.page.plan&&!["payment","product"].includes(r.page.type)&&(t.plan=r.page.plan.id),t.metadata.transaction_charge){var e=r.page.plan?r.page.plan.amount:r.page.amount;if(t.metadata.transaction_charge>e)return r.$broadcast("pageCreated",!1),void a.error("Flat Fee Split Error","Your flat fee split cannot be more than the "+(r.page.plan?"plan":"page")+"amount")}r.activeSubscriptionError&&(t.split_policy="update_subscriptions"),o.one("page",r.page.id).customPUT(t).then(function(){a.success("Updated successfully","Page has been updated successfully"),n.reload(),r.confirm()},function(e){var t=e.data.message;t.includes("active and future subscriptions")?r.activeSubscriptionError=t:a.error("Could not update this page",e),r.$broadcast("pageUpdated",!1)})}}]).controller("RemovePageCtrl",["$state","$scope","API","ngDialog","Notification",function(e,t,r,n,o){var a;t.archive=function(){(function(){for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t="archived_",n=10;0<n;--n)t+=e[Math.floor(Math.random()*e.length)];return a=t,r.one("page/check_slug_availability",t).get()})().then(function(){r.one("page",t.page.id).customPUT({active:!1,slug:a}).then(function(){o.success("Deleted successfully","Page will no longer be accesible"),t.confirm()},function(e){t.$broadcast("deleteSuccessful",!1),o.error("Could not delete this page",e)})},function(e){e.data&&"Slug already in use"==e.data.message?t.archive():o.error("Could not delete this page",e)})}}]).controller("PageProductsCtrl",["$scope","API","Notification","$state","ngDialog","ProductUtils",function(n,t,r,o,e,a){var i=n.page||n.ngDialogData.page,s=(n.products||[]).map(function(e){return e.product_id}),c=n.allProducts||n.ngDialogData.allProducts;n.allProducts=c.filter(function(e){return!s.includes(e.id)}).map(function(e){return _objectSpread(_objectSpread({},e),{},{description:e.description?window.striptags(e.description).substring(0,60):""})}).map(function(e){return _objectSpread(_objectSpread({},e),{},{description:e.description&&60<=e.description.length?"".concat(e.description,"..."):e.description})}),n.addedProducts=[],n.page=i,n.alreadyAdded=function(t){return n.addedProducts.find(function(e){return e.id===t.id})},n.createProduct=function(){e.open({template:"modules/products/views/modals/create-product.html",controller:"CreateProductCtrl",showClose:!1,closeByDocument:!1,data:{reload:!1}}).closePromise.then(function(e){e.value&&e.value.data&&n.allProducts.unshift(e.value.data)})},n.addProduct=function(e){n.addedProducts.push(e)},n.removeProductOnModal=function(t){var e=n.addedProducts.findIndex(function(e){return e.id===t});n.addedProducts.splice(e,1)},n.addProducts=function(){var e=n.addedProducts.map(function(e){return e.id});t.one("page",n.page.id).post("product",{products:e}).then(function(){n.$broadcast("productsAdded",!0),r.success("Success","Added successfully"),o.reload(),n.confirm()}).catch(function(e){n.$broadcast("productsAdded",!1),r.error("Could not add products",e)})},n.removeProduct=function(e){t.one("page",n.page.id).customDELETE("product/".concat(e)).then(function(){r.success("Update successful","Product was removed successfully"),o.reload(),n.confirm()}).catch(function(e){n.$broadcast("productRemoved",!1),r.error("Could not remove product",e)})}}]),angular.module("app.payouts",["ui.router"]).factory("Settlements",["API",function(t){var n={data:[],meta:{},fetch:function(e){return t.one("settlement").get(e).then(function(e){return n.data=_.map(e.data,function(e){return angular.isDefined(e.effective_amount)||(e.effective_amount=e.total_amount),e}),n.meta=e.meta,e})}};return n}]).config(["$stateProvider",function(e){e.state("payouts",{abstract:!0,url:"/payouts",title:"Payouts",templateUrl:"components/layout/base.html",redirectTo:"payouts.list",data:{permission:"settlement-view",authenticable:!0}}).state("payouts.list",{url:"?page&subaccount&status&from&to",pageTrack:"/payouts",title:"Payouts",templateUrl:"modules/payouts/list.html",controller:"PayoutsCtrl",resolve:{payouts:["Settlements","$stateParams",function(e,t){return e.fetch(t)}]}}).state("payouts.one",{url:"/:id",pageTrack:"/payouts",title:"Payouts",templateUrl:"modules/payouts/one.html",controller:"PayoutCtrl",resolve:{payouts:["Settlements","$stateParams",function(e,t){return e.data.length?Promise.resolve():e.fetch(t)}]}})}]).controller("PayoutsCtrl",["$state","$stateParams","$filter","$scope","$rootScope","$timeout","Settlements","API","ngDialog","TransactionData","TransactionParams","SettlementService","Notification","Session",function(n,e,t,r,o,a,i,s,c,u,l,d,p,f){var m=o.Business;r.payouts=i.data,r.meta=i.meta,r.subaccounts=[],r.query={},r.isNigerianBusiness=m.attributes&&m.attributes.country&&"NG"===m.attributes.country.iso_code;var g=["$scope","API",function(e,t){e.requestPendingPayout=function(){t.all("settlement/request_open_settlement").post({settlement_id:e.openPayout.id}).then(function(){p.success("Payout requested","Pending payout requested successfully"),e.closeThisDialog(),n.reload()}).catch(function(e){p.error("Could not request for pending payout",e)})}}];r.shownStatusMap={success:"paid",computing:"pending"},d.getNextBusinessDay({country:m.attributes.country}).then(function(e){r.nextSettlementDate=moment().day(e).format("dddd, MMM D, YYYY")}),r.openRequestPayoutModal=function(){return c.open({template:"/modules/payouts/modals/pending-payout.html",controller:g,scope:r,width:450,showClose:!0})};var h=r.payouts.find(function(e){return"open"===e.status});h?s.one("settlement/open_settlements").get().then(function(e){var t={};return r.openPayoutInfo=e.data,(r.openPayout=h).subaccount?t.subaccount_settlement=h.id:t.settlement=h.id,s.one("transaction").get(_objectSpread(_objectSpread({},t),{},{perPage:1})).then(function(e){r.totalOpenPayoutsCount=e.meta.total,r.$broadcast("fetchedOpenPayoutDetail")})}).catch(function(e){p.error("Could not fetch open payout detail",e),r.$broadcast("fetchedOpenPayoutDetail",!1)}):a(function(){r.$broadcast("fetchedOpenPayoutDetail",!1)}),f.hasPermission("subaccount-view")?s.one("subaccount").get({perPage:1e3}).then(function(e){r.subaccounts=e.data||[],n.params.subaccount&&(r.subaccount=r.subaccounts.find(function(e){return e.id==n.params.subaccount}))}).catch(function(){r.subaccounts=[]}):r.subaccounts=[],r.query=angular.copy(e),r.query.from=e.from?t("date")(e.from,"dd MMM yyyy"):"",r.query.to=e.to?t("date")(e.to,"dd MMM yyyy"):"",r.formattedParams=l.format(_objectSpread({period:"range"},r.query)),r.resetSubaccountSearch=function(e){r.subaccountsFilter="",e||(r.focusSearch=!1)},r.showExport=function(){u.setParams(r.queryParams),c.open({template:"/modules/transactions/modals/export.html",controller:"TransactionExportCtrl",width:700,showClose:!0,trapFocus:!1,resolve:{DefaultKeys:["LocalAPI",function(e){return e.all("transaction_export_keys").getList()}]}})},r.reload=function(e){n.params.subaccount=e,n.go(n.current,n.params,{reload:!0,inherit:!0,notify:!0})}}]).controller("PayoutCtrl",["$state","$scope","$i18next","Settlements","API","ngDialog","TransactionData",function(t,n,a,e,r,o,i){var s=_.find(e.data,function(e){return e.id==t.params.id});n.payout=_objectSpread(_objectSpread({},s),{},{title:moment(s.settlement_date).format("MMM D YYYY")});n.getDeductionDescription=function(e){var t=e.source,n=e.source_row,r=e.amount;if("refund"===t&&r<0)return a.t("payouts.one.creditForFailedRefund",{refund:n});var o={opensettlementrequestfee:a.t("payouts.one.minimumPayoutRequest")}[t]||"".concat(t," ").concat(n);return a.t("payouts.one.deductionFor",{reason:o})};var c,u;c={perPage:50,use_cursor:!0},s.subaccount?c.subaccount_settlement=s.id:c.settlement=s.id,n.params=c,i.fetch(c).then(function(e){n.transactions=_.map(e.data,function(t){if(!t.fees_split)return t;try{return t.fees_split="string"==typeof t.fees_split?JSON.parse(t.fees_split):t.fees_split,t}catch(e){return t}}),n.meta=e.meta,n.total={transactions:_.reduce(e.data,function(e,t){return t.amount+e},0),fees:_.reduce(e.data,function(e,t){return t.fees+e},0)}}).then(function(){return r.one("deduction").get({settlement:s.id})}).then(function(e){n.deductions=e.data.map(function(e){return _objectSpread(_objectSpread({},e),{},{absoluteAmount:Math.abs(e.amount)})}),n.$broadcast("fetchedTransactions")}).catch(function(){n.deductions=[],n.$broadcast("fetchedTransactions")}),u={},s.subaccount?u.subaccount_settlement=s.id:u.settlement=s.id,r.one("transaction").get(_objectSpread(_objectSpread({},u),{},{perPage:1})).then(function(e){n.totalTransactionsCount=e.meta.total}),r.one("settlement/".concat(t.params.id,"/trials")).get().then(function(e){n.batches=e.data.filter(function(e){return"failed"!==e.status})}),n.getPayoutSubaccountShare=function(e,t){var n=e.find(function(e){return e.subaccount_code===t});return n?n.amount:0},n.showExport=function(){i.setParams(n.params),o.open({template:"/modules/transactions/modals/export.html",controller:"TransactionExportCtrl",width:700,showClose:!0,trapFocus:!1,resolve:{DefaultKeys:["LocalAPI",function(e){return e.all("transaction_export_keys").getList()}]}})},n.showBatches=function(){o.open({template:"modules/payouts/modals/batches.html",scope:n,width:500,showClose:!0})}}]);var PlansModule=angular.module("app.plans",["ui.router"]);PlansModule.config(["$stateProvider",function(e){e.state("plans",{abstract:!0,url:"/plans",templateUrl:"components/layout/base.html",redirectTo:"plans.list",title:"Plans",data:{permission:"plan-view",authenticable:!0}}).state("plans.list",{url:"?search&status&interval&from&to&query&subscriptions&amount&revenue&page&index",pageTrack:"/plans",title:"Plans",templateUrl:"modules/plans/views/list.html",controller:"PlansListCtrl",resolve:{plans:["API","$stateParams",function(e,t){return e.one("plan").get(t)}]}}).state("plans.one",{url:"/:id",pageTrack:"/plans",title:"Plans",templateUrl:"modules/plans/views/one/one.html",controller:"PlanCtrl",resolve:{plan:["API","$stateParams",function(e,t){return e.one("plan",t.id).get()}]}}).state("plans.one.subscriptions",{url:"/subscriptions",pageTrack:"/plans",controller:"PlanCtrl",templateUrl:"modules/plans/views/one/subscriptions.html"}).state("plans.one.subscribers",{url:"/subscribers",pageTrack:"/plans",controller:"PlanCtrl",templateUrl:"modules/plans/views/one/subscribers.html"}).state("plans.one.pages",{url:"/pages",pageTrack:"/plans",controller:"PlanPagesCtrl",templateUrl:"modules/plans/views/one/pages.html"})}]);var ProductModule=angular.module("app.products",["ui.router"]);ProductModule.config(["$stateProvider",function(e){e.state("products",{abstract:!0,url:"/products",title:"Products",templateUrl:"components/layout/base.html",redirectTo:"products.list",data:{permission:"product-view",authenticable:!0},onEnter:function(){window.scrollTo(0,0),document.body.style.overflow="hidden"},onExit:function(){document.body.style.overflow=null}}).state("products.list",{url:"?search&from&to&price&quantity&currency&unlimited&page&active&quantity_sold&perPage",pageTrack:"/products",title:"Products",templateUrl:"modules/products/views/one/list.html",controller:"ProductListCtrl",resolve:{products:["API","$stateParams",function(e,t){return e.one("product").get(t)}]}}).state("products.one",{url:"/:id?search",pageTrack:"/products",title:"Products",templateUrl:"modules/products/views/one/one.html",controller:"SingleProductCtrl",redirectTo:"products.one.orders",resolve:{product:["API","$stateParams",function(e,t){return e.one("product",t.id).get()}]}}).state("products.one.orders",{url:"/orders?email&region&from&to&status&delivered&delivered_at&current&page&index&duplicated",pageTrack:"/products",controller:"ProductOrderCtrl",templateUrl:"modules/products/views/one/orders.html",showBackButton:!0}).state("products.one.inventory",{url:"/inventory?page",pageTrack:"/products",controller:"ProductVariantsCtrl",templateUrl:"modules/products/views/one/variants.html",resolve:{variants:["API","$stateParams",function(e,t){return e.one("product/".concat(t.id,"/variant")).get(t)}],variantOptions:["API","$stateParams",function(e,t){return e.one("product/".concat(t.id,"/option")).get()}]}}).state("products.one.shipping",{url:"/delivery?email&from&to",pageTrack:"/products",controller:"ProductShippingCtrl",templateUrl:"modules/products/views/one/shipping.html",showBackButton:!0}).state("products.one.link",{url:"/link?view",pageTrack:"/products",controller:"ProductDesignCtrl",templateUrl:"modules/products/views/one/design.html",resolve:{variantOptions:["API","$stateParams",function(e,t){return e.one("product/".concat(t.id,"/option")).get()}]}}).state("products.one.design",{url:"/design",pageTrack:"/products",controller:"ProductDesignCtrl",templateUrl:"modules/products/views/one/design.html",redirectTo:"products.one.link"}).state("products.one.after-purchase",{url:"/after-purchase",pageTrack:"/products",controller:"ProductPostPurchaseCtrl",templateUrl:"modules/products/views/one/post-purchase.html",resolve:{subaccounts:["API","$rootScope",function(e,t){if(t.User.hasPermission("subaccount-view"))return e.one("subaccount").get()}]}})}]),angular.module("app.refunds",["ui.router"]).config(["$stateProvider",function(e){e.state("refunds",{abstract:!0,title:"Refunds",url:"/refunds",templateUrl:"/components/layout/base.html",redirectTo:"refunds.list",data:{authenticable:!0}}).state("refunds.list",{title:"Refunds",url:"?search&status&amount&from&to",pageTrack:"/refunds",templateUrl:"/modules/refunds/list.html",controller:"RefundsCtrl",onExit:function(){return window.cleanupMicroFrontend&&window.cleanupMicroFrontend("refunds-root")}}).state("refunds.one",{url:"/:id",title:"Refunds",templateUrl:"modules/refunds/one.html",controller:"RefundsCtrl",onExit:function(){return window.cleanupMicroFrontend&&window.cleanupMicroFrontend("refunds-root")}})}]).controller("RefundsCtrl",["$scope",function(e){e.$watch("mfeServiceReady",function(e){e&&window.postMessage({message:"RENDER_REFUNDS_MICROFRONTEND"})})}]),angular.module("app.search",["ui.router"]).config(["$stateProvider",function(e){e.state("app.search",{url:"/search?model&query",pageTrack:"/search",title:"Search",templateUrl:"modules/search/list.html",controller:"SearchCtrl",resolve:{results:["API","$stateParams","$rootScope",function(e,t,n){var r=_.omit(t,"page"),o=_.some(_.values(r)),a=_.clone(t);return a.search=a.query,a.model=a.model||"customers",a.domain=n.User.display_state,o?e.one("integration/search").get(a):{}}]}})}]).controller("SearchCtrl",["$state","$scope","$rootScope","results",function(e,t,n,r){t.params=e.params,t.results=r.data,t.meta=r.meta,t.search=function(){e.go(e.current,t.params,{reload:!0,inherit:!0,notify:!0})},t.switchTo=function(e){t.params.model=e,t.search()}}]);_excluded=["id"],_excluded2=["kycType"];var _excluded3=["id"];function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("app.settings",["ui.router"]).config(["$stateProvider",function(e){e.state("app.settings",{url:"/settings",pageTrack:"/settings",templateUrl:"/modules/settings/base.html",redirectTo:"app.settings.profile",controller:"SettingsCtrl",resolve:{submittedKyc:["API",function(e){return e.one("kyc").get({include:"requirement"}).then(function(e){return e.data}).catch(function(e){return[]})}]}}).state("app.settings.profile",{url:"/profile?toggle_mfa",pageTrack:"/settings/profile",templateUrl:"/modules/settings/profile.html",controller:"ProfileCtrl",resolve:{currentUser:["API",function(e){return e.one("session").get().then(function(e){return e.data.user})}]},title:"Profile"}).state("app.settings.business",{url:"/business",pageTrack:"/settings/business",templateUrl:"/modules/settings/business.html",title:"Business",permission:"settings-view",redirectTo:"app.settings.compliance"}).state("app.settings.accounts",{url:"/accounts",pageTrack:"/settings/accounts",templateUrl:"/modules/settings/accounts.html",title:"Accounts",controller:"BankAccountCtrl",permission:"accounts-view"}).state("app.settings.team",{url:"/team",template:"<ui-view></ui-view>",redirectTo:"app.settings.team.list"}).state("app.settings.team.list",{pageTrack:"/settings/team",templateUrl:"/modules/settings/team.html",title:"Team",controller:"TeamCtrl",permission:"user-view",resolve:{team:["API",function(e){return e.one("integration/users").get()}],roles:["RoleService",function(e){return e.fetch()}]}}).state("app.settings.team.roles",{url:"/roles?role",pageTrack:"/settings/team/roles",templateUrl:"/modules/settings/roles.html",title:"Roles",controller:"RolesCtrl",permission:"user-*",resolve:{team:["API",function(e){return e.one("integration/users").get()}],roles:["RoleService",function(e){return e.fetch()}]}}).state("app.settings.preferences",{url:"/preferences",pageTrack:"/settings/preferences",templateUrl:"/modules/settings/preferences.html",title:"Preferences",controller:"PreferencesCtrl",resolve:{subscriptionPreferences:["API","$rootScope",function(e,t){return t.User.hasPermission("plan-view")?e.one("subscription/preferences").get():Promise.resolve({data:{}})}],transferApprovalPreference:["API","$rootScope",function(e,t){return t.User.hasPermission("settings-*")?e.one("transfer/approval/settings").get():Promise.resolve({data:{}})}],southAfricanVATRegNoDocument:["API","Session",function(e,t){if(!t.get("account")||"ZA"!==t.get("account").attributes.country_code)return null;var n=t.get("account")&&t.get("account").id;return e.one("integration/".concat(n,"/documents/code/ZA-VAT-NO")).get().then(function(e){return e.data})}]}}).state("app.settings.developer",{url:"/developer",pageTrack:"/settings/developer",templateUrl:"/modules/settings/developer.html",title:"Developer",controller:"DeveloperCtrl",permission:"api-key-*",resolve:{keys:["API",function(e){return e.one("integration/keys").get()}]}}).state("app.settings.compliance",{url:"/compliance?utm_medium",pageTrack:"/settings/compliance?utm_medium",templateUrl:"/modules/settings/compliance/index.html",title:"Compliance",controller:"ComplianceCtrl",permission:"settings-*"}).state("app.settings.apple-pay",{url:"/apple-pay",pageTrack:"/settings/apple-pay",templateUrl:"/modules/settings/apple-pay.html",title:"Apple Pay",controller:"ApplePayCtrl",resolve:{domainNames:["API",function(e){return e.one("apple-pay/domain").get().then(function(e){return e.data.domainNames})}]}})}]).factory("SettlementAccountData",["API","$rootScope",function(e,t){return{fetch:function(){return e.one("integration/view_settlement_accounts",t.Business.id).get()}}}]).controller("SettingsCtrl",["$state","$scope","$rootScope","API","Notification","Auth","ngDialog","utils","Session","submittedKyc",function(a,i,s,e,c,u,t,n,r,o){var l=s.currentSession,d=(i.session=l).account,p=d.is_live,f=d.email,m=d.support_email,g=d.chargeback_email,h=d.social_urls,y=d.default_currency,b=d.business_name,v=d.product_name,S=d.website_url,P=d.address,w=d.attributes,C=d.phone,O=d.office_address,A=d.registered_address;i.integrationEmails={support_email:m,chargeback_email:g,email:f},i.integrationSocials={social_urls:h},i.integrationBasicInfo={business_name:b,product_name:v,website_url:S,default_currency:y,phone:C,attributes:w,office_address:_objectSpread({street_line_one:P,country:w.country.name},O),registered_address:A},s.User.isDemoUser()&&a.go("transactions.list"),i.account=_.omit(l.account,"keys","primary_user","users","registration_packet_path","director_identity_evidence_path","identity_evidence_path","bvn","registration_document_number","registration_document_path","registration_document_type");var T=l.user,k=T.id,D=T.first_name,x=T.last_name,j=T.calling_code,$=T.email,I=T.phone,F=T.is_primary_user,E=T.is_developer,M=T.truecaller_verified,U=T.display_state;i.user={id:k,first_name:D,last_name:x,calling_code:j,email:$,phone:I,is_primary_user:F,is_developer:E,truecaller_verified:M,display_state:U},i.copyOfficeAddressToRegisteredAddress=function(){var e=i.integrationBasicInfo.office_address,t=(e.id,_objectWithoutProperties(e,_excluded));i.integrationBasicInfo.registered_address=angular.copy(t)},i.saveIntegrationBasicInfo=function(){i.shouldUseOfficeAddressAsRegisteredAddress=angular.equals(i.integrationBasicInfo.office_address,i.integrationBasicInfo.registered_address),i.shouldUseOfficeAddressAsRegisteredAddress&&i.copyOfficeAddressToRegisteredAddress();var e=n.concatenateObjectValues(i.integrationBasicInfo.office_address),t=_objectSpread(_objectSpread({},i.integrationBasicInfo),{},{address:e});i.save("account",{},t)},i.isDirectDebitBusiness=i.session.account&&"direct_debit"===i.session.account.business_type,i.showComplianceSettingsMenu=r.hasPermission("settings-*")&&p&&w&&w.compliance_documents_submitted,i.showApplePaySettingsMenu="admin"===s.User.role.name&&i.session.account&&i.session.account.allow_international_cards&&!settings.restrictedBusinessCategoriesForApplePay.includes(i.session.account.mcc_category)&&i.session.account.active_channels.includes("apple_pay"),i.save=function(t,e,n,r){var o=n||_.clone(i[t]);u.update(t,o).then(function(){var e="user"===t?"Your profile":"Your business";c.success("Update successful",e+" has been updated successfully"),a.reload(),"function"==typeof r&&r()},function(e){s.$broadcast("updated_account",!1),c.error("Could not update your account",e)})},i.showSettlementAccountModal=function(){t.open({template:"modules/settings/modals/manage-settlement-accounts.html",trapFocus:!1,controller:"SettlementAccountsCtrl",width:600})},i.getSettlementAccounts=function(){e.one("integration/view_settlement_accounts",l.account.id).get().then(function(e){i.settlement_accounts=e.data})},i.closeBusiness=function(){t.open({closeByDocument:!1,closeByEscape:!1,template:"modules/settings/modals/close-business.html",controller:"CloseBusinessCtrl",width:500,scope:i,preCloseCallback:function(){i.$broadcast("closedBusiness",!1)},resolve:{users:["API",function(e){return e.one("integration/users").get()}]}})},i.sendVerificationEmail=function(){e.all("send-verification-email").post().then(function(){c.success("Verification email request sent","Verification email sent successfully")}).catch(function(e){c.error("Could not send verification email",e)})}}]).controller("ProfileCtrl",["$scope","$state","currentUser","ngDialog","AmplitudeService","API","Auth","Notification",function(o,e,t,a,n,r,i,s){var c=n.logEvent,u=t.id,l=t.first_name,d=t.last_name,p=t.calling_code,f=t.email,m=t.phone,g=t.is_primary_user,h=t.is_developer,y=t.truecaller_verified,b=t.display_state;o.user={id:u,first_name:l,last_name:d,calling_code:p,email:f,phone:m,is_primary_user:g,is_developer:h,truecaller_verified:y,display_state:b},o.mfaEnabled=t.mfa_enabled;var v=(t.integrations||[]).filter(function(e){var t=e.mfa;return t&&t.is_required});o.userIsOnIntegrationWithMFAEnforced=!!v.length;o.showMFASuccessModal=function(e){var t=e.backupCodes;o.mfaEnabled=!0,o.backupCodes=t;var n=o.backupCodes.join("\n"),r=new Blob([n],{type:"text/plain"});o.backupCodeLink=URL.createObjectURL(r),a.open({showClose:!0,closeByDocument:!1,closeByEscape:!1,template:"modules/settings/modals/mfa-enabled-successfully.html",scope:o,width:450})};var _=["$scope","mfaRequest",function(t,e){t.mfaRequest=e.data,t.enableMFA=function(){t.enablingMFA=!0,r.all("enable-mfa").post({totp:t.totp}).then(function(e){t.closeThisDialog(),c("Enabled 2FA"),t.enablingMFA=!1,t.showMFASuccessModal({backupCodes:e.data.backup_codes}),i.update("user")}).catch(function(e){t.enablingMFA=!1,s.error("Could not enable Two Factor Authentication",e)})}}],S=["$scope","API",function(t,n){t.payload={},t.MFAType="totp",t.updateMFAType=function(e){t.MFAType=e},t.disableMFA=function(){t.disablingMFA=!0;var e=_objectSpread(_objectSpread({},"totp"===t.MFAType&&{totp:t.payload.totp}),"backupCode"===t.MFAType&&{backup_code:t.payload.backup_code});n.all("disable-mfa").post(e).then(function(){o.mfaEnabled=!1,t.closeThisDialog(),t.disablingMFA=!1,s.success("Disabled Two Factor Authentication","Two Factor Authentication successfully disabled"),i.update("user")}).catch(function(e){t.disablingMFA=!1,s.error("Could not disable Two Factor Authentication",e)})}}];o.showBackupCodeGeneratedSuccessModal=function(e){var t=e.backupCodes;o.backupCodes=t;var n=o.backupCodes.join("\n"),r=new Blob([n],{type:"text/plain"});o.backupCodeLink=URL.createObjectURL(r),a.open({showClose:!0,closeByDocument:!1,closeByEscape:!1,template:"modules/settings/modals/generated-backup-codes-successfully.html",scope:o,width:450})};var P=["$scope","API",function(t,e){t.generateBackupCodes=function(){t.generatingBackupCodes=!0,e.all("generate-backup-codes").post({totp:t.totp}).then(function(e){t.closeThisDialog(),t.generatingBackupCodes=!1,t.showBackupCodeGeneratedSuccessModal({backupCodes:e.data.backup_codes})}).catch(function(e){t.generatingBackupCodes=!1,s.error("Could not generate Backup codes",e)})}}];o.toggleMFA=function(){o.mfaEnabled?a.open({showClose:!0,closeByDocument:!1,closeByEscape:!1,template:"modules/settings/modals/disable-mfa.html",className:"ngdialog-theme-plain dialog-close-center-icon",scope:o,controller:S,width:450}):a.open({showClose:!0,closeByDocument:!1,closeByEscape:!1,template:"modules/settings/modals/enable-mfa.html",className:"ngdialog-theme-plain dialog-close-center-icon",resolve:{mfaRequest:["API",function(e){return e.one("request-mfa").get()}]},scope:o,controller:_,width:450})},e.params.toggle_mfa&&!o.mfaEnabled&&o.toggleMFA(),o.openGenerateBackupCodesModal=function(){a.open({showClose:!0,closeByDocument:!1,closeByEscape:!1,template:"modules/settings/modals/generate-backup-codes.html",className:"ngdialog-theme-plain dialog-close-center-icon",scope:o,controller:P,width:450})},o.saveProfile=function(){o.save("user",{},_objectSpread(_objectSpread({},o.user),{},{calling_code:o.user.phone.calling_code,phone:o.user.phone.subscriber_number}))}}]).controller("CloseBusinessCtrl",["$state","$scope","$rootScope","API","Notification","users",function(e,t,n,r,o,a){t.account=n.Business,t.usersCount=a.data.length,t.isShowingCustomReason=!1,t.reason="";var i=_.filter(n.User.integrations,function(e){return e.id!==t.account.id});t.reasons=["I have another Paystack account","There was an issue with my integration","My business is not permitted on Paystack","I am dissatisfied with Paystack services"],t.setReason=function(e){t.reason=e,t.isShowingCustomReason=!1},t.showCustomReason=function(){t.reason="",t.isShowingCustomReason=!0},t.confirmCloseBusiness=function(){r.all("integration/"+t.account.id+"/close").post({reason:t.reason}).then(function(){t.closeThisDialog(),o.success(t.account.business_name+" has been closed successfully"),1<=i.length?n.switchIntegration(i[0]):(n.Business=null,e.go("setup.new"))}).catch(function(e){t.$broadcast("closedBusiness",!1),o.error("An error occurred while closing this business",e.message||"Unknown error")})}}]).controller("TeamCtrl",["$state","$scope","API","Notification","RoleService","Auth","Session","ngDialog","team",function(e,c,t,u,n,r,o,a,i){var s=o.get("account"),l=o.get("user");c.teamMembers=_.map(i.data,function(e){return e.is_primary_user=s.primary_user===e.id,e.is_current_user=l.id===e.id,e.can_be_removed=!e.is_primary_user,e.role=_.findWhere(n.data(),{id:e.role_id}),e});var d=function(){c.teamMembersWithoutMFAEnabled=c.teamMembers.filter(function(e){return!e.mfa_enabled}),c.numberOfTeamMembersWithoutMFAEnabled=c.teamMembersWithoutMFAEnabled.length};d();c.hasOtherAdmins=function(){return 0<_.filter(c.teamMembers,function(e){return e.role.id===n.id("admin")}).length};var p=function(e,t){a.open({template:e,controller:"TeamMemberPopupCtrl",data:{teamMembers:c.teamMembers,teamMember:t?t.teamMember:null}})};c.inviteTeamMember=function(){p("newTeamMember")},c.changeBusinessOwner=function(){p("changeBusinessOwner")},c.changeRole=function(e){p("changeRole",{teamMember:e})},c.confirmRemove=function(e){p("removeTeamMember",{teamMember:e})},e.params.invite&&setTimeout(function(){p("newTeamMember")},100),c.isMFAEnforcementPilot=[100043,100073,608232,487186].includes(s.id),c.mfaIsEnforced=s.attributes.mfa_is_required,t.one("integration/".concat(s.id)).get().then(function(e){var t=e.data;c.mfaIsEnforced=t.attributes.mfa_is_required});var f=function(e){c.mfaIsEnforced=e};c.showEnforceMFAModal=function(){a.open({template:"modules/settings/modals/enforce-mfa.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450,scope:c,controller:["$scope","$state","Session","API","Auth","AmplitudeService",function(r,e,t,n,o,a){var i=t.get("user"),s=a.logEvent;r.showTeamMembersWithoutMFAEnabled=!1,r.toggleShowTeamMembersWithoutMFAEnabled=function(){r.showTeamMembersWithoutMFAEnabled=!r.showTeamMembersWithoutMFAEnabled},r.step=i.mfa_enabled?"enforceMFA":"noMFA",r.setStep=function(e){"enableMFA"===e?n.one("request-mfa").get().then(function(e){var t=e.data;r.mfaRequest=t,r.step="enableMFA"}):r.step=e};r.enableMFA=function(e){r.enablingMFA=!0,n.all("enable-mfa").post({totp:e}).then(function(e){s("Enabled 2FA before enforcing 2FA on integration"),r.enablingMFA=!1,c.teamMembers=c.teamMembers.reduce(function(e,t){return t.id===l.id?e.push(_objectSpread(_objectSpread({},t),{},{mfa_enabled:1})):e.push(t),e},[]),d(),function(e){r.mfaEnabled=!0,r.backupCodes=e,r.setStep("downloadBackupCode");var t=r.backupCodes.join("\n"),n=new Blob([t],{type:"text/plain"});r.backupCodeLink=URL.createObjectURL(n),r.showProceedButton=!0,r.proceedButtonText="Enforce 2FA",r.proceedToNextStep=function(){r.setStep("enforceMFA")}}(e.data.backup_codes),o.update("user")}).catch(function(e){r.enablingMFA=!1,s("Could not enable 2FA before enforcing 2FA on integration",{errorStatus:e&&e.statusCode,errorMessage:e&&e.data&&e.data.message}),u.error("Could not enable Two Factor Authentication",e)})},r.minimumAllowedDateForMFAEnforcement=moment().add(1,"day").format("DD MMM YYYY"),r.mfaEnforcementType=!!r.numberOfTeamMembersWithoutMFAEnabled&&"deadline",r.enforceMFA=function(){var e=_objectSpread({},"deadline"===r.mfaEnforcementType&&{enforcement_deadline:r.mfaDeadlineDate});n.all("integration/enforce_mfa").post(e).then(function(e){f(!0),u.success("2FA enforced successfully",e.message),s("Enforced 2FA on integration"),o.update("account"),"immediate"===r.mfaEnforcementType&&c.numberOfTeamMembersWithoutMFAEnabled&&(c.teamMembers=c.teamMembers.filter(function(e){return!!e.mfa_enabled}),d()),r.closeThisDialog()}).catch(function(e){u.error("Could not enforce 2FA",e),s("Could not enforce 2FA on integration",{errorStatus:e&&e.statusCode,errorMessage:e&&e.data&&e.data.message})})}}]})},c.showUndoMFAEnforcementModal=function(){a.open({template:"modules/settings/modals/undo-mfa-enforcement.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450,controller:["$scope","API","Notification",function(t,e,n){t.undoEnforceMFA=function(){e.all("integration/undo_enforce_mfa").post({password:t.password}).then(function(e){f(!1),n.success("2FA enforcement disabled",e.message),r.update("account"),t.closeThisDialog()}).catch(function(e){n.error("Could not undo 2FA enforcement",e)})}}]})}}]).controller("TeamMemberPopupCtrl",["$state","$scope","$rootScope","API","ngDialog","Notification","Auth","RoleService",function(n,r,e,o,t,a,i,s){var c=e.currentSession;r.teamMember=r.ngDialogData.teamMember||{},r.teamMembers=r.ngDialogData.teamMembers,r.admins=_.filter(r.teamMembers,function(e){if(c&&c.user.id!==e.id)return e&&"admin"===e.role_name}),r.roles=s.data(),r.isAlreadyTeamMember=function(e){return _.findWhere(r.teamMembers,{email:e.email})},r.addTeamMember=function(){o.all("integration/add_user").post({integration:c.account.id,email:r.teamMember.email,role:r.teamMember.role_id,is_developer:r.teamMember.is_developer}).then(function(e){i.update("account").then(function(){a.success("Team member added!",r.teamMember.email+" has been added successfully"),n.reload(),r.closeThisDialog()})},function(e){r.$broadcast("teamMemberAdded",!1),a.error("Could not add team member to your business",e)})},r.removeTeamMember=function(){o.all("integration/remove_user").post({integration:c.account.id,user:r.teamMember.id}).then(function(e){i.update("account").then(function(){a.success("Team member removed from business",r.teamMember.email+" has been removed successfully"),r.closeThisDialog(),n.reload()})},function(e){r.$broadcast("teamMemberRemoved",!1),a.error("Could not remove team member from your business",e)})},r.primary_user=c.account.primary_user,r.changeBusinessOwner=function(e){o.all("integration/set_primary_user").post({integration:c.account.id,user:e}).then(function(e){i.update("account").then(function(){a.success("Business updated","Business Owner changed successfully"),r.closeThisDialog(),n.reload()})},function(e){r.$broadcast("changedBusinessOwner",!1),a.error("Could not change business owner",e)})},r.changeRole=function(t){o.all("integration/modify_user_role").post({integration:e.Business.id,user:t.id,role:t.role_id}).then(function(e){i.update("account").then(function(){a.success("Team member role updated!",t.email+"'s role has been updated"),n.reload(),r.closeThisDialog()})},function(e){r.$broadcast("changedRole",!1),a.error("Could not change team member role",e)})}}]).controller("RolesCtrl",["$state","$scope","API","Notification","team","RoleService","Auth","Session","ngDialog",function(e,t,n,r,o,a,i,s,c){var u=_.map(a.data(),function(t){return t.availablePermissions=[],t.unavailablePermissions=[],_.each(a.permissions,function(e){_.each(e.permissions,function(e){_.contains(t.permissions,e.key)?t.availablePermissions.push(e):t.unavailablePermissions.push(e)})}),t.users=_.filter(o.data,function(e){return e.role_id===t.id}),t.listUsers=function(){return _.map(t.users,function(e){return e.first_name+" "+e.last_name}).join(", ")},t});if(t.defaultRoles=_.filter(u,function(e){return!e.is_custom}),t.customRoles=_.filter(u,function(e){return e.is_custom}),e.params.role){var l=_.findWhere(u,{id:Number(e.params.role)});t.selectedRole=l}if(!t.selectedRole){var d=_.findWhere(u,{id:a.id("admin")});t.selectedRole=d}t.setRole=function(e){t.selectedRole=angular.copy(e)},t.editRole=function(e){c.open({template:"modules/settings/modals/update-role.html",controller:"RolePopupCtrl",data:{role:e}})},t.deleteRole=function(e){c.open({template:"modules/settings/modals/delete-role.html",controller:"RolePopupCtrl",data:{role:e}})}}]).controller("RolePopupCtrl",["$state","$scope","$rootScope","API","Notification","Auth","RoleService",function(t,n,e,r,o,a,i){n.permissionGroups=i.permissions,n.role=n.ngDialogData?n.ngDialogData.role:{name:"",permissions:[]},n.role.hasPermission=function(e){return _.contains(n.role.permissions,e)},n.togglePermission=function(e){_.contains(n.role.permissions,e)?n.role.permissions=_.without(n.role.permissions,e):n.role.permissions.push(e)},n.createRole=function(){r.all("integration/roles").post({name:n.role.name,description:n.role.description,permissions:n.role.permissions}).then(function(e){t.go("app.settings.team.roles",{role:e.data.id},{reload:!0}),n.closeThisDialog()}).catch(function(e){n.$broadcast("roleCreated",!1),o.error("Could not create custom role",e)})},n.updateRole=function(){r.one("integration/roles",n.role.id).customPUT({name:n.role.name,description:n.role.description,permissions:n.role.permissions}).then(function(e){t.go("app.settings.team.roles",{role:n.role.id},{reload:!0}),n.closeThisDialog()}).catch(function(e){n.$broadcast("roleUpdated",!1),o.error("Could not update custom role",e)})},n.deleteRole=function(){r.one("integration/roles",n.role.id).remove().then(function(e){t.go("app.settings.team.roles",{},{reload:!0}),n.closeThisDialog()}).catch(function(e){n.$broadcast("roleDeleted",!1),o.error("Could not delete custom role",e)})}}]).controller("BankAccountCtrl",["$state","$scope","$rootScope","$timeout","API","Session","ngDialog","BankService","LocaleService","Notification","AmplitudeService","CountryService","ComplianceStatus","Auth","ConsentAPI",function(n,o,e,t,a,r,i,s,c,u,l,d,p,f,m){o.account=r.get("account"),o.canProcessMobileMoney=function(e){return d.currencyHasFeature(e,"mobile_money")},o.canProcessMobileMoneyInCountry=d.countryHasFeature(o.account.attributes.country.iso_code,"mobile_money"),o.getCurrencyData=function(e){return d.getCurrencyData(e)};var g=l.logEvent;o.logEvent=g,o.managedAccountSettlementFormVersions=[];var h=[608229,608196,608109,608201,608211,608235,608239,608241,100091,100043,165949,168550,709755,115278,437725,369128,362275,669072,637354,683274,418090,471913,683714,124637,788325].includes(o.account.id),y=e.Business;o.isEligibleForSettlementManagedAccount=y.is_live&&y.agreements&&y.agreements.settlement_managed_account&&y.agreements.settlement_managed_account.visible,o.isEligibleForTopupManagedAccount=y.is_live&&"registered"===y.business_type&&y.can_transfer&&"NG"===y.attributes.country_code&&h,Promise.all([m.getComplianceStatus(),m.getAgreements({type:"settlement_managed_account"})]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];o.integrationIsFullyCompliant=n.completed,o.outstandingComplianceStep=n.current,o.managedAccountSettlementFormVersions=r.data.map(function(e){var t=e.version,n=e.signed,r=void 0!==n&&n,o=e.signature,a=e.role,i=e.updated_at,s=e.type;return{version:t,signed:r,signatureDate:i?moment(i).format("DD MMM YYYY"):"-",type:s,signature:o||"-",role:a||"-"}}),o.managedAccountAgreementSigned=r.data.some(function(e){return e.signed}),o.$broadcast("fetchedManagedAccountsAgreement"),o.gottenComplianceAndConsentInfo=!0}),o.switchToLiveMode=function(){o.account.is_live?e.switchState({state:n.current},!0):n.go("app.compliance")},o.internationalEnabled=!o.account.international_toggle_disabled&&o.account.allow_international_cards,o.new_settlement_account={currency:o.account.selected_currency};var b=function(t){a.all("integration/enable_currency/"+o.account.id).post({currency:t}).then(function(e){r.saveBusiness(e.data),u.success("Currency enabled",t+" has been enabled successfully"),n.reload()},function(e){u.error("Could not enable currency",e)})},v={PROFILE:"app.compliance.profile",CONTACT:"app.compliance.contact",ACCOUNT:"app.compliance.account",DOCUMENTS:"app.compliance.documents"};o.directToComplianceModule=function(){n.go(v[o.outstandingComplianceStep],{edit:!0})},o.getTopupManagedAccounts=function(){o.isEligibleForTopupManagedAccount&&o.integrationIsFullyCompliant&&o.managedAccountAgreementSigned?a.one("automated_top_up_account/status").get({id:o.account.id,provider_slug:"titan-bank"}).then(function(e){o.topupManagedAccountStatus=e.data.status;var t=r.get("account");o.topupManagedAccounts=t.top_up_accounts||[],o.$broadcast("fetchedTopupManagedAccount")}).catch(function(e){404===e.status&&e.data&&e.data.message?o.topupManagedAccountStatus="not_found":(o.topupManagedAccountStatus=e.data.status,u.error("Could not fetch topup account",e)),o.$broadcast("fetchedTopupManagedAccount",!1)}):(o.topupManagedAccountStatus="not_found",t(function(){return o.$broadcast("fetchedTopupManagedAccount",!1)}))},o.requestForTopupManagedAccount=function(){a.all("automated_top_up_account").post({preferred_bank:"titan-bank"}).then(function(e){u.success("Request successful","Your managed account was requested successfully"),o.$broadcast("requestedTopupAccount",!0),o.getTopupManagedAccounts()}).catch(function(e){u.error("Could not request for managed account",e),o.$broadcast("requestedTopupAccount",!1)})},o.getSettlementManagedAccount=function(){o.isEligibleForSettlementManagedAccount&&o.managedAccountAgreementSigned?a.one("manual_settlement_account/status").get({id:o.account.id,provider_slug:"titan-bank"}).then(function(e){o.settlementManagedAccountStatus=e.data.status,o.$broadcast("fetchedSettlementManagedAccount")}).catch(function(e){404===e.status&&e.data&&e.data.message&&(o.settlementManagedAccountStatus="not_found"),o.$broadcast("fetchedSettlementManagedAccount",!1)}):(o.settlementManagedAccountStatus="not_found",t(function(){return o.$broadcast("fetchedSettlementManagedAccount",!1)}))},o.requestForSettlementManagedAccount=function(){a.all("manual_settlement_account").post({preferred_bank:"titan-bank"}).then(function(e){u.success("Request successful","Your managed account was requested successfully"),o.$broadcast("requestedSettlementAccount",!0),o.getSettlementManagedAccount()}).catch(function(e){u.error("Could not request for managed account",e),o.$broadcast("requestedSettlementAccount",!1)})},o.disableCurrency=function(t){a.all("integration/disable_currency/"+o.account.id).post({currency:t}).then(function(e){r.saveBusiness(e.data),u.success("Currency disabled",t+" has been disabled successfully"),o.closeThisDialog(),n.reload()},function(e){u.error("Could not disable currency",e)})},o.switchSettlementAccountState=function(e){var t;e.isActive?(t=e.currency,o.account.selected_currency=t,i.openConfirm({template:"modules/settings/modals/confirm-disable-currency.html",trapFocus:!1,controller:"BankAccountCtrl",width:500})):b(e.currency)},o.getSettlementAccounts=function(){c.fetch().then(function(e){var t=e.allowed_currencies,r=o.account.allowed_currencies;o.isInternationPaymentsEnabled=!o.account.international_toggle_disabled&&o.account.allow_international_cards,a.one("integration/view_settlement_accounts",o.account.id).get().then(function(n){o.settlementAccounts=t.map(function(t){var e=n.data.find(function(e){return e.currency===t})||{};return e.currency=t,e.isActive=r.includes(t),e}),o.$broadcast("fetchedData")})})},o.addAccount=function(){a.all("integration/add_settlement_account/"+o.account.id).post(o.new_settlement_account).then(function(){b(o.new_settlement_account.currency),o.$broadcast("accountCreated",!0),o.closeThisDialog(),n.reload(),u.success("Account added successfully","Your settlement accounts have been updated")},function(e){o.$broadcast("accountCreated",!1),u.error("Could not create account",e)})},o.changeAccount=function(){o.new_settlement_account.settlement_account_type||(o.new_settlement_account.settlement_account_type="bank_account"),a.all("integration/add_settlement_account/"+o.account.id).post(o.new_settlement_account).then(function(){o.$broadcast("accountChanged",!0),o.closeThisDialog(),u.success("Account changed successfully","Your settlement account have been updated"),f.update("account",null).then(function(){n.reload()})},function(e){o.$broadcast("accountChanged",!1),u.error("Could not change account",e)})},o.fetchBanks=function(){o.banks=[],o.loadingBanks=!0,s.init({currency:o.new_settlement_account.currency}).then(function(e){o.banks=e,o.loadingBanks=!1}).catch(function(){o.loadingBanks=!1})},o.openChangeAccountModal=function(e){o.account.selected_currency=e,i.open({template:"modules/settings/modals/settlement-change.html",trapFocus:!1,controller:"BankAccountCtrl",width:500})},o.showAddSettlementAccountModal=function(e){o.account.selected_currency=e,i.open({template:"modules/settings/modals/add-settlement-account.html",trapFocus:!1,controller:"BankAccountCtrl",width:500})},o.toggleInternational=function(){o.save("account",{},{allow_international_cards:!0})},o.requestInternational=function(){g("Clicked Request International button"),p.getComplianceStatus().then(function(e){if(e.completed)return a.one("integration/request_international",o.account.id).post().then(function(){o.internationalRequested=!0,g("Requested international payments"),u.success("Your request has been sent. We'll review your documents within 48 hours. If it all checks out, international payments will be enabled for your business.")});u.error("Could not request international for your business","Please submit all the required documents on the compliance page in order to request for international")}).catch(function(e){u.error("Could not request international for your business",e)})},o.verifyAccountNumber=function(){o.accountVerification=null;var e=o.new_settlement_account.account_number,t=o.new_settlement_account.bank,n=o.new_settlement_account.currency;e&&s.validate(e,t).then(function(){return o.accountVerification="pending",s.resolve(e,t,n)}).then(function(e){o.accountVerification=e})}}]).controller("PreferencesCtrl",["$state","$scope","$window","$rootScope","API","Notification","Auth","ngDialog","Session","AmplitudeService","PreferencesService","ComplianceStatus","subscriptionPreferences","southAfricanVATRegNoDocument","utils","transferApprovalPreference",function(r,o,t,n,a,i,s,c,e,u,l,d,p,f,m,g){o.account=e.get("account"),o.email_notification="instant"==o.account.email_notification,o.transfer_notification="instant"==o.account.transfer_notification,o.transfer_notification_to_recipient="instant"==o.account.transfer_notification_to_recipient,o.send_transfer_email_otp=o.account.send_transfer_email_otp,o.user_email=n.User.email,o.user_phone=n.User.phone,o.showTransferApprovalSettings=[100043,100073,487186,360344,340690,104401,148259].includes(o.account.id);var h=g&&g.data,y=h.test_contact_email,b=h.live_contact_email,v=h.on_for_live_mode,_=h.automatically_blacklist_rejected_recipients;o.transferApprovalIsOnForLiveModeFromApi=v,o.transferApprovalPreference=_objectSpread({},g.data||{}),o.transferApprovalPreference.contact_email=y||b,o.transferApprovalPreference.action_on_transfer_rejection=_?"blacklist_recipient":"do_nothing",o.subscriptionPreferences=p.data,o.southAfricanVATRegNo=f&&f.value;var S=u.logEvent;o.shouldDisableApplePayChannel=!o.account.allow_international_cards;var P={card:"Card",bank:"Bank",ussd:"USSD",qr:"QR",bank_transfer:"Bank Transfer",mobile_money:"Mobile Money",eft:"EFT",payattitude:"PayAttitude",apple_pay:"Apple Pay",paypal:"PayPal",debit_order:"Debit Order"};o.allowedChannels=o.account.available_channels.map(function(e){return{code:e,name:P[e]||e}}),o.showAmexCardPreference="NG"===o.account.attributes.country_code,o.showCardPreferences=o.account.active_channels.includes("card")&&o.showAmexCardPreference,o.change_email=function(e){o.account.email_notification=e?"instant":"none"},o.change_transfer_notification=function(e){o.account.transfer_notification=e?"instant":"none"},o.change_transfer_notification_to_recipient=function(e){o.account.transfer_notification_to_recipient=e?"instant":"none"},o.change_send_transfer_email_otp=function(e){o.account.send_transfer_email_otp=e},o.saveSubscriptionPreferences=function(e){a.all("subscription/preferences").customPUT(_defineProperty({},e,o.subscriptionPreferences[e])).then(function(){i.success("Update successful","Your profile has been updated successfully"),r.reload()}).catch(function(e){n.$broadcast("updated_account",!1),i.error("Could not update your profile",e)})},o.channels={};var w=function(){o.account.active_channels.forEach(function(e){o.channels[e]=!0})};w(),o.updatePreferences=function(){o.save("account",{},{receipts:o.account.receipts,email_notification:o.account.email_notification,send_transfer_email_otp:o.account.send_transfer_email_otp,transfer_notification:o.account.transfer_notification,transfer_notification_to_recipient:o.account.transfer_notification_to_recipient})},o.updateActiveChannels=function(){var e=Object.entries(o.channels).filter(function(e){return _slicedToArray(e,2)[1]}).map(function(e){return _slicedToArray(e,1)[0]}),t=e.includes("apple_pay")&&!e.includes("card"),n=e.includes("apple_pay")&&!o.account.active_channels.includes("apple_pay"),r=e.includes("paypal")&&!o.account.active_channels.includes("paypal");return e.length?t?(o.channels.apple_pay=!1,w(),void i.error("Channel required","Card should be enabled as a payment channel with Apple Pay")):void(n?(o.channels.apple_pay=!1,c.open({scope:o,template:"modules/settings/modals/accept-apple-pay-terms-and-conditions.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450})):r?(o.channels.paypal=!1,c.open({scope:o,template:"modules/settings/modals/accept-paypal-terms-and-conditions.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450})):o.save("account",{},{active_channels:e})):(w(),void i.error("Channel required","Please choose at least one payment channel"))},o.acceptApplePayTermsAndConditions=function(){o.channels.apple_pay=!0,c.close(),o.save("account",{},{active_channels:[].concat(_toConsumableArray(o.account.active_channels),["apple_pay"])},function(){c.open({template:"modules/settings/modals/apple-pay-enabled.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450})})},o.acceptPayPalTermsAndConditions=function(){o.channels.paypal=!0,c.close(),o.save("account",{},{active_channels:[].concat(_toConsumableArray(o.account.active_channels),["paypal"])})},o.toggleInternational=function(){o.save("account",{},{allow_international_cards:o.account.allow_international_cards})},o.toggleAmericanExpress=function(){o.account.attributes.process_amex_cards?(o.account.attributes.process_amex_cards=!1,c.open({scope:o,template:"modules/settings/modals/enable-american-express.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450})):o.save("account",{},{process_amex_cards:o.account.attributes.process_amex_cards})},o.enableAmericanExpress=function(){o.account.attributes.process_amex_cards=!0,o.save("account",{},{process_amex_cards:!0}),c.close()},o.openDeleteTestDataModal=function(){S("Clicked delete test data"),c.open({template:"/modules/settings/modals/delete-test-data.html",controller:["$scope","$state","Session","API","AmplitudeService","Notification",function(t,e,n,r,o,a){t.account=n.get("account");var i=o.logEvent;t.deleteTestData=function(){r.all("integration/clear_test_data").post({integration:t.account.id}).then(function(){i("Deleted test data"),a.success("Test data has been removed successfully"),e.reload(),t.closeThisDialog()},function(e){t.$broadcast("testDataDeleted",!1),a.error("Could not delete test data",e)})}}]})},o.settlementSchedules={T1:"Settled next day",T2:"Settled two days after",T3:"Settled three days after",MANUAL:"Settled to Balance"},o.changeSettlementSchedule=function(t){a.all("settlement/set_schedule").post({settlement_schedule:t}).then(function(e){return s.update("account")}).then(function(){var e="MANUAL"===t?"A settlement review will be performed within 48 hours":"You are now on automatic settlement";i.success("Settlement schedule changed successfully",e),r.reload(),o.closeThisDialog()}).catch(function(e){o.$broadcast("changedSchedule",!1),i.error("Could not change settlement schedule",e)})},o.enableOTP=function(){a.all("transfer/enable_otp").post().then(function(){return s.update("account")}).then(function(){r.reload()}).catch(function(e){i.error("Could not enable transfer OTP",e)})},o.disableOTP=function(){a.all("transfer/disable_otp").post().then(function(){return c.openConfirm({template:"disableTransferOTP",scope:o}).catch(function(e){return Promise.reject({message:"You closed the modal"})})}).then(function(e){return a.all("transfer/disable_otp_finalize").post({otp:e})}).then(function(){return s.update("account")}).then(function(){i.success("Transfer OTP Disabled")}).catch(function(e){i.error("Could not disable transfer OTP",e)})},o.updateTransferApprovalPreference=function(){var e={on_for_live_mode:o.transferApprovalPreference.on_for_live_mode,on_for_test_mode:o.transferApprovalPreference.on_for_test_mode,on_when_otp_is_on:o.transferApprovalPreference.on_when_otp_is_on,test_approval_url:o.transferApprovalPreference.test_approval_url,live_approval_url:o.transferApprovalPreference.live_approval_url,on_for_dashboard_initiated_transfers:o.transferApprovalPreference.on_for_dashboard_initiated_transfers,test_contact_email:o.transferApprovalPreference.contact_email,live_contact_email:o.transferApprovalPreference.contact_email,automatically_blacklist_rejected_recipients:"blacklist_recipient"===o.transferApprovalPreference.action_on_transfer_rejection};a.all("transfer/approval/settings").post(e).then(function(){o.$broadcast("transferApprovalPreferenceUpdated"),i.success("Update successful","Your transfer approval preference has been updated successfully"),r.reload()}).catch(function(e){o.$broadcast("transferApprovalPreferenceUpdated",!1),i.error("Could not update your transfer approval preference",e)})},o.resendOTPToDisableApprovalForLiveTransfers=function(){a.all("transfer/approval/resend_otp").post({reason:"disable_transfer_approval"}).then(function(){i.success("Confirmation code resent","Please check your phone to disable approval for live transfers")}).catch(function(e){i.error("Confirmation code not resent",e)})},o.disableApprovalForLiveTransfers=function(){a.all("transfer/approval/disable").post().then(function(){c.openConfirm({template:"disableApprovalForLiveTransfers",scope:o,preCloseCallback:function(){i.error("Could not disable approval","You closed the modal"),r.reload()}}).then(function(e){a.all("transfer/approval/disable_finalize").post({otp:e}).then(function(){i.success("Update successful","You have successfully disabled approval for live transfers"),r.reload()}).catch(function(e){i.error("Could not disable approval",e),r.reload()})})}).catch(function(e){i.error("Could not send OTP",e),r.reload()})},o.updateDefaultCurrency=function(){o.save("account",{},{default_currency:o.account.default_currency})},o.resendCode=function(){a.all("transfer/resend_otp").post({reason:"disable_otp"}).then(function(e){i.success("Confirmation Code Resent","Please check your phone to complete this transfer")}).catch(function(e){i.error("Confirmation not resent",e)})},o.requestedInternational=!1,o.requestInternational=function(){S("Clicked Request International button"),d.getComplianceStatus().then(function(e){if(e.completed)return a.one("integration/request_international",o.account.id).post().then(function(){o.requestedInternational=!0,S("Requested international payments"),i.success("Your request has been sent. We'll review your documents within 48 hours. If it all checks out, international payments will be enabled for your business.")});i.error("Could not request international for your business","Please submit all the required documents on the compliance page in order to request for international")}).catch(function(e){i.error("Could not request international for your business",e)})},o.generateFinancialReport=function(){c.open({template:"modules/settings/modals/financial-report.html",trapFocus:!1,controller:["$scope","API","Session",function(t,e,n){t.params={user:n.get("user").id,from:null,to:null},t.resetParams=function(){t.params.from=null,t.params.to=null},t.generate=function(){e.one("report","export_statement").get(t.params).then(function(e){t.$broadcast("generatedReport",!0),t.generatedReport=!0},function(e){i.error("Error exporting data",e),t.$broadcast("generatedReport",!1)})}}]})};var C=n.User&&n.User.dashboard_preferences&&n.User.dashboard_preferences.pagination;C&&(o.paginationPreferences={perPage:C.per_page,type:C.use_cursor?"continuous":"singlePage"}),o.updatePaginationPreferences=function(){var e=o.paginationPreferences,t=e.type,n={pagination:{per_page:e.perPage,use_cursor:"continuous"===t}},r={singlePage:"Single page",continuous:"Continuous"};l.updatePaginationPreferences(n).then(function(){i.success("Update successful","Your pagination style has been updated successfully."),S("Updated pagination style",{"Pagination style":r[t]}),s.update("user")}).catch(function(e){i.error("Your pagination style could not be updated",e)})},o.timezonePreference=n.User&&n.User.dashboard_preferences&&n.User.dashboard_preferences.timezone,o.updateTimezonePreference=function(e){l.updateTimezonePreference({timezone:e}).then(function(){i.success("Timezone updated successful","Your timezone has been updated successfully."),S("Updated timezone preference",{Timezone:e}),t.location.reload()}).catch(function(e){i.error("Your timezone preference could not be updated",e)})},o.showTaxInvoiceSection="ZA"===o.account.attributes.country_code,o.minimumAllowedDateForTaxInvoice=moment(n.Business.go_live_date).format("DD MMM YYYY"),o.maximumAllowedDateForTaxInvoice=moment().format("DD MMM YYYY"),o.downloadTaxInvoice=function(){f?c.open({scope:o,template:"modules/settings/modals/download-tax-invoice.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:480}):c.open({scope:o,template:"modules/settings/modals/submit-vat-no.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:480})},o.vatRegNoForm={vatRegNo:""},o.updateVatRegNoPayload={vatRegNo:o.southAfricanVATRegNo||""};var O=function(e){return a.all("integration/".concat(o.account.id,"/documents")).post({code:"ZA-VAT-NO",value:e})};o.updateVatRegistrationNumber=function(){O(o.updateVatRegNoPayload.vatRegNo).then(function(){o.$broadcast("updatedVatRegistrationNumber"),i.success("Update successful","Your VAT registration number has been updated successfully"),r.reload()}).catch(function(e){o.$broadcast("updatedVatRegistrationNumber",!1),i.error("Could not update VAT registration number",e)})},o.submitVATRegNo=function(){O(o.vatRegNoForm.vatRegNo).then(function(){c.close(),c.open({scope:o,template:"modules/settings/modals/download-tax-invoice.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:480})}).catch(function(e){o.$broadcast("submittingVatRegNo",!1),i.error("Could not submit VAT registration number",e)})},o.taxInvoiceForm={startDate:null,endDate:null,currency:o.account.default_currency},o.generateTaxInvoice=function(){a.one("integration/".concat(o.account.id,"/vat_report")).get({start_date:moment(new Date(o.taxInvoiceForm.startDate)).format("YYYY-MM-DD"),end_date:moment(new Date(o.taxInvoiceForm.endDate)).format("YYYY-MM-DD"),currency:o.taxInvoiceForm.currency}).then(function(e){var t,n;o.$broadcast("downloadingTaxInvoice",!0),i.success("Receipt generation successful","VAT Receipt generated successfully"),e&&e.data&&e.data.filename&&(t=e.data.filename,(n=document.createElement("a")).setAttribute("href",t),n.setAttribute("download",null),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)),c.close(),r.reload()}).catch(function(e){o.$broadcast("downloadingTaxInvoice",!1),i.error("Could not download Tax Invoice",e)})}}]).controller("ApplePayCtrl",["$scope","API","Notification","ngDialog","domainNames","$state",function(t,n,r,o,e,a){t.domainNames=e,t.validDomainName=function(e){return!!new RegExp("^(?!-)[A-Za-z0-9-]+([\\-\\.]{1}[a-z0-9]+)*\\.[A-Za-z]{2,7}$").test(e)},t.form={domainName:""},t.showAddNewDomainModal=function(){t.form.domainName="",o.close(),o.open({scope:t,template:"modules/settings/modals/verify-apple-pay-domain.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450})},t.addNewDomain=function(){o.close(),o.open({scope:t,template:"modules/settings/modals/verifying-apple-pay-domain.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!1,width:450}),n.all("apple-pay/domain").post({domainName:t.form.domainName}).then(function(){o.close(),o.open({scope:t,template:"modules/settings/modals/verify-apple-pay-domain-successful.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450}),a.reload()}).catch(function(e){o.close(),o.open({scope:t,template:"modules/settings/modals/verify-apple-pay-domain-failed.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450}),r.error("Could not verify domain",e)})},t.removeDomainConfirm=function(e){o.openConfirm({scope:t,template:"modules/settings/modals/remove-apple-pay-domain.html",className:"ngdialog-theme-plain dialog-close-center-icon",showClose:!0,width:450,data:{domainName:e}}).then(function(){a.reload()})},t.removeDomain=function(e){t.removingDomain=!0,n.one("apple-pay/domain").customOperation("remove","",null,{"content-type":"application/json"},{domainName:e}).then(function(){r.success("Remove successful","Domain successfully unregistered on Apple Pay"),a.reload()}).catch(function(e){r.error("Could not remove domain",e)}).finally(function(){t.removingDomain=!1,o.close()})}}]).controller("DeveloperCtrl",["$state","$scope","$rootScope","API","ngDialog","Notification","Auth","keys","AmplitudeService",function(r,n,o,a,e,i,s,t,c){var u=c.logEvent;n.live_public=t.data.find(function(e){return"public"===e.type&&"live"===e.domain}),n.test_secret=t.data.find(function(e){return"secret"===e.type&&"test"===e.domain}),n.test_public=t.data.find(function(e){return"public"===e.type&&"test"===e.domain}),n.showLiveSecretKey=!1;var l="**************************************************";n.live_secret={key:l},n.restoreDefaultLiveSecretKey=function(){n.showLiveSecretKey=!1,n.live_secret={key:l}},n.verifyPassword=function(e){a.all("integration/reveal_secret_key").post({password:e}).then(function(e){n.live_secret=e.data,n.showLiveSecretKey=!0}).catch(function(e){i.error("Could not fetch secret keys",e)})},n.openVerifyPasswordModal=function(){e.open({template:"modules/settings/modals/verify-password.html",showClose:!0,scope:n,width:450})},n.openGenerateNewSecretKeyModal=function(){e.open({template:"modules/settings/modals/generate-new-secret-key.html",showClose:!0,width:500,controller:["$scope","API",function(e,t){var n={immediately:0,"30minutes":1800,"2hours":7200};e.generateNewSecretKey=function(){u("Attempted to generate new secret keys",{expiresIn:n[e.keyExpiryDuration]}),t.all("auth/reset_keys").post({expires_in:n[e.keyExpiryDuration],password:e.password}).then(function(){e.closeThisDialog(),r.reload(),u("Generated new secret keys",{expiresIn:n[e.keyExpiryDuration]}),i.success("Generated Successfully","A new live secret key has been generated")}).catch(function(e){i.error("Could not update secret key",e)})}}]})},n.request=function(){a.all("integration/request_live_keys").post({integration:n.account.id,test_integration_url:n.account.test_integration_url,test_integration_instruction:n.account.test_integration_instruction}).then(function(e){return s.update("account")}).then(function(){i.success("Review Requested","We'll be in touch soon"),r.reload()}).catch(function(e){o.$broadcast("reviewRequested",!1),i.error("Could not request your review",e)})},n.saveWebhooks=function(){var e=n.account,t={test_webhook_endpoint:e.test_webhook_endpoint,test_redirect_url:e.test_redirect_url,live_webhook_endpoint:e.live_webhook_endpoint,live_redirect_url:e.live_redirect_url};t.integration=o.Business.id,a.all("integration/webhooks").customPUT(t).then(function(){n.$broadcast("businessUpdated"),s.update("account"),i.success("Update successful","Your business has been updated successfully")}).catch(function(e){n.$broadcast("businessUpdated",!1),i.error("Could not update your business",e)})}}]).controller("ImageUploadCtrl",["$scope",function(n){n.$on("uploadCompleted",function(e,t){n.save("account",{},{logo_path:t.uploadPath})})}]).controller("PasswordChangeCtrl",["$state","$scope","API","ngDialog","Notification","PasswordValidator","Session",function(e,o,t,n,a,r,i){o.validatePassword=function(e){o.passwordChecker=r.validate(o.new_password),e.$setValidity(e.$name,o.passwordChecker.isValid)},o.change=function(){t.all("user/change_password").post({old_password:o.old_password,password:o.new_password}).then(function(e){var t=e.data,n=t.token,r=t.expiry;i.saveToken(n,r),o.closeThisDialog(),a.success("Password Change Successful","Your password was changed successfully")},function(e){o.$broadcast("changedPassword",!1),a.error("Password could not be changed",e.data?e.data:e)})}}]).controller("ComplianceDocumentsCtrl",["$state","$scope","$rootScope","API","Session","ngDialog","Notification","LocalAPI","ComplianceDocuments","$filter",function(a,i,s,c,e,r,u,t,n,o){var l=n.fetchRequirements(),d=n.fetchDocuments(),p=t.one("countries.json").get();i.documentsPayload={},i.showInputForm={},Promise.all([l,d,p]).then(function(e){var t=_slicedToArray(e,3),n=t[0],r=t[1],o=t[2];i.countries=o;var a=(i.requirements=n).map(function(t){var e=r.find(function(e){return t.id===e.requirement});return e?_objectSpread(_objectSpread({},t),{},{document:e}):t});i.directorRequirement=n.find(function(e){return"director"===e.belongsTo}),i.ownerRequirement=n.find(function(e){return"owner"===e.belongsTo}),i.companyDocuments=a.filter(function(e){return"company"===e.belongsTo}),i.directorsDocuments=r.filter(function(e){return e&&e.requirement===i.directorRequirement.id}),i.ownerDocuments=r.filter(function(e){return e.requirement===i.ownerRequirement.id}),i.companyDocuments.forEach(function(e){i.documentsPayload[e.code]=e.document&&e.document.value}),i.submittedRequirements=a&&a.every(function(e){var t=e.document;return t&&t.value}),i.$broadcast("loadedCompliance")}).catch(function(e){u.error("Could not fetch documents",e.data&&e.data.message)}),i.tooltips={tin:"If you currently use Transfers for your business or want to keep a balance with Paystack, please provide your companyâ€™s Tax Identification Number (TIN).",form7a:"The Form 7a is the CAC document that lists all the directors of your business.",form2a:"The Form 2a is the CAC document that lists all the shareholders of your business."},i.idModalHeaders={directorRequirement:"Director",ownerRequirement:"Owner"},i.documentProperties={bvn:{name:"Bank Verification Number",label:"Bank Verification Number",pattern:"[0-9]{11}"},drivers_licence:{name:"Drivers Licence",label:"Licence Number",pattern:""},passport:{name:"Passport Number",label:"Passport Number",pattern:""},nin:{name:"National ID card/NIN",label:"National Identification Number(NIN)",pattern:""},voters_id:{name:"Voter's ID",label:"Voter's ID Number",pattern:""},default:{name:"ID Number",label:"ID Number",pattern:""}},i.maximumDateLimit=o("date")(new Date,"yyyy MM dd"),i.deleteDocument=function(e){i.documentsPayload[e]=null},i.toggleInput=function(e){i.showInputForm[e]=!i.showInputForm[e]},i.saveTin=function(){var e=i.companyDocuments.find(function(e){return"tin"===e.code});i.uploadDocument(e)},i.isAllowedDocument=function(){return function(e){return!e.country||e.country===i.payload.country}},i.findCountry=function(t){var e=i.countries.find(function(e){return e.countryCode===t.country});return"(".concat(e&&e.name,")")},i.uploadDocument=function(e){var t=e.id,n=e.code,r=e.document,o={requirement:t,value:i.documentsPayload[n]};r&&r.id?c.one("compliancedocument",r.id).customPUT(o).then(function(){s.$broadcast("savedDocument"),a.reload()}).catch(function(e){s.$broadcast("savedDocument",!1),u.error("Could not update document",e.data&&e.data.message)}):c.all("compliancedocument").post(o).then(function(){i.toggleInput(n),s.$broadcast("savedDocument"),a.reload()}).catch(function(e){s.$broadcast("savedDocument",!1),u.error("Could not save document",e.data&&e.data.message)})},i.addId=function(e){i.allowedkycTypes=i[e].options,i.payload={country:i[e].country,type:i[e].options[0].code,value:null,kycType:e},r.open({template:"modules/settings/modals/upload-identification.html",trapFocus:!0,scope:i,width:465,controller:"ComplianceDocumentsCtrl"})},i.saveId=function(e){var t=e.kycType,n=_objectWithoutProperties(e,_excluded2),r=i[t];c.all("compliancedocument").post(_objectSpread(_objectSpread({},n),{},{requirement:r.id})).then(function(){s.$broadcast("savedID"),i.closeThisDialog(),a.reload()}).catch(function(e){s.$broadcast("savedID",!1),u.error("Could not save ID",e.data&&e.data.message)})},i.editId=function(e,t){i.allowedkycTypes=i[e].options;var n=t.dob&&moment(t.dob).format("DD MMMM YYYY");i.payload=_objectSpread(_objectSpread({},t),{},{dob:n}),r.open({template:"modules/settings/modals/edit-identification.html",trapFocus:!0,scope:i,width:465,controller:"ComplianceDocumentsCtrl"})},i.saveEditedId=function(e){var t=e.id,n=_objectWithoutProperties(e,_excluded3);c.one("compliancedocument",t).customPUT(n).then(function(){s.$broadcast("editedID"),i.closeThisDialog(),a.reload()}).catch(function(e){s.$broadcast("editedID",!1),u.error("Could not update ID",e.data&&e.data.message)})},i.completeSubmission=function(){c.all("compliance_documents_complete").post().then(function(){s.$broadcast("completedSubmission"),i.closeThisDialog(),a.reload()}).catch(function(e){s.$broadcast("completedSubmission",!1),u.error("Error",e.data&&e.data.message)})}}]).factory("ComplianceDocuments",["API","$stateParams",function(e,t){var n={data:{},fetchRequirements:function(){return n.data.requirements?Promise.resolve(n.data.requirements):e.one("compliancerequirement").get().then(function(e){return n.data.requirements=e.data,e.data})},fetchDocuments:function(){return e.one("compliancedocument").get().then(function(e){return n.data.documents=e.data,e.data})}};return n}]),angular.module("app.setup",["ui.router"]).config(["$stateProvider",function(e){e.state("setup",{templateUrl:"components/layout/setup.html",url:"",abstract:!0,isSetup:!0,data:{authenticable:!0}}).state("setup.new",{title:"Create New Business",url:"/new-business?pilot",pageTrack:"/new-business",templateUrl:"modules/setup/new.html",controller:"SetupNewBusinessCtrl",isSetup:!0,resolve:{options:["API",function(e){return e.one("create_business/options").get()}],industries:["API",function(e){return e.one("industry").get()}]}})}]).controller("SetupProfileCtrl",["$scope","$state","$rootScope","Auth","PopularDomains","options","API","Notification","AmplitudeService","industries",function(r,t,o,n,a,e,i,s,c,u){r.options=e,r.industries=u.data,r.user={},r.business={};var l=c.setActiveUser,d=c.logEvent;r.save=function(){var e="".concat(r.user.phone.calling_code).concat(r.user.phone.subscriber_number);n.update("account",{primary_contact_email:o.User.email,primary_contact_name:r.user.firstName+" "+r.user.lastName,primary_contact_phone:e,calling_code:r.user.phone.calling_code,industry:r.business.industry,integration_type:r.business.integrationType.code,international_requested:r.business.internationalRequested}).then(function(){return n.update("user",{first_name:r.user.firstName,last_name:r.user.lastName,phone:e,calling_code:r.user.phone.calling_code,job_title:r.user.jobTitle,is_developer:r.user.isDeveloper})}).then(function(){var e=o.User.email.replace(/.*@/,""),t=a.indexOf(e)<=-1,n="large"===r.business.businessSize;return i.all("integration/complete_setup").post({integration:o.Business.id,business_size:r.business.businessSize,integration_type:r.business.integrationType.id,send_slack_notification:n||t})}).then(function(){o.Business.setup_complete=!0,l(o.User,o.Business,"marketingInstance"),d("Onboarding complete",{},"marketingInstance"),l(o.User,o.Business),d("Onboarding complete"),t.go("app.onboarding")}).catch(function(e){o.$broadcast("profileSaved",!1),s.error("Could not save your profile",e)})}}]).controller("SetupNewBusinessCtrl",["$state","$rootScope","$scope","API","Notification","Auth","AmplitudeService","options",function(r,e,i,t,o,a,n,s){var c=e.User,u=e.Business;i.Business=u,i.countries=s.data.countries.filter(function(e){return!settings.pilotCountriesForNewBusinesses.includes(e.value)||e.value===r.params.pilot}),i.businessTypes=s.data.businessTypes;var l=n.logEvent;i.logEvent=l;t.one("session").get().then(function(e){i.existingBusinesses=e.data.user.integrations}).catch(function(){i.existingBusinesses=[]}),i.duplicateExistingBusiness=!1,i.newBusinessFormData={businessName:"",country:u&&u.attributes&&u.attributes.country.iso_code};i.setBusinessTypes=function(){var t,e,n;i.supportedBusinessTypes=(t=i.newBusinessFormData.country,e=i.countries,n=i.businessTypes,((e.find(function(e){return e.value===t})||{}).businessTypes||["starter","registered"]).map(function(e){return _objectSpread(_objectSpread({},n[e]),{},{value:e})})),i.newBusinessFormData.businessType=void 0},i.setBusinessTypes();var d=function(e){var t,n=e.businessName,r=e.businessType,o={business_name:n,country_code:e.country,email:u?u.email:c.email,business_type:r};if(i.duplicateExistingBusiness){o.duplicate_integration_id=i.newBusinessFormData.selectedBusiness;var a=(t=i.newBusinessFormData.selectedBusiness,i.existingBusinesses.find(function(e){return e.id===t})||{});o.country_code=a.country_code,o.business_type=a.business_type}return o};i.createNewBusiness=function(){var e=d(i.newBusinessFormData),n={is_duplicated:i.duplicateExistingBusiness,country_code:e.country_code,business_type:e.business_type};t.all("integration").post(e).then(function(e){var t;l("new-business_created",n),t=e.data,a.switchIntegration(t).then(function(){r.go("app.compliance")}).catch(function(e){i.$broadcast("accountCreated",!1),o.error("Could not create business",e)})}).catch(function(e){l("new-business_create-failed",_objectSpread(_objectSpread({},n),{},{error:e})),o.error("Could not create business",e&&e.data&&e.data.message),i.$broadcast("accountCreated",!1)})}}]);var StorefrontsModule=angular.module("app.storefronts",["ui.router"]);StorefrontsModule.config(["$stateProvider",function(e){e.state("storefronts",{url:"/storefronts",title:"Storefronts",abstract:!0,templateUrl:"components/layout/base.html",redirectTo:"storefronts.list",data:{permission:"product-view",authenticable:!0},onEnter:function(){window.scrollTo(0,0),document.body.style.overflow="hidden"},onExit:function(){document.body.style.overflow=null}}).state("storefronts.list",{url:"?status&revenue&orders_count",pageTrack:"/storefronts",title:"Storefronts",templateUrl:"modules/storefronts/views/one/list.html",controller:"StorefrontsListCtrl",resolve:{storefronts:["API","$stateParams",function(e,t){return e.one("storefront").get(t)}]}}).state("storefronts.one",{url:"/:id",pageTrack:"/storefronts",title:"Storefronts",templateUrl:"modules/storefronts/views/one/one.html",controller:"SingleStorefrontCtrl",redirectTo:"storefronts.one.products",resolve:{storefront:["API","$stateParams",function(e,t){return e.one("storefront",t.id).get()}],contactTypes:["API",function(e){return e.one("storefront/contact/types").get()}],socialMediaTypes:["API",function(e){return e.one("storefront/social-media/types").get()}]}}).state("storefronts.one.products",{url:"/products?search&page",pageTrack:"/storefronts",templateUrl:"modules/storefronts/views/one/products.html",controller:"StorefrontsProductsCtrl",resolve:{products:["API","$stateParams",function(e,t){return e.one("storefront/".concat(t.id,"/product")).get(t)}]}}).state("storefronts.one.shipping",{url:"/delivery",pageTrack:"/storefronts",templateUrl:"modules/storefronts/views/one/shipping.html",controller:"StorefrontsShippingCtrl"}).state("storefronts.one.link",{url:"/link",pageTrack:"/storefronts",templateUrl:"modules/storefronts/views/one/link.html",controller:"StorefrontsLinkCtrl"}).state("storefronts.one.after-purchase",{url:"/after-purchase",pageTrack:"/storefronts",templateUrl:"modules/storefronts/views/one/post-purchase.html",controller:"StorefrontsPostPurchaseCtrl",resolve:{subaccounts:["API","$rootScope",function(e,t){if(t.User.hasPermission("subaccount-view"))return e.one("subaccount").get()}]}}).state("storefronts.one.orders",{url:"/orders",pageTrack:"/storefronts",template:"<div ui-view />",redirectTo:"storefronts.one.orders.list"}).state("storefronts.one.orders.list",{url:"?email&region&from&to&status&delivered&refunded&delivered_at&current&page&index&products&search&is_viewed",pageTrack:"/storefronts",templateUrl:"modules/storefronts/views/one/orders/list.html",controller:"StorefrontsOrdersCtrl",resolve:{ordersList:["API","$stateParams",function(e,t){var n=t.id;return e.one("storefront/".concat(n,"/order")).get(t)}]}}).state("storefronts.one.orders.list.one",{url:"/:orderId",pageTrack:"/storefronts",templateUrl:"modules/storefronts/views/one/orders/one/one.html",redirectTo:"storefronts.one.orders.list.one.overview",controller:"StorefrontsOrdersCtrl",resolve:{activeOrder:["API","$stateParams",function(e,t){return e.one("order",t.orderId).get()}]}}).state("storefronts.one.orders.list.one.overview",{url:"/overview",pageTrack:"/storefronts",controller:"StorefrontsOrdersOverviewCtrl",templateUrl:"modules/storefronts/views/one/orders/one/overview.html"}).state("storefronts.one.orders.list.one.shipping",{url:"/shipping",pageTrack:"/storefronts",controller:"StorefrontsOrdersShippingCtrl",templateUrl:"modules/storefronts/views/one/orders/one/shipping.html"})}]);_excluded=["currency"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}angular.module("app.subaccounts",[]).config(["$stateProvider",function(e){e.state("subaccounts",{abstract:!0,url:"/subaccounts",templateUrl:"components/layout/base.html",redirectTo:"subaccounts.list",data:{permission:"subaccount-view",authenticable:!0}}).state("subaccounts.list",{url:"?page&search&sort_by",pageTrack:"/settings/subaccounts",templateUrl:"/modules/subaccounts/list.html",controller:"SubaccountsCtrl",title:"Subaccounts",resolve:{banks:["BankService",function(e){return e.init({})}],subaccounts:["API","$stateParams",function(e,t){return e.one("subaccount").get(t)}]}})}]).controller("SubaccountsCtrl",["$state","$scope","$stateParams","LocaleService","$rootScope","ngDialog","subaccounts","banks",function(r,t,e,n,o,a,i,s){var c,u=o.Business.allow_international_cards;t.query=angular.copy(e),t.subaccounts=i.data,t.meta=i.meta,n.fetch().then(function(e){c=e.allowed_currencies,u||(c=c.filter(function(e){return"USD"!==e})),t.$broadcast("fetchedLocales")}).catch(function(e){t.$broadcast("fetchedLocales",!1)}),t.openSubaccountModal=function(e,t){var n=_.clone(t);a.openConfirm({template:e,controller:"SubaccountCtrl",data:{banks:s,account:n,subaccountCurrencies:c}}).then(function(){r.reload()})},t.reload=function(e){e&&(t.query=angular.extend({},t.query,e)),r.go(r.current,t.query,{reload:!0,inherit:!0,notify:!0})}}]).controller("SubaccountCtrl",["$state","$scope","$rootScope","ngDialog","API","Notification","BankService",function(n,r,e,t,o,a,i){var s=e.Business;r.banks=r.ngDialogData.banks,r.subaccountCurrencies=r.ngDialogData.subaccountCurrencies,r.subaccount=r.ngDialogData.account||{currency:s.default_currency,percentage_charge:0},r.getBanksByCurrency=function(e){r.fetchingBanks=!0,i.init({currency:e}).then(function(e){r.banks=e,r.fetchingBanks=!1}).catch(function(){r.fetchingBanks=!1})};r.resetAccountName=function(){r.subaccount.business_name=null,r.subaccount.account_number&&10<=r.subaccount.account_number.length&&r.subaccount.settlement_bank&&(r.account_name_placeholder="Trying to get account name",i.resolve(r.subaccount.account_number,r.subaccount.settlement_bank).then(function(e){r.subaccount.business_name=e&&e.account_name,r.account_name_placeholder=r.subaccount.business_name||"Unable to resolve"}))},r.createSubaccount=function(){var e=r.subaccount,t=(e.currency,_objectWithoutProperties(e,_excluded));o.all("subaccount").post(t).then(function(e){a.success("Created successfully","Sub Account has been created successfully"),n.reload().then(function(){r.closeThisDialog()})},function(e){r.$broadcast("subaccountCreated",!1),a.error("Could not create this sub account",e)})},r.updateSubaccount=function(){var e=_.pick(r.subaccount,"business_name","settlement_bank","account_number","percentage_charge","description","migrate");o.one("subaccount",r.subaccount.id).customPUT(e).then(function(){a.success("Updated successfully","Sub account has been updated"),r.confirm()},function(e){r.$broadcast("updateSuccessful",!1),a.error("Could not update this sub account",e)})},r.deleteSubaccount=function(){o.one("subaccount",r.subaccount.id).customPUT({active:!1}).then(function(){a.success("Deleted successfully","Sub Account will no longer be used"),r.confirm()},function(e){r.$broadcast("deleteSuccessful",!1),a.error("Could not delete this sub account",e)})}}]);var SubscribersModule=angular.module("app.subscribers",["ui.router"]);SubscribersModule.config(["$stateProvider",function(e){e.state("subscribers",{abstract:!0,url:"/subscribers",templateUrl:"components/layout/base.html",redirectTo:"subscribers.list",data:{permission:"plan-view",authenticable:!0}}).state("subscribers.list",{url:"?search&status&plan&subscriptions_count&lifetime_value&amount&page&index",pageTrack:"/subscribers",templateUrl:"modules/subscribers/views/list.html",controller:"SubscriberListCtrl",resolve:{subscribers:["API","$stateParams",function(e,t){return e.one("subscriber").get(t)}]}}).state("subscribers.list.one",{url:"/:id",pageTrack:"/subscribers",templateUrl:"modules/subscribers/views/one.html",controller:"SubscriberCtrl",resolve:{subscriber:["API","$stateParams",function(e,t){return e.one("subscriber",t.id).get()}]}})}]);var SubscriptionsModule=angular.module("app.subscriptions",["ui.router"]);SubscriptionsModule.config(["$stateProvider",function(e){e.state("subscriptions",{abstract:!0,url:"/subscriptions",templateUrl:"components/layout/base.html",redirectTo:"subscriptions.list",data:{permission:"plan-view",authenticable:!0}}).state("subscriptions.list",{url:"?search&status&plan&amount&from&to&current&cards_expiry_date&customer&page&index",pageTrack:"/subscriptions",templateUrl:"modules/subscriptions/views/list.html",controller:"SubscriptionListCtrl",resolve:{subscriptions:["API","$stateParams",function(e,t){return e.one("subscription").get(t)}]}}).state("subscriptions.list.one",{url:"/:id",pageTrack:"/subscriptions",templateUrl:"modules/subscriptions/views/one/one.html",controller:"SubscriptionCtrl",resolve:{subscription:["API","$stateParams",function(e,t){return e.one("subscription",t.id).get()}]}})}]);_excluded=["defaultState"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}angular.module("app.support",["ui.router","app.introService"]).config(["$stateProvider",function(e){e.state("support",{templateUrl:"components/layout/base.html",redirectTo:"support.home",pageTrack:"/support",url:"/support",data:{authenticable:!0}}).state("support.home",{title:"Support",templateUrl:"modules/support/index.html",controller:"SupportCtrl"})}]).controller("SupportCtrl",["AmplitudeService","$scope",function(e,t){var n=e.logEvent;t.onClick=function(e){return n("Used support page",{Clicked:e})}}]).controller("FeatureRequestCtrl",["$state","$scope","Session","FeedbackAPI","Notification",function(n,o,a,i,s){o.categories=[{name:"API/Webhooks",team_id:64826},{name:"Audit Logs",defaultState:"audit-logs",team_id:64644},{name:"BVN & other Identity Verification Services",team_id:69602},{name:"Checkout form",team_id:68353},{name:"Compliance & KYC",team_id:69604},{name:"Customers Page",defaultState:"customers",team_id:64827},{name:"Dedicated NUBAN",team_id:68347},{name:"Disputes",defaultState:"disputes",team_id:64644},{name:"Invoices",defaultState:"invoices",team_id:64640},{name:"New countries",team_id:64248},{name:"New Payment methods",team_id:64248},{name:"Pay with Transfer",team_id:68348},{name:"Payment Pages",defaultState:"pages",team_id:64641},{name:"Paystack Mobile App",team_id:53111},{name:"Plans & Subscriptions",defaultState:"subscriptions",team_id:64642},{name:"Plugins and Integrations",team_id:69851},{name:"Product Links",team_id:64643},{name:"Products",defaultState:"products",team_id:68346},{name:"Refunds",team_id:68354},{name:"Reports & Exports",team_id:69603},{name:"Settlement",defaultState:"payouts",team_id:68353},{name:"Storefront",team_id:68345},{name:"Subaccounts & Split Payments",defaultState:"subaccounts",team_id:64828},{name:"Terminal",team_id:64645},{name:"Transfers",defaultState:"transfers",team_id:68352},{name:"USSD",team_id:68350},{name:"Other",team_id:64248}],o.importanceOptions=["Nice-to-have","Important","Critical"];var e=o.categories.find(function(e){var t=e.defaultState;return t&&n.includes(t)});o.payload={category:e||"",details:"",importance:""},o.submit=function(){var e=a.get("user"),t=a.get("account"),n=o.payload.category,r=(n.defaultState,_objectWithoutProperties(n,_excluded));return i.all("send_to_zendesk").post({email:e.email,integration:t.id,body:o.payload.details,subject:o.payload.title,category:r,urgency:o.payload.importance,role:e.role.name.toLowerCase(),business_name:t.business_name,name:"".concat(e.first_name||""," ").concat(e.last_name||"").trim()}).then(function(){o.closeThisDialog(),s.success("Thank you!","We have received your feedback"),o.$broadcast("featureRequested")}).catch(function(){s.error("Error Occured","We could not record your feedback"),o.$broadcast("featureRequested",!1)})}}]),angular.module("app.terminals",[]).config(["$stateProvider",function(e){e.state("terminals",{abstract:!0,templateUrl:"components/layout/base.html",redirectTo:"terminals.list",url:"/terminals",data:{authenticable:!0},onExit:function(){window.cleanupMicroFrontend&&window.cleanupMicroFrontend("terminals-root")}}).state("terminals.list",{title:"Terminals",url:"?search&status",pageTrack:"/terminals",templateUrl:"modules/terminals/list.html",controller:"TerminalsCtrl"}).state("terminals.list.one",{url:"/:id",pageTrack:"/terminals",templateUrl:"modules/terminals/list.html"}).state("terminals.shop",{pageTrack:"/terminals/shop",templateUrl:"modules/terminals/list.html"})}]).controller("TerminalsCtrl",["$rootScope","$scope","API","$stateParams",function(e,t,n,r){t.$watch("mfeServiceReady",function(e){e&&window.postMessage({message:"RENDER_TERMINALS_MICROFRONTEND"})}),n.one("terminal/count").get({search:r.search,status:r.status}).then(function(e){t.terminalsCount=e.data.count})}]);_excluded=["id"];function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var TransactionSplitsModule=angular.module("app.transaction-splits",["ui.router"]);TransactionSplitsModule.config(["$stateProvider",function(e){e.state("transaction-splits",{abstract:!0,url:"/transaction-splits",templateUrl:"components/layout/base.html",redirectTo:"transaction-splits.list",data:{permission:"subaccount-view",authenticable:!0}}).state("transaction-splits.list",{url:"?type&name&active&subaccount&page&is_dynamic",title:"Transaction Splits",pageTrack:"/transaction-splits",templateUrl:"modules/transaction-splits/list.html",controller:"TransactionSplitsListCtrl"}).state("transaction-splits.list.one",{url:"/:id",pageTrack:"/transaction-splits",templateUrl:"modules/transaction-splits/one.html",redirectTo:"transaction-splits.list.one.accounts"}).state("transaction-splits.list.one.accounts",{url:"/accounts",pageTrack:"/transaction-splits",templateUrl:"modules/transaction-splits/one/accounts.html"}).state("transaction-splits.list.one.transactions",{url:"/transactions",pageTrack:"/transaction-splits",templateUrl:"modules/transaction-splits/one/transactions.html"})}]),TransactionSplitsModule.controller("TransactionSplitsListCtrl",["$scope","$rootScope","$state","Notification","ngDialog","TransactionSplitsData","TransactionSplitsService","AmplitudeService","LocaleService","$i18next",function(r,e,o,t,n,a,i,s,c,u){var l=s.logEvent;r.transactionSplits=[],r.filteredSubaccount=null,r.filters=o.params,r.filterSplitTypes=i.filterSplitTypes,r.filterStatuses=i.filterStatuses,r.filterCategories=i.filterCategories;var d=e.Business;r.appendSplitIdToStateParams=function(e){return i.appendSplitIdToStateParams(e)},r.transactionSplitTypeMapping={percentage:u.t("transactionSplits.list.splitTypeMapping.percentage"),flat:u.t("transactionSplits.list.splitTypeMapping.flat")},r.updateTransactionSplits=function(e){r.transactionSplits=e},r.clearFilters=function(){r.filters=_objectSpread({},i.defaultFilters)},r.filterTransactionSplits=function(e){var t=_objectSpread(_objectSpread({},e),{},{subaccount:r.filteredSubaccount&&r.filteredSubaccount.subaccount_code});l("Clicked to filter transaction splits",t),o.go("transaction-splits.list",t,{reload:!0})},r.isStateParamsEmpty=i.isStateParamsEmpty(),r.searchTransactionSplits=function(){o.go("transaction-splits.list",{name:r.transactionSplits.searchTerm},{reload:!0}),l("Searched for a split group")},r.filters.subaccount?a.fetchSubaccount(r.filters.subaccount).then(function(e){r.filteredSubaccount=e.data,r.formattedPillFilters=i.formatPillFilters({subaccount:r.filteredSubaccount})}).catch(function(e){t.error("Could not fetch subaccount",e),r.formattedPillFilters=i.formatPillFilters()}):r.formattedPillFilters=i.formatPillFilters(),r.removeFilter=function(n){var e=Object.keys(r.filters).reduce(function(e,t){return t!==n.key&&(e=_objectSpread(_objectSpread({},e),{},_defineProperty({},t,r.filters[t]))),e},{});o.go("transaction-splits.list",e,{inherit:!1})},r.computeTransactionSplitTableHeight=function(){return i.computeTransactionSplitTableHeight()};var p=o.params,f=(p.id,_objectWithoutProperties(p,_excluded));a.fetch(f).then(function(e){r.transactionSplits=e.data,r.meta=e.meta,r.$broadcast("fetchedTransactionSplits")}).catch(function(e){t.error("Could not fetch transaction splits",e),r.$broadcast("fetchedTransactionSplits",!1)}),r.subaccountSearchResults=[],r.subaccountSearchStatus="idle",r.resetSubAccountSearchForm=function(){r.filters.subaccount="",r.subaccountSearchStatus="idle"},r.setFilteredSubaccount=function(e){r.filteredSubaccount=e},r.unsetFilteredSubaccount=function(){r.filteredSubaccount=null},r.searchSubaccounts=function(e){r.subaccountSearchStatus="searching",a.searchSubaccounts(e).then(function(e){l("Searched for an existing subaccount",{context:"filter"}),r.subaccountSearchStatus="searched",r.subaccountSearchResults=e.data}).catch(function(e){t.error("Could not search subaccounts",e)})},r.openNewTransactionSplitModal=function(){l("Create new split group started"),n.open({width:450,scope:r,showClose:!0,controller:"NewTransactionSplitCtrl",className:"ngdialog-theme-plain dialog-close-center-icon",template:"/modules/transaction-splits/modals/new-transaction-split.html"})},c.fetch().then(function(e){var t=d.allow_international_cards;r.transactionSplitCurrencies=e.allowed_currencies,t||(r.transactionSplitCurrencies=r.transactionSplitCurrencies.filter(function(e){return"USD"!==e})),r.$broadcast("fetchedLocales")}).catch(function(e){t.error("Could not fetch data",e),r.$broadcast("fetchedLocales",!1)})}]),TransactionSplitsModule.controller("NewTransactionSplitCtrl",["$scope","$rootScope","$state","LocalService","TransactionSplitsService",function(t,e,n,r,o){t.newTransactionSplit={path:"create"},t.$on("fetchedLocales",function(){t.newTransactionSplit.currency=e.Business.default_currency}),t.saveNewTransactionSplit=function(){t.closeThisDialog();var e="create"===n.params.id;n.go("transaction-splits.list.one.accounts",{id:t.newTransactionSplit.path},{reload:e}),0===t.transactionSplits.length&&o.showIntroJS(),r.set("newTransactionSplit",t.newTransactionSplit)}}]),TransactionSplitsModule.controller("SingleTransactionSplitCtrl",["$scope","$rootScope","$state","CountryService","LocaleService","BankService","TransactionSplitsData","TransactionSplitsService","AmplitudeService","LocalService","Notification","ngDialog","$i18next","utils",function(s,e,c,t,n,a,u,l,r,d,p,i,o,f){var m=r.logEvent,g=e.Business,h=g.attributes&&g.attributes.country&&g.attributes.country.iso_code;s.countryData=t.getCountryData(h),s.transactionSplitStatus="idle",s.subaccountActions={},s.currentTransactionSplit={subaccounts:[]},s.transactionSplitTypeMapping={percentage:o.t("transactionSplits.one.accounts.percentage"),flat:o.t("transactionSplits.one.accounts.flat")};var y=function(){return l.focusOnElementBySelector("[data-selected-subaccount-input]")};s.setSubaccountAction=function(e){var t=e.id,n=e.type;"edit"===(s.subaccountActions[t]=n)&&y()},s.updateBearerType=function(e,t){var n=_objectSpread({bearer_type:e},t&&{bearer_subaccount:t.subaccount_code});u.updateSplit(s.currentTransactionSplit.id,n).then(function(){p.success("Split configuration updated")}).catch(function(e){p.error("Could not update split",e)})},u.fetchSettlementAccount().then(function(e){s.settlementAccount=e.data.find(function(e){return e.currency===s.currentTransactionSplit.currency})}).catch(function(e){p.error("Could not fetch settlement account",e)}),s.activateSplit=function(){m("Clicked to activate split group"),u.activateSplit(s.currentTransactionSplit.id).then(function(){c.go(c.current,c.params,{reload:!0}),p.success("Split activated successfully")}).catch(function(e){p.error("Could not activate split",e)})},s.openDisableSplitModal=function(){i.open({width:450,scope:s,showClose:!0,className:"ngdialog-theme-plain dialog-close-center-icon",template:"/modules/transaction-splits/modals/disable-split.html"})},s.deactivateSplit=function(){m("Clicked to deactivate split group"),u.deactivateSplit(s.currentTransactionSplit.id).then(function(){c.go(c.current,c.params,{reload:!0}),p.success("Split deactivated successfully")}).catch(function(e){p.error("Could not deactivate split",e)})},s.subaccountPayload={},s.openCreateOrUpdateSubaccountModal=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.intent,n=void 0===t?"create":t,r=e.subaccount;if("update"===(s.intent=n)){m("Update subaccount in split started");var o=s.subaccountPayload.currency||s.currentTransactionSplit.currency;s.subaccountPayload=_objectSpread(_objectSpread({},r),{},{currency:o})}else"create"===n&&m("Add new subaccount to split group started");s.getBanksByCurrency=function(e){s.fetchingBanks=!0,a.init({currency:e}).then(function(e){s.settlementBanks=e,s.fetchingBanks=!1}).catch(function(){s.fetchingBanks=!1})},s.getBanksByCurrency(s.currentTransactionSplit.currency),i.open({width:450,scope:s,showClose:!0,className:"ngdialog-theme-plain dialog-close-center-icon",template:"/modules/transaction-splits/modals/create-update-subaccount.html"}),s.verifyAccountNumber=function(){s.accountVerification=null;var e=s.subaccountPayload.account_number,t=s.subaccountPayload.settlement_bank;e&&a.validate(e,t).then(function(){return s.accountVerification="pending",a.resolve(e,t,s.subaccountPayload.currency)}).then(function(e){!s.subaccountPayload.business_name&&e.account_name&&(s.subaccountPayload.business_name=f.toTitleCase(f.firstNthWords(e.account_name,2)).trim()),s.accountVerification=e})},s.saveSubaccountAndAddToGroup=function(e){var t=e.intent;if("create"===t)u.createSubaccount(_objectSpread(_objectSpread({},s.subaccountPayload),{},{percentage_charge:50})).then(function(e){var t=e.data;s.addSubaccountToList(t),m("Add new subaccount to split group complete")}).catch(function(e){p.error("Could not create subaccount",e)});else if("update"===t){var n=s.subaccountPayload,r=n.id,o=n.account_number,a=n.settlement_bank,i=n.business_name;u.updateSubaccount(r,{account_number:o,settlement_bank:a,business_name:i}).then(function(e){var t=e.data;s.addSubaccountToList(t),s.unsetSubaccountWithoutCurrency(),m("Update subaccount in split complete")}).catch(function(e){p.error("Could not update subaccount",e)})}}};"create"===c.params.id?function(){var e=d.get("newTransactionSplit");if(e){var t=_objectSpread(_objectSpread({},e),{},{id:e.path,subaccounts:[]});s.transactionSplitStatus="fetched",s.currentTransactionSplit=t;var n=!1;s.$on("fetchedTransactionSplits",function(){n=!0,s.updateTransactionSplits([t].concat(_toConsumableArray(s.transactionSplits)))}),n||s.updateTransactionSplits([t].concat(_toConsumableArray(s.transactionSplits)))}else c.go("transaction-splits.list",{},{reload:!0})}():(s.transactionSplitStatus="fetching",u.fetchSingleSplit(c.params.id).then(function(e){s.currentTransactionSplit=l.formatTransactionSplitResponse(e),s.transactionSplitStatus="fetched",s.fetchingSplitTransactions=!0,u.fetchTransactionsBySplitCode(s.currentTransactionSplit.split_code).then(function(e){s.transactions=e.data,s.fetchingSplitTransactions=!1}).catch(function(e){p.error("Could not fetch transactions",e),s.fetchingSplitTransactions=!1})}).catch(function(e){p.error("Could not fetch transaction split",e),c.go("transaction-splits.list",{},{reload:!0})})),s.subaccountSearchStatus="idle",s.setSubaccountSearchStatus=function(e){s.subaccountSearchStatus=e},s.subaccountSearchResults=[],s.searchSubaccounts=function(){var e=s.currentTransactionSplit.searchSubaccountInput;s.setSubaccountSearchStatus("searching"),u.searchSubaccounts(e).then(function(e){m("Searched for an existing subaccount"),s.setSubaccountSearchStatus("searched"),s.subaccountSearchResults=e.data}).catch(function(e){p.error("Could not fetch subaccounts",e)})},s.resetSubAccountSearchForm=function(){s.currentTransactionSplit.searchSubaccountInput="",s.setSubaccountSearchStatus("idle")},s.unsetSubaccountWithoutCurrency=function(){s.subaccountWithoutCurrency=null};s.addSubaccountToList=function(e){if(!e.currency)return s.subaccountWithoutCurrency=e,void s.resetSubAccountSearchForm();var t;t=e.subaccount_code,s.currentTransactionSplit.subaccounts.find(function(e){return e.subaccount_code===t})?p.error(null,"Subaccount already exist on this transaction split"):(s.currentTransactionSplit.subaccounts=[e].concat(_toConsumableArray(s.currentTransactionSplit.subaccounts)),s.setSubaccountAction({id:e.id,type:"edit"}),y(),s.resetSubAccountSearchForm())},s.removeSubaccountFromList=function(t){s.currentTransactionSplit.subaccounts=s.currentTransactionSplit.subaccounts.filter(function(e){return e!==t})},s.computeMainAccountPercentageShare=function(){var e=s.currentTransactionSplit.subaccounts.reduce(function(e,t){var n=t.share;return e-=parseFloat(n||0)},100);return 0<=e?e:0},s.computedMinimumTransactionAmount=function(){return s.currentTransactionSplit.subaccounts.reduce(function(e,t){var n=t.share;return e+=parseFloat(n||0)},0)};var b=function(){return s.transactionSplits.filter(function(e){return"create"!==e.path})};s.addSubaccount=function(e){var t,n,r,o,a,i;"create"===c.params.id?(a=s.currentTransactionSplit.subaccounts[0],i={subaccounts:[{share:l.formatAccountShareBySplitType({share:a.share,splitType:s.currentTransactionSplit.type,formatTo:"kobo"}),subaccount:a.subaccount_code}],name:s.currentTransactionSplit.name,type:s.currentTransactionSplit.type,currency:s.currentTransactionSplit.currency},u.createSplit(i).then(function(e){m("Create new split group complete"),d.unset("newTransactionSplit"),s.subaccountActions={},s.currentTransactionSplit=l.formatTransactionSplitResponse(e);var t=b();s.updateTransactionSplits([s.currentTransactionSplit].concat(_toConsumableArray(t))),c.go("transaction-splits.list.one.accounts",{id:e.data.id})}).catch(function(e){p.error("Could not create split",e)})):(n=(t=e).subaccount_code,r=t.share,o={subaccount:n,share:l.formatAccountShareBySplitType({share:r,splitType:s.currentTransactionSplit.type,formatTo:"kobo"})},u.addSubaccountToSplit({splitId:s.currentTransactionSplit.id,payload:o}).then(function(e){s.currentTransactionSplit=l.formatTransactionSplitResponse(e),s.subaccountActions={}}).catch(function(e){p.error("Could not update split",e)}))},s.deleteSubaccount=function(e){var t={subaccount:e.subaccount_code};u.removeSubaccountFromSplit({splitId:s.currentTransactionSplit.id,payload:t}).then(function(){s.removeSubaccountFromList(e),p.success("Subaccount removed from transaction split"),c.go("transaction-splits.list.one.accounts",{id:s.currentTransactionSplit.id},{notify:!1})}).catch(function(e){p.error("Could not remove subaccount from transaction split",e)})},s.$on("$stateChangeStart",function(e,n,r){s.restoredCachedTransactionSplit=function(){d.set("newTransactionSplit",s.currentTransactionSplit)},s.leaveTransactionSplitPage=function(){var e=b();if(i.close(),n.name===c.current.name&&"create"===r.id){var t=d.get("newTransactionSplit");s.currentTransactionSplit=_objectSpread(_objectSpread({},t),{},{subaccounts:[]}),s.updateTransactionSplits([t].concat(_toConsumableArray(e)))}else s.currentTransactionSplit={},s.updateTransactionSplits(e),d.unset("newTransactionSplit");c.go(n.name,r)},"create"===s.currentTransactionSplit.path&&c.current.name!==n.redirectTo&&(e.preventDefault(),i.open({width:450,scope:s,showClose:!0,className:"ngdialog-theme-plain dialog-close-center-icon",template:"/modules/transaction-splits/modals/exit-page-warning.html"}))})}]);_excluded=["error"],_excluded2=["page"],_excluded3=["disputeId"];function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("app.transactions",["ui.router","chart.js"]).config(["$stateProvider",function(e){e.state("transactions",{abstract:!0,url:"/transactions",title:"Transactions",templateUrl:"components/layout/base.html",redirectTo:"transactions.list",data:{permission:"transaction-view",authenticable:!0}}).state("transactions.list",{title:"Transactions",url:"?amount&status&from&to&graph&page&subaccount&currency&error&period&for&channel&customer&payment_page&terminal_id&settlement&subaccount_settlement&authorization_code&split_code&use_cursor&next&previous&per_page",pageTrack:"/transactions",templateUrl:"modules/transactions/list.html",controller:"TransactionListCtrl"}).state("transactions.disputes",{title:"Disputes",url:"/disputes",pageTrack:"/disputes",templateUrl:"modules/transactions/disputes.html",controller:"TransactionDisputesCtrl",permission:"transaction-dispute",resolve:{disputes:["PendingDisputes",function(e){return e.fetch()}],dispute_statuses:["LocalAPI",function(e){return e.all("dispute_statuses").getList()}]}}).state("transactions.one",{title:"Transactions",url:"/:id?disputeId&collect_recipient_details&refund_id",pageTrack:"/transactions",templateUrl:"modules/transactions/one.html",showBackButton:!0,controller:"SingleTransactionCtrl",redirectTo:"transactions.one.analytics",resolve:{transaction:["API","$stateParams",function(e,t){return e.one("transaction",t.id).get()}],order:["API","transaction",function(e,t){return t.data.order_id?e.one("order",t.data.order_id).get():[]}],disputes:["$stateParams","API","Session",function(e,t,n){return n.hasPermission("transaction-dispute")?t.one("dispute").get({transaction:e.id}).catch(function(){return{data:[]}}):Promise.resolve({data:[]})}],dispute_statuses:["LocalAPI",function(e){return e.all("dispute_statuses").getList()}],dispute_resolutions:["LocalAPI",function(e){return e.all("dispute_resolutions").getList()}],refunds:["$stateParams","API","Session",function(e,t,n){return n.hasPermission("transaction-dispute")?t.one("refund").get({transaction:e.id}).catch(function(){return{data:[]}}):Promise.resolve({data:[]})}]}}).state("transactions.one.analytics",{url:"/analytics",pageTrack:"/transactions",templateUrl:"modules/transactions/one/analytics.html",showBackButton:!0}).state("transactions.one.refunds",{url:"/refunds",pageTrack:"/transactions",templateUrl:"modules/transactions/one/refunds.html",showBackButton:!0}).state("transactions.one.disputes",{url:"/disputes",pageTrack:"/transactions",templateUrl:"modules/transactions/one/disputes.html",showBackButton:!0})}]).factory("TransactionData",["API","TransactionParams","Session","URLService",function(t,n,e,r){var o={data:[],meta:{},params:{},setParams:function(e){return o.params=n.format(e),o.params},fetch:function(e){return o.params=n.format(e),t.one("transaction").withHttpConfig({ignoreLoadingBar:!0}).get(_objectSpread({},o.params)).then(function(e){return o.data=e.data,o.meta=e.meta,e})},getCustomerId:function(n){return t.one("integration/search").get({model:"customers",search:n,domain:e.get("account").display_state}).then(function(e){if(e.data){var t=(e.data||[]).find(function(e){return e.email===n});return t?t.id:n}return n})},getTotalTransactionsCount:function(){var e=r.getQuery();return t.one("transaction").get(_objectSpread(_objectSpread({},e),{},{perPage:1,next:null,previous:null,use_cursor:!1,reduced_fields:!0})).then(function(e){return e&&e.meta&&e.meta.total})}};return o}]).service("TransactionParams",["LocalService",function(e){return{isEmpty:function(e){return!Object.values(e).some(function(e){return void 0!==e})},withoutErrorData:function(e){e.error;return _objectWithoutProperties(e,_excluded)},format:function(e){var t=angular.copy(e);if("today"===t.period&&(t.from=moment().startOf("day").format(),t.to=null),"day"===t.period){var n=new Date(t.for);t.from=moment(n).startOf("day").format(),t.to=moment(n).endOf("day").format()}if("range"===t.period){if(t.from){var r=new Date(t.from);t.from=moment(r).startOf("day").format()}if(t.to){var o=new Date(t.to);t.to=moment(o).endOf("day").format()}}return t.error&&(t.errorcategory="processing"===t.error?"paystack":t.error,delete t.error),t}}}]).controller("TransactionListCtrl",["$state","$scope","$rootScope","$stateParams","Session","$filter","TransactionData","TransactionParams","ngDialog","LocalService","API","utils","Notification","AmplitudeService",function(n,r,e,o,t,a,i,s,c,u,l,d,p,f){r.transactions=[],r.transactionPages=[],r.meta={},r.subaccounts=[];var m=f.logEvent,g=!(r.getFormattedTransactionChannel=function(e){return"bank_transfer_ussd"===e?"ussd":e.replace("_"," ")}),h=function(e,t){var n=o.use_cursor?"cursor":"paging";g||m(e,_objectSpread({"Pagination type":n},t))},y=function(e){var t=_objectSpread(_objectSpread({},e),{},{reduced_fields:!0});return h("Transaction List endpoint request started"),i.fetch(t).then(function(e){return h("Transaction List endpoint request complete"),g=!0,e}).catch(function(e){h("Transaction List endpoint request complete",{"Error code":e.status}),g=!0,p.error("Could not fetch transactions",e),r.$broadcast("fetchedTransactions",!1)})},b=null,v=function(e){var t=e.data,n=e.meta;r.transactionPages=[].concat(_toConsumableArray(r.transactionPages),[t]),r.transactions=t,r.meta=n,b=n.next,o.use_cursor&&(t.length>=n.perPage?i.getTotalTransactionsCount().then(function(e){r.meta.total=e}):r.meta.total=t.length),r.$broadcast("fetchedTransactions")};r.fetchingMoreTransactions=!1;var S=!(r.fetchMoreTransactions=function(e){var t=e.next;return r.fetchingMoreTransactions=!0,y(_objectSpread(_objectSpread({},o),{},{next:t})).then(function(e){var t=e.data,n=e.meta;r.meta.next=n.next,r.transactionPages=[].concat(_toConsumableArray(r.transactionPages),[t]),r.fetchingMoreTransactions=!1})});r.checkForNewTransactions=function(){S||(S=!0,y(_objectSpread(_objectSpread({},o),{},{prev:b})).then(function(){S=!1}))},"failed"!==o.status&&o.error&&(o=s.withoutErrorData(o)),o.customer&&d.isEmail(o.customer)?i.getCustomerId(o.customer).then(function(e){var t=angular.copy(o);t.customer=e,y(t).then(v)}):y(o).then(v),t.hasPermission("subaccount-view")?l.one("subaccount").get().then(function(e){r.subaccounts=e.data}).catch(function(){r.subaccounts=[]}):r.subaccounts=[],r.$watch("$state.activeFilters",function(e,t){r.filteredBySuccessful=t.includes("status")&&o&&"success"===o.status,r.formattedActiveFilters=t.map(function(e){return"terminal_id"===e?"terminal":e}).join(", ").replace("_"," ")}),r.query=angular.copy(o),r.queryParams=i.params,r.onPeriodChanged=function(e){switch(e){case"day":r.query.from=null,r.query.to=null;break;case"range":r.query.for=null;default:r.query.from=null,r.query.to=null,r.query.for=null}},r.query.amount=o.amount&&d.currencySubUnitToBaseUnit(o.amount),r.filterTransactions=function(){r.reloadWithParams(_objectSpread(_objectSpread({},r.query),r.query.amount&&{amount:d.currencyBaseUnitToSubUnit(r.query.amount)}))},r.labels=["11/9","11/10","11/11","11/12","11/13","11/14","Today"],r.graphData=[[0,0,0,0,0,0,0]],r.series=["Transaction Amount"],r.resetSubaccountSearch=function(e){r.subaccountsFilter="",e||(r.focusSearch=!1)},r.reload=function(e){var t=_.extend(n.params,e);n.go(n.current,t,{reload:!0,inherit:!0,notify:!0})},r.getSubaccount=function(){var e=r.subaccounts.find(function(e){return e.subaccount_code===n.params.subaccount});return e?e.business_name:"All Accounts"},r.showExport=function(){c.open({template:"/modules/transactions/modals/export.html",controller:"TransactionExportCtrl",width:700,showClose:!0,trapFocus:!1,resolve:{DefaultKeys:["LocalAPI",function(e){return e.all("transaction_export_keys").getList()}]}})},r.showQuickExportSuccess=function(){c.open({template:"/modules/transactions/modals/quick-export-success.html",scope:r,showClose:!0,width:516})},r.saveFilters=function(e){if(e){var t=r.query,n=(t.page,_objectWithoutProperties(t,_excluded2));u.set("default_transaction_filters",n)}}}]).controller("TransactionExportCtrl",["$scope","$stateParams","TransactionData","LocalService","DefaultKeys","API","Notification","Session","ngDialog",function(n,t,s,e,c,r,o,a,i){var u=function(){var e=c.plain(),t=_.filter(s.data,function(e){return e.metadata&&angular.isDefined(e.metadata.custom_fields)}),n=_.flatten(_.pluck(t,"metadata")).map(function(e){return e.custom_fields}).filter(function(e){return!!e}).reduce(function(e,t){return Array.isArray(t)?[].concat(_toConsumableArray(e),_toConsumableArray(t)):[].concat(_toConsumableArray(e),[t])},[]),r=[];_.each(n,function(e){var t=_.findWhere(r,{variable_name:e.variable_name});e.variable_name&&!t&&r.push(e)});var o=_.filter(e,{default:!0}),a=_.filter(e,{default:!1}),i=_.map(r,function(e){return{name:e.display_name,slug:"custom_field_"+e.variable_name,is_custom:!0}});return{selected:o,available:_.union(i,a),all:_.union(o,a,i)}},l="transaction-export-preferences-"+a.get("account").id,d=e.get(l);d?(n.selected_keys=d,n.available_keys=_.reject(u().all,function(e){return _.findWhere(d,{slug:e.slug})})):(n.available_keys=u().available,n.selected_keys=u().selected),n.selectedKeyStatusIsSuccessful=function(e){return"status"===e.slug&&"success"===t.status},n.remove=function(e,t){n.selected_keys.splice(t,1),n.available_keys.push(_.pick(e,["name","slug","is_custom"])),n.save()},n.add=function(e,t){n.available_keys.splice(t,1),n.selected_keys.push(_.pick(e,["name","slug","is_custom"])),n.save()},n.save=function(){e.set(l,n.selected_keys)},n.reset=function(){n.available_keys=u().available,n.selected_keys=u().selected,n.save()},n.export=function(){var e=angular.copy(s.params);e.columns=_.pluck(n.selected_keys,"slug"),e.user=a.get("user").id,r.one("transaction","export_by_column").get(e).then(function(){n.closeThisDialog(),i.open({template:"/modules/transactions/modals/export-success.html",showClose:!0,trapFocus:!1})}).catch(function(e){n.$broadcast("exported",!1),o.error("Could not export transactions",e)})}}]).controller("TransactionDisputesCtrl",["$scope","PendingDisputes","dispute_statuses",function(e,t,n){t.promise.then(function(){e.disputes=t.data,e.meta=t.meta,e.$broadcast("fetchedDisputes")}),e.getStatusDescription=function(e){var t=_.findWhere(n,{slug:e});return t?t.description:e}}]).controller("SingleTransactionCtrl",["$state","$scope","$rootScope","$stateParams","ngDialog","transaction","refunds","disputes","dispute_statuses","dispute_resolutions","$i18next","API","Notification","order","AmplitudeService","utils",function(o,a,t,n,i,e,r,s,c,u,l,d,p,f,m,g){e=e.data;a.order=f.data,a.products=a.order&&a.order.items.filter(function(e){return"product"===e.type});var h=m.logEvent;if(e.split&&e.split.shares&&e.split.shares.subaccounts){a.totalSubaccountShares=e.split.shares.subaccounts.reduce(function(e,t){return e+t.amount},0);Promise.all(e.split.shares.subaccounts.map(function(n){return d.one("subaccount",n.subaccount_code).get().then(function(e){var t=e.data;return _objectSpread(_objectSpread({},n),t)})})).then(function(e){a.$broadcast("fetchedSubaccountsDetails"),a.subaccountsDetails=e}).catch(function(e){a.$broadcast("fetchedSubaccountsDetails",!1),p.error("Could not fetch subaccount details",e)})}if(e.authorization&&!_.isEmpty(e.authorization)){var y="",b="";if(e.authorization.description){var v=e.authorization.description.split(" ");y=v[0],b=_.last(v)}e.authorization.card_type=(e.authorization.card_type||y).toLowerCase(),e.authorization.last4=(e.authorization.last4||b).toLowerCase(),e.authorization.bank=(e.authorization.bank||"").toLowerCase(),e.has_authorization=!0}else e.has_authorization=!1;e.has_authorization&&(e.authorization.country_name&&(e.authorization.bank=e.authorization.bank+" - "+e.authorization.country_name),e.ip_country&&(e.ip_address=e.ip_address+" - "+e.ip_country)),a.feesBreakDownLabels={},e.fees_breakdown&&e.fees_breakdown.forEach(function(e){a.feesBreakDownLabels[e.type]=l.t("transactions.one.list.".concat(e.type))}),a.canRetryRefund=function(e){return e.collect_account_number&&"failed"===e.status&&t.User.hasPermission("refund-pwt")},a.refunds=r.data;var S=_.map(a.refunds,function(e){return e.amount}).reduce(function(e,t){return e+t},0);a.canProcessAnotherRefund=S<e.amount,a.refundRequiresCustomerDetails=a.refunds.some(function(e){return e.collect_account_number&&"failed"===e.status});var P="awaiting-merchant-feedback",w=(s.data||[]).map(function(e){return _objectSpread(_objectSpread({},e),e.attachments&&{attachments:g.jsonParse(e.attachments)})}),C=_toConsumableArray(w).sort(function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)}),O=C.find(function(e){var t=e.category,n=e.status;return"fraud"===t&&n===P})||C.find(function(e){return"fraud"===e.category}),A=C.find(function(e){var t=e.category,n=e.status;return"chargeback"===t&&n===P})||C.find(function(e){return"chargeback"===e.category});a.recentDisputes=[O,A].filter(function(e){return void 0!==e}).map(function(e){return _objectSpread(_objectSpread({},e),{},{resolved:"resolved"===e.status,title:function(e){var t=e.category,n=e.status,r=e.resolvedAt,o=e.createdAt;if("resolved"===n&&r){var a=moment(r).format("LLLL");return"fraud"===t?"".concat(i18next.t("transactions.one.fraudResolvedOn")," ").concat(a):"".concat(i18next.t("transactions.one.chargebackResolvedOn")," ").concat(a)}return"resolved"===n?"fraud"===t?i18next.t("transactions.one.fraudResolved"):i18next.t("transactions.one.chargebackResolved"):"".concat(i18next.t("transactions.one.disputeCreated")," ").concat(moment(o).fromNow())}(e)})}),a.dispute=a.recentDisputes.length?a.recentDisputes[0]:null;var T=w.find(function(e){return e.id==n.disputeId});if(T?a.dispute=T:h("No matching dispute"),a.dispute_statuses=c,a.dispute_resolutions=u,a.dispute){a.dispute.refund_amount=a.dispute.refund_amount||e.amount,a.dispute.resolved="resolved"===a.dispute.status;try{var k=a.dispute.attachments;a.dispute.attachments=k?"string"==typeof k?JSON.parse(k):k:[]}catch(e){a.dispute.attachments=[]}}function D(){var e=o.params,t=(e.disputeId,_objectWithoutProperties(e,_excluded3));o.transitionTo(o.current,t,{reload:!0,inherit:!1})}if(a.transaction=_objectSpread(_objectSpread({},e),{},{formattedChannel:"bank_transfer_ussd"===e.channel?"ussd":e.channel.replace("_"," ")}),a.isBankTransfer=["bank_transfer","dedicated_nuban"].includes(e.channel),a.isApplePay="apple_pay"===e.channel,a.setRisk=function(e){d.all("customer/set_risk_action").post({customer:a.transaction.customer.customer_code,risk_action:e}).then(function(){p.success("Updated successfully","Customer has been updated successfully"),o.reload()},function(e){p.error("Could not update customer",e)})},a.logLimit=10,a.increaseLogLimit=function(){a.logLimit=e.log.history.length},a.getStatusDescription=function(e){var t=_.findWhere(c,{slug:e});return t?t.description:e},a.getResolutionDescription=function(t){var e=u.find(function(e){return e.slug===t});return e?e.short:t},a.showRefundModal=function(e){var t=e.view,n=e.refund,r=angular.copy(a.transaction);r.refunded=S,i.openConfirm({template:"/modules/transactions/modals/refund.html",controller:"TransactionRefundCtrl",showClose:!0,closeByDocument:!1,data:{transaction:r,view:t,refund:n}}).then(function(){o.reload()})},a.showDisputeModal=function(e){a.selectedDispute=e,i.openConfirm({template:"modules/transactions/modals/dispute.html",controller:"DisputeCtrl",trapFocus:!1,showClose:!0,closeByDocument:!1,scope:a,width:900}).then(D).catch(D)},n.collect_recipient_details&&n.refund_id){var x=a.refunds.find(function(e){return e.id===Number(n.refund_id)});x&&a.showRefundModal({view:"collect_recipient_details",refund:x})}if(n.disputeId){var j=a.recentDisputes.find(function(e){return e.id===Number(n.disputeId)});j&&a.showDisputeModal(j)}}]).controller("TransactionRefundCtrl",["$scope","API","Notification","Session","AmplitudeService","utils","CountryService","BankService","$state",function(r,n,o,a,e,i,t,s,c){var u=e.logEvent;r.transaction=r.ngDialogData.transaction,r.existingRefund=r.ngDialogData.refund,r.currentRefundFormView=r.ngDialogData.view;var l=r.transaction.amount-r.transaction.refunded;r.currencyData=t.getCurrencyData(r.transaction.currency),r.refundPayload={maxRefundable:l/100,amount:l/100,currency:r.transaction.currency},r.refundFormViews={COLLECT_AMOUNT:"collect_amount",COLLECT_RECIPIENT_DETAILS:"collect_recipient_details",CONFIRM_WITH_RECIPIENT_DETAILS:"confirm_with_recipient_details",CONFIRM_WITHOUT_RECIPIENT_DETAILS:"confirm_without_recipient_details"},r.setRefundFormView=function(e){r.currentRefundFormView=e,r.modalHeader=r.currentRefundFormView.startsWith("confirm")?i18next.t("transactions.one.tabs.refunds.confirmRefund"):i18next.t("transactions.one.tabs.refunds.refundCustomer")},r.recipientDetails={},r.modalHeader=i18next.t("transactions.one.tabs.refunds.refundCustomer"),r.fetchBanks=function(){r.banks=[],r.loadingBanks=!0,s.init({currency:r.transaction.currency}).then(function(e){r.banks=e,r.loadingBanks=!1}).catch(function(){r.loadingBanks=!1})},r.resetAccountVerification=function(){r.accountVerification=null},r.processRecipientDetails=function(){r.accountVerification=null;var e=r.recipientDetails.account_number,t=r.recipientDetails.bank.id,n=r.transaction.currency;e&&t&&(r.accountVerification="pending",s.validate(e,t).then(function(){return s.resolve(e,t,n)}).then(function(e){"unconfirmed"!==(r.accountVerification=e)&&(r.recipientDetails=_objectSpread(_objectSpread({},r.recipientDetails),{},{account_name:e.account_name}),r.setRefundFormView(r.refundFormViews.CONFIRM_WITH_RECIPIENT_DETAILS))}).catch(function(){r.accountVerification="unconfirmed"}).finally(function(){r.$broadcast("processedRecipientDetails")}))},r.retryRefund=function(){var e={currency:r.transaction.currency,account_number:r.recipientDetails.account_number,bank_id:r.recipientDetails.bank.id};n.all("refund/retry_with_customer_details/".concat(r.existingRefund.id)).post({refund_account_details:e}).then(function(){o.success("Refund retried","Your refund has been retried successfully"),r.confirm(),r.$broadcast("retriedRefund")}).catch(function(e){r.$broadcast("retriedRefund",!1),o.error("Could not retry refund",e)})},r.postRefund=function(){var e=r.refundPayload,t={amount:e.amount,currency:e.currency};t.amount=i.toKobo(t).amount,t.transaction=r.transaction.id,t.user=a.get("user").email,t.source="merchant",n.all("refund").post(t).then(function(){var e=r.transaction.amount===t.amount;u("Payment refunded",{FullRefund:e}),r.confirm()}).catch(function(e){404===e.status&&(r.closeThisDialog(),c.reload()),o.error("Could not process refund",e),r.$broadcast("processedRefund")})}}]).controller("DisputeCtrl",["$scope","$state","$filter","API","Notification","Session","PendingDisputes","utils",function(s,e,c,u,l,d,t,p){if(d.hasPermission("transaction-dispute")){s.dispute=s.selectedDispute||s.dispute;var f=angular.copy(s.dispute.attachments),n=_.findWhere(s.dispute_statuses,{slug:s.dispute.status});s.dispute.status_description=n?n.description:status,s.dispute.resolution=s.dispute.resolution||"merchant-accepted",s.evidence={};var r=_.findWhere(s.dispute_resolutions,{slug:s.dispute.resolution});s.dispute.resolution_description=r?r.description:status,s.dispute.merchant_refund_amount=s.dispute.refund_amount/100,s.dispute.attachments=s.dispute.attachments||[],s.$on("uploadStarted",function(e){s.uploadingAttachment=!0}),s.$on("uploadCompleted",function(e,t){s.uploadingAttachment=!1,s.new_attachment=null,s.dispute.attachments.push({name:t.file.name,path:t.uploadPath})}),s.removeAttachment=function(e){s.dispute.attachments=_.without(s.dispute.attachments,e)},s.dispute.refund_type="full",s.dispute.decline_message="",s.dispute.partial_dispute_message="",s.refundFullAmount=function(){s.dispute.merchant_refund_amount=s.dispute.refund_amount/100},s.refundFullAmount(),"fraud"===s.dispute.category&&(s.dispute.customer_name=(s.transaction.customer.first_name||"")+" "+(s.transaction.customer.last_name||""),s.dispute.customer_email=s.transaction.customer.email,s.dispute.customer_phone=s.transaction.customer.phone),s.canAcceptChargeback=function(){var e=p.toKobo({amount:s.dispute.merchant_refund_amount||0}).amount,t=e&&e<=s.dispute.refund_amount,n=!("partial"===s.dispute.refund_type)||s.dispute.partial_dispute_message;return t&&n},s.canDeclineChargeback=function(){var e=s.dispute.decline_message,t=0<s.dispute.attachments.length;return e&&t},s.getSender=function(e){var t=d.get("user").email,n=e.sender||e.created_by;return n===t?"You":-1<n.endsWith("@paystack.com")?"Paystack":n},s.sendMessage=function(e){u.one("dispute",s.dispute.id).all("message").post({user:d.get("user").email,body:e}).then(function(e){s.$broadcast("sentMessage"),s.new_comment=null,s.dispute.messages.push(e.data)}).catch(function(e){s.$broadcast("sentMessage"),l.error("Could not send message",e)})},s.deleteMessage=function(e){s.dispute.messages=_.without(s.dispute.messages,e),u.one("dispute/message",e.id).remove()},s.resolveDispute=function(e,t){var n=Promise.resolve(),r=Promise.resolve(),o={resolution:e,user:d.get("user").email};if("declined"===e)o.message="This dispute was declined with evidence and reason: "+t;else{if(o.refund_amount=p.toKobo({amount:s.dispute.merchant_refund_amount}).amount,t){var a=c("money")(o.refund_amount,s.transaction.currency);o.message="Dispute was accepted for a partial refund of "+a+" and reason: "+t}else o.message="This dispute was accepted for a full refund";if(!o.refund_amount||o.refund_amount>s.dispute.refund_amount)return s.$broadcast("resolvedDispute",!1),void l.error("Could not create dispute","Please confirm refund amount is less than requested refund")}if("fraud"===s.dispute.category){var i="dispute/".concat(s.dispute.id,"/evidence");r=u.all(i).post(s.evidence).then(function(e){o.evidence=e.data.id})}s.dispute.attachments!=f&&(n=u.one("dispute",s.dispute.id).customPUT({attachments:JSON.stringify(s.dispute.attachments)})),r.then(n).then(function(){return u.one("dispute",s.dispute.id).all("resolve").customPUT(o)}).then(function(e){s.confirm(),l.success("Dispute Updated","This dispute has been resolved")}).catch(function(e){s.$broadcast("resolvedDispute",!1),l.error("Could not resolve dispute",e)})}}}]),angular.module("app.transfer-recipients",["ui.router"]).config(["$stateProvider",function(e){e.state("transfer-recipients",{abstract:!0,title:"Recipients",url:"/transfer-recipients",templateUrl:"/components/layout/base.html",redirectTo:"transfer-recipients.list",data:{authenticable:!0}}).state("transfer-recipients.list",{title:"Recipients",url:"?page&use_cursor&is_blacklisted&search",pageTrack:"/transfer-recipients",templateUrl:"/modules/transfer-recipients/list.html",controller:"TransferRecipientsCtrl",onExit:function(){return window.cleanupMicroFrontend&&window.cleanupMicroFrontend("transfer-recipients-root")}}).state("transfer-recipients.one",{url:"/:id",title:"Recipients",templateUrl:"modules/transfer-recipients/one.html",controller:"TransferRecipientsCtrl",onExit:function(){return window.cleanupMicroFrontend&&window.cleanupMicroFrontend("transfer-recipients-root")}})}]).factory("TransferRecipientData",["API","URLService",function(t,n){return{fetch:function(e){return t.one("transferrecipient").get(e)},getTotalRecipientsCount:function(){var e=n.getQuery();return t.one("transferrecipient").get(_objectSpread(_objectSpread({},e),{},{perPage:1,use_cursor:!1})).then(function(e){return e&&e.meta&&e.meta.total})}}}]).controller("TransferRecipientsCtrl",["$scope","TransferRecipientData",function(t,e){t.$watch("mfeServiceReady",function(e){e&&window.postMessage({message:"RENDER_TRANSFER_RECIPIENTS_MICROFRONTEND"})}),e.getTotalRecipientsCount().then(function(e){t.recipientCount=e})}]),angular.module("app.transfers",["ui.router","autocomplete"]).config(["$stateProvider",function(e){e.state("transfers",{abstract:!0,url:"/transfers",title:"Transfers",templateUrl:"components/layout/base.html",redirectTo:"transfers.list",data:{permission:"transfer-view",authenticable:!0}}).state("transfers.list",{url:"?page&amount&recipient&currency&new&status&from&to&reference&period&for&use_cursor&next&previous&per_page&request",pageTrack:"/transfers",title:"Transfers",templateUrl:"modules/transfers/list.html",controller:"TransfersCtrl"}).state("transfers.new",{url:"/new?withdraw&currency",title:"New Transfer",templateUrl:"modules/transfers/new.html",controller:"NewTransferCtrl",permission:"transfer-*",resolve:{settlement_accounts:["API","Session",function(e,t){return e.one("integration/view_settlement_accounts",t.get("account").id).get()}],needs_setup:["settlement_accounts","Session","$state","Notification",function(r,o,a,i){return new Promise(function(e,t){var n=_.findWhere(r.data,{currency:o.get("account").default_currency})||{};o.get("account").is_live&&!n.recipient_code?(i.error("Transfers Not Setup","Please set up transfer for your business first"),a.go("transfers.list"),t()):e()})}],balances:["API",function(e){return e.one("balance").get()}]}}).state("transfers.one",{url:"/:id?confirm",title:"Transfers",templateUrl:"modules/transfers/one.html",controller:"TransferDetailCtrl",onExit:function(){return window.cleanupMicroFrontend&&window.cleanupMicroFrontend("transfers-root")}})}]).factory("TransferData",["API","URLService",function(t,n){return{fetch:function(e){return t.one("transfer").withHttpConfig({ignoreLoadingBar:!0}).get(e)},exportTransfersToEmail:function(){var e=n.getQuery();return t.one("transfer","export").get(_objectSpread(_objectSpread({},e),{},{destination:"email"}))}}}]).factory("TransferCount",["API","URLService",function(t,n){return{fetch:function(){var e=n.getQuery();return t.one("transfer").get(_objectSpread(_objectSpread({},e),{},{perPage:1,next:null,previous:null,use_cursor:!1})).then(function(e){return e&&e.meta&&e.meta.total})}}}]).factory("TransferCharge",["API",function(t){return{fetch:function(e){return t.one("transfer/fees").get(e).then(function(e){return e&&e.data&&e.data.transfer_fees})}}}]).factory("TransferConfig",["API",function(t){var r={};return{fetch:function(e){var n=e.currency;return r[n]?Promise.resolve(r[n]):t.one("transfer/config").get({currency:n}).then(function(e){var t=e.data;return r[n]=t})}}}]).controller("TransfersCtrl",["$state","$stateParams","$scope","$rootScope","ngDialog","API","Notification","TopupService","Session","LocalService","URLService","TransferData","TransferCount","TransferRecipientData","BalanceHistoryData","SettlementAccountData","AmplitudeService",function(t,r,o,n,a,i,s,e,c,u,l,d,p,f,m,g,h){var y=h.logEvent;o.logEvent=y,o.transfers=[],o.transferPages=[],o.meta={},o.balances=[],o.selectedCurrency=t.params.currency||n.Business.default_currency,o.goToTransfer=function(e){t.go("transfers.one",{id:e})};var b=p.fetch().then(function(e){o.total=e}),v=m.getBalances().then(function(e){var t=e.data;o.balance=t.find(function(e){return e.currency===o.selectedCurrency})}).catch(function(e){s.error("Could not fetch balance",e)});Promise.all([b,v]).finally(function(){o.$broadcast("fetchedMetrics")});var S=!1,P=function(e,t){var n=r.use_cursor?"cursor":"paging";S||y(e,_objectSpread({"Pagination type":n},t))},w=function(e){return P("Transfer List endpoint request started"),d.fetch(e).then(function(e){return P("Transfer List endpoint request complete"),S=!0,e}).catch(function(e){P("Transfer List endpoint request complete",{"Error code":e.status}),S=!0,s.error("Could not fetch transfers",e),o.$broadcast("fetchedTransfers",!1)})},C=l.getQuery();o.params=C,w(C).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=e.meta;t&&(o.transfers=t,o.meta=n,C.use_cursor&&(o.transferPages.push(t),A(n)),o.$broadcast("fetchedTransfers"))});var O=null,A=function(e){var t=e.next,n=e.perPage;O=t;o.shiftJumpDistance=50*n};o.fetchingMoreTransfers=!1;var T=!(o.fetchMoreTransfers=function(){o.fetchingMoreTransfers=!0;var e=o.meta.next;return w(_objectSpread(_objectSpread({},C),{},{next:e})).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=e.meta;t&&(o.transferPages.push(t),o.meta.next=n.next),o.fetchingMoreTransfers=!1})});o.checkForNewTransfers=function(){T||(T=!0,w({previous:O}).then(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).meta;e&&(o.meta.previous=e.previous),T=!1}))},o.query=angular.copy(r),o.onPeriodChanged=function(e){switch(e){case"day":o.query.from=null,o.query.to=null;break;case"range":o.query.for=null;default:o.query.from=null,o.query.to=null,o.query.for=null}},o.needs_setup=!1,g.fetch().then(function(e){o.settlement_account=(e.data||[]).find(function(e){return e.currency===c.get("account").default_currency}),o.needs_setup=n.Business.is_live&&!o.settlement_account.recipient_code,o.needs_setup&&(o.setup=function(){i.all("integration/add_settlement_account/"+n.Business.id).post({currency:o.settlement_account.currency,bank:o.settlement_account.bank.id,account_number:o.settlement_account.account_number}).then(function(){t.reload()}).catch(function(e){o.$broadcast("createdSelfRecipient",!1),s.error("Could not setup this account",e)})})}).catch(function(e){s.error("Could not fetch settlement accounts",e)}),o.resetRecipientSearch=function(e){o.recipientFilter="",e||(o.focusSearch=!1)},o.saveFilters=function(e){if(e){var t=_.omit(o.query,["page"]);u.set("default_transfer_filters",t)}},o.confirmTransfer=function(e){a.openConfirm({template:"/modules/transfers/modals/confirm-transfer.html",resolve:{transfer:function(){return e}},controller:"TransferConfirmationCtrl"}).then(function(){t.reload()})},o.loadTransfer=function(e){i.one("transfer",e.id).get().then(function(e){var t=e.data;"otp"==t.status?o.confirmTransfer(t):t?a.open({template:"/modules/transfers/modals/view-transfer.html",controller:"ViewTransferCtrl",trapFocus:!1,resolve:{transfer:[function(){return{data:t}}]}}):s.error("Didn't find that transfer","Please check the id and try again")})},o.exportTransfersToEmail=function(){d.exportTransfersToEmail().then(function(){a.open({template:"/modules/transfers/modals/email-export-success.html",scope:o,showClose:!0,width:450})}).catch(function(e){return s.error("Could not export your transfers",e)})},o.showQuickExportSuccess=function(){a.open({template:"/modules/transfers/modals/quick-export-success.html",scope:o,showClose:!0,width:450})},o.topupBalance=function(){e.topup().then(t.reload).catch(function(e){s.error("Could not topup your account",e)})},f.fetch({perPage:250,use_cursor:!0}).then(function(e){o.totals={recipients:e.meta.total,completed:o.transfers.filter(function(e){return"success"===e.status}).length},o.recipients=(e.data||[]).map(function(e){return e.name=e.name||e.details.account_name,e})}).catch(function(e){s.error("Could not fetch transfer recipients",e)}),o.updateRecipients=function(e){i.one("transferrecipient").get({search:e,perPage:250}).then(function(e){o.recipients=e.data}).catch(function(e){s.error("Could not fetch transfer recipients",e)})},o.getRecipient=function(){var e=(o.recipients||[]).find(function(e){return e.id===parseInt(t.params.recipient,10)});return e?e.name:"Choose Recipient"}}]).controller("ViewTransferCtrl",["$scope","$state","$interval","$timeout","API","Notification","transfer","ngDialog",function(n,r,e,t,o,a,i,s){var c;n.transfer=i.data,n.automaticallyRefresh=function(){"pending"===i.data.status&&(n.timer=10,c=e(function(){n.timer=n.timer-=1},1e3),t(r.reload,1e4))},n.reload=function(){e.cancel(c),r.reload()},"otp"==n.transfer.status&&s.openConfirm({template:"/modules/transfers/modals/confirm-transfer.html",resolve:{transfer:function(){return i.data}},controller:"TransferConfirmationCtrl"}).then(function(){r.reload()}),n.retry=function(e){o.all("transfer").post({source:"balance",amount:e.amount,currency:e.currency,reason:e.reason,recipient:e.recipient.recipient_code}).then(function(e){var t=e.data;"success"==t.status&&a.success("Transfer successful","Your balance has been updated"),"otp"==t.status&&a.success("Transfer initiated","Please confirm to complete"),r.go("transfers.one",{id:t.id,confirm:"otp"==t.status}).then(function(){n.closeThisDialog&&n.closeThisDialog(t)})},function(e){n.$broadcast("retryingTransfer",!1),a.error("Unable to retry transfer",e)})}}]).controller("TransferDetailCtrl",["$scope",function(e){e.$watch("mfeServiceReady",function(e){e&&window.postMessage({message:"RENDER_TRANSFERS_MICROFRONTEND"})})}]).controller("NewTransferCtrl",["$state","$scope","API","balances","settlement_accounts","Notification","BankService","ngDialog","Session","DEFAULTS","TopupService","TransferConfig","utils","TransferCharge",function(r,i,n,e,t,o,a,s,c,u,l,d,p,f){i.balances=e.data,i.recipients=[],i.all_recipients_fetched=!1;var m=c.get("account"),g=r.params.currency||m&&m.default_currency,h=m&&m.attributes&&m.attributes.country_code;if(i.isAccountVerificationRequired="ZA"!==h,i.getTransferConfigForCurrency=function(e){i.fetchingMinimumTranserAmount=!0,d.fetch({currency:e}).then(function(e){var t=e.minimum_amount,n=e.maximum_amount;i.minimumTransferAmount=p.currencySubUnitToBaseUnit(t),i.maximumTransferAmount=n,i.fetchingMinimumTranserAmount=!1}).catch(function(){i.fetchingMinimumTranserAmount=!1})},i.getTransferCharge=function(){var e=i.transfer||{},t=e.amount,n=e.currency,r=e.recipient;return t&&n&&r?(i.transferChargeCalculated=!1,f.fetch({currency:n,amount:p.currencyBaseUnitToSubUnit(t),recipient_type:r.type}).then(function(e){i.transferChargeCalculated=!0,i.transferCharge=p.currencySubUnitToBaseUnit(e)}).catch(function(e){o.error("There was a problem while fetching the transfer fees",e)})):i.transferCharge=0,i.transferCharge},i.updateRecipients=function(e,t){if(!i.all_recipients_fetched)return n.one("transferrecipient").get({currency:t,search:e,perPage:250}).then(function(e){var t=e.data.filter(function(e){return e.active});return i.recipients=t.map(function(e){return angular.extend(e,{account_number:e.details.account_number,bank_name:e.details.bank_name,account_name:e.name||e.details.account_name})}),e})},i.setRecipient=function(e){var t=(i.banks||[]).filter(function(e){return e.code===i.transfer.bank_code});i.transfer.recipient=e||t.length&&t[0],i.getTransferCharge()},i.updateBanks=function(e){i.loadingBanks=!0,a.init({currency:e,transferRecipient:!0}).then(function(e){i.banks=e,i.loadingBanks=!1}).catch(function(){i.loadingBanks=!1})},i.balanceSufficient=!0,i.checkIfBalanceSufficient=function(){if(0===i.activeBalance.balance)return i.balanceSufficient=!1;var e=u.minimumTransfer[i.activeBalance.currency]||0;i.balanceSufficient=i.activeBalance.balance>e+i.getTransferCharge()},i.setBalance=function(e){i.activeBalance=_.findWhere(i.balances,{currency:e}),i.transfer&&(i.transfer.recipient=null),i.transferCharge=0,i.updateBanks(e),i.getTransferConfigForCurrency(e),i.all_recipients_fetched=!1,i.updateRecipients(null,e).then(function(e){i.transfer.newRecipient=0===e.meta.total,i.all_recipients_fetched=1===e.meta.pageCount,i.$broadcast("fetchedRecipients")}).catch(function(){i.$broadcast("fetchedRecipients")}),i.checkIfBalanceSufficient()},i.setBalance(g),i.transfer={currency:i.activeBalance.currency},i.handleBalanceCurrencyChange=function(){r.go(r.current.name,{currency:i.transfer.currency})},r.params.withdraw){var y=t.data.find(function(e){return e.currency===c.get("account").default_currency})||{};i.transfer.amount=i.activeBalance.balance/100-i.transferCharge,y.recipient_code&&i.setRecipient({account_number:y.account_number,bank_name:y.bank.name,type:y.bank.type,account_name:y.account_name||"Settlement Account",recipient_code:y.recipient_code})}i.overTransferLimit=function(){if(!i.transfer.amount)return!1;var e=parseFloat(i.transfer.amount,10)+i.transferCharge;return{maximumLimitReached:e>i.maximumTransferAmount,balanceExceeds:e>i.activeBalance.balance/100}},i.enableStartTransferButton=function(){var e=i.overTransferLimit(),t=e.balanceExceeds,n=e.maximumLimitReached,r=i.transfer||{},o=r.newRecipient,a=r.recipient;return!o&&!a||t||n||!i.transferChargeCalculated},i.verifyAccountNumber=function(){if(i.isAccountVerificationRequired){i.accountVerification=null,i.transfer.account_name=null;var e=i.transfer.account_number,t=i.transfer.bank_code;a.validate(e,t).then(function(){return i.accountVerification="pending",a.resolve(e,t)}).then(function(e){i.accountVerification=e,i.transfer.account_name=e.account_name}).catch(function(){i.accountVerification=null})}};var b=function(t){n.all("transfer").post({source:"balance",amount:(100*t.amount).toFixed(),currency:t.currency,reason:t.reason,recipient:t.recipient.recipient_code,reference:t.reference}).then(function(e){var n=e.data;n.recipient=t.recipient,"success"==n.status?(o.success("Transfer successful","Your balance has been updated"),r.go("transfers.one",{id:n.id})):"otp"==n.status?s.openConfirm({template:"/modules/transfers/modals/confirm-transfer.html",resolve:{transfer:[function(){return n}]},controller:"TransferConfirmationCtrl"}).then(function(e){var t=e.currency+" "+e.amount/100+" will been sent to "+e.recipient.name||e.recipient.details.account_name;o.success("Transfer queued",t),r.go("transfers.one",{id:n.id})}).catch(function(){r.go("transfers.list")}):(o.success("Transfer queued","Your transfer has been queued"),r.go("transfers.one",{id:n.id}))},function(e){i.$broadcast("moneyTransferred",!1),o.error("Transfer unsuccessful",e)})};i.topupBalance=function(){l.topup().then(r.reload).catch(function(e){o.error("Could not topup your account",e)})},i.start=function(t){t.newRecipient?n.all("transferrecipient").post({type:"NGN"===t.currency?"nuban":"",currency:t.currency,bank_code:t.bank_code,account_number:t.account_number,name:t.account_name,email:t.email_address}).then(function(e){t.recipient=e.data,b(t)},function(e){i.$broadcast("moneyTransferred",!1),o.error("There was a problem with the recipient",e)}):b(t)}}]).controller("TransferConfirmationCtrl",["$state","$scope","$rootScope","API","transfer","Notification","Session",function(e,n,t,r,o,a,i){n.transfer=o,n.user_email=t.User.email,n.transfer_email_otp_enabled=i.get("account").send_transfer_email_otp,n.resendCode=function(){r.all("transfer/resend_otp").post({reason:"transfer",transfer_code:o.transfer_code}).then(function(e){a.success("Confirmation Code Resent",n.transfer_email_otp_enabled?"Please check your phone or email to complete this transfer":"Please check your phone to complete this transfer")},function(e){a.error("Confirmation not resent",e)})},n.confirmTransfer=function(t){r.all("transfer/finalize_transfer").post({transfer_code:t.transfer_code,otp:t.otp}).then(function(e){n.confirm(t)},function(e){n.$broadcast("transferConfirmed",!1),a.error("Transfer error",e)})}}]).controller("RecipientsCtrl",["$state","$scope","$rootScope","API","recipients","Notification",function(e,t,n,r,o,a){t.recipients=o.data,t.meta=o.meta}]).service("TransferService",["$rootScope","utils",function(c,u){return{getTransferCharge:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.amount,r=void 0===n?0:n,o=t.currency,a=void 0===o?"NGN":o,i=u.toKobo({amount:r}).amount,s=c.Business.transfer_fees.find(function(e){return e.currency===a})||{};return s.thresholds&&(e=s.thresholds.find(function(e){return i<=e.max})),(e||s).fee/100||0}}}]),FilesModule.controller("FileDisplayCtrl",["$scope","$state","FileDisplay",function(r,o,a){r.$on("$viewContentLoaded",function(){var e=function(e){if(e)return decodeURI(e)}(o.params.location);if(!e)return r.message="The download filename was not specified",void r.$broadcast("fetchedFile",!1);var t,n={};t=e,new RegExp(/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/).test(t)?n.url=e:n.storage_key=e,a.getSignedURL(n).then(function(e){window.location.href=e.data.path}).catch(function(e){r.message=e&&e.data&&e.data.message,r.$broadcast("fetchedFile",!1)})})}]),FilesModule.factory("FileDisplay",["API",function(r){return{getSignedURL:function(e){var t=e.storage_key,n=e.url;return r.all("download_url").post({storage_key:t,url:n})}}}]),angular.module("app.settings").service("GoogleMapsService",function(){var n,r,o=settings.googleMapsApiKey;return{init:function(){return new Promise(function(e){if(window.initMap=function(){n=new google.maps.Map(document.getElementById("compliance-map"),{center:{lat:6.5842652,lng:3.3461127},zoom:16,disableDefaultUI:!0,scaleControl:!1,zoomControl:!1}),r=new google.maps.Geocoder,e()},!window.google||!window.google.maps){var t=document.createElement("script");t.setAttribute("src","https://maps.googleapis.com/maps/api/js?callback=initMap&key=".concat(o,"&libraries=&v=weekly")),document.body.appendChild(t)}})},geocodeAddress:function(e){e&&r.geocode({address:e},function(e,t){"OK"==t&&(n.setCenter(e[0].geometry.location),new google.maps.Marker({map:n,position:e[0].geometry.location}))})}}});_excluded=["id","page"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}OrderModule.controller("StorefrontsOrdersFiltersCtrl",["$scope","$state","$stateParams","utils","StorefrontOrdersFactory","ProductOrdersFilters","$timeout","Notification",function(o,a,e,t,n,i,r,s){o.query=angular.copy(e),o.isOrdersPage=!0,o.productFilterVisible=!1,o.products=[],o.copyProducts=angular.copy(o.products),o.filteredProducts=[],o.productSearch="",o.productSearchCopy=angular.copy(o.productSearch),o.orderSearch="";var c=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=_objectSpread({perPage:10},e);n.fetchProducts(t).then(function(e){u(e)}).catch(function(e){s.error("Could not fetch products",e)})},u=function(e){var t=e.data;o.products=t},l=function(e,t){var n=t.id;return e.filter(function(e){return e.id!==n})},d=function(e,t){return[t].concat(_toConsumableArray(e))};o.toggleProductFilter=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];(o.productFilterVisible=e)&&r(function(){var e=document.getElementById("productSearch");e&&(e.focus(),e.select())})},o.onFilterOrders=function(e){o.$broadcast("$locationChangeSuccess");var t=i.getProductIds(o.filteredProducts);e.products=t;e.id,e.page;var n=_objectWithoutProperties(e,_excluded),r=i.filterOrders(n);a.go("storefronts.one.orders.list",_objectSpread({},r),{reload:!0,inherit:!0})},o.populateOrdersFilters=function(){e.delivered&&"false"===e.delivered&&(o.query.status="false"),e.refunded&&"true"===e.refunded&&(o.query.status="refunded"),e.is_viewed&&"false"===e.is_viewed&&(o.query.status="new")},o.$on("fetchedProduct",function(e,t){o.filteredProducts=d(o.filteredProducts,t)}),o.clearFilters=function(){a.go(a.current,{id:a.params.id},{reload:!0,inherit:!1})},o.includeProductToFilters=function(e){o.filteredProducts=d(o.filteredProducts,e),o.toggleProductFilter(!1),o.productSearch="",r(function(){o.products=l(o.products,e)})},o.removeProductFromFilters=function(e){r(function(){o.filteredProducts=l(o.filteredProducts,e)}),o.products=d(o.products,e)},o.$watch("productSearch",_.debounce(function(e,t){e!==t&&e!==o.productSearchCopy&&(o.productSearchCopy=e,c({search:e}))},800)),o.clearSearch=function(){r(function(){o.productSearch=""})};o.populateOrdersFilters(),c()}]),OrderModule.controller("StorefrontsOrdersCtrl",["$scope","$rootScope","$state","ngDialog","StorefrontOrdersFactory","ProductConstants","ProductOrdersFilters","Notification","utils","OrderUtils","ordersList","StorefrontIntroService","$timeout",function(r,o,a,i,s,e,c,u,t,l,n,d,p){var f=t.pipe,m=t.sideEffect;r.query=angular.copy(a.params),delete r.query.id,r.searchOrders=angular.copy(r.query.search)||"",r.loading=!0,r.orders=n.data,r.copyOrders=angular.copy(r.orders),r.ordersMeta=n.meta,r.params=angular.copy(a.params),r.ordersNotFound=Object.keys(r.query).some(function(e){return r.query[e]}),r.orderStatus=e.ORDER_STATUSES,r.selectingMultipleOrders=!1,r.selectedOrdersCount=0,r.allOrdersSelected=!1,r.refunds={refundPayment:!0},r.activeOrder=null;var g=function(e){r.orders=e.data||e},h=function(e){r.selectedOrdersCount=e};r.toggleSelectingMultipleOrders=function(){r.selectingMultipleOrders=!r.selectingMultipleOrders,r.allOrdersSelected=!1,r.selectedOrdersCount=0,r.selectingMultipleOrders?r.orders=l.sortOrders(r.orders):r.orders=angular.copy(r.copyOrders)},r.viewOrder=function(e){e.is_viewed||(e.is_viewed=!0)},r.checkIfOrderIsSelected=function(e){return e.toString()===a.params.orderId},r.generateOrdersFilters=function(e){var t=c.generateProductFilters(a.params),n=c.generateOrdersFilters(e,a.params);r.activeProductFilters=t,o.$state.activeFilterValues=[].concat(_toConsumableArray(t),_toConsumableArray(n))};r.removeFilterTag=function(e){var t=c.removeFilterTag(e,r.query);a.go("storefronts.one.orders.list",_objectSpread(_objectSpread({},t),{},{storefrontId:r.storefront.id}),{reload:!0,inherit:!0})},r.checkOrder=function(){f(l.getSelectedOrdersCount,m(h))(r.orders)},r.checkAllOrders=function(e){r.allOrdersSelected=e.target.checked,r.allOrdersSelected?f(l.selectAllOrders,m(g),l.getSelectedOrdersCount,m(h))(r.orders):f(l.deselectAllOrders,m(g),l.getSelectedOrdersCount,m(h))(r.orders)},r.showBulkOperationModal=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"delivered",t=l.getSelectedOrderIds(r.orders),n={delivered:"modules/storefronts/views/one/orders/modals/bulk-mark-orders-delivered.html",cancelled:"modules/storefronts/views/one/orders/modals/bulk-mark-orders-cancelled.html",refunded:"modules/storefronts/views/one/orders/modals/bulk-mark-orders-refunded.html"}[e];i.openConfirm({template:n,scope:r,controller:"StorefrontsOrdersPopupCtrl",data:{orders:r.orders,orderIds:t,ordersCount:r.selectedOrdersCount,scope:r,refunds:r.refunds}}).then(function(){a.reload()})},r.showExport=function(){i.open({template:"/modules/storefronts/views/one/orders/modals/orders-export.html",controller:"ProductOrdersExportCtrl",width:700,showClose:!0,trapFocus:!1,appendClassName:"export-orders-modal",resolve:{DefaultKeys:["LocalAPI",function(e){return e.all("transaction_export_keys").getList()}]}})},r.$watch("query.search",_.debounce(function(e,t){e!==t&&a.go("storefronts.one.orders.list",_objectSpread({},r.query),{reload:!0,inherit:!0})},800)),r.clearOrderSearch=function(){r.query.search=""},r.resetFilters=function(){a.go(a.current,{id:a.params.id},{reload:!0,inherit:!1})},r.$on("activeOrderFetched",function(e,t){r.activeOrder=t});(function(){var e,n,t;r.generateOrdersFilters(["status","delivered","refunded","delivered_at","from","to","products"]),e=o.$state.activeFilterValues,n=angular.copy(e),t=c.getProductIdsFromFilters(n),Promise.all(t.map(function(e){return s.fetchProductById(e).then(function(e){r.$broadcast("fetchedProduct",e.data);var t=c.replaceProductFilterNames(e,n);o.$state.activeFilterValues=angular.copy(t)}).catch(function(e){return u.error("Product filters could not be updated",e)})}))})(),d.isOrdersTabVisited()||p(function(){introJs().addSteps(d.ordersTabIntroSteps).setOptions(d.introOptions).start().oncomplete(function(){d.setOrdersTabVisited()})},100)}]),OrderModule.controller("StorefrontsOrdersOverviewCtrl",["$scope","$state","$stateParams","activeOrder","Notification","StorefrontOrdersFactory","ProductFactory","ProductOrdersService","utils","ngDialog","$timeout","OrderLoggingService","OrderUtils",function(o,n,e,t,r,a,i,s,c,u,l,d,p){var f=c.pipeAsync,m=c.sideEffect,g=c.currencyBaseUnitToSubUnit,h=d.logOrderRefunded;o.refunds={refundPayment:!0,amountToRefund:null,maxRefundableAmount:null,merchantNote:null},o.activeOrder=t.data,o.activeOrderCopy=angular.copy(o.activeOrder),o.logs=[],o.logsCollapsed=!1,o.firstLetterOfPayerName=null,o.payerFullName=null,o.payerEmail=null,o.payerPhone=null,o.refundFormVisible=!1,o.hasDigitalProducts=o.activeOrder.items.some(function(e){return"digital"===e.product_level_type});var y=function(){o.refunds.amountToRefund=s.getRefundAmount(o.activeOrder.amount,o.activeOrder.shipping_fees,o.activeOrder.refunded_amount),o.refunds.maxRefundableAmount=angular.copy(o.refunds.amountToRefund)},b=function(e){return e&&e.payer&&e.payer.first_name||""},v=function(e){o.payerFullName=e},_=function(e){o.firstLetterOfPayerName=e},S=function(e){o.payerEmail=e},P=function(e){o.payerPhone=e},w=function(e){o.isActiveOrderDelivered="delivered"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderPaid="paid"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderCancelled="cancelled"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderRefunded=e.refunded,o.isActiveOrderNotFullyRefunded=e.refunded&&!e.fully_refunded,o.isActiveOrderFullyRefunded=e.refunded&&e.fully_refunded},C=function(e){o.logs=e};o.resetAmountToRefund=function(){o.refunds.amountToRefund=angular.copy(o.refunds.maxRefundableAmount)},o.toggleRefundForm=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];o.refundFormVisible=e},o.toggleRefundCheckbox=function(){o.refunds.refundPayment||(o.refunds.amountToRefund=angular.copy(o.refunds.maxRefundableAmount))};o.createVariantNameFromOrder=function(e){return p.createVariantNameFromOrder(e)},o.showCancelOrderModal=function(e){u.openConfirm({template:"modules/storefronts/views/one/orders/modals/cancel-order.html",scope:o,controller:"StorefrontsOrdersPopupCtrl",data:{payload:e,scope:o}}).then(function(){n.reload()})},o.showMarkOrderAsDeliveredModal=function(e){u.openConfirm({template:"modules/storefronts/views/one/orders/modals/mark-order-delivered.html",scope:o,controller:"StorefrontsOrdersPopupCtrl",data:{payload:e,scope:o}}).then(function(){n.reload()})},o.collapseLogs=function(){!function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];o.logsCollapsed=e}(!0)},o.refundOrder=function(){var e=g(o.refunds.amountToRefund),t={id:o.activeOrder.id,status:"refunded",amount_to_refund:e};i.updateOrderStatus(t).then(function(){r.success("Updated successfully","Order has been refunded successfully"),o.refundFormVisible=!1,o.$broadcast("orderRefunded"),h(o.activeOrder,e),n.reload()}).catch(function(e){r.error("Could not refund this order",e),o.$broadcast("orderRefunded",!1)})};o.activeOrder&&(o.$emit("activeOrderFetched",o.activeOrder),f(m(w),function(){return e=o.activeOrder,n=b(e),r=(t=e)&&t.payer&&t.payer.last_name||"","".concat(n," ").concat(r);var e,t,n,r},m(v),function(){return e=o.activeOrder,(t=b(e))&&t.substring(0,1)||"";var e,t},m(_),function(){return o.activeOrder.payer.email},m(S),function(){return function(e){if(e.payer){if(e.payer.international_format_phone)return e.payer.international_format_phone;if(e.payer.phone)return"+".concat(e.payer.phone)}return null}(o.activeOrder)},m(P),y,m(function(){o.refundButtonText=o.isActiveOrderNotFullyRefunded?"Complete refund":"Refund payment"}),function(){return a.fetchOrderLogs(e.orderId)},s.removeSameTimeLogs,m(C))(o.activeOrder).catch(function(e){r.error("Could not fetch this order",e)}).finally(function(){l(function(){o.$broadcast("fetchedActiveOrder")})})),o.showResendDigitalDownloadDialog=function(){u.open({template:"/modules/products/views/modals/resend-digital-download-link.html",controller:"OrdersPopupCtrl",scope:o,data:{order:o.activeOrder}})}}]),OrderModule.controller("StorefrontsOrdersPopupCtrl",["$scope","$state","Notification","ProductFactory","StorefrontOrdersFactory","OrderUtils","utils","OrderLoggingService",function(i,s,c,u,a,l,e,t){var d=e.pipe,p=e.currencyBaseUnitToSubUnit,n=i.ngDialogData.scope;i.closeCancelOrderModal=function(){i.closeThisDialog(),n.resetAmountToRefund()},i.cancelOrder=function(e){var t,n,r=(t={id:e.id,status:"cancelled"},n="Order has been cancelled successfully",i.refunds.refundPayment&&(t.status="refunded",t.amount_to_refund=p(Number(i.refunds.amountToRefund)),n="Order has been cancelled and refunded successfully"),i.refunds.merchantNote&&(t.merchant_note=i.refunds.merchantNote),{params:t,notification:n}),o=r.params,a=r.notification;u.updateOrderStatus(o).then(function(){c.success("Updated successfully",a),s.reload()}).catch(function(e){c.error("Could not cancel this order",e)})},i.markOrderAsDelivered=function(e){var t=e.id;u.updateOrderStatus({id:t,status:"delivered"}).then(function(){c.success("Updated successfully","Order has been marked as delivered"),s.reload()}).catch(function(e){c.error("Could not mark as delivered",e)})},i.markOrdersAsDelivered=function(e,t,n){if(d(l.getSelectedOrders,l.checkIsAnyOrderDelivered)(t))return c.error("Order statuses could not be updated","One or more orders are already delivered");a.bulkUpdateOrders({status:"delivered",orders:e}).then(function(){c.success("Order statuses updated","Marked as delivered"),n.toggleSelectingMultipleOrders(),s.reload()}).catch(function(e){c.error("Order statuses could not be updated",e)})},i.markOrdersAsCancelled=function(e,t,n){var r={status:"cancelled",orders:e},o="Marked as cancelled";if(d(l.getSelectedOrders,l.checkIsAnyOrderCancelled)(t))return c.error("Order statuses could not be updated","One or more orders are already cancelled");n.refunds.refundPayment&&(r.refund_customer=!0,o="Marked as refunded"),a.bulkUpdateOrders(r).then(function(){c.success("Order statuses updated",o),n.toggleSelectingMultipleOrders(),s.reload()}).catch(function(e){c.error("Order statuses could not be updated",e)})},i.markOrdersAsRefunded=function(e,t,n){if(d(l.getSelectedOrders,l.checkIsAnyRefundedOrder)(t))return c.error("Order statuses could not be updated","One or more orders are already refunded");a.bulkUpdateOrders({status:"refunded",orders:e}).then(function(){c.success("Order statuses updated","Marked as refunded"),n.toggleSelectingMultipleOrders(),s.reload()}).catch(function(e){var t=e&&e.data&&e.data.data&&e.data.data.failed;t&&t.length?t.forEach(function(e){return c.error("Order ID: ".concat(e.id),e.message)}):c.error("Order statuses could not be updated",e)})}}]),OrderModule.controller("StorefrontsOrdersShippingCtrl",["$scope","activeOrder","StorefrontOrdersFactory","Notification","utils","OrderUtils","CountryService","$state","$timeout","OrderLoggingService",function(t,e,n,r,o,a,i,s,c,u){var l=o.pipeAsync,d=o.sideEffect,p=u.logAddressFieldsEvent;t.activeOrder=e.data,t.activeOrderCopy=angular.copy(t.activeOrder),t.editingShippingDetails=!1,t.editing=!1,t.countriesList=[],t.availableRegions=_.flatten(t.storefront.shipping_fees),t.phone={selectedCallingCode:t.activeOrder&&t.activeOrder.shipping&&t.activeOrder.shipping.agent&&t.activeOrder.shipping.agent.calling_code||"234"},t.isDeliveryAgentAvailable=!1,t.firstLetterOfAgentName=null,t.agentFullName=null,t.agentPhone=null,t.shippingInfoForm={},t.deliveryAgentForm={};var f=function(e){t.firstLetterOfAgentName=e},m=function(e){t.agentFullName=e},g=function(e){t.agentPhone=e},h=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t.editingShippingDetails=e,t.editingDeliveryAgent=e};t.toggleEditingShippingDetails=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t.editingShippingDetails=e,t.editingDeliveryAgent=!1},t.toggleEditingDeliveryAgent=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t.editingDeliveryAgent=e,t.editingShippingDetails=!1},t.cancelEdit=function(){h(!1),t.activeOrderCopy=angular.copy(t.activeOrder),t.deliveryAgentForm.formElement.$setPristine(),t.deliveryAgentForm.formElement.$setUntouched(),t.shippingInfoForm.formElement.$setPristine(),t.shippingInfoForm.formElement.$setUntouched()},t.saveShippingDetails=function(){n.updateOrderShipment(t.activeOrderCopy,t.storefront).then(function(){h(!1),r.success("Updated successfully","Shipment info changed"),s.reload()}).catch(function(e){r.error("Shipment info could not be saved",e)}),p()},t.saveDeliveryAgentDetails=function(){var e={agent:{first_name:t.activeOrderCopy.shipping.agent.first_name,last_name:t.activeOrderCopy.shipping.agent.last_name,calling_code:t.phone.selectedCallingCode,phone_number:t.activeOrderCopy.shipping.agent.phone_number,delivery_company:t.activeOrderCopy.shipping.agent.delivery_company,delivery_tracking_link:t.activeOrderCopy.shipping.agent.delivery_tracking_link}};n.saveDeliveryAgent(t.activeOrderCopy.id,e).then(function(){h(!1),r.success("Updated successfully","Shipment info changed"),s.reload()}).catch(function(e){r.error("Shipment info could not be saved",e)})};var y=function(e){t.countriesList=e};t.activeOrder&&(t.$emit("activeOrderFetched",t.activeOrder),t.isDeliveryAgentAvailable=t.activeOrderCopy.shipping&&t.activeOrderCopy.shipping.agent&&t.activeOrderCopy.shipping.agent.phone_number,l(a.getFirstLetterOfAgentName,d(f),function(){return a.getAgentFullName(t.activeOrder)},d(m),function(){return a.getAgentPhone(t.activeOrder)},d(g),i.getCountries,a.removeFirstCharFromPhoneCodes,d(y))(t.activeOrder).catch(function(e){r.error("Could not fetch this order",e)}).finally(function(){c(function(){t.$broadcast("fetchedActiveOrder")})}))}]);_excluded=["id"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}OrderModule.factory("StorefrontOrdersFactory",["API","$stateParams",function(o,e){return{fetchOrders:function(){return o.one("order").get(e)},fetchOrdersByFilter:function(e){return o.one("order".concat(e)).get()},fetchOrder:function(e){return o.one("order",e).get()},fetchOrderLogs:function(e){return o.one("order/".concat(e,"/log")).get().then(function(e){return e.data})},fetchProducts:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return o.one("product").get(e)},fetchProductById:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return o.one("product",e).get()},bulkUpdateOrders:function(e){return o.one("order").customPUT(e)},saveDeliveryAgent:function(e,t){return o.one("order",e).customPUT(t)},fetchPendingOrdersCount:function(){return o.one("order/metrics").get().then(function(e){return e.data.pending_orders_count})},updateOrderShipment:function(t,e){var n={},r=e.shipping_fees.find(function(e){return t.shipping_method.name===e.name});return n.shipping=_objectSpread({},t.shipping),n.shipping_method={name:r.name,currency:r.currency,amount:r.fee},o.one("order",t.id).customPUT(n)},exportStorefrontOrdersToCsv:function(e,t){var n=t.id,r=_objectWithoutProperties(t,_excluded);return o.one("storefront/".concat(n,"/order/export?export_columns=").concat(e)).get(_objectSpread({},r))}}}]),angular.module("app.transfers").controller("BulkTransferProgressCtrl",["$state","$scope","$timeout","$q","API","Notification","Session","LocalService","BankService","ngDialog",function(e,t,n,r,o,a,i,s,c,u){var l="transfer_batch_upload_"+e.params.id,d=s.get(l);if(d){c.init({currency:d.transfers[0].currency}),t.batchDate=d.date,t.batch=_.map(d.transfers,function(e){return e.status=e.status||"pending",e.rawObject=function(){return _.pick(e,["amount","note","reference","recipient_code","recipient"])},e.retry=function(){f(this)},e.requery=function(){var n;(n=this).result.status="requery",o.one("transfer",n.result.id).get().then(function(e){n.result=e.data,n.recipient={account_name:e.data.recipient.name,account_number:e.data.recipient.details.account_number},n.bank={name:e.data.recipient.details.bank_name,code:e.data.recipient.details.bank_code};var t=d.hasHeader?n.index-1:n.index;d.content[t]=n,s.set(l,d)})},e}),t.pendingTransfers=function(){return _.filter(t.batch,function(e){return e.result&&"pending"===e.result.status})},t.retryPending=function(){_.each(t.batch,function(e){e.result&&"pending"===e.result.status&&e.requery()})},t.failedTransfers=function(){return _.filter(t.batch,function(e){return e.result&&"failed"===e.result.status})},t.clearSelection=function(){_.each(t.batch,function(e){e.selected=!1}),t.selectedForRetry=[]},t.getItemsForRetry=function(){t.selectedForRetry=t.batch.filter(function(e){return e.selected})},t.retrySelectedFailed=function(){_.each(t.batch,function(e){e.selected&&e.retry()})},t.retryAllFailed=function(){_.each(t.batch,function(e){e.result&&"failed"===e.result.status&&e.retry()})};var p=r.when();_.each(t.batch,function(e){p=p.then(function(){return f(e)})}),t.updateTransfer=function(n){u.openConfirm({template:"updateTransfer",showClose:!0,closeByDocument:!1,controller:["$scope",function(t){c.getBanks().then(function(e){t.banks=e}),t.selectedTransfer=angular.copy(n),t.selectedTransfer.recipient_type=n.recipient_code?"Use recipient code":"Enter recipient details",t.selectedTransfer.resetRecipient=function(){t.selectedTransfer.recipient_code=null,t.selectedTransfer.recipient={}}}]}).then(function(e){var t=_.pick(e,["amount","note","recipient_code","recipient","reference"]);(n=angular.extend(n,t)).result=null,n.retry()})}}function f(t){var n=r.defer();return t.result&&-1<["success","pending"].indexOf(t.result.status)?(t.exists=!0,"pending"===t.result.status&&t.requery(),n.resolve()):(t.status="processing",(t.recipient_code?Promise.resolve():o.all("transferrecipient").post({type:"NGN"===t.currency?"nuban":"",currency:t.currency,bank_code:t.recipient.bank_code,account_number:t.recipient.account_number,name:t.recipient.account_name,email:t.recipient.email}).then(function(e){t.recipient_code=e.data.recipient_code})).then(function(){return o.all("transfer").post({source:"balance",amount:(100*t.amount).toFixed(),currency:t.currency,reason:t.reason,recipient:t.recipient_code,reference:t.reference})}).then(function(e){if(t.result=e.data,t.status="success",!t.recipient)return o.one("transferrecipient",e.data.recipient).get().then(function(e){t.recipient={account_name:e.data.name,account_number:e.data.details.account_number},t.bank={name:e.data.details.bank_name,code:e.data.details.bank_code}}).catch(function(){return!0})}).then(function(){var e=d.hasHeader?t.index-1:t.index;d.content[e]=t,s.set(l,d),n.resolve()}).catch(function(e){e&&e.data&&(t.error=e.data.message,t.status="failed",t.result=e.data,t.result.status="failed"),n.resolve()})),n.promise}}]),angular.module("app.transfers").controller("BulkTransferStartCtrl",["$state","$scope","API","$q","Notification","BankService","LocalService","BulkTransferService","ngDialog",function(t,r,e,o,n,a,i,s,c){var u="transfer_batch_upload_"+t.params.id;if(r.batch=i.get(u),r.batch){r.csv={processing:!1,transfers:null,isValid:function(){return!!r.csv.transfers&&_.every(r.csv.transfers,"is_valid")},hasNoDuplicates:function(){return!!r.csv.transfers&&0===r.csv.transfers.filter(function(e){return e.is_duplicated}).length}},r.loadCSV=function(){r.csv.processing=!0,a.init({}).then(function(){return l()}).then(function(e){r.csv.processing=!1,r.csv.is_uploaded=!0,r.csv=angular.extend(r.csv,e),r.csv.transfers=_.sortBy(r.csv.transfers,"is_valid")}).catch(function(e){r.csv.processing=!1,n.error("There was a problem parsing your CSV",e)})},r.loadCSV();var l=function(){var e=o.defer(),t=r.highlightDuplicates(r.batch.transfers),n=s.processCSV(t);return e.resolve({transfers:n}),e.promise};r.resetDuplicates=function(e){return _.map(e,function(e){return e.is_duplicated=!1,e.duplicate_group=null,e})},r.highlightDuplicates=function(e){for(var t=0,n=0;n<e.length;n++){for(var r=0;r<e.length;r++)n!==r&&e[n].join()===e[r].join()&&(e[n].is_duplicated=!0,e[r].is_duplicated=!0,e[n].duplicate_group=t,e[r].duplicate_group=t);t++}return e},r.updateTransfer=function(n,e){c.openConfirm({template:"modules/transfers/bulk-upload/modals/update-csv.html",showClose:!0,closeByDocument:!1,controller:["$scope",function(t){a.getBanks().then(function(e){t.banks=e}),t.selectedTransfer=angular.copy(n),t.selectedTransfer.recipient_type=n.recipient_code?"Use recipient code":"Enter recipient details",t.selectedTransfer.resetRecipient=function(){t.selectedTransfer.recipient_code=null,t.selectedTransfer.recipient={}}}]}).then(function(e){var t=_.pick(e,["amount","note","recipient_code","reference","account_name","account_number","email","bank","bank_code_slug"]);(n=angular.extend(n,t)).validate()})},r.viewMatchingDuplicates=function(e,n){c.openConfirm({template:"modules/transfers/bulk-upload/modals/view-duplicates.html",showClose:!0,width:700,controller:["$scope",function(t){t.duplicatesRemoved=[],t.duplicates=_.filter(e,function(e){return e.duplicate_group===n.duplicate_group}),t.removeDuplicate=function(e){t.duplicatesRemoved.push(t.duplicates.splice(e,1)[0])}}]}).then(function(e){var t=_.difference(r.csv.transfers,e.duplicatesRemoved);r.resetDuplicates(e.duplicates),r.csv.transfers=t})},r.start=function(){if(r.csv.isValid()){var e=uuidv4();i.set("transfer_batch_upload_"+e,{date:new Date,transfers:r.csv.transfers}),t.go("transfers.bulk-upload.progress",{id:e})}}}}]),angular.module("app.transfers").controller("BulkTransferViewCtrl",["$scope","$q","Notification","balances","Session","DEFAULTS","LocalService","$state","BankService","TransferService",function(c,t,n,e,r,o,a,i,s,u){function l(){var e=_.contains(c.headers,"Transfer Amount"),t=_.contains(c.headers,"Recipient Code")||3===_.intersection(c.headers,["Bank Code or Slug","Account Number","Account Name"]).length;return e&&t}c.csv={processing:!1,transfers:null,isValid:function(){return!!c.csv.transfers&&l(c.csv.transfers)}},c.options={activeCurrency:r.get("account").default_currency},c.banks=[],c.updateBanks=function(){s.init({currency:c.options.activeCurrency}).then(function(e){c.banks=e})},c.updateBanks(),c.balances=e.data,c.activeBalance=function(){return _.findWhere(c.balances,{currency:c.options.activeCurrency})},c.balanceSufficient=function(){if(0===c.activeBalance().balance)return!1;var e=o.minimumTransfer[c.activeBalance().currency]||0,t=u.getTransferCharge({amount:c.activeBalance().balance,currency:c.activeBalance().currency});return c.activeBalance().balance>e+t},c.$on("uploaded_transfers",function(e,t){return c.csv.processing=!0,d(t).then(function(e){c.csv.processing=!1,c.csv.is_uploaded=!0,c.csv=angular.extend(c.csv,e)}).catch(function(e){c.csv.processing=!1,n.error("There was a problem parsing your CSV",e)})}),c.setColumn=function(e,t){var n=c.headers.indexOf(t);-1<n&&(c.headers[n]=null),c.headers[e]=t},c.hasEnoughColumns=function(){return 0===_.filter(c.headers,function(e){return c.permittedHeaders.indexOf(e)<=-1}).length&&!l(c.csv.transfers)},c.permittedHeaders=["Transfer Amount","Transfer Note","Transfer Reference","Recipient Code","Bank Code or Slug","Account Number","Account Name","Email Address"],c.headers=[];c.columnIsDiscarded=function(e){return c.csv.isValid()&&null===c.headers[e]};var d=function(e){var s=t.defer();return Papa.parse(e,{complete:function(e){if(e.data.length){var t,n,r=e.data[0],o=_.every(r,function(e){return isNaN(e)||""===e});if(c.generatedHeaders=[],c.headers=o?_.map(r,function(e){return"Transfer Note (Optional)"===e?"Transfer Note":"Transfer Reference (Optional)"===e?"Transfer Reference":"Recipient Code (This overrides all other details if available)"===e?"Recipient Code":"Account Name (Optional)"===e?"Account Name":"Email Address (Optional)"===e?"Email Address":e}):c.generatedHeaders,l(e.data))c.continueToValidation(e.data);else if(o)e.data.shift();else for(var a=(t=e.data,n=_.map(t,function(e){return e.length}),Math.max.apply(null,n)),i=0;i<a;i++)c.generatedHeaders[i]=null;s.resolve({transfers:e.data})}else s.reject("Please upload a CSV with data")}}),s.promise};c.continueToValidation=function(e){if(e||c.csv.isValid()){!e&&c.csv.transfers.unshift(c.headers);var t=uuidv4();a.set("transfer_batch_upload_"+t,{date:new Date,transfers:e||c.csv.transfers}),i.go("transfers.bulk-upload.start",{id:t})}}}]),angular.module("app.transfers").service("BulkTransferService",["BankService","Session","utils","$timeout",function(c,t,n,e){var u=function(e){var t=e,n=null;return e?isNaN(+e)||0==+e?n="Transfer amount is invalid":t=parseFloat(String(e).replace(/\,/g,"")):n="Transfer amount is required",{value:t,error:n,is_valid:!n}},l=function(e){e=e.toLowerCase();var t=null;return!1===/^[a-z0-9-_]+$/.test(String(e))&&(t="Reference should be unique, in lowercase, and contain no special characters"),{value:e.trim(),error:t,is_valid:!t}},d=function(e){var t=null;return"RCP"!==(e=e.replace(/\s/g,"")).substring(0,3)&&(t="Recipient Code should always start with RCP"),{value:e.trim(),error:t,is_valid:!t}},p=function(e){var t=null,n=null;return e?(e=e.toLowerCase().replace(/\s/g,""),(n=c.getBank(e))||(t="Invalid Bank Code or Slug")):t="Recipient Code or Bank Information required",{value:e,bank:n,error:t,is_valid:!t}},f=function(e,t){var n=null,r=e&&e.trim();if(e){var o="Account number is invalid";(!_.isNumber(parseInt(e))||"NGN"===t&&10!==r.length&&(o="Please use a 10-digit NUBAN number"))&&(n=o)}else n="Recipient Code or Bank Information required";return{value:r,error:n,is_valid:!n}},m=function(e){var t=null;return n.isEmail(e)||(t="Email is not valid."),{value:e,error:t,is_valid:!t}};function r(e){angular.extend(this,e),this.errors={},this.warnings={},this.is_valid=!1,this.currency=t.get("account").default_currency,this.validate=function(){var t=this;this.errors={};var e=u(this.amount);if(this.amount=e.value,this.errors.amount=e.error,this.reference){var n=l(this.reference);this.reference=n.value,this.errors.reference=n.error}if(this.recipient_code){var r=d(this.recipient_code);this.recipient_code=r.value,this.errors.recipient_code=r.error}else{var o=p(this.bank_code_slug),a=f(this.account_number,this.currency);if(this.errors.account_number=a.error,this.errors.bank_code_slug=o.error,this.email){var i=m(this.email);this.email=i.value,this.errors.email=i.error}this.bank=o.bank,this.bank&&a.is_valid&&(this.account_number=a.value,this.resolving_account_number=!0,c.resolve(this.account_number,this.bank.code).then(function(e){if(!t.recipient.account_name)return t.recipient.account_name=e.account_name,void(t.resolving_account_number=!1);t.resolving_account_number=!1,"unconfirmed"!==e&&t.account_name&&!function(e,t){e=e.replace(/[^A-Za-z]/gi,"").toLowerCase(),t=t.replace(/[^A-Za-z]/gi,"").toLowerCase();var n=function(e){return e.split("").sort().join("")};return n(e)===n(t)}(t.account_name,e.account_name)&&(t.warnings.account_name="Account name provided does not match actual account name: "+e.account_name)})),this.recipient={bank_code:this.bank?this.bank.code:null,account_number:a.value,account_name:this.account_name,email:this.email}}var s=_.values(this.errors);this.is_valid=0===s.filter(function(e){return null!==e}).length},this.validate()}return{createTransfer:function(e){return new r(e)},processCSV:function(e){var t=e[0],n={};_.each(t,function(e,t){"Transfer Amount"===e?n.amount=t:"Transfer Note (Optional)"===e||"Transfer Note"===e?n.note=t:"Transfer Reference (Optional)"===e||"Transfer Reference"===e?n.reference=t:"Recipient Code (This overrides all other details if available)"===e||"Recipient Code"===e?n.recipient_code=t:"Bank Code or Slug"===e?n.bank_code_slug=t:"Account Number"===e?n.account_number=t:"Account Name (Optional)"===e||"Account Name"===e?n.account_name=t:"Email Address (Optional)"!==e&&"Email Address"!==e||(n.email=t)}),e.shift();var r=_.map(e,function(e){return{amount:e[n.amount],note:e[n.note],reference:e[n.reference],recipient_code:e[n.recipient_code],bank_code_slug:e[n.bank_code_slug],account_number:e[n.account_number],account_name:e[n.account_name],email:e[n.email],is_duplicated:e.is_duplicated||!1,duplicate_group:e.duplicate_group||null}});return _.map(r,this.createTransfer)}}}]),AccessModule.directive("downloadApp",["AmplitudeService","DeviceService","$stateParams",function(r,o,a){return{restrict:"E",scope:{copyTitle:"@",copyAbout:"@",linkPrimary:"@",linkPrimaryText:"@",linkSecondary:"@",linkSecondaryText:"@",buttonDismiss:"@"},template:'\n    <div class="download-app" ng-if="platform && showModal">\n      <div ng-if="!closed" class="download-app-overlay animated fadeIn" ng-click="dismiss()" ng-class="{\'fadeOut\': closing}"></div>\n      <div class="download-app-content animated fadeInUp" ng-class="{\'slideOutDownFull\': closing}">\n          <div class="download-app-icon">\n              <img src="assets/img/flag-icon.gif" alt="Animated flag" />\n          </div>\n          <p class="font-bold">{{copyTitle}}</p>\n          <p>{{copyAbout}}</p>\n          <div class="download-app-cta">\n              <a target="_blank" href="{{linkPrimary}}" rel="noopenner noreferrer" class="button button--primary button--wide" ng-if="linkPrimary" ng-click="logEvent(\'Clicked Download app\')">\n                  {{linkPrimaryText}}&nbsp;<device />\n              </a>\n              <a target="_blank" href="{{linkSecondary}}" rel="noopenner noreferrer" class="button button--wide" ng-if="linkSecondary" ng-click="logEvent(\'Clicked Learn more about app\')">\n                  {{linkSecondaryText}}\n              </a>\n              <button class="button button--wide" ng-click="dismiss()" ng-if="buttonDismiss" ng-click="logEvent(\'Clicked Dismiss app\')">\n                  {{buttonDismiss}}\n              </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',link:function(e){var t=o.platform;e.platform=t;var n=r.logEvent;e.logEvent=n;e.showModal=!["app.settings.compliance"].includes(a.next),e.dismiss=function(){e.closing=!0,setTimeout(function(){e.closed=!0},1e3)}}}}]),AccessModule.directive("emailSuggestion",[function(){return{restrict:"A",require:["ngModel"],link:function(t,e,n,r){var o=r[0],a=n.emailSuggestion;Mailcheck.defaultTopLevelDomains.push("com.ng","ng","io","me");t.$watch(function(){return o.$viewValue},function(e){Mailcheck.run({email:e,secondLevelDomains:["yahoo","hotmail","mail","live","outlook"],suggested:function(e){t[a]=e.full},empty:function(){t[a]=null}})})}}}]),AccessModule.directive("validatePassword",[function(){return{restrict:"E",scope:{checker:"=",formField:"="},templateUrl:"modules/access/directives/validate-password.html"}}]),AccessModule.factory("PasswordValidator",[function(){var t={hasLowerCase:function(e){return/[a-z]/.test(e)},hasUpperCase:function(e){return/[A-Z]/.test(e)},hasSpecialCharacter:function(e){return/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/.test(e)},hasNumber:function(e){return/[0-9]/.test(e)},hasValidLength:function(e){return/.{8,}$/.test(e)},isValid:function(e){return/^(?=.*[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~])(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]).{8,}$/.test(e)},validate:function(e){return{hasLowerCase:t.hasLowerCase(e),hasUpperCase:t.hasUpperCase(e),hasSpecialCharacter:t.hasSpecialCharacter(e),hasNumber:t.hasNumber(e),hasValidLength:t.hasValidLength(e),isValid:t.isValid(e)}}};return t}]),angular.module("app.audit-logs").controller("AuditLogsCtrl",["$scope","$state","$stateParams","AuditLogsData","Notification",function(t,e,n,r,o){t.query=angular.copy(n),t.selectedActivity=null,r.fetch().then(function(e){t.activityLogs=r.transformData(e),t.meta=r.meta,t.hasActivityLogs=t.activityLogs&&0<t.activityLogs.length,t.$broadcast("fetchedActivityLogs")}).catch(function(e){var t=e&&e.message||"We could not retrieve your audit logs";o.error("Error Ocurred",t)}),t.showActivityDetails=function(e){t.selectedActivity=e},r.fetchTeam().then(function(e){t.team=e.data}).catch(function(e){var t=e&&e.message||"We could not retrieve your team list";o.error("Error Ocurred",t)}),t.onUserSelected=function(e){t.query.performed_by=e&&e.email},t.onActionSelected=function(e){t.query.action=e&&e.key},t.actions=Object.keys(r.actions).map(function(e){return{key:e,name:r.actions[e].contextualSubtext}}),t.setSelectedAction=function(e){t.query.action=e.action}}]),angular.module("app.audit-logs").directive("activityLogChangesHeader",function(){return{restrict:"E",scope:{numberOfChanges:"=",action:"="},template:'\n      <span class="font-bold font-size-md l-h-2x" ng-if="action.canDisplayChanges && numberOfChanges > 0">\n        {{ numberOfChanges }} Change{{ numberOfChanges > 1 ? \'s\' : \'\'}}\n      </span>\n      <span ng-if="action" ng-class="{\'pull-right\':  action.canDisplayChanges && numberOfChanges > 0}">\n        <a class="button" rel="noreferrer" target="_blank" href="{{ action.url }}">\n          {{ action.text }}\n        </a>\n      </span>\n    '}}),angular.module("app.audit-logs").directive("activityLogAbout",function(){return{restrict:"E",scope:{name:"=",email:"=",roleName:"=",ipAddress:"=",performedAt:"="},template:'\n      <div class="row text-block">\n        <div class="col-xs-6 m-b-md">\n            <p class="text-muted">User</p>\n            <a ui-sref="app.settings.team"><span class="text-capitalize text-primary">{{ name }}</span></a>\n        </div>\n        <div class="col-xs-6 m-b-md">\n            <div>\n                <p class="text-muted">Email</p>\n                <span>{{ email }}</span>\n            </div>\n        </div>\n        <div class="col-xs-6 m-b-md">\n            <p class="text-muted">Role</p>\n            <span class="text-capitalize">{{ roleName }}</span>\n        </div>\n        <div class="col-xs-6 m-b-md">\n            <div>\n                <p class="text-muted">IP Address</p>\n                <span>{{ ipAddress }}</span>\n            </div>\n        </div>\n        <div class="col-xs-6 m-b-md">\n            <div>\n                <p class="text-muted">Date</p>\n                <span> {{ performedAt }}\n                </span>\n            </div>\n        </div>\n      </div>\n    '}}),angular.module("app.audit-logs").directive("activityLogChange",function(){return{restrict:"E",scope:{field:"=",from:"=",to:"="},template:'\n      <ul class="list-group" >\n        <li class="list-group-item padder-md font-bold text-capitalize activity-log__change header">\n            {{ field }} </li>\n        <li class="list-group-item padder-md activity-log__change item" ng-if="from"><i\n                class="fa fa-minus text-muted activity-log__change removed-item"></i>\n            <span class="padder-left-sm ">{{ from }}</span></li>\n        <li class="list-group-item padder-md activity-log__change item" ng-if="to"><i\n                class="fa fa-plus text-muted activity-log__change added-item"></i>\n            <span class="font-bold padder-left-sm"> {{ to }} </span></li>\n      </ul>\n    '}}),angular.module("app.audit-logs").factory("AuditLogsData",["API","$stateParams","utils",function(t,n,P){var w={data:[],meta:{},actions:{added_a_customer:{canDisplayChanges:!1,contextualSubtext:"added a customer",contextualLinkText:"View customer",getContextualLinkPath:function(e){return"/#/customers/".concat(e.id,"/transactions")}},created_an_invoice:{canDisplayChanges:!1,contextualSubtext:"created a new invoice",contextualLinkText:"View invoice",getContextualLinkPath:function(e){return"/#/invoices/".concat(e.id)}},updated_an_invoice:{canDisplayChanges:!1,contextualSubtext:"updated an invoice",contextualLinkText:"View invoice",getContextualLinkPath:function(e){return"/#/invoices/".concat(e.id)}},sent_notification_for_an_invoice:{canDisplayChanges:!1,contextualSubtext:"sent notification for an invoice",contextualLinkText:"View invoice",getContextualLinkPath:function(e){return"/#/invoices/".concat(e.id)}},generated_pdf_for_an_invoice:{canDisplayChanges:!1,contextualSubtext:"generated pdf for an invoice",contextualLinkText:"Download invoice",getContextualLinkPath:function(e){return"/#/invoices/".concat(e.id)}},archived_an_invoice:{canDisplayChanges:!1,contextualSubtext:"archived an invoice"},marked_an_invoice_as_paid:{canDisplayChanges:!1,contextualSubtext:"marked an invoice as paid",contextualLinkText:"View invoice",getContextualLinkPath:function(e){return"/#/invoices/".concat(e.id)}},created_a_plan:{canDisplayChanges:!1,contextualSubtext:"created a new plan",contextualLinkText:"View plan",getContextualLinkPath:function(e){return"/#/plans/".concat(e.id)}},deleted_a_plan:{canDisplayChanges:!1,contextualSubtext:"deleted a plan"},updated_a_plan:{canDisplayChanges:!0,contextualSubtext:"updated a plan",contextualLinkText:"View plan",getContextualLinkPath:function(e){return"/#/plans/".concat(e.id)}},refunded_a_customer:{canDisplayChanges:!1,contextualSubtext:"refunded a customer",contextualLinkText:"View transaction",getContextualLinkPath:function(e){return"/#/transactions/".concat(e.transaction.id)}},created_a_role:{canDisplayChanges:!1,contextualSubtext:"created a new role",contextualLinkText:"View roles",getContextualLinkPath:function(){return"/#/settings/team/roles"}},updated_a_role:{canDisplayChanges:!0,contextualSubtext:"updated a role",contextualLinkText:"View roles",getContextualLinkPath:function(){return"/#/settings/team/roles"}},deleted_a_role:{canDisplayChanges:!1,contextualSubtext:"deleted a role"},created_a_subaccount:{canDisplayChanges:!1,contextualSubtext:"created a new subaccount",contextualLinkText:"View subaccounts",getContextualLinkPath:function(){return"/#/subaccounts"}},updated_a_subaccount:{canDisplayChanges:!0,contextualSubtext:"updated a subaccount",contextualLinkText:"View subaccounts",getContextualLinkPath:function(){return"/#/subaccounts"}},deleted_a_subaccount:{canDisplayChanges:!1,contextualSubtext:"deleted a subaccount",contextualLinkText:"View subaccounts",getContextualLinkPath:function(){return"/#/subaccounts"}},exported_transfers:{canDisplayChanges:!1,contextualSubtext:"exported a transfers CSV",contextualLinkText:"Download the exported file",getContextualLinkPath:function(e){return e}},created_a_transfer:{canDisplayChanges:!1,contextualSubtext:"initiated a transfer",contextualLinkText:"View transfer",getContextualLinkPath:function(e){return"/#/transfers/".concat(e.id)}},created_a_transfer_recipient:{canDisplayChanges:!1,contextualSubtext:"added a new transfer recipient"},deleted_a_transfer_recipient:{canDisplayChanges:!1,contextualSubtext:"deleted a transfer recipient"},updated_a_transfer_recipient:{canDisplayChanges:!0,contextualSubtext:"updated a transfer recipient"},created_a_payment_page:{canDisplayChanges:!1,contextualSubtext:"added a new payment page",contextualLinkText:"View page",getContextualLinkPath:function(e){return"/#/pages/".concat(e.id)}},updated_a_payment_page:{canDisplayChanges:!0,contextualSubtext:"updated a payment page",contextualLinkText:"View page",getContextualLinkPath:function(e){return"/#/pages/".concat(e.id)}},generated_a_dedicated_nuban:{canDisplayChanges:!0,contextualSubtext:"generated a dedicated NUBAN",contextualLinkText:"View customer",getContextualLinkPath:function(e){return"/#/customers/".concat(e.customer.customer_code,"/transactions")}},deactivated_a_dedicated_nuban:{canDisplayChanges:!0,contextualSubtext:"deactivated a dedicated NUBAN",contextualLinkText:"View customer",getContextualLinkPath:function(e){return"/#/customers/".concat(e.customer.customer_code,"/transactions")}},exported_transactions:{canDisplayChanges:!1,contextualSubtext:"exported a transactions CSV",contextualLinkText:"Download the exported file",getContextualLinkPath:function(e){return e}},resolved_a_dispute:{canDisplayChanges:!1,contextualSubtext:"resolved a dispute",contextualLinkText:"View dispute",getContextualLinkPath:function(e){return"/#transactions/".concat(e.transaction,"/dispute")}},commented_on_a_dispute:{canDisplayChanges:!1,contextualSubtext:"commented on a dispute"},deleted_a_dispute_comment:{canDisplayChanges:!1,contextualSubtext:"deleted a dispute",contextualLinkText:"View dispute",getContextualLinkPath:function(e){return"/#transactions/".concat(e,"/dispute")}},uploaded_evidence_for_a_dispute:{canDisplayChanges:!1,contextualSubtext:"uploaded evidence for a dispute",contextualLinkText:"View dispute",getContextualLinkPath:function(e){var t=e.dispute;return"/#transactions/".concat(t.transaction,"/dispute")}},exported_disputes:{canDisplayChanges:!1,contextualSubtext:"exported a disputes CSV",contextualLinkText:"Download the exported file",getContextualLinkPath:function(e){return e}},added_a_settlement_account:{canDisplayChanges:!1,contextualSubtext:"added a new settlement account",contextualLinkText:"View settlement accounts",getContextualLinkPath:function(){return"/#/settings/accounts"}},updated_webhook_url:{canDisplayChanges:!0,contextualSubtext:"updated webhook URL",contextualLinkText:"View settings",getContextualLinkPath:function(){return"/#/settings/developer"}},enabled_currency:{canDisplayChanges:!0,contextualSubtext:"enabled currency"},disabled_currency:{canDisplayChanges:!0,contextualSubtext:"disabled currency"},removed_a_user:{canDisplayChanges:!1,contextualSubtext:"removed team member",contextualLinkText:"View team",getContextualLinkPath:function(){return"/#/settings/team"}},invited_a_user:{canDisplayChanges:!1,contextualSubtext:"invited team member",contextualLinkText:"View team",getContextualLinkPath:function(){return"/#/settings/team"}},enabled_international_toggle:{canDisplayChanges:!1,contextualSubtext:"enabled international payments",contextualLinkText:"View settings",getContextualLinkPath:function(){return"/#/settings/preferences"}},requested_international:{canDisplayChanges:!1,contextualSubtext:"requested international payments",contextualLinkText:"View settings",getContextualLinkPath:function(){return"/#/settings/preferences"}},changed_settlement_schedule:{canDisplayChanges:!1,contextualSubtext:"changed settlement schedule",contextualLinkText:"View settings",getContextualLinkPath:function(){return"/#/settings/preferences"}},exported_payouts:{canDisplayChanges:!1,contextualSubtext:"exported a payout CSV -",contextualLinkText:"Download the exported file",getContextualLinkPath:function(e){return e}},upgraded_business:{canDisplayChanges:!1,contextualSubtext:"upgraded this business"},login:{canDisplayChanges:!1,contextualSubtext:"logged in"},reset_password:{canDisplayChanges:!1,contextualSubtext:"reset password"},updated_profile:{canDisplayChanges:!1,contextualSubtext:"updated profile information"},switched_display_state:{canDisplayChanges:!1,contextualSubtext:"switched display state"},enabled_apple_pay:{canDisplayChanges:!1,contextualSubtext:"enabled apple pay"},disabled_apple_pay:{canDisplayChanges:!1,contextualSubtext:"disabled apple pay"},enabled_paypal:{canDisplayChanges:!1,contextualSubtext:"enabled paypal"},disabled_paypal:{canDisplayChanges:!1,contextualSubtext:"disabled paypal"}},fetch:function(){var e=angular.copy(n);return t.one("auditlog").get(e).then(function(e){return w.meta=e.meta,w.data=e.data,w.data})},fetchTeam:function(){return t.one("integration/users").get()},transformData:function(e){return e.map(function(e){var t=e.id,n=e.name,r=e.action,o=e.delta,a=e.performed_at,i=e.ip_address,s=e.role_name,c=e.performed_by,u=e.object,l=P.isObject(u)?u:JSON.parse(u),d=l&&(r.includes("nuban")?"for ".concat(l.customer.email):P.toTitleCase(l.name)),p=n&&n.split(" ")[0]||n,f=w.actions[r]&&w.actions[r].contextualSubtext||r&&r.split("_").join(" "),m=moment(a).format("D MMM, YYYY - H:MM a"),g=i&&i.split(",")[0],h=moment(a).calendar(null,{sameDay:function(){return"[".concat(this.fromNow(),"]")},lastDay:function(){return"[Yesterday - ".concat(this.format("H:MM a"),"]")},lastWeek:function(){return"[".concat(this.format("D MMM, YYYY - H:MM a"),"]")},sameElse:function(){return"[".concat(this.format("D MMM, YYYY - H:MM a"),"]")}}),y=(o?Object.keys(o):[]).filter(function(e){return!["updatedAt","columns","active"].includes(e)}),b=w.actions[r]&&w.actions[r].canDisplayChanges,v=y&&y.length,_=1===v?y[0]:2===v?y.join(" and "):2<v?"".concat(y[0]," & ").concat(y.length-1," other properties"):d,S=l&&l.name||b&&_;return{id:t,email:c,action:r,changes:b?y.map(function(e){return{field:e,from:l[e],to:o[e]}}):[],roleName:s,fullName:n,firstName:p,ipAddress:g,performedAt:m,description:f,timeSinceChange:h,displayDescription:S,numberOfFieldsChanged:v,descriptionOfFieldsChanged:_,contextualAction:{canDisplayChanges:b,text:w.actions[r]&&w.actions[r].contextualLinkText,url:w.actions[r]&&w.actions[r].getContextualLinkPath&&w.actions[r].getContextualLinkPath(o&&o.path||l)}}})}};return w}]),BalanceHistoryModule.constant("BalanceHistoryTypesFilterConstants",{ZA_AVAILABLE_FILTERS:{Auto_Topup:"balanceHistory.filters.type.options.autoTopup",AccountValidationFee:"balanceHistory.filters.type.options.accountValidationCharge",Account_Validation_Charge_R:"balanceHistory.filters.type.options.accountValidationChargeReversal",Transaction:"balanceHistory.filters.type.options.transaction",Transfer:"balanceHistory.filters.type.options.transfer",Transfer_R:"balanceHistory.filters.type.options.reversedTransfer",Transfer_Charge:"balanceHistory.filters.type.options.transferCharge",Transfer_Charge_R:"balanceHistory.filters.type.options.transferChargeReversal",Payout_Request:"balanceHistory.filters.type.options.payoutRequest",Payout_Request_Charge:"balanceHistory.filters.type.options.payoutRequestCharge",Settlement:"balanceHistory.filters.type.options.paystackPayout",Refund:"balanceHistory.filters.type.options.refund",Refund_R:"balanceHistory.filters.type.options.refundReversal",External:"balanceHistory.filters.type.options.external"},DEFAULT_AVAILABLE_FILTERS:{Auto_Topup:"balanceHistory.filters.type.options.autoTopup",BVN_Charge:"balanceHistory.filters.type.options.bvnRequestCharge",BVN_Charge_R:"balanceHistory.filters.type.options.bvnRequestChargeReversal",BVN_Resolve_2_Charge:"balanceHistory.filters.type.options.bvnResolve2Charge",BVN_Resolve_2_Charge_R:"balanceHistory.filters.type.options.bvnResolve2ChargeReversal",BVN_Match_Charge:"balanceHistory.filters.type.options.bvnMatchCharge",Transaction:"balanceHistory.filters.type.options.transaction",Transfer:"balanceHistory.filters.type.options.transfer",Transfer_R:"balanceHistory.filters.type.options.reversedTransfer",Transfer_Charge:"balanceHistory.filters.type.options.transferCharge",Transfer_Charge_R:"balanceHistory.filters.type.options.transferChargeReversal",Payout_Request:"balanceHistory.filters.type.options.payoutRequest",Payout_Request_Charge:"balanceHistory.filters.type.options.payoutRequestCharge",Settlement:"balanceHistory.filters.type.options.paystackPayout",Refund:"balanceHistory.filters.type.options.refund",Refund_R:"balanceHistory.filters.type.options.refundReversal",External:"balanceHistory.filters.type.options.external"}}),angular.module("app.compliance").controller("ComplianceAccountController",["$scope","$location","$rootScope","ComplianceAccount","Notification","$state","AmplitudeService","BankService","CountryService","ComplianceProfile","FileService","RegistrationDocuments",function(o,t,n,r,a,i,e,s,c,u,l,d){var p=e.logEvent;o.accountStatus=o.complianceStatusData.modules.find(function(e){return["ACCOUNT-STARTER","ACCOUNT"].includes(e.code)}),o.useEditMode=i.params&&i.params.edit||!o.accountStatus.completed,u.fetchSavedBusinessProfile().then(function(e){o.businessProfileData=e,o.isRegistered="registered"===e.businessType,o.country=e&&e.country,o.isGhanaianBusiness="GH"===o.country;var t=c.getCountryData(o.country);return o.currency=t&&t.defaultCurrency||n.Business.default_currency,Promise.all([r.fetchPayoutAccount(),s.init({currency:o.currency})])}).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];o.payoutAccount=n&&n.data||{},o.payoutAccountMeta=n&&n.meta||{},o.banks=r,p("page_load",{pageName:i.current.name,state:"succeeded"}),o.$broadcast("accountPageReady")}).catch(function(e){p("page_load",{pageName:i.current.name,state:"failed"}),a.error("Could not fetch payout account",e)}),o.$watch("payoutAccount.bankCode",function(t){t&&(o.payoutBank=o.banks&&o.banks.find(function(e){return e.code===t}),o.payoutBankTypeIsMobileMoney=o.payoutBank&&"mobile_money"===o.payoutBank.type)}),o.$watch("payoutAccount.accountType",function(e){e&&s.init({currency:o.currency,type:e}).then(function(e){o.banks=e})}),o.accountResolutionStatus=null,o.verifyAccountNumber=function(){var e=o.payoutAccount,t=e.accountNumber,n=e.bankCode;t&&n&&(p("compliance-account_verify-account-number",{state:"started"}),o.accountResolutionStatus="pending",s.validate(t,n).then(function(){return s.resolve(t,n,o.currency)}).then(function(e){"unconfirmed"===e?(o.accountResolutionStatus=null,p("compliance-account_verify-account-number",{state:"failed"})):(o.payoutAccount.accountName=e&&e.account_name,o.accountResolutionStatus="success",p("compliance-account_verify-account-number",{state:"succeeded"}))}))};o.savePayoutAccount=function(){p("Attempted to save compliance module",{module:o.accountStatus.code});var e=_objectSpread(_objectSpread({},o.payoutAccount),{},{currency:o.currency},o.payoutBankTypeIsMobileMoney&&{branchCode:"00000000"});Promise.all([r.savePayoutAccount(e)].concat(_toConsumableArray(o.payoutAccount.documents.map(function(e){var t=e.type,n=e.code,r=e.documentData,o=r.locations,a=r.value,i={code:n};return"file"===t?i.locations=l.extractFilePathFromUploader(o):i.value=a,d.saveDocument(i)})))).then(function(){n.$broadcast("savedPayoutAccount"),p("Successfully saved compliance module",{module:o.accountStatus.code}),o.reloadWithParams({edit:null})}).catch(function(e){n.$broadcast("savedPayoutAccount",!1);var t=e&&e.message;p("Error saving compliance module",{module:o.accountStatus.code,message:t}),a.error("Could not save payout account",e)})},o.switchToEditMode=function(){o.reloadWithParams({edit:"true"})},o.$watch("accountStatus.completed",function(e){e||t.search("edit","true")})}]);_excluded=["supportEmailIsSameAsGeneral","disputeEmailIsSameAsGeneral","useRegisteredAddress","phone"];function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}angular.module("app.compliance").controller("ComplianceContactController",["$scope","$rootScope","ComplianceContact","ComplianceProfile","Notification","$state","AmplitudeService","AddressService","$location",function(s,c,u,e,l,o,t,n,r){s.contactStatus=s.complianceStatusData.modules.find(function(e){return["CONTACT-STARTER","CONTACT"].includes(e.code)}),s.useEditMode=o.params&&o.params.edit||!s.contactStatus.completed;var d=t.logEvent,a=n.stringifyAddress,i=n.formatAddress;s.formatAddress=i,Promise.all([u.fetchContact(),e.fetchSavedBusinessProfile()]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];s.contactData=n,s.contactData.supportEmailIsSameAsGeneral=n.email.support===n.email.general,s.contactData.disputeEmailIsSameAsGeneral=n.email.disputes===n.email.general,s.businessProfileData=r,s.country=r&&r.country,s.isStarterBusiness=r&&"starter"===r.businessType,s.contactData.useRegisteredAddress=a(n.address.registered)===a(n.address.main),s.socialNetworks=Object.keys(n.social),d("page_load",{pageName:o.current.name,state:"succeeded"}),s.$broadcast("contactPageReady")}).catch(function(e){d("page_load",{pageName:o.current.name,state:"failed"}),l.error("Could not fetch contact data",e),s.$broadcast("contactPageReady")}),s.saveContact=function(){d("Attempted to save compliance module",{module:s.contactStatus.code});var e=s.contactData,t=e.supportEmailIsSameAsGeneral,n=e.disputeEmailIsSameAsGeneral,r=e.useRegisteredAddress,o=e.phone,a=_objectWithoutProperties(e,_excluded),i=_objectSpread(_objectSpread({},a),{},{email:_objectSpread(_objectSpread(_objectSpread({},a.email),t&&{support:a.email.general}),n&&{disputes:a.email.general}),phone:{callingCode:o.calling_code,number:o.number},address:_objectSpread(_objectSpread({},a.address),!s.isStarterBusiness&&r&&{main:a.address.registered})},a.website&&{website:s.formatWebsite(a.website)});u.saveContactData(i).then(function(){c.$broadcast("savedContact"),d("Successfully saved compliance module",{module:s.contactStatus.code}),s.reloadWithParams({edit:null})}).catch(function(e){c.$broadcast("savedContact",!1);var t=e&&e.message;d("Error saving compliance module",{module:s.contactStatus.code,message:t}),l.error("Could not save contact data",e)})},s.urlPattern=/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,24}(:[0-9]{1,5})?(\/.*)?$/,s.formatWebsite=function(t){return t?["http://","https://"].some(function(e){return t.includes(e)})?t:"http://".concat(t):""},s.switchToEditMode=function(){s.reloadWithParams({edit:"true"})},s.$watch("contactStatus.completed",function(e){e||r.search("edit","true")})}]);_excluded=["phone"];function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("app.compliance").controller("ComplianceDocumentsController",["$scope","$rootScope","RegistrationDocuments","Notification","$state","AmplitudeService","ComplianceOwner","ngDialog","Addresses","Session","$location","FileService","ComplianceProfile",function(g,r,s,o,h,e,t,a,n,i,c,u,l){var y=e.logEvent;g.documentsStatus=g.complianceStatusData&&g.complianceStatusData.modules.find(function(e){return"DOCUMENTS"===e.code});var d=g.documentsStatus&&g.documentsStatus.completed;g.useEditMode=h.params&&h.params.edit||!d;var p=i.get("account");g.businessName=p&&p.business_name;g.dobMaximumYear=(new Date).getFullYear()-18;var b=function(e){var t=_objectSpread({},e);return t.addressDoc&&t.addressDoc.locations||(t.addressDoc={locations:[]}),t.identityDoc&&t.identityDoc.locations||(t.identityDoc={locations:[]}),t.addressDoc.locations=u.formatDocumentLocationsForFileUploader(t.addressDoc.locations),t.identityDoc.locations=u.formatDocumentLocationsForFileUploader(t.identityDoc.locations),t},f=r.Business&&r.Business.attributes&&r.Business.attributes.country&&r.Business.attributes.country.iso_code;Promise.all([t.fetchIdentificationDocuments(),n.fetchCountries(),s.fetchDocuments(),s.fetchOwners(),s.fetchDirectors(),l.fetchBusinessProfile(f)]).then(function(e){var t=_slicedToArray(e,6),n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5];g.documentTypes=n&&n.all,g.addressDocumentType=n&&n.address,g.countries=r,g.directors=i.map(b),g.owners=a.map(b),g.selectedDocumentType=g.personData&&g.personData.identityDoc&&g.documentTypes.find(function(e){return e.code===g.personData.identityDoc.code});var c=o.data,u=o.meta;g.documents=c||[];var l=u||{},d=l.submitted,p=l.minOwnership,f=l.minDirectors,m=l.minOwners;g.submittedDocuments=d,g.minDirectors=f,g.minOwners=m,g.ownershipThreshold=p,g.requiresProofOfAddress=s&&s.meta&&s.meta.requiresPoa,g.totalOwnership=a.reduce(function(e,t){return t.percentOwned?e+t.percentOwned:e},0),g.$watch("i18nextReady",function(e){e&&(y("page_load",{pageName:h.current.name,state:"succeeded"}),g.$broadcast("documentsPageReady"))})}).catch(function(e){y("page_load",{pageName:h.current.name,state:"failed"}),o.error("Could not fetch compliance documents",e)}),g.$watch("personData.country",function(n){if(n){var e=g.countries&&g.countries.find(function(e){var t=e.iso2;return n===t});if(e)t.fetchIdentificationDocuments(e.iso2).then(function(e){g.documentTypes=e&&e.all,g.addressDocumentType=e&&e.address}),g.personData.address&&g.personData.address.country||(g.personData.address||(g.personData.address={}),g.personData.address.country=e.name)}}),g.$watch("personData.identityDoc.code",function(t){t&&(g.selectedDocumentType=g.documentTypes&&g.documentTypes.find(function(e){return e.code===t}))});var m=r.Business.attributes.calling_code,v={phone:{calling_code:m}},_={phone:{calling_code:m}};g.addOwner=function(){g.addPerson("OWNER",v,!0)},g.addDirector=function(){g.addPerson("DIRECTOR",_)},g.addPerson=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];g.personData=t,a.open({template:"modules/compliance/views/documents/modals/add-person.html",controller:"ComplianceDocumentsController",showClose:!1,closeByDocument:!0,scope:g,data:{role:e,showPercentage:n}})};var S=function(e){r.$broadcast("savedPerson"),y("Successfully compliance saved person",{role:e})},P=function(e,t){r.$broadcast("savedPerson",!1);var n=e&&e.message;y("Error saving compliance person",{message:n,role:t}),o.error("Could not save ".concat(t.toLowerCase()),e)},w=function(e,t){var n=e.phone,r=_objectWithoutProperties(e,_excluded);return _objectSpread(_objectSpread({},r),{},{addressDoc:_objectSpread(_objectSpread({},r.addressDoc),{},{code:"ADDRESS",location:void 0,locations:u.extractFilePathFromUploader(r.addressDoc&&r.addressDoc.locations)}),identityDoc:_objectSpread(_objectSpread({},r.identityDoc),{},{location:void 0,locations:u.extractFilePathFromUploader(r.identityDoc&&r.identityDoc.locations)}),phone:{callingCode:n&&n.calling_code,number:n&&n.number},role:t})};g.savePerson=function(t){var e=w(g.personData,t);s.savePerson(e).then(function(){S(t),g.closeThisDialog(),h.reload()}).catch(function(e){P(e,t)})},g.chooseSomeone=function(e){var t=w(e,"OWNER");s.savePerson(t).then(function(){S("OWNER"),h.reload()}).catch(function(e){P(e,"OWNER")})};g.saveAllOwners=function(){y("Attempted to save compliance module",{module:g.documentsStatus.code});var e=(g.owners||[]).map(function(e){var t=w(e,"OWNER");return s.savePerson(t)});Promise.all([].concat(_toConsumableArray(e),_toConsumableArray(g.documents.map(function(e){var t=e.code,n=e.type,r=e.documentData,o=r.locations,a=r.value,i={code:t};return"file"===n?i.locations=u.extractFilePathFromUploader(o):i.value=a,s.saveDocument(i)})))).then(function(){r.$broadcast("savedPerson"),y("Successfully saved compliance module",{module:g.documentsStatus.code}),o.success("Documents saved!",'Click on "Submit" to activate your business'),g.reloadWithParams({edit:null})}).catch(function(e){P(e,"OWNER"),y("Error saving compliance module",{module:g.documentsStatus.code,message:message})})},g.switchToEditMode=function(){g.reloadWithParams({edit:"true"})},g.$watch("documentsStatus.completed",function(e){e||c.search("edit","true")})}]),angular.module("app.compliance").controller("ComplianceController",["$scope",function(e){}]),angular.module("app.compliance").controller("ComplianceOwnerController",["$scope","$location","$rootScope","ComplianceOwner","Notification","$state","AmplitudeService","CountryService","AddressService","ComplianceContact","ComplianceProfile","FileService",function(s,t,n,r,o,c,e,a,i,u,l,d){var p=e.logEvent;s.ownerStatus=s.complianceStatusData.modules.find(function(e){return["OWNER"].includes(e.code)});var f=i.formatAddress;s.formatAddress=f,s.useEditMode=c.params&&c.params.edit||!s.ownerStatus.completed;var m=n.Business&&n.Business.attributes&&n.Business.attributes.country&&n.Business.attributes.country.iso_code;Promise.all([r.fetchOwner(),u.fetchContact(),l.fetchSavedBusinessProfile(),l.fetchBusinessProfile(m)]).then(function(e){var t,n=_slicedToArray(e,4),r=n[0],o=n[1],a=n[2],i=n[3];s.ownerData=r?((t=_objectSpread({},r)).addressDoc&&t.addressDoc.locations||(t.addressDoc={locations:[]}),t.identityDoc&&t.identityDoc.locations||(t.identityDoc={locations:[]}),t.addressDoc.locations=d.formatDocumentLocationsForFileUploader(t.addressDoc.locations),t.identityDoc.locations=d.formatDocumentLocationsForFileUploader(t.identityDoc.locations),t):{},s.contactData=o||{},s.ownerData.useBusinessAddress=!0,s.businessProfileData=a,s.country=a.fieldNames&&a.fieldNames.country,s.requiresProofOfAddress=i&&i.meta&&i.meta.requiresPoa,p("page_load",{pageName:c.current.name,state:"succeeded"}),s.$broadcast("ownerPageReady")}).catch(function(e){p("page_load",{pageName:c.current.name,state:"failed"}),o.error("Could not fetch owner information",e)}),a.getCountries().then(function(e){s.countries=e}),s.$watch("ownerData.country",function(e){e&&r.fetchIdentificationDocuments(e).then(function(e){if(s.documentTypes=e&&e.all,s.addressDocumentType=e&&e.address,s.ownerData.identityDoc&&s.ownerData.identityDoc.code){var t=s.ownerData.identityDoc.code;s.selectedDocumentType=s.documentTypes&&s.documentTypes.find(function(e){return e.code===t})}})}),s.$watch("ownerData.identityDoc.code",function(t){t&&(s.selectedDocumentType=s.documentTypes&&s.documentTypes.find(function(e){return e.code===t}))});s.dobMaximumYear=(new Date).getFullYear()-18,s.saveOwner=function(){p("Attempted to save compliance module",{module:s.ownerStatus.code});var e=_objectSpread(_objectSpread(_objectSpread({},s.ownerData),s.ownerData.useBusinessAddress&&{address:s.contactData.address.main}),{},{addressDoc:_objectSpread(_objectSpread({},s.ownerData.addressDoc),{},{location:void 0,code:"ADDRESS",locations:d.extractFilePathFromUploader(s.ownerData.addressDoc&&s.ownerData.addressDoc.locations)}),identityDoc:_objectSpread(_objectSpread({},s.ownerData.identityDoc),{},{location:void 0,locations:d.extractFilePathFromUploader(s.ownerData.identityDoc&&s.ownerData.identityDoc.locations)}),role:"OWNER"});r.saveOwnerData(e).then(function(){n.$broadcast("savedOwner"),p("Successfully saved compliance module",{module:s.ownerStatus.code}),s.reloadWithParams({edit:null})}).catch(function(e){n.$broadcast("savedOwner",!1);var t=e&&e.message;p("Error saving compliance module",{module:s.ownerStatus.code,message:t}),o.error("Could not save owner data",e)})},s.switchToEditMode=function(){s.reloadWithParams({edit:"true"})},s.$watch("ownerStatus.completed",function(e){e||t.search("edit","true")})}]);_excluded=["fieldNames"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("app.compliance").controller("ComplianceProfileController",["$scope","$location","$window","$state","$rootScope","ComplianceProfile","Notification","AmplitudeService","Session",function(a,t,e,i,n,r,o,s,c){var u=s.logEvent;a.logEvent=u,a.profileStatus=a.complianceStatusData.modules.find(function(e){return"PROFILE"===e.code}),a.useEditMode=i.params&&i.params.edit||!a.profileStatus.completed;var l=c.get("account");a.integrationIsLive=l.is_live;var d=l&&l.attributes&&l.attributes.country;a.countryName=d&&d.name;var p=function(){var t=a.savedBusinessProfile&&a.savedBusinessProfile.categories[0];a.categoryData=a.categories&&a.categories.find(function(e){return e.code===t})};r.fetchSavedBusinessProfile().then(function(e){return a.savedBusinessProfile=e||{},a.savedBusinessProfile.country||(a.savedBusinessProfile.country=d&&d.iso_code),r.fetchBusinessProfile(a.savedBusinessProfile.country)}).then(function(e){a.profileFormData=e||{};var t,n,r,o;a.profileFormData.starterBusinessLimit={NG:"NGN 2,000,000",GH:"GHS 30,000",ZA:"ZAR 80,000"}[a.savedBusinessProfile.country],a.businessTypes=(t=a.savedBusinessProfile.country,n={countries:e.countries,businessTypesData:e.businessTypesMap},r=n.countries,o=n.businessTypesData,((r.find(function(e){return e.value===t})||{}).businessTypes||["starter","registered"]).map(function(e){return _objectSpread(_objectSpread({},o[e]),{},{value:e})})),a.$watch("savedBusinessProfile.industry",function(){var e=a.profileFormData.industries&&a.profileFormData.industries.find(function(e){return e.code===a.savedBusinessProfile.industry});a.categories=e&&e.categories,p()}),a.showRegistrationTypes=Array.isArray(e.registrationTypes)&&1<e.registrationTypes.length,a.showRegistrationTypes||(a.savedBusinessProfile.registrationType=e.registrationTypes[0]&&e.registrationTypes[0].code),a.$watch("savedBusinessProfile.registrationType",function(){var e=a.profileFormData.registrationTypes&&a.profileFormData.registrationTypes.find(function(e){return e.code===a.savedBusinessProfile.registrationType});a.ownershipTypes=e&&e.ownershipTypes,a.ownershipTypes&&0===a.ownershipTypes.length&&(a.savedBusinessProfile.ownershipType=null)}),u("page_load",{pageName:i.current.name,state:"succeeded"}),a.$broadcast("profilePageReady")}).catch(function(e){u("page_load",{pageName:i.current.name,state:"failed"}),o.error("Could not fetch business profile",e)}),a.saveProfile=function(){u("Attempted to save compliance module",{module:a.profileStatus.code});var e=a.savedBusinessProfile,t=(e.fieldNames,_objectWithoutProperties(e,_excluded));r.saveBusinessProfile(t).then(function(){n.$broadcast("savedBusinessProfile"),u("Successfully saved compliance module",{module:a.profileStatus.code}),a.reloadWithParams({edit:null})}).catch(function(e){n.$broadcast("savedBusinessProfile",!1);var t=e&&e.message;u("Error saving compliance module",{module:a.profileStatus.code,message:t}),o.error("Could not save business profile",e)})},a.switchToEditMode=function(){a.reloadWithParams({edit:"true"})},a.showContactOptions=function(e){n.openHelpDesk({tab:"contact"}),u("Clicked Need Help from ".concat(e," guide"))},a.onIndustryChange=function(e){return u("Set industry",{source:e})},a.setIndustry=function(e){a.savedBusinessProfile.industry=e.code,a.onIndustryChange("guide")},a.onCategoryChange=function(e){p(),u("Set category",{source:e})},a.setCategory=function(e){a.savedBusinessProfile.categories[0]=e.code,a.onCategoryChange("guide")},a.$watch("profileStatus.completed",function(e){e||t.search("edit","true")})}]),angular.module("app.compliance").directive("complianceAddress",["AmplitudeService","Addresses","Session","$rootScope",function(a,i,s){return{restrict:"E",scope:{address:"=",country:"="},templateUrl:"/modules/compliance/views/address.html",link:function(n){var e=s.get("account"),t=a.logEvent;n.logEvent=t,n.address=n.address||{};var r=e&&e.attributes&&e.attributes.country_code;n.country=n.country||n.address&&n.address.country||r,n.address.countryName=n.address.country,n.isFetchingStates=!1,i.fetchCountries().then(function(e){n.countries=e,n.address.country&&o(n.address.country),n.$broadcast("fetchedCountries")}).catch(function(){n.countries=[],n.$broadcast("fetchedCountries",!1)});var o=function(e){n.isFetchingStates=!0,n.states=[],i.fetchStates(e).then(function(e){n.states=e}).catch(function(){n.states=[]}).finally(function(){n.isFetchingStates=!1})};n.setAddressState=function(e){n.address.state=e},n.$watch("address",function(e,t){e.country!=t.country&&o(n.address.country)},!0)}}}]),angular.module("app.compliance").directive("complianceDocumentInput",["AmplitudeService","CountryService",function(e,t){return{restrict:"E",scope:{documentType:"=",documentData:"="},templateUrl:"/modules/compliance/views/document-input.html",link:function(r){r.instructions={"NG-VOTERS":{file:"Upload a copy of your Voter's card",text:"Voter's ID number"},PASSPORT:{file:"Upload a copy of your passport's data page",text:"Passport Number"},"NG-DRIVERS":{file:"Upload a copy of your Driver's License",text:"Driver's License ID number"},"NG-NIN":{file:"Upload a copy of your National ID card or slip",text:"National Identity Number"}},r.handleKeyDownOnGHCardInput=function(e){var t=e.code;if("Backspace"!==t){var n=e.target.value;0<n.length&&(2<(n=n.replace(/(-)/g,"")).length&&(n="".concat(n.slice(0,3),"-").concat(n.slice(3,12)).concat(12<=n.length?"-".concat(n.slice(12,n.length)):"")),r.documentData.value=n,"Minus"===t&&e.preventDefault())}}}}}]),angular.module("app.compliance").directive("complianceDocument",["AmplitudeService","RegistrationDocuments","API","$http","Notification","$state","$rootScope","FileService",function(o,e,t,n,r,a,i,s){return{restrict:"E",scope:{requirement:"=",onUpload:"&"},templateUrl:"/modules/compliance/views/document.html",link:function(e){var t=o.logEvent;e.logEvent=t,e.reviewStatus=e.requirement.documents[0]&&e.requirement.documents[0].status,e.reviewNote=e.requirement.documents[0]&&e.requirement.documents[0].reviewNote,e.canEditModule=a.params&&a.params.edit,e.isEditMode=!0,e.showDocumentData=!1,e.toggleShowDocumentData=function(){e.showDocumentData=!e.showDocumentData};var n,r=e.requirement.documents&&e.requirement.documents[0]&&e.requirement.documents[0].value;e.requirement.documentData={locations:(n=e.requirement.documents,n&&n.length&&n[0].locations?s.formatDocumentLocationsForFileUploader(n[0].locations):[]),value:r},e.toggleEditMode=function(){e.isEditMode=!e.isEditMode}}}}]),angular.module("app.compliance").directive("complianceMenu",["AmplitudeService","ComplianceModulesRouteMappings",function(t,a){return{restrict:"E",scope:{modules:"=",currentModule:"="},templateUrl:"/modules/compliance/views/menu.html",link:function(o){var e=t.logEvent;o.logEvent=e,o.activeModules=o.modules.map(function(e){var t=e.code,n="PROFILE"!==o.currentModule||"PROFILE"===t,r="app.compliance.".concat(a[t].route);return _objectSpread(_objectSpread({},e),{},{link:r,isActive:n})})}}}]),angular.module("app.compliance").directive("complianceMenuItem",["$state","AmplitudeService","$rootScope",function(r,o,a){return{restrict:"E",scope:{module:"=",isLast:"="},templateUrl:"/modules/compliance/views/menuItem.html",link:function(n){var e=o.logEvent;n.logEvent=e;var t=function(){n.isCurrentModule=n.module.link===r.current.name,n.currentModuleIsBeingEdited=n.module.link===r.current.name&&!!r.params.edit;var e=n.module.completed,t=0===n.module.completion;n.status=(n.currentModuleIsBeingEdited?"editing":t&&"pending")||e&&"complete"};t(),a.$on("$stateChangeSuccess",function(){t()})}}}]);_excluded=["phone"];function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}angular.module("app.compliance").directive("compliancePerson",["AmplitudeService","ngDialog","$state","RegistrationDocuments","$rootScope","Notification",function(t,a,n,r,i,s){return{restrict:"E",scope:{personData:"=",role:"=",showPercentage:"="},templateUrl:"/modules/compliance/views/person.html",link:function(o){var e=t.logEvent;o.logEvent=e,o.canEditModule=n.params&&n.params.edit,o.openPersonModal=function(e){var t=o.personData,n=t.phone,r=_objectWithoutProperties(t,_excluded);o.personData=_objectSpread(_objectSpread({},r),{},{phone:{calling_code:n&&n.callingCode||"",number:n&&n.number||""}}),a.open({template:"modules/compliance/views/documents/modals/add-person.html",controller:"ComplianceDocumentsController",showClose:!1,closeByDocument:!0,scope:o,data:{role:e,showPercentage:o.showPercentage}})},o.deletePerson=function(e){r.deletePerson(e).then(function(){i.$broadcast("deletedPerson"),n.reload()}).catch(function(e){i.$broadcast("deletedPerson",!1),s.error("Could not delete person",e)})}}}}]),angular.module("app.compliance").directive("complianceProgress",["AmplitudeService","BusinessActivation","$rootScope","$window","Notification","Session","$state",function(l,d,p,f,m,g,h){return{restrict:"E",replace:!0,scope:{status:"="},templateUrl:"/modules/compliance/views/progress.html",link:function(e){var r=l.logEvent,t=g.get("account")||{},o=t.attributes,n=t.is_live,a=e.status,i=a.modules,s=void 0===i?[]:i,c=a.completed;e.inEditMode=h.params&&h.params.edit,e.totalNumberOfModules=s.length,e.completedModules=s.reduce(function(e,t){return t.completed?e+1:e},0);var u=e.completedModules/e.totalNumberOfModules*100;e.isComplete=c,e.isLive=n,e.activateBusiness=function(){var n=!!o.duplicated_from_integration;r("Attempted to activate business",{is_duplicated:n}),d.activate().then(function(){p.$broadcast("activatedBusiness"),r("Business successfully activated",{is_duplicated:n}),m.success("All done!","Refreshing your Dashboard..."),f.location.reload()}).catch(function(e){p.$broadcast("activatedBusiness",!1);var t=e&&e.message;r("Error activating business",{message:t,is_duplicated:n}),m.error("Could not activate business",e)})},e.isSubmitted=o&&o.compliance_documents_submitted,e.showComplianceBadge=e.isSubmitted&&!e.inEditMode,e.progressWidthStyle={width:"".concat(u,"%")}}}}]),angular.module("app.compliance").directive("complianceFormSocial",["AmplitudeService",function(n){return{restrict:"E",scope:{name:"=",handle:"="},templateUrl:"/modules/compliance/views/social-form.html",link:function(t){t.isEditing=!1;var e=n.logEvent;t.logEvent=e,t.toggleEditor=function(){t.isEditing=!t.isEditing},t.updateHandle=function(e){t.handle=e}}}}]),angular.module("app.compliance").directive("complianceSocialLink",[function(){return{restrict:"E",scope:{name:"=",handle:"="},templateUrl:"/modules/compliance/views/social-link.html",link:function(e){var t={facebook:"https://facebook.com/",twitter:"https://twitter.com/",instagram:"https://instagram.com/"}[e.name];e.url="".concat(t).concat(e.handle)}}}]),angular.module("app.compliance").directive("complianceStatus",["AmplitudeService","ComplianceStatus","Session",function(r,e,o){return{restrict:"E",replace:!0,scope:{status:"="},templateUrl:"/modules/compliance/views/status.html",link:function(e){var t=r.logEvent;e.logEvent=t;var n=o.get("account");e.url=n.logo_path,e.businessName=n.business_name}}}]),angular.module("app.compliance").factory("ComplianceAccount",["API","Session",function(t,n){var r=function(){var e=n.get("account");return e&&e.id};return{fetchPayoutAccount:function(){return t.one("integration/".concat(r(),"/payout")).get().catch(function(){})},savePayoutAccount:function(e){return t.one("integration/".concat(r(),"/payout")).patch(e)}}}]),angular.module("app.compliance").factory("BusinessActivation",["API","Session",function(t,n){return{activate:function(){return t.one("integration/".concat((e=n.get("account"),e&&e.id),"/activate")).get().then(function(e){return e.data});var e}}}]),angular.module("app.compliance").factory("ComplianceModulesRouteMappings",[function(){return{PROFILE:{route:"profile"},CONTACT:{route:"contact"},"CONTACT-STARTER":{route:"contact"},OWNER:{route:"owner"},ACCOUNT:{route:"account"},"ACCOUNT-STARTER":{route:"account"},DOCUMENTS:{route:"documents"}}}]),angular.module("app.compliance").factory("ComplianceContact",["API","Session",function(t,n){var r=function(){var e=n.get("account");return e&&e.id};return{fetchContact:function(){return t.one("integration/".concat(r(),"/contact")).get().then(function(e){return e.data})},saveContactData:function(e){return t.one("integration/".concat(r(),"/contact")).patch(e)}}}]),angular.module("app.compliance").factory("RegistrationDocuments",["API","Session",function(r,t){var n=function(){var e=t.get("account");return e&&e.id};return{fetchDocuments:function(){return r.one("integration/".concat(n(),"/documents")).get()},saveDocument:function(e){return r.all("integration/".concat(n(),"/documents")).post(e)},savePerson:function(e){return r.one("integration/".concat(n(),"/person")).patch(e)},deletePerson:function(e){var t=e.integration,n=e.id;return r.one("integration/".concat(t,"/person/").concat(n)).customDELETE()},fetchOwners:function(){return r.one("integration/".concat(n(),"/owners?documents=true")).get().then(function(e){return e.data})},fetchDirectors:function(){return r.one("integration/".concat(n(),"/directors?documents=true")).get().then(function(e){return e.data})}}}]),angular.module("app.compliance").factory("ComplianceOwner",["API","Session",function(n,r){var t=function(){var e=r.get("account");return e&&e.id};return{fetchIdentificationDocuments:function(e){return n.one("documents/identification").get({country:e||(t=r.get("account"),t&&t.attributes&&t.attributes.country&&t.attributes.country.iso_code||"NG")}).then(function(e){return e.data});var t},fetchOwnerDocuments:function(e){return e?n.one("person/".concat(e,"/documents")).get().then(function(e){return e.data}):Promise.resolve()},fetchOwner:function(){return n.one("integration/".concat(t(),"/owners?documents=true")).get().then(function(e){return e.data&&e.data[0]})},saveOwnerData:function(e){return n.one("integration/".concat(t(),"/person")).patch(e)}}}]),angular.module("app.compliance").factory("ComplianceProfile",["API","Session",function(n,t){var r={},o=function(){var e=t.get("account");return e&&e.id};return{fetchBusinessProfile:function(t){return r[t]?Promise.resolve(r[t]):n.one("integration/".concat(o(),"/business_profile_data")).get({country:t}).then(function(e){return r[t]=e.data,r[t]})},saveBusinessProfile:function(e){return n.one("integration/".concat(o(),"/business_profile")).patch(e)},fetchSavedBusinessProfile:function(){return n.one("integration/".concat(o(),"/business_profile")).get().then(function(e){return e.data})}}}]),angular.module("app.compliance").factory("ComplianceStatus",["API","Session",function(t,n){return{getComplianceStatus:function(){return t.one("integration/".concat((e=n.get("account"),e&&e.id),"/compliance_status")).get().then(function(e){return e.data});var e}}}]),ConsentModule.controller("ConsentCtrl",["$scope","$state","ngDialog","API","ConsentAPI","ConsentKycAPI","ManagedAccountAPI","Session","Notification","$rootScope","CountryService","utils","Auth","AmplitudeService",function(u,s,r,e,o,t,n,l,a,i,c,d,p,f){var m=i.Business,g=f.logEvent;u.logEvent=g;var h=m.is_live&&m.agreements&&m.agreements.settlement_managed_account&&m.agreements.settlement_managed_account.visible,y=m.is_live&&"registered"===m.business_type&&m.can_transfer&&"NG"===m.attributes.country_code;u.signingReason=s.params.referrer,!h&&!y||u.signingReason||s.go("app.settings.accounts"),u.businessName=m.business_name;var b="markdown",v={UNCLEAR_PROCESS:"I do not understand how this process works",INSUFFICIENT_PERMISSIONS:"I do not have the required permissions to consent in my company",DISINTERESTED:"I am not interested in Managed Accounts"};u.showInviteSignatoryInput=!1,u.consentFormValues={email:"",name:"",role:"",signed:"",confirmSignature:!1,reasons:{UNCLEAR_PROCESS:!1,INSUFFICIENT_PERMISSIONS:!1,DISINTERESTED:!1,otherReason:""}};u.isEditingSignature=!0,u.businessPeople=[],u.isUserKycSubmitted=!1,u.agreementDetails={type:"",version:"",signed:!1},u.toggleEditMode=function(){u.isEditingSignature=!u.isEditingSignature},u.toggleInviteSignatory=function(){u.showInviteSignatoryInput=!u.showInviteSignatoryInput};var _=function(e){var t,n,r=e.content,o=e.contentType;switch(o){case b:return t=r,n=marked.parse(t),DOMPurify.sanitize(n,{USE_PROFILES:{html:!0}});default:return r}},S=function(){return o.getAgreement({agreementType:s.params.type}).then(function(e){var t=e.content,n=e.content_type,r=e.version,o=e.type,a=e.signed,i=e.signatories,s=void 0===i?[]:i;u.agreementContent=_({content:t,contentType:n}),u.agreementDetails={version:r,type:o,signed:a,signatories:s};var c=l.get("user").email;u.isSignedByLoggedInUser=s.some(function(e){return e.email===c})})};Promise.all([o.getUserKycStatus(),o.getBusinessPeople(),c.getCountries(),t.fetchIdentificationDocuments(),o.getComplianceStatus(),S()]).then(function(e){var t=_slicedToArray(e,5),n=t[0],r=t[1],o=t[2],a=t[3],i=t[4];u.isUserKycSubmitted=n.submitted,u.businessPeople=r,u.countries=o,u.documentTypes=a.all,u.isComplianceCompleted=i.completed,g("page_load",{pageName:s.current.name,state:"succeeded"}),u.$broadcast("consentAgreementRetrieved")}).catch(function(e){g("page_load",{pageName:s.current.name,state:"failed"}),a.error("Error loading agreement",e.message||"There was an error loading the managed accounts consent agreement"),s.go("app.home")}),u.openOptOutModal=function(){g("managed-accounts-consent_show-opt-out-reasons"),u.consentFormValues.reasons={UNCLEAR_PROCESS:!1,INSUFFICIENT_PERMISSIONS:!1,DISINTERESTED:!1,otherReason:""},r.open({template:"/modules/consent/views/modals/managed-accounts-opt-out.html",scope:u,showClose:!0,trapFocus:!1,width:500})};var P=function(){r.open({template:"/modules/consent/views/modals/managed-accounts-signature-complete.html",scope:u,showClose:!0,closeByDocument:!1,width:500})};u.signAgreement=function(){var e={signature:u.consentFormValues.name,role:u.consentFormValues.role,version:u.agreementDetails.version,type:u.agreementDetails.type};o.signAgreement(e).then(function(){g("managed-accounts-consent_accept-terms"),S(),p.refreshBusiness(),u.$broadcast("agreementSigned"),"auto_topup"===u.signingReason?n.requestForTopupManagedAccount().then(function(){P()}).catch(function(e){a.error("Could not request for auto topup account",e),s.go("app.settings.accounts")}):"manual_settlement"===u.signingReason&&n.requestForSettlementManagedAccount().then(function(){P()}).catch(function(e){a.error("Could not request for single payout account",e),s.go("app.settings.accounts")})}).catch(function(){g("managed-accounts-consent_accept-terms-failed"),u.$broadcast("agreementSigned",!1)})};u.openAddKycModal=function(){g("managed-accounts-consent_clicked-open-kyc"),r.open({template:"modules/consent/views/modals/add-user-kyc.html",controller:"ConsentKycCtrl",closeByDocument:!1,scope:u})},u.optOut=function(){var e,t,n={reasons:(e=Object.keys(u.consentFormValues.reasons).reduce(function(e,t){return u.consentFormValues.reasons[t]&&v[t]&&e.push(v[t]),e},[]),t=u.consentFormValues.reasons.otherReason.trim(),t&&e.push(t),e.join(" | ")),version:u.agreementDetails.version,type:u.agreementDetails.type};o.optOut(n).then(function(e){g("managed-accounts-consent_opt-out",{reasons:n.reasons}),a.success(e.message),p.refreshBusiness(),s.go("app.home"),u.$broadcast("optedOut")}).catch(function(e){g("managed-accounts-consent_opt-out-failed",{reasons:n.reasons}),a.error("Error opting out",e.message||"There was an error processing your opt out request."),u.$broadcast("optedOut",!1)}).finally(function(){r.close()})},i.$on("signatoryKycSubmitted",function(){Promise.all([o.getUserKycStatus(),o.getBusinessPeople()]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];u.isUserKycSubmitted=n.submitted,u.businessPeople=r}).catch(function(){a.error("Error refreshing agreement","There was an error loading the managed accounts consent agreement status.")})}),u.$watch("consentFormValues.email",function(e){u.isValidEmail=d.isEmail(e)}),u.inviteSignatory=function(){o.inviteSignatory({email:u.consentFormValues.email,referrer:s.params.referrer}).then(function(e){g("managed-accounts-consent_send-invite"),a.success(e.message),u.$broadcast("userInvited")}).catch(function(e){g("managed-accounts-consent_send-invite-failed"),u.$broadcast("userInvited",!1),a.error("Error inviting user",e.message||"There was an error inviting the user.")})}}]);_excluded=["phone"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ConsentModule.controller("ConsentKycCtrl",["$scope","ConsentKycAPI","Session","FileService","Notification","$rootScope","AmplitudeService",function(o,a,e,i,s,c,t){var u=t.logEvent;o.logEvent=u;var n,r,l,d,p,f,m,g,h,y,b,v;p=e.get("user"),f=p.email,m=p.first_name,g=p.last_name,h=p.job_title,y=p.phone,b=p.calling_code,n=o.businessPeople,r=f,v=n.find(function(e){return e.email===r}),o.personData=v?(l=v,(d=JSON.parse(JSON.stringify(l))).addressDoc&&d.addressDoc.locations||(d.addressDoc={locations:[]}),d.identityDoc&&d.identityDoc.locations||(d.identityDoc={locations:[]}),d.addressDoc.locations=i.formatDocumentLocationsForFileUploader(d.addressDoc.locations),d.identityDoc.locations=i.formatDocumentLocationsForFileUploader(d.identityDoc.locations),d):_objectSpread(_objectSpread({},v),{},{email:f,firstName:m,lastName:g,jobTitle:h,phone:{number:y,calling_code:b}}),o.selectedDocumentType=o.personData&&o.personData.identityDoc&&o.documentTypes.find(function(e){return e.code===o.personData.identityDoc.code}),o.$watch("personData.identityDoc.code",function(t){t&&(o.selectedDocumentType=o.documentTypes&&o.documentTypes.find(function(e){return e.code===t}))}),o.$watch("personData.country",function(n){if(n){var e=o.countries&&o.countries.find(function(e){var t=e.countryCode;return n===t});if(e)a.fetchIdentificationDocuments(e.countryCode).then(function(e){o.documentTypes=e&&e.all,o.addressDocumentType=e&&e.address}),o.personData.address&&o.personData.address.country||o.personData.address||(o.personData.address={}),o.personData.address.country=e.name}});o.savePersonData=function(){var e,t,n,r=(e=o.personData,t=e.phone,n=_objectWithoutProperties(e,_excluded),_objectSpread(_objectSpread({},n),{},{addressDoc:_objectSpread(_objectSpread({},n.addressDoc),{},{code:"ADDRESS",locations:i.extractFilePathFromUploader(n.addressDoc&&n.addressDoc.locations)}),identityDoc:_objectSpread(_objectSpread({},n.identityDoc),{},{locations:i.extractFilePathFromUploader(n.identityDoc&&n.identityDoc.locations)}),phone:{callingCode:t&&t.calling_code,number:t&&t.number},role:"SIGNATORY"}));a.saveUserKyc(r).then(function(e){u("managed-accounts-consent_clicked-submit-kyc"),o.closeThisDialog(),s.success(e.message),c.$broadcast("signatoryKycSubmitted")}).catch(function(e){u("managed-accounts-consent_clicked-submit-kyc-failed"),s.error("Error saving signatory",e.message||"There was an error saving the signatory KYC."),c.$broadcast("signatoryKycSubmitted",!1)})}}]);_excluded=["type"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}ConsentModule.factory("ConsentAPI",["API","$rootScope",function(o,a){var i=function(e){var t=e.type,n=_objectWithoutProperties(e,_excluded);return o.all("agreements/".concat(t,"/integrations/").concat(a.Business.id)).post(n)};return{getAgreement:function(e){var t=e.agreementType,n=e.version;return o.one("agreements/".concat(t)).get({integration_id:a.Business.id,version:n}).then(function(e){return e.data})},signAgreement:function(e){var t=e.signature,n=e.role,r=e.version,o=e.type;return i({signed:!0,signature:t,role:n,version:r,type:o})},optOut:function(e){var t=e.reasons,n=e.version,r=e.type;return i({signed:!1,reasons:t,version:n,type:r})},getAgreements:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.version,r=e.active;return o.one("agreements/integrations/".concat(a.Business.id)).get({type:t,version:n,active:r})},getBusinessPeople:function(){return o.one("integration/".concat(a.Business.id,"/people")).get({documents:!0,screening:!0,verification:!0}).then(function(e){return e.data})},getUserKycStatus:function(){return o.one("integrations/".concat(a.Business.id,"/people/kyc_status")).get().then(function(e){return e.data})},inviteSignatory:function(e){var t=e.email,n=e.referrer;return o.all("integrations/".concat(a.Business.id,"/invite_user")).post({email:t,referrer:n})},getComplianceStatus:function(){return o.one("integration/".concat(a.Business.id,"/compliance_status")).get().then(function(e){return e.data})}}}]),ConsentModule.factory("ManagedAccountAPI",["API",function(e){return{requestForTopupManagedAccount:function(){return e.all("automated_top_up_account").post({preferred_bank:"titan-bank"})},requestForSettlementManagedAccount:function(){return e.all("manual_settlement_account").post({preferred_bank:"titan-bank"})}}}]),ConsentModule.factory("ConsentKycAPI",["API","Session","$rootScope",function(n,r,t){return{saveUserKyc:function(e){return n.one("integration/".concat(t.Business.id,"/person")).patch(e)},fetchIdentificationDocuments:function(e){return n.one("documents/identification").get({country:e||(t=r.get("account"),t&&t.attributes&&t.attributes.country&&t.attributes.country.iso_code||"NG")}).then(function(e){return e.data});var t}}}]),angular.module("app.customer-insights").controller("CustomerInsightsGraphHelper",["$scope","$stateParams","URLService",function(e,t,o){var a=[{fillColor:"rgba(54, 118, 200, 0.1)",strokeColor:"rgba(54, 118, 200, 0.8)",pointColor:"rgb(54, 118, 200)"},{fillColor:"rgba(17, 160, 78, 0.1)",strokeColor:"rgba(17, 160, 78, 0.8)",pointColor:"rgb(16, 186, 87)"},{fillColor:"rgba(231, 76, 60, 0.1)",strokeColor:"rgba(231, 76, 60, 0.8)",pointColor:"rgb(231, 76, 60)"}],n='-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif';function r(){var n,r;e.data=[],e.series=[],e.colors=[],e.labels=(n=o.formatMoment(),r=n.from.year()===n.to.year(),_.map(e.trendData,function(e,t){switch(n.period){case"hour":return moment(e.from).format("hh A");case"month":return moment(e.from).format(r?"MMM":"MMM YY");case"week":return moment(e.from).format("MMM D")+" - "+moment(e.to).format("D");default:return moment(e.from).format("MMM D")}})),e.render.all&&(e.data.push(_.pluck(e.trendData,"all_customers")),e.series.push("All Paying Customers"),e.colors.push(a[0])),e.render.new&&(e.data.push(_.pluck(e.trendData,"new_customers")),e.series.push("New Customers"),e.colors.push(a[1])),e.render.returning&&(e.data.push(_.pluck(e.trendData,"returning_customers")),e.series.push("Returning Customers"),e.colors.push(a[2]))}e.options={scaleShowLabels:!0,scaleShowVerticalLines:!1,scaleBeginAtZero:!0,scaleFontFamily:n,scaleLineColor:"transparent",tooltipTitleFontFamily:n,tooltipFontFamily:n,tooltipFontStyle:"normal",tooltipFontSize:12,tooltipTitleFontSize:12,tooltipCornerRadius:3,tooltipXPadding:10,tooltipYPadding:10,tooltipCaretSize:4,barStrokeWidth:1,bezierCurve:!1,datasetFill:!0,pointDotRadius:3,pointHitDetectionRadius:e.trendData.length<15?20:e.trendData.length<=30?14:30<e.trendData.length?8:void 0},r(),e.$watch("render",r,{deep:!0})}]),angular.module("app.customer-insights").controller("CustomerInsightsGrowthCtrl",["$scope","$rootScope","$state","CustomerInsightsTrend","CustomerInsightsTotals",function(n,e,t,r,o){n.render={all:!0,new:!0,returning:!1},n.toggle=function(e){var t=_.filter(_.values(n.render),_.identity);n.render[e]?1<t.length&&(n.render[e]=!1):n.render[e]=!0},r.fetch().then(function(){n.trendData=r.data,n.$broadcast("fetchedTrend")}).catch(function(){n.trendData=[],n.$broadcast("fetchedTrend")}),o.fetch().then(function(){n.totals=o.data,e.$broadcast("updateRevenueShare:totals",o.data)}).catch(function(){e.$broadcast("updateRevenueShare:totals")})}]),angular.module("app.customer-insights").controller("CustomerInsightsCtrl",["$scope","$state","$filter","URLService",function(e,t,n,r){e.period=t.params.period,e.startDate=t.params.from?n("date")(t.params.from,"dd MMM yyyy"):"",e.endDate=t.params.to?n("date")(t.params.to,"dd MMM yyyy"):"",e.params=r.format(),e.paramsMoment=r.formatMoment(),e.customPeriod=function(e){e.period="custom",t.go(t.current,e,{reload:!0,inherit:!0,notify:!0})}}]),angular.module("app.customer-insights").controller("CustomerInsightsRevenueShareCtrl",["$scope","$filter",function(r,e){r.setup=function(){if(r.customers&&r.totals){var e=Math.min(r.customers.length,10);r.slider={value:e,options:{floor:1,ceil:r.customers.length}},r.$watch("slider.value",function(e){var t=_.first(r.customers,e),n=_.reduce(t,function(e,t){return e+t.total_transaction_amount},0);r.cumulative_revenue_share=100*Math.min(n/r.totals.volume,1)}),r.$broadcast("fetchedRevenueShareData")}},r.$on("updateRevenueShare:customers",function(e,t){t&&t.length?(r.customers=t,r.setup()):r.$broadcast("fetchedRevenueShareData")}),r.$on("updateRevenueShare:totals",function(e,t){t?(r.totals=t,r.setup()):r.$broadcast("fetchedRevenueShareData")})}]),angular.module("app.customer-insights").controller("CustomerInsightsTimeDistributionCtrl",["$scope","CustomerInsightsTimeDistribution",function(e,t){t.fetch().then(function(){e.hasPayments=t.hasPayments,e.timeDistributionData=t.data,e.$broadcast("fetchedTimeDistribution")}).catch(function(){e.$broadcast("fetchedTimeDistribution")})}]),angular.module("app.customer-insights").controller("CustomerInsightsTopCustomersCtrl",["$scope","$rootScope","CustomerInsightSpenders",function(n,e,t){n.view="spend",n.limit=10,n.increaseLimit=function(){n.limit=Math.min(n.customers.length,n.limit+10)},n.populate=function(){t.fetch({type:"spend"===n.view?"biggest":"regular"}).then(function(){n.customers=t.data,n.meta=t.meta;_.reduce(t.data,function(e,t){return e+t.total_transaction_amount},0);n.$broadcast("fetchedSpenders"),e.$broadcast("updateRevenueShare:customers",n.customers)}).catch(function(){n.$broadcast("fetchedSpenders",[]),e.$broadcast("updateRevenueShare:customers",[])})},n.$watch("view",function(){e.$broadcast("resetView"),n.populate()}),n.changeView=function(e){n.view=e},n.$on("updateRevenueShare:totals",function(e,t){t&&(n.totals=t)})}]),angular.module("app.customer-insights").directive("daysChart",function(){return{restrict:"E",replace:!0,scope:{key:"=",data:"="},template:'<div class="days-chart">            <div class="days-chart-bubbles">                <div class="days-chart-bubble" ng-repeat="bubble in bubbles" uib-tooltip="{{bubble.tooltip}}" tooltip-append-to-body="true">                    <span ng-style="{width: bubble.size, height: bubble.size}" ng-class="{\'is-largest\': bubble.largest}"></span>                    <span class="text-capitalize">{{bubble.label | limitTo : 3}}</span>                </div>            </div>            <p>Your busiest day of the week was: <b class="text-capitalize">{{busiestDay.day}}</b></p>            </div>',link:function(r,e,t,n){var o=_.max(_.pluck(r.data,"payments"));r.busiestDay=_.max(r.data,function(e){return e.payments}),r.bubbles=_.map(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],function(e){var t=_.findWhere(r.data,{day:e})||{day:e,payments:0},n=parseInt(t.payments/o*30);return{tooltip:t.day+"s : "+t.payments+(1===t.payments?" payment":" payments"),label:t.day,size:n+1+"px",largest:r.busiestDay.day===e}})}}}),angular.module("app.customer-insights").directive("hoursChart",function(){return{restrict:"E",replace:!0,scope:{key:"=",data:"="},template:'<div class="hours-chart">            <div class="hours-chart-bubbles">                <div class="hours-chart-bubble" ng-repeat="bubble in bubbles" uib-tooltip="{{bubble.tooltip}}" tooltip-append-to-body="true">                    <span ng-style="{height: bubble.size}" ng-class="{\'is-largest\': bubble.largest}"></span>                </div>                <div class="hours-chart-label">                    <span>12 - 1AM</span>                    <span>NOON</span>                    <span>11 - 12PM</span>                </div>            </div>            <p>Your busiest time of day was <b class="text-capitalize">{{busiestHour.hour}}</b></p>            </div>',link:function(e,t,n,r){var s=_.max(_.pluck(e.data,"payments")),o=_.range(0,24),c=_.reject(e.data,function(e){return isNaN(e.hour)});c=_.sortBy(_.map(c,function(e){return e.hour=parseInt(e.hour),e}),"hour");var u=_.max(c,function(e){return e.payments});e.bubbles=_.map(o,function(e,t){var n=angular.copy(c),r=_.findWhere(n,{hour:e})||{hour:e,payments:0};if(0===r.hour)r.hour="12 - 1 AM";else if(r.hour<12){var o=r.hour+" - "+(r.hour+1);r.hour=o+" AM"}else if(12===r.hour)r.hour="12 - 1 PM";else{var a=r.hour-12;o=a+" - "+(a+1);r.hour=o+" PM"}var i=parseInt(r.payments/s*60);return{hour:r.hour,payments:r.payments,tooltip:r.hour+": "+r.payments+(1===r.payments?" payment":" payments"),size:i+1+"px",largest:u.hour===e}}),e.busiestHour=_.max(e.bubbles,function(e){return e.payments})}}}),angular.module("app.customer-insights").factory("CustomerInsightSpenders",["API","URLService",function(n,r){var o={data:[],meta:{},fetch:function(e){var t=r.format();return e&&(t=angular.extend(t,e)),n.one("insights/spenders").get(t).then(function(e){return o.meta=e.meta,o.data=_.map(e.data,function(e){return angular.extend(e,e.customer),e}),o.data})}};return o}]),angular.module("app.customer-insights").factory("CustomerInsightsTimeDistribution",["API","URLService",function(t,n){var r={data:[],hasPayments:!1,fetch:function(){var e=n.format();return t.one("insights/activity").get(e).then(function(e){r.data=e.data,r.hasPayments=_.reduce(e.data.hours,function(e,t){return e+t.payments},0)})}};return r}]),angular.module("app.customer-insights").factory("CustomerInsightsTotals",["API","URLService",function(t,n){var r={data:{},fetch:function(){var e=n.format();return t.one("insights/totals").get(e).then(function(e){r.data=e.data})}};return r}]),angular.module("app.customer-insights").factory("CustomerInsightsTrend",["API","URLService",function(t,n){var i={data:[],fetch:function(){var a=n.format(),e=n.getDurations();return t.one("insights/trend").get(a).then(function(o){var r=_.map(e,function(e){return t=o.data,n=e,r=a.period,t=_.find(t,function(e){var t=moment(new Date(e.from));return n.from.isSame(t,r)})||{new_customers:0,returning_customers:0},n.new_customers=t.new_customers,n.returning_customers=t.returning_customers,n.all_customers=t.new_customers+t.returning_customers,n.retention=0,n;var t,n,r});i.data=_.map(r,function(e,t){if(0<t){var n=r[t-1];0<n.all_customers&&(e.retention=e.returning_customers/n.all_customers*100)}return e})})}};return i}]),angular.module("app.direct-debit").controller("AccountsListCtrl",["$state","$scope","$rootScope","$stateParams","$filter","AccountsData","ngDialog","API","Notification",function(e,r,t,n,o,a,i,s,c){a.fetch().then(function(e){r.provisionedAccounts=e.data,r.meta=e.meta}),r.balance={},r.refreshAccountBalance=function(n){s.one("directdebit/"+n+"/balance").get().then(function(e){var t=e.data.balance;r.provisionedAccounts.map(function(e){return e.account_code===n&&(e.balance=t),e}),c.success("Balance retrieved successfully")}).catch(function(e){c.error("Error Occured",e)})}}]),angular.module("app.direct-debit").controller("PaymentsListCtrl",["$state","$scope","$rootScope","$stateParams","$filter","PaymentsData","ngDialog","API",function(e,t,n,r,o,a,i,s){a.fetch().then(function(e){t.payments=e.data,t.meta=e.meta})}]).controller("SinglePaymentCtrl",["$state","$scope","$rootScope","$stateParams","ngDialog","payment",function(e,t,n,r,o,a){(a=a.data).has_authorization=a.authorization&&!_.isEmpty(a.authorization),t.payment=a}]),angular.module("app.direct-debit").factory("AccountsData",["API",function(e){var t={data:[],meta:{},params:{},fetch:function(){return e.one("directdebit/account").get().then(function(e){return t.data=e.data,t.meta=e.meta,e})}};return t}]),angular.module("app.direct-debit").factory("PaymentsData",["API",function(e){var t={data:[],meta:{},params:{},fetch:function(){return e.one("directdebit/transaction").get().then(function(e){return t.data=e.data,t.meta=e.meta,e})}};return t}]),FilesModule.config(["$stateProvider",function(e){e.state("files.view",{url:"?location",title:"Display File",templateUrl:"modules/files/display-file/views/index.html",controller:"FileDisplayCtrl"})}]);_excluded=["id","page"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}OrderModule.controller("OrdersFiltersCtrl",["$scope","$state","$stateParams","utils","OrderFactory","ProductOrdersFilters","$timeout","Notification",function(o,a,e,t,n,i,r,s){o.query=angular.copy(e),o.isOrdersPage=!0,o.productFilterVisible=!1,o.products=[],o.copyProducts=angular.copy(o.products),o.filteredProducts=[],o.productSearch="",o.productSearchCopy=angular.copy(o.productSearch),o.orderSearch="";var c=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=_objectSpread({perPage:10},e);n.fetchProducts(t).then(function(e){u(e)}).catch(function(e){s.error("Could not fetch products",e)})},u=function(e){var t=e.data;o.products=t},l=function(e,t){var n=t.id;return e.filter(function(e){return e.id!==n})},d=function(e,t){return[t].concat(_toConsumableArray(e))};o.toggleProductFilter=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];(o.productFilterVisible=e)&&r(function(){var e=document.getElementById("productSearch");e&&(e.focus(),e.select())})},o.onFilterOrders=function(e){o.$broadcast("$locationChangeSuccess");var t=i.getProductIds(o.filteredProducts);e.products=t;e.id,e.page;var n=_objectWithoutProperties(e,_excluded),r=i.filterOrders(n);a.go("orders.list",_objectSpread({},r),{reload:!0,inherit:!0})},o.populateOrdersFilters=function(){e.delivered&&"false"===e.delivered&&(o.query.status="false"),e.refunded&&"true"===e.refunded&&(o.query.status="refunded"),e.is_viewed&&"false"===e.is_viewed&&(o.query.status="new")},o.$on("fetchedProduct",function(e,t){o.filteredProducts=d(o.filteredProducts,t)}),o.clearFilters=function(){a.go(a.current,{id:a.params.id},{reload:!0,inherit:!1})},o.includeProductToFilters=function(e){o.filteredProducts=d(o.filteredProducts,e),o.toggleProductFilter(!1),o.productSearch="",r(function(){o.products=l(o.products,e)})},o.removeProductFromFilters=function(e){r(function(){o.filteredProducts=l(o.filteredProducts,e)}),o.products=d(o.products,e)},o.$watch("productSearch",_.debounce(function(e,t){e!==t&&e!==o.productSearchCopy&&(o.productSearchCopy=e,c({search:e}))},800)),o.clearSearch=function(){r(function(){o.productSearch=""})};o.populateOrdersFilters(),c()}]),OrderModule.controller("OrdersCtrl",["$scope","$rootScope","$state","ngDialog","OrderFactory","ProductConstants","ProductOrdersFilters","Notification","utils","OrderUtils","ordersList",function(r,o,a,i,t,e,s,n,c,u,l){var d=c.pipe,p=c.sideEffect;r.query=angular.copy(a.params),delete r.query.id,r.searchOrders=angular.copy(r.query.search)||"",r.loading=!0,r.orders=l.data,r.copyOrders=angular.copy(r.orders),r.ordersMeta=l.meta,r.revenues=u.calculateRevenues(l.meta.revenue),r.params=angular.copy(a.params),r.ordersNotFound=Object.keys(r.query).some(function(e){return r.query[e]}),r.orderStatus=e.ORDER_STATUSES,r.selectingMultipleOrders=!1,r.selectedOrdersCount=0,r.allOrdersSelected=!1,r.refunds={refundPayment:!0},r.activeOrder=null;var f=function(e){r.orders=e.data||e},m=function(e){r.selectedOrdersCount=e};r.toggleSelectingMultipleOrders=function(){r.selectingMultipleOrders=!r.selectingMultipleOrders,r.allOrdersSelected=!1,r.selectedOrdersCount=0,r.selectingMultipleOrders?r.orders=u.sortOrders(r.orders):r.orders=angular.copy(r.copyOrders)},r.viewOrder=function(e){if(e.id.toString()!==a.params.id)return e.is_viewed||(e.is_viewed=!0),a.go("orders.list.one.overview",{id:e.id},{inherit:!0})},r.generateOrdersFilters=function(e){var t=s.generateProductFilters(a.params),n=s.generateOrdersFilters(e,a.params);r.activeProductFilters=t,o.$state.activeFilterValues=[].concat(_toConsumableArray(t),_toConsumableArray(n))};r.removeFilterTag=function(e){var t=s.removeFilterTag(e,r.query);a.go("orders.list",_objectSpread({},t),{reload:!0,inherit:!1})},r.checkOrder=function(){d(u.getSelectedOrdersCount,p(m))(r.orders)},r.checkAllOrders=function(e){r.allOrdersSelected=e.target.checked,r.allOrdersSelected?d(u.selectAllOrders,p(f),u.getSelectedOrdersCount,p(m))(r.orders):d(u.deselectAllOrders,p(f),u.getSelectedOrdersCount,p(m))(r.orders)},r.showBulkOperationModal=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"delivered",t=u.getSelectedOrderIds(r.orders),n={delivered:"modules/orders/views/modals/bulk-mark-orders-delivered.html",cancelled:"modules/orders/views/modals/bulk-mark-orders-cancelled.html",refunded:"modules/orders/views/modals/bulk-mark-orders-refunded.html"}[e];i.openConfirm({template:n,scope:r,controller:"OrdersPopupCtrl",data:{orders:r.orders,orderIds:t,ordersCount:r.selectedOrdersCount,scope:r,refunds:r.refunds}}).then(function(){a.reload()})},r.showExport=function(){i.open({template:"/modules/orders/views/modals/orders-export.html",controller:"ProductOrdersExportCtrl",width:700,showClose:!0,trapFocus:!1,appendClassName:"export-orders-modal",resolve:{DefaultKeys:["LocalAPI",function(e){return e.all("transaction_export_keys").getList()}]}})},r.$watch("query.search",_.debounce(function(e,t){e!==t&&a.go("orders.list",_objectSpread({},r.query),{reload:!0,inherit:!0})},800)),r.clearOrderSearch=function(){r.query.search=""},r.$on("activeOrderFetched",function(e,t){r.activeOrder=t});var g,h,y;r.generateOrdersFilters(["status","delivered","refunded","delivered_at","from","to","products"]),g=o.$state.activeFilterValues,h=angular.copy(g),y=s.getProductIdsFromFilters(h),Promise.all(y.map(function(e){return t.fetchProductById(e).then(function(e){r.$broadcast("fetchedProduct",e.data);var t=s.replaceProductFilterNames(e,h);o.$state.activeFilterValues=angular.copy(t)}).catch(function(e){return n.error("Product filters could not be updated",e)})}))}]),OrderModule.controller("OrdersOverviewCtrl",["$scope","$state","$stateParams","activeOrder","Notification","OrderFactory","ProductFactory","ProductOrdersService","utils","ngDialog","$timeout","OrderLoggingService","OrderUtils",function(o,n,e,t,r,a,i,s,c,u,l,d,p){var f=c.pipeAsync,m=c.sideEffect,g=c.currencyBaseUnitToSubUnit,h=d.logOrderRefunded;o.refunds={refundPayment:!0,amountToRefund:null,maxRefundableAmount:null,merchantNote:null},o.activeOrder=t.data,o.activeOrderCopy=angular.copy(o.activeOrder),o.logs=[],o.logsCollapsed=!1,o.firstLetterOfPayerName=null,o.payerFullName=null,o.payerEmail=null,o.payerPhone=null,o.refundFormVisible=!1,o.hasDigitalProducts=o.activeOrder.items.some(function(e){return"digital"===e.product_level_type});var y=function(){o.refunds.amountToRefund=s.getRefundAmount(o.activeOrder.amount,o.activeOrder.shipping_fees,o.activeOrder.refunded_amount),o.refunds.maxRefundableAmount=angular.copy(o.refunds.amountToRefund)},b=function(e){return e&&e.payer&&e.payer.first_name||""},v=function(e){o.payerFullName=e},_=function(e){o.firstLetterOfPayerName=e},S=function(e){o.payerEmail=e},P=function(e){o.payerPhone=e},w=function(e){o.isActiveOrderDelivered="delivered"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderPaid="paid"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderCancelled="cancelled"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderRefunded=e.refunded,o.isActiveOrderNotFullyRefunded=e.refunded&&!e.fully_refunded,o.isActiveOrderFullyRefunded=e.refunded&&e.fully_refunded},C=function(e){o.logs=e};o.resetAmountToRefund=function(){o.refunds.amountToRefund=angular.copy(o.refunds.maxRefundableAmount)},o.toggleRefundForm=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];o.refundFormVisible=e},o.toggleRefundCheckbox=function(){o.refunds.refundPayment||(o.refunds.amountToRefund=angular.copy(o.refunds.maxRefundableAmount))};o.createVariantNameFromOrder=function(e){return p.createVariantNameFromOrder(e)},o.showCancelOrderModal=function(e){u.openConfirm({template:"modules/orders/views/modals/cancel-order.html",scope:o,controller:"OrdersPopupCtrl",data:{payload:e,scope:o}}).then(function(){n.reload()})},o.showMarkOrderAsDeliveredModal=function(e){u.openConfirm({template:"modules/orders/views/modals/mark-order-delivered.html",scope:o,controller:"OrdersPopupCtrl",data:{payload:e,scope:o}}).then(function(){n.reload()})},o.collapseLogs=function(){!function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];o.logsCollapsed=e}(!0)},o.showResendDigitalDownloadDialog=function(){u.open({template:"/modules/products/views/modals/resend-digital-download-link.html",controller:"OrdersPopupCtrl",scope:o,data:{order:o.activeOrder}})},o.refundOrder=function(){var e=g(o.refunds.amountToRefund),t={id:o.activeOrder.id,status:"refunded",amount_to_refund:e};i.updateOrderStatus(t).then(function(){r.success("Updated successfully","Order has been refunded successfully"),o.refundFormVisible=!1,o.$broadcast("orderRefunded"),h(o.activeOrder,e),n.reload()}).catch(function(e){r.error("Could not refund this order",e),o.$broadcast("orderRefunded",!1)})};o.activeOrder&&(o.$emit("activeOrderFetched",o.activeOrder),f(m(w),function(){return e=o.activeOrder,n=b(e),r=(t=e)&&t.payer&&t.payer.last_name||"","".concat(n," ").concat(r);var e,t,n,r},m(v),function(){return e=o.activeOrder,(t=b(e))&&t.substring(0,1)||"";var e,t},m(_),function(){return o.activeOrder.payer.email},m(S),function(){return function(e){if(e.payer){if(e.payer.international_format_phone)return e.payer.international_format_phone;if(e.payer.phone)return"+".concat(e.payer.phone)}return null}(o.activeOrder)},m(P),y,m(function(){o.refundButtonText=o.isActiveOrderNotFullyRefunded?"Complete refund":"Refund payment"}),function(){return a.fetchOrderLogs(e.id)},s.removeSameTimeLogs,m(C))(o.activeOrder).catch(function(e){r.error("Could not fetch this order",e)}).finally(function(){l(function(){o.$broadcast("fetchedActiveOrder")})}))}]),OrderModule.controller("OrdersPopupCtrl",["$scope","$state","Notification","ProductFactory","OrderFactory","OrderUtils","utils","ngDialog",function(i,s,c,u,a,l,e,t){var d=e.pipe,p=e.currencyBaseUnitToSubUnit,n=i.ngDialogData.scope;i.closeCancelOrderModal=function(){i.closeThisDialog(),n.resetAmountToRefund()},i.cancelOrder=function(e){var t,n,r=(t={id:e.id,status:"cancelled"},n="Order has been cancelled successfully",i.refunds.refundPayment&&(t.status="refunded",t.amount_to_refund=p(Number(i.refunds.amountToRefund)),n="Order has been cancelled and refunded successfully"),i.refunds.merchantNote&&(t.merchant_note=i.refunds.merchantNote),{params:t,notification:n}),o=r.params,a=r.notification;u.updateOrderStatus(o).then(function(){c.success("Updated successfully",a),s.reload()}).catch(function(e){c.error("Could not cancel this order",e)})},i.markOrderAsDelivered=function(e){var t=e.id;u.updateOrderStatus({id:t,status:"delivered"}).then(function(){c.success("Updated successfully","Order has been marked as delivered"),s.reload()}).catch(function(e){c.error("Could not mark as delivered",e)})},i.markOrdersAsDelivered=function(e,t,n){if(d(l.getSelectedOrders,l.checkIsAnyOrderDelivered)(t))return c.error("Order statuses could not be updated","One or more orders are already delivered");a.bulkUpdateOrders({status:"delivered",orders:e}).then(function(){c.success("Order statuses updated","Marked as delivered"),n.toggleSelectingMultipleOrders(),s.reload()}).catch(function(e){c.error("Order statuses could not be updated",e)})},i.markOrdersAsCancelled=function(e,t,n){var r={status:"cancelled",orders:e},o="Marked as cancelled";if(d(l.getSelectedOrders,l.checkIsAnyOrderCancelled)(t))return c.error("Order statuses could not be updated","One or more orders are already cancelled");n.refunds.refundPayment&&(r.refund_customer=!0,o="Marked as refunded"),a.bulkUpdateOrders(r).then(function(){c.success("Order statuses updated",o),n.toggleSelectingMultipleOrders(),s.reload()}).catch(function(e){c.error("Order statuses could not be updated",e)})},i.markOrdersAsRefunded=function(e,t,n){if(d(l.getSelectedOrders,l.checkIsAnyRefundedOrder)(t))return c.error("Order statuses could not be updated","One or more orders are already refunded");a.bulkUpdateOrders({status:"refunded",orders:e}).then(function(){c.success("Order statuses updated","Marked as refunded"),n.toggleSelectingMultipleOrders(),s.reload()}).catch(function(e){var t=e&&e.data&&e.data.data&&e.data.data.failed;t&&t.length?t.forEach(function(e){return c.error("Order ID: ".concat(e.id),e.message)}):c.error("Order statuses could not be updated",e)})},i.resendDigitalDownloadLink=function(e){a.resendDigitalDownloadEmail(e.id).then(function(){i.$broadcast("sentDigitalDownloadEmail"),t.closeAll(),c.success("Download link sent!","Your customer can now download their digital files."),s.reload()}).catch(function(e){i.$broadcast("sentDigitalDownloadEmail",!1),c.error("Download link could not be sent",e)})}}]),OrderModule.controller("OrdersShippingCtrl",["$scope","activeOrder","ProductFactory","OrderFactory","Notification","utils","OrderUtils","CountryService","$state","$timeout","OrderLoggingService","availableShippingRegions",function(t,e,n,r,o,a,i,s,c,u,l,d){var p=a.pipeAsync,f=a.sideEffect,m=l.logAddressFieldsEvent;t.activeOrder=e.data,t.activeOrderCopy=angular.copy(t.activeOrder),t.editingShippingDetails=!1,t.editing=!1,t.countriesList=[],t.availableRegions=_.flatten(d),t.phone={selectedCallingCode:t.activeOrder&&t.activeOrder.shipping&&t.activeOrder.shipping.agent&&t.activeOrder.shipping.agent.calling_code||"234"},t.isDeliveryAgentAvailable=!1,t.firstLetterOfAgentName=null,t.agentFullName=null,t.agentPhone=null,t.shippingInfoForm={},t.deliveryAgentForm={};var g=function(e){t.firstLetterOfAgentName=e},h=function(e){t.agentFullName=e},y=function(e){t.agentPhone=e},b=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t.editingShippingDetails=e,t.editingDeliveryAgent=e};t.toggleEditingShippingDetails=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t.editingShippingDetails=e,t.editingDeliveryAgent=!1},t.toggleEditingDeliveryAgent=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t.editingDeliveryAgent=e,t.editingShippingDetails=!1},t.cancelEdit=function(){b(!1),t.activeOrderCopy=angular.copy(t.activeOrder),t.deliveryAgentForm.formElement.$setPristine(),t.deliveryAgentForm.formElement.$setUntouched(),t.shippingInfoForm.formElement.$setPristine(),t.shippingInfoForm.formElement.$setUntouched()},t.saveShippingDetails=function(){n.updateOrderShipment(t.activeOrderCopy).then(function(){b(!1),o.success("Updated successfully","Shipment info changed"),c.reload()}).catch(function(e){o.error("Shipment info could not be saved",e)}),m()},t.saveDeliveryAgentDetails=function(){var e={agent:{first_name:t.activeOrderCopy.shipping.agent.first_name,last_name:t.activeOrderCopy.shipping.agent.last_name,calling_code:t.phone.selectedCallingCode,phone_number:t.activeOrderCopy.shipping.agent.phone_number,delivery_company:t.activeOrderCopy.shipping.agent.delivery_company,delivery_tracking_link:t.activeOrderCopy.shipping.agent.delivery_tracking_link}};r.saveDeliveryAgent(t.activeOrderCopy.id,e).then(function(){b(!1),o.success("Updated successfully","Shipment info changed"),c.reload()}).catch(function(e){o.error("Shipment info could not be saved",e)})};var v=function(e){t.countriesList=e};t.activeOrder&&(t.$emit("activeOrderFetched",t.activeOrder),t.isDeliveryAgentAvailable=t.activeOrderCopy.shipping&&t.activeOrderCopy.shipping.agent&&t.activeOrderCopy.shipping.agent.phone_number,p(i.getFirstLetterOfAgentName,f(g),function(){return i.getAgentFullName(t.activeOrder)},f(h),function(){return i.getAgentPhone(t.activeOrder)},f(y),s.getCountries,i.removeFirstCharFromPhoneCodes,f(v))(t.activeOrder).catch(function(e){o.error("Could not fetch this order",e)}).finally(function(){u(function(){t.$broadcast("fetchedActiveOrder")})}))}]),OrderModule.factory("OrderFactory",["API","$stateParams",function(n,e){return{fetchOrders:function(){return n.one("order").get(e)},fetchOrdersByFilter:function(e){return n.one("order".concat(e)).get()},fetchOrder:function(e){return n.one("order",e).get()},fetchOrderLogs:function(e){return n.one("order/".concat(e,"/log")).get().then(function(e){return e.data})},fetchProducts:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return n.one("product").get(e)},fetchProductById:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return n.one("product",e).get()},bulkUpdateOrders:function(e){return n.one("order").customPUT(e)},saveDeliveryAgent:function(e,t){return n.one("order",e).customPUT(t)},fetchPendingOrdersCount:function(){return n.one("order/metrics").get().then(function(e){return e.data.pending_orders_count})},resendDigitalDownloadEmail:function(e){return n.all("order/digital/resend").post({order_id:e})}}}]),OrderModule.service("OrderLoggingService",["AmplitudeService",function(e){var r=e.logEvent;return{logAddressFieldsEvent:function(){r("Clicked save address fields button")},logOrderRefunded:function(e,t){var n=e.shipping_fees||0;r("Payment refunded",{FullRefund:e+n===t})},logOrderCancelled:function(e,t){var n={Refund:e};t&&(n.Note=t),r("Order cancelled",n)}}}]),OrderModule.factory("OrderUtils",[function(){var t=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.selected})},n=function(e){return"cancelled"===e.status.toLowerCase()||e.refunded};return{removeFirstCharFromPhoneCodes:function(e){return e.map(function(e){return{name:e.name,code:e.callingCodes[0].substring(1)}})},calculateRevenues:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=Object.keys(t);return e.length?e.map(function(e){return{currency:e.toString(),amount:t[e]}}):[]},sortOrders:function(e){var t=e.filter(function(e){return e.refunded}),n=e.filter(function(e){return!e.refunded}),r=n.filter(function(e){return"paid"===e.status.toLowerCase()}),o=n.filter(function(e){return"delivered"===e.status.toLowerCase()}),a=n.filter(function(e){return"cancelled"===e.status.toLowerCase()}),i=[].concat(_toConsumableArray(r),_toConsumableArray(o)).sort(function(e,t){return new Date(t.created_at)-new Date(e.created_at)});return[].concat(_toConsumableArray(i),_toConsumableArray(a),_toConsumableArray(t))},getSelectedOrders:t,getSelectedOrderIds:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return t(e).map(function(e){return e.id})},getSelectedOrdersCount:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return t(e).length},selectAllOrders:function(e){return e.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:!n(e)})})},deselectAllOrders:function(e){return e.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:!1})})},checkIsAnyOrderDelivered:function(e){return e.some(function(e){return"delivered"===e.status})},checkIsAnyOrderCancelled:function(e){return e.some(function(e){return"cancelled"===e.status&&!e.refunded})},checkIsAnyRefundedOrder:function(e){return e.some(function(e){return e.refunded})},getFirstLetterOfAgentName:function(e){return e&&e.shipping&&e.shipping.agent&&e.shipping.agent.first_name&&e.shipping.agent.first_name.substring(0,1)||null},getAgentFullName:function(e){return e&&e.shipping&&e.shipping.agent&&e.shipping.agent.first_name+" "+e.shipping.agent.last_name||null},getAgentPhone:function(e){return e&&e.shipping&&e.shipping.agent&&e.shipping.agent.calling_code+e.shipping.agent.phone_number||null},createVariantNameFromOrder:function(e){return[e.value_1_name,e.value_2_name,e.value_3_name].filter(function(e){return null!==e}).join(", ")}}}]),PlansModule.controller("CreatePageForPlanCtrl",["$scope","$rootScope","utils","$state","PlanFactory","subaccounts","transactionSplits","Notification",function(n,r,o,a,i,e,t,s){n.subaccounts=e.data,n.transactionSplits=t.data,n.page={type:"subscription",migrate:"test"===r.User.display_state,currency:r.Business.default_currency,metadata:{}},n.newPlan={currency:n.page.currency},n.customFields=[{displayName:""}],n.toggleAdvanced=function(){n.advancedIsVisible=!n.advancedIsVisible,n.page.slug=null,n.page.redirect_url=null,n.customFields=[{displayName:""}]},n.$on("uploadCompleted",function(e,t){n.page.metadata.image_path=t.uploadPath,n.page_image=null}),n.createSubscriptionPage=function(){var t=_objectSpread(_objectSpread({},n.page),{},{amount:o.currencyBaseUnitToSubUnit(n.page.amount)});if(t.custom_fields=[],t.plan=n.plan.id,n.customFields.forEach(function(e){e.displayName&&t.custom_fields.push({display_name:e.displayName,variable_name:e.displayName.replace(/-|\s/g,"_").toLowerCase()})}),t.metadata.transaction_charge){var e=n.page.plan?n.page.plan.amount:n.page.amount;t.metadata.transaction_charge>e&&(n.$broadcast("pageCreated",!1),s.error("Flat Fee Split Error","Your flat fee split cannot be more than the "+(n.page.plan?"plan":"page")+"amount"))}t.currency=t.plan?t.plan.currency:r.Business.default_currency,t.type="subscription",i.createSubscriptionPage(t).then(function(){s.success("Created successfully","Subscription page has been created successfully"),n.closeThisDialog(),a.reload()}).catch(function(e){n.$broadcast("pageCreated",!1),s.error("Could not create this page",e)})}}]);_excluded=["page"],_excluded2=["page"];function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}PlansModule.controller("PlansListCtrl",["$scope","$state","$stateParams","plans","ngDialog","PlanFilters","$i18next",function(o,a,e,t,n,r,i){o.plans=t.data,o.meta=t.meta,o.filters=angular.copy(e),o.numberOfSubscriptionsFilter=r.getFilter(o.filters,{filter:"subscriptions",defaultValue:"5",tagLabel:i.t("plans.filters.noOfSubscriptions")}),o.amountFilter=r.getFilter(o.filters,{filter:"amount",defaultValue:"100",tagLabel:i.t("plans.filters.amount"),includeCurrency:!0}),o.totalRevenueFilter=r.getFilter(o.filters,{filter:"revenue",defaultValue:"1000",tagLabel:i.t("plans.filters.totalRevenue"),includeCurrency:!0}),o.filterTags=r.getFilterTags(o.filters,[o.numberOfSubscriptionsFilter,o.amountFilter,o.totalRevenueFilter]),o.showCreatePlanModal=function(){n.open({template:"/modules/plans/views/modals/create-plan.html",controller:"PlanPopupCtrl",scope:o})},o.reloadList=function(){var e=o.filters,t=(e.page,_objectWithoutProperties(e,_excluded)),n=r.formatFiltersForApi(t,[o.numberOfSubscriptionsFilter,o.amountFilter,o.totalRevenueFilter]);a.go("plans.list",n,{reload:!0,inherit:!1})},o.removeFilterTag=function(e){var t=o.filters,n=(t[e],_objectWithoutProperties(t,[e].map(_toPropertyKey)));"period"===e&&(n.from=void 0,n.to=void 0),a.go("plans.list",n,{reload:!0,inherit:!1})},o.$watch("search",function(e,t){if(e!==t){var n=o.filters,r=(n.page,_objectWithoutProperties(n,_excluded2));a.go("plans.list",{restFilters:r,search:e},{reload:!0,inherit:!1})}}),o.clearSearch=function(){o.filters.search=""}}]),PlansModule.controller("PlanCtrl",["$scope","$state","plan","ngDialog","PlanFactory","Notification","utils","SubscriptionUtils",function(n,r,e,t,o,a,i,s){n.plan=e.data,n.planCopy=angular.copy(n.plan),n.planCopy.amount=i.currencySubUnitToBaseUnit(n.planCopy.amount),n.subscriptions=n.plan.subscriptions,n.subscribers=n.plan.subscribers,n.pagesStatus="published",n.publishedPages=n.plan.pages.filter(function(e){return e.published}),n.unpublishedPages=n.plan.pages.filter(function(e){return!e.published}),n.pages=n.publishedPages,n.getSubscriberFullName=s.getSubscriberFullName,n.getPlanStatus=function(){return n.plan.is_deleted?"deleted":n.plan.is_archived?"archived":"active"},n.resetPlan=function(){n.planCopy=angular.copy(n.plan)},n.showEditPlanModal=function(){t.open({template:"/modules/plans/views/modals/edit-plan.html",controller:"PlanPopupCtrl",scope:n})},n.showDeletePlanModal=function(){t.open({template:"/modules/plans/views/modals/delete-plan.html",controller:"PlanPopupCtrl",scope:n})},n.showArchivePlanModal=function(){t.open({template:"/modules/plans/views/modals/archive-plan.html",controller:"PlanPopupCtrl",scope:n})},n.showCancelAllSubscriptionsModal=function(){t.open({template:"/modules/plans/views/modals/cancel-all-subscriptions.html",controller:"PlanPopupCtrl",scope:n})},n.closeEditPlanName=function(){n.editingPlanName=!1,n.resetPlan()},n.togglePagesStatus=function(e){n.pages="published"===e?n.publishedPages:n.unpublishedPages,n.pagesStatus=e},n.updatePlanName=function(){o.updatePlan(n.plan.id,{name:n.planCopy.name}).then(function(){a.success("Updated successfully","Plan name has been updated successfully"),r.reload()}).catch(function(e){n.$broadcast("planUpdated",!1),a.error("Could not update this plan name",e)})},n.updatePlan=function(){var e=n.planCopy,t={name:e.name,currency:e.currency,interval:e.interval,description:n.planCopy.description||null,amount:i.currencyBaseUnitToSubUnit(n.planCopy.amount),invoice_limit:n.planCopy.invoice_limit||0};o.updatePlan(n.plan.id,t).then(function(){a.success("Updated successfully","Plan has been updated successfully"),r.reload()}).catch(function(e){n.resetPlan(),n.$broadcast("planUpdated",!1),a.error("Could not update this plan",e)})}}]),PlansModule.controller("PlanPagesCtrl",["$scope","ngDialog",function(t,n){t.getPageUrl=function(e){return"".concat(settings.landingPage,"/pay/").concat(e.slug)},t.showNewPageDialog=function(){n.open({template:"/modules/plans/views/modals/create-page.html",controller:"CreatePageForPlanCtrl",showClose:!0,closeByDocument:!1,scope:t,resolve:{subaccounts:["API","$stateParams",function(e,t){return e.one("subaccount").get(t)}],transactionSplits:["TransactionSplitsData",function(e){return e.fetch({active:!0})}]}})},t.showDeletePageDialog=function(e){n.open({template:"/modules/plans/views/modals/delete-page.html",controller:"PlanPopupCtrl",scope:t,data:{page:e}})}}]),PlansModule.controller("PlanPopupCtrl",["$scope","$state","$rootScope","utils","PlanFactory","PlanUtils","Notification","PlanConstants","$timeout",function(o,a,e,t,i,n,s,r,c){o.frequencyOptions=r.PLAN_FREQUENCY_OPTIONS,o.newPlan={currency:e.Business.default_currency},o.cancelExistingSubscriptions=!1,o.createPlan=function(){var r=_objectSpread(_objectSpread({},o.newPlan),{},{amount:t.currencyBaseUnitToSubUnit(o.newPlan.amount)});i.createPlan(r).then(function(e){s.success("Created successfully","Plan has been created successfully");var t=e.data;if(r.createPage){var n={name:"Subscribe to plan: ".concat(t.name),plan:t.id};i.createSubscriptionPage(n).then(function(e){o.createdPage=e.data,o.createdPage.url="".concat(settings.landingPage,"/pay/").concat(e.data.slug),a.go("plans.one.subscriptions",{id:t.id})}).catch(function(e){s.error("Could not create page for plan",e),o.closeThisDialog()})}else o.closeThisDialog(),a.go("plans.one.subscriptions",{id:t.id})}).catch(function(e){s.error("Could not create this plan",e),o.$broadcast("planCreated",!1)})},o.archivePlan=function(){i.archivePlan(o.plan.id,o.cancelExistingSubscriptions).then(function(){var e=o.cancelExistingSubscriptions?"Plan has been archived and all subscriptions to this plan have been cancelled":"Plan has been archived successfully";s.success("Archived successfully",e),o.closeThisDialog(),a.reload()}).catch(function(e){o.$broadcast("planArchived",!1),s.error("Could not archive this plan",e)})},o.cancelAllSubscriptions=function(){i.cancelAllSubscriptions(o.plan.id).then(function(){s.success("Subscriptions cancelled","All subscriptions to this plan have been cancelled"),o.closeThisDialog(),a.reload()}).catch(function(e){o.$broadcast("allSubscriptionsCancelled",!1),s.error("Could not cancel subscriptions",e)})},o.deletePlan=function(){i.deletePlan(o.plan.id).then(function(){s.success("Deleted successfully","Plan was deleted successfully"),a.go("plans.list",{status:"active"}),o.closeThisDialog()}).catch(function(e){o.$broadcast("planDeleted",!1),s.error("Could not delete this plan",e)})},o.deletePage=function(t){var e=n.generateRandomPageSlug();i.checkSlugAvailability(e).then(function(){i.deleteSubscriptionPage(t.id,e)}).then(function(){s.success("Deleted successfully","Page will no longer be accessible"),o.closeThisDialog(),c(function(){a.reload()},100)}).catch(function(e){if(e.data&&"Slug already in use"==e.data.message)return o.deletePage(t);o.$broadcast("pageDeleted",!1),s.error("Could not delete this page",e)})}}]),PlansModule.factory("PlanFactory",["API",function(n){return{fetchPlans:function(e){return e?n.one("plan").get(e):n.one("plan").get()},createPlan:function(e){return n.all("plan").post(e)},updatePlan:function(e,t){return n.one("plan",e).customPUT(t)},archivePlan:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return n.one("plan/".concat(e,"/archive?cancel_subscriptions=").concat(t)).customPUT()},cancelAllSubscriptions:function(e){return n.one("plan/".concat(e,"/subscriptions")).customDELETE()},deletePlan:function(e){return n.one("plan",e).customDELETE()},createSubscriptionPage:function(e){return n.all("page").post(e)},checkSlugAvailability:function(e){return n.one("page/check_slug_availability",e).get()},deleteSubscriptionPage:function(e,t){return n.one("page",e).customPUT({active:!1,slug:t})}}}]).factory("PlansData",["API",function(t){return{search:function(e){return t.one("plan").get({search:e})}}}]),PlansModule.constant("PlanConstants",{PLAN_FREQUENCY_OPTIONS:[{slug:"hourly",name:"Hourly"},{slug:"daily",name:"Daily"},{slug:"weekly",name:"Weekly"},{slug:"monthly",name:"Monthly"},{slug:"quarterly",name:"Quarterly"},{slug:"biannually",name:"Biannually"},{slug:"annually",name:"Annually"}]});_excluded=["page","index"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}PlansModule.service("PlanFilters",["$rootScope","utils",function(s,d){var c={gte:">",lte:"<",eq:"="};return{formatFiltersForApi:function(e,t){var o=_objectSpread({},e);return t.forEach(function(e){if(e.isSelected)if(e.currency){var t=d.currencyBaseUnitToSubUnit(e.filterValue),n='{"'.concat(e.filterOperator,'": "').concat(t,'", "currency": "').concat(e.currency,'"}');o[e.filter]=n}else{var r='{"'.concat(e.filterOperator,'": "').concat(e.filterValue,'"}');o[e.filter]=r}else o[e.filter]=void 0}),o},getFilterTags:function(e,t){e.page,e.index;var n,r,o,a=_objectWithoutProperties(e,_excluded),i=(n=t,r=_objectSpread({},a),n.forEach(function(e){r[e.filter]&&(r[e.filter]=void 0)}),r),s=(o=i,Object.keys(o).map(function(e){if(["from","to"].includes(e)&&null!=o.from&&null!=o.to){var t=o.from,n=o.to;return o.from=void 0,o.to=void 0,{filter:"period",tagLabel:"Period",tagOperator:":",tagValue:"".concat(t," - ").concat(n)}}return{filter:e,tagLabel:e,tagOperator:": ",tagValue:o[e]}}));return t.forEach(function(e){e.isSelected&&s.push(e)}),s},getFilter:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{filter:n,defaultValue:r,tagLabel:o,includeCurrency:!1},n=t.filter,r=t.defaultValue,o=t.tagLabel,a=t.includeCurrency;if(e[n]){var i=function(e,t){var n=t.filter,r=t.includeCurrency,o=void 0!==r&&r,a=JSON.parse(e[n]),i=Object.keys(a)[0],s=a[i];if(o){var c,u=a.currency,l=d.currencySubUnitToBaseUnit(s);return _defineProperty(c={filterOperator:i},n,l),_defineProperty(c,"currency",u),c}return _defineProperty({filterOperator:i},n,s)}(e,{filter:n,includeCurrency:a});return{isSelected:"selected",filter:n,filterOperator:i.filterOperator,filterValue:i[n],tagLabel:o,tagOperator:" ".concat(c[i.filterOperator]," "),tagValue:a?"".concat(i.currency," ").concat(i[n]):i[n],currency:i.currency}}return{isSelected:"",filter:n,filterOperator:"gte",filterValue:r,tagLabel:o,tagOperator:" > ",tagValue:r,currency:a?s.Business.default_currency:null}}}}]),PlansModule.service("PlanUtils",[function(){return{generateRandomPageSlug:function(){for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t="archived_",n=10;0<n;--n)t+=e[Math.floor(Math.random()*e.length)];return t}}}]),ProductModule.constant("ProductConstants",{AVAILABLE_FORMATS:[".gif",".jpg",".jpeg",".png","video/*"],MAX_FILE_SIZE:20485760,MAX_DESCRIPTION_CHARACTERS:8e3,DESCRIPTION_CHARACTERS_WARNING_AT:8e3,MAX_PRODUCT_NAME_CHARACTERS:100,MAX_UPLOAD_COUNT:6,MAX_VARIANT_OPTIONS:3,MAX_VARIANT_OPTION_VALUES:10,MIN_SIZE:{image:1e4,video:1e5},DESCRIPTION_AVAILABLE_TAGS:["div","ul","li","ol","strong","em","br","b","h2","h3","p","br","a","blockquote"],DEPLOYMENT_DATE:"2020-04-29T013:30:05.000Z",ORDER_STATUSES:{paid_an_order:{field:"paid",description:"Received",action:"paid_an_order"},delivered_an_order:{field:"delivered",description:"Delivered",action:"delivered_an_order"},cancelled_an_order:{field:"cancelled",description:"Cancelled",action:"cancelled_an_order"},refunded_an_order:{field:"refunded",description:"Posted a refund",action:"refunded_an_order"},order_has_been_partially_refunded:{field:"partially_refunded",description:"Refunded",action:"refunded_an_order"},order_has_been_refunded:{field:"refunded",description:"Payment refunded",action:"refunded_an_order"},updated_an_order_shipping_address:{field:"updated",description:"Address updated",action:"updated_an_order_shipping_address"}},DIGITAL_PRODUCTS_DEPLOYMENT_DATE:"2022-02-09T17:00:00.000Z"}),ProductModule.constant("DigitalProductConstants",{AVAILABLE_FORMATS:[".gif",".jpg",".jpeg",".png","video/*","application/pdf",".mobi",".epub",".wav",".csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword",".mid",".midi",".ogg","audio/aac","audio/mpeg","audio/x-m4a","audio/flac","audio/alac","audio/aif","audio/aiff","application/zip",".pkg",".rar","application/postscript","image/vnd.adobe.photoshop",".tiff",".indd",".3ds",".3dm",".key","application/vnd.oasis.opendocument.presentation","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.oasis.opendocument.text","text/rtf","text/plain",".wpd",".xmp",".lrtemplate",".fxp",".aep","text/html",".obj",".fbx",".ply",".stl",".wrl"],MAX_FILE_SIZE_BYTES:5368709120,MAX_FILE_SIZE_KB:5242880,MAX_FILE_UPLOAD_COUNT:10}),ProductModule.controller("CreateProductCtrl",["$scope","Notification","$state","$rootScope","ProductIntroService","$timeout","ProductFactory","ngDialog","MediaUploadService","AmplitudeService","Upload","ProductUtils","ProductConstants",function(u,t,i,n,s,r,o,a,c,e,l,d,p){var f=e.logEvent;u.createproductResponse=null,u.currencies=n.Business.allowed_currencies,u.product={currency:n.Business.allowed_currencies&&n.Business.allowed_currencies[0],unlimited:!0,description:"",files:[],hasPhysicalGoods:!1,is_shippable:!1,type:"service",shipping_fields:{delivery_note:"disabled",shipping_address:"disabled",shipping_fees:[]}},u.processing=!1,u.filesToUpload=null,u.files=[],u.uploadedFiles=[],u.isUploading=!1,u.isUpdatingProduct=!1,u.toggleIsShippable=function(){u.product.is_shippable=!u.product.is_shippable,u.product.is_shippable?(u.product.shipping_fields.delivery_note="optional",u.product.shipping_fields.shipping_address="required",u.product.type="good"):(u.product.shipping_fields.delivery_note="disabled",u.product.shipping_fields.shipping_address="disabled",u.product.type="service")};var m=function(){s.isFirstProductCreated()||r(function(){introJs().addSteps(s.ordersTabSteps).setOptions(s.options).start().oncomplete(function(){s.setFirstProductIsCreated(),s.setOrdersTabTourAsFinished()})},500)};u.createProduct=function(e){e&&(u.storefront=e,u.product.storefront=e.id),o.createProduct(u.product).then(function(e){return t.success("Created successfully","Product has been created successfully"),e}).then(function(e){u.createproductResponse=e,u.copyProduct=e.data,u.copyProduct.files=[]}).catch(function(e){u.$broadcast("productCreated",!1),t.error("Could not create the product",e)})},n.$on("isUploading",function(e,t){u.isUploading=t}),u.resetUploadedFiles=function(){u.uploadedFiles=[]},u.cancelUpload=function(e){e.upload.abort()};var g=function(){if(u.uploadedFiles.length===u.files.length){u.isUploading=!1,u.processing=!1;var e=a.getOpenDialogs();Array.isArray(e)&&!e.length&&a.open({templateUrl:"/modules/products/views/modals/upload.html",showClose:!1,scope:u,closeByDocument:!1})}},h=function(e,t){e.forEach(function(s,e){var c=t[e];s.upload=l.http({url:window.location.href.includes("localhost")?"https://cors-anywhere.herokuapp.com/".concat(c.signed_url):c.signed_url,method:"PUT",headers:{"Content-Type":s.type},data:s}),s.upload.then(function(e){return r(function(){s.result=e.data,s.status=e.status}),e},function(e){0<e.status&&(u.errorMsg="".concat(e.status,": ").concat(e.data))},function(e){s.progress=Math.min(100,parseInt(100*e.loaded/e.total))}).then(function(e){if(!e)return u.files=u.files.filter(function(e){return e!==s}),g();var t,n,r,o,a,i;u.uploadedFiles.push(s),t=s,r=(n=c).key,o=n.path,a=d.getMediaType(t.type),i={key:r,path:o,original_filename:t.name,type:a},Array.isArray(u.copyProduct.files)?u.copyProduct.files.push(i):u.copyProduct.files=[i],g()})})};u.upload=function(e){u.resetUploadedFiles();var t=c.getValidFiles(e,"standard");t.length&&(u.files=c.removeUnnecessaryFiles(t,u.copyProduct,{maxFileUploadCount:p.MAX_UPLOAD_COUNT,fileType:"standard"}),u.processing=!0,n.$broadcast("isUploading",!0),f("Media upload started"),c.getSignedUrls(u.files).then(function(e){h(u.files,e)}))},u.saveUpload=function(){u.isUpdatingProduct=!0;var e={id:u.copyProduct.id,files:u.copyProduct.files};o.updateProduct(e,function(){u.closeThisDialog(data),function(e){var t=e.data.id,n=i.current.pageTrack,r=i.current.url,o=s.isFirstProductCreated()?"link":"orders";if("/products"===n)i.go("products.one.".concat(o),{id:t}).then(function(){m()});else if("/storefronts"===n){var a=u.storefront.id;r.includes("/products")?i.reload():i.go("storefronts.one.products",{id:a})}}(u.createproductResponse)})},u.closeUploadModal=function(e){e.closeThisDialog(),u.product.files&&u.product.files.length&&(u.copyProduct.files=angular.copy(u.product.files)),i.reload()},u.deleteImage=function(e){var t=u.copyProduct.files.slice(0,e).concat(u.copyProduct.files.slice(e+1,u.copyProduct.files.length));u.copyProduct.files=t.length?t:null}}]),ProductModule.controller("ProductDesignCtrl",["$scope","Notification","MediaUploadService","$state","ngDialog","ProductConstants","$timeout","$q","LocalService","ProductUtils","ProductFactory","AmplitudeService","ProductIntroService","$rootScope","Upload","$location","variantOptions",function(u,r,n,o,t,a,i,e,s,l,c,d,p,f,m,g,h){if(u.digitalProductUploadIsAllowed=["digital","service"].includes(u.product.type)||!u.product.is_shippable||moment(u.product.createdAt).isAfter(a.DIGITAL_PRODUCTS_DEPLOYMENT_DATE),!u.digitalProductUploadIsAllowed&&"upload-files"===g.$$search.view)return o.go(o.current,{reload:!0,inherit:!1});var y=d.logEvent,b=settings.landingPage+"/buy/",v="IDLE",S="CHECKING",P="USABLE",w="NOT_USABLE",C="INVALID",O=document.getElementById("description-editor"),A=e.defer();function T(){i(function(){var e=u.product.metadata&&u.product.metadata.background_color||"#F5F5F5",t=l.checkColor(e);document.getElementById("chevronLeft").style.stroke=t,document.getElementById("chevronRight").style.stroke=t,document.querySelectorAll(".carousel-indicator-dot").forEach(function(e){e&&(e.style.background=t,e.style.borderColor=t)})},100)}T(),u.descriptionTextLength=O.innerText.length,u.copyProduct=angular.copy(u.product),u.checkingSlug=v,u.editingSlug=!1,u.editingDescription=!1,u.urlWithoutProtocolAndSlug=b.substr(u.product.url.indexOf("://")+3),u.isFilesPresent=Array.isArray(u.product.files)&&u.product.files.length,u.filesToUpload=null,u.files=[],u.uploadedFiles=[],u.isUploading=!1,u.isUpdatingProduct=!1,u.isColorPickerShown=!1,u.maxDescriptionCharacters=a.MAX_DESCRIPTION_CHARACTERS,u.descriptionCharactersWarningLimit=a.DESCRIPTION_CHARACTERS_WARNING_AT,u.productInfoActiveTab=g.search().view||"product-info",u.totalProductVariantOptions=h.data.length,u.closeColorPicker=function(){u.showBgColor=!1},u.setProductInfoTabView=function(e){g.search("view",e),u.productInfoActiveTab=e},f.$on("isUploading",function(e,t){u.isUploading=t}),u.$watch("copyProduct.description",function(){u.copyProduct&&(u.copyProduct.description||""===u.copyProduct.description)&&(u.descriptionTextLength=O.innerText.length,u.availableDescChars=a.MAX_DESCRIPTION_CHARACTERS-O.innerText.length)}),u.updateDescription=function(e,t){u.copyProduct.description=t},u.$on("colorpicker-selected",function(e,t){u.copyProduct.metadata&&(u.copyProduct.metadata.background_color=t.value)}),u.$on("colorpicker-closed",function(e,t){if(u.copyProduct.metadata&&u.copyProduct.metadata.background_color&&t.value!==u.product.metadata.background_color){u.copyProduct.metadata.background_color=t.value,u.product.metadata.background_color=t.value;var n={id:u.copyProduct.id,metadata:{background_color:t.value}};c.updateProduct(n,function(){T(),x(t.value)})}}),u.toggleBgColorPalette=function(){u.showBgColor=!u.showBgColor,y("Clicked on background color icon")},u.changeBgColor=function(e){if(u.copyProduct.metadata&&u.copyProduct.metadata.background_color&&e!==u.copyProduct.metadata.background_color){u.copyProduct.metadata.background_color=e,u.product.metadata.background_color=e;var t={id:u.copyProduct.id,metadata:{background_color:e}};c.updateProduct(t,function(){T(),x(e)})}},u.onCarouselClick=function(e){var t=_toConsumableArray(document.querySelectorAll("video")),n=e.target.nodeName.toLowerCase();t&&t.length&&"video"!==n&&["a","li","svg","path"].includes(n)&&t.forEach(function(e){e.pause(),i(function(){e.currentTime=0},300)})},u.switchActive=function(){u.copyProduct.active=!u.copyProduct.active;var e=u.copyProduct.active?"Activated Product Link":"Disabled Product Link";y(e);var t={id:u.copyProduct.id,active:u.copyProduct.active};c.updateProduct(t,function(e){e?u.copyProduct.active=!u.copyProduct.active:(u.copyProduct.active?r.success("Update successful","Product Link is now on"):r.success("Update successful","Product Link is now off"),o.reload())})},u.checkSlugAvailability=_.debounce(function(){u.$apply(function(){var e=angular.copy(u.copyProduct.slug)||"";if(!new RegExp("^[a-zA-Z0-9-]*$").test(e))return u.checkingSlug=C,void u.slugForm.slug.$setValidity("required",!1);if(e){u.checkingSlug=S;var t=decodeURIComponent(e);c.checkSlug(t,A).then(function(e){e&&(e.available?u.checkingSlug=P:(u.checkingSlug=w,u.slugForm.slug.$setValidity("required",!1),y("Typed unavailable slug")))}).catch(function(){u.checkingSlug=w,u.slugForm.slug.$setValidity("required",!1),y("Typed unavailable slug")})}else u.checkingSlug=v})},800),u.showMediaUploadModal=function(){y("Clicked on upload media icon")},u.resetUploadedFiles=function(){u.uploadedFiles=[]},u.cancelUpload=function(e){e.upload.abort()};var k=function(){if(u.uploadedFiles.length===u.files.length){u.isFilesPresent=!0,u.isUploading=!1,u.processing=!1;var e=t.getOpenDialogs();Array.isArray(e)&&!e.length&&t.open({templateUrl:"/modules/products/views/modals/upload.html",showClose:!1,scope:u,closeByDocument:!1})}},D=function(e,t){e.forEach(function(s,e){var c=t[e];s.upload=m.http({url:window.location.href.includes("localhost")?"https://cors-anywhere.herokuapp.com/".concat(c.signed_url):c.signed_url,method:"PUT",headers:{"Content-Type":s.type},data:s}),s.upload.then(function(e){return i(function(){s.result=e.data,s.status=e.status}),e},function(e){0<e.status&&(u.errorMsg="".concat(e.status,": ").concat(e.data))},function(e){s.progress=Math.min(100,parseInt(100*e.loaded/e.total))}).then(function(e){if(!e)return u.files=u.files.filter(function(e){return e!==s}),k();var t,n,r,o,a,i;u.uploadedFiles.push(s),t=s,r=(n=c).key,o=n.path,a=l.getMediaType(t.type),i={key:r,path:o,original_filename:t.name,type:a},Array.isArray(u.copyProduct.files)?u.copyProduct.files.push(i):u.copyProduct.files=[i],k()})})};function x(e){["#F5F5F5","#285056","#03649A","#FFAD00","#E9623B","#E35B67","#786B9C"].includes(e)?y("Used a default bg color",{Color:e}):y("Used custom bg color",{Color:e})}u.upload=function(e){u.resetUploadedFiles();var t=n.getValidFiles(e,"standard");t.length&&(u.files=n.removeUnnecessaryFiles(t,u.copyProduct,{maxFileUploadCount:a.MAX_UPLOAD_COUNT,fileType:"standard"}),u.processing=!0,f.$broadcast("isUploading",!0),y("Media upload started"),n.getSignedUrls(u.files).then(function(e){D(u.files,e)}))},u.handleClick=function(){var e=moment(u.product.createdAt).isBefore(a.DEPLOYMENT_DATE);y("Clicked media upload button",{ProductBeforeLaunch:e})},u.saveUpload=function(n){u.isUpdatingProduct=!0;var e={id:u.copyProduct.id,files:u.copyProduct.files};c.updateProduct(e,function(){var e=l.isAnyFileUploadedBefore(),t=!0===JSON.parse(e);n.closeThisDialog(),u.isUpdatingProduct=!1,t?o.reload():(s.set("firstFileUploaded",!0),u.showBgColor=!0,u.copyProduct.files&&u.copyProduct.files.length?(u.product.files=angular.copy(u.copyProduct.files),T()):(u.product.files=null,u.isFilesPresent=!1,u.filesToUpload=null))})},u.closeUploadModal=function(e){e.closeThisDialog(),u.product.files&&u.product.files.length&&(u.copyProduct.files=angular.copy(u.product.files)),o.reload()},u.editSlug=function(){u.slugForm.$setPristine(),u.slugForm.$setUntouched(),i(function(){var e=document.getElementById("slug");e.focus(),e.select()}),u.checkingSlug=v,u.copyProduct=angular.copy(u.product),u.editingSlug=!0,u.editingDescription=!1},u.editDescription=function(e){u.availableDescChars=a.MAX_DESCRIPTION_CHARACTERS-O.innerText.length,u.slugForm.$setPristine(),u.slugForm.$setUntouched(),u.checkingSlug=v,u.copyProduct=angular.copy(u.product),u.editingDescription=!0,u.editingSlug=!1,function(e){if(!e)return;var t=e.target.id;y("Clicked Product Description edit",{FromWhere:{descriptionContent:"Content",descriptionPlaceholder:"Placeholder",descriptionButton:"Button"}[t]})}(e)},u.cancelDesign=function(){A.resolve(),u.slugForm.$setPristine(),u.slugForm.$setUntouched(),u.checkingSlug=v,u.copyProduct=angular.copy(u.product),u.editingSlug=!1,u.editingDescription=!1,i(function(){A=e.defer()})},u.saveSlug=function(){var e=u.copyProduct.slug.split(" ").join("-");u.slugForm.$setPristine(),u.slugForm.$setUntouched(),u.checkingSlug=v,u.copyProduct.slug=angular.copy(e),u.product=angular.copy(u.copyProduct),u.editingSlug=!1,u.editingDescription=!1;var t=decodeURIComponent(u.copyProduct.slug),n={id:u.copyProduct.id,slug:t};c.updateProduct(n,function(e,t){if(e)return o.reload();r.success("Update successful","Shareable link updated"),y("Changed Product Link URL"),o.reload()})},u.saveDescription=function(){if(u.copyProduct.description){var e=window.striptags(u.copyProduct.description,a.DESCRIPTION_AVAILABLE_TAGS);u.copyProduct.description=e}u.product=angular.copy(u.copyProduct),u.editingSlug=!1,u.editingDescription=!1;var t={id:u.copyProduct.id,description:u.copyProduct.description};c.updateProduct(t,function(e,t){if(e)return o.reload();r.success("Update successful","Product description saved"),o.reload()})},u.deleteImage=function(e){var t=u.copyProduct.files.slice(0,e).concat(u.copyProduct.files.slice(e+1,u.copyProduct.files.length));u.copyProduct.files=t.length?t:null},document.querySelector("#shareableLinkText").addEventListener("copy",function(){y("Copied Product Link",{From:"Shareable Link"})}),document.querySelector("#productActions").addEventListener("click",function(){y("Clicked product actions")});p.isProductLinkTabTourFinished()||u.product.files&&u.product.files.length||i(function(){var e=p.setupProductLinkTabSteps();introJs().addSteps(e).setOptions(p.options).start().oncomplete(function(){p.setProductLinkTabTourAsFinished()})},100)}]),ProductModule.controller("ProductListCtrl",["$state","$scope","$stateParams","products","LocalService","Notification","$rootScope","ProductListFilters","ProductFactory","AmplitudeService","ngDialog",function(n,r,o,e,t,a,i,s,c,u,l){var d=u.logEvent;r.listDisplayStyle=t.get("listDisplayStyle")||"grid",function(){var n=angular.copy(o);delete n.page,n.search&&(d("Searched products",{SearchTerm:n.search}),delete n.search);if(Object.values(n).some(function(e){return void 0!==e})){var e=Object.keys(n).reduce(function(e,t){return void 0===n[t]?e:_objectSpread(_objectSpread({},e),{},_defineProperty({},t,n[t]))},{});d("Filtered products",{Filters:e})}}(),r.query=angular.copy(o),r.search=angular.copy(r.query.search)||"",r.products=e.data.filter(function(e){return!e.is_deleted}),r.meta=angular.copy(e.meta),r.dialogOptions={products:e,reload:!0},r.query.quantity_condition="gt",r.query.quantity_amount="1",r.query.unlimited=o.unlimited||"",r.query.quantity_display="",r.query.quantity_sold_condition="gt",r.query.price_display="",r.query.price_condition="gt",r.removeFilter=function(e){var t=s.removeFilter(r.query,e);r.reloadWithParams(t)},r.filterProducts=function(e){r.$broadcast("$locationChangeSuccess");var t=s.filterProducts(e);n.go(n.current,t,{reload:!0,inherit:!0,notify:!0})},r.populateFilters=function(){var e=s.populateFilters(r.query,o).query;r.query=e},r.generateProductFilters=function(e){r.populateFilters();var t=s.generateProductFilters(e,o);i.$state.activeFilterValues=t},r.$watch("query.search",_.debounce(function(e,t){e!==t&&e!==r.search&&("true"===r.query.active&&(r.query.active=void 0),r.reloadWithParams(r.query),r.$apply())},800)),r.clearSearch=function(){r.query.search=""},r.reorderList=function(e){e=e||"grid",r.listDisplayStyle=e,t.set("listDisplayStyle",e),d("Used layout option",{Layout:e})},r.restoreProduct=function(e,t){e.stopPropagation(),e.preventDefault(),c.restoreProduct(t,function(){a.success("Restored successfully","Product has been restored successfully"),n.reload()},function(e){r.$broadcast("productUpdated",!1),a.error("Could not restore this product",e)})},r.duplicateProduct=function(e){c.duplicateProduct(e.id).then(function(e){a.success("Duplicated successfully","Product has been duplicated"),n.go("products.one.orders",{id:e.data.product.id,duplicated:!0})}).catch(function(e){a.error("Could not duplicate the product",e)})},r.archiveProduct=function(e){d("Product Link disabled");var t={id:e.id,active:!1};c.updateProduct(t,function(){a.success("Update successful","Product has been archived successfully"),n.reload()})},r.showDeleteProductModal=function(e){l.openConfirm({template:"modules/products/views/modals/delete-product.html",scope:r,controller:"ProductPopupCtrl",data:{product:e}}).then(function(){n.reload()})}}]),ProductModule.controller("ProductOrderCtrl",["$scope","$rootScope","product","$state","$stateParams","ngDialog","ProductConstants","ProductOrdersService","ProductOrdersFilters","ProductFactory","AmplitudeService","Notification","OrderUtils",function(o,a,e,n,i,s,t,c,u,l,r,d,p){var f=r.logEvent;o.fetchOrders=function(){o.query=angular.copy(i),delete o.query.id,o.searchOrder=angular.copy(o.query.search)||"",o.paidDate=o.query.paid_at?"paidday":"",o.deliveryDatePeriod=o.query.delivered_at?"deliveryday":"",o.regions=[],o.ordersNotFound=Object.keys(o.query).some(function(e){return o.query[e]}),o.product.shipping_fields&&o.product.shipping_fields.shipping_fees&&Array.isArray(o.product.shipping_fields.shipping_fees)&&(o.regions=o.product.shipping_fields.shipping_fees.map(function(e){return e.region})),o.loading=!0,o.orders=[],o.ordersMeta=null,o.activeOrder=null,o.activeOrderCopy=null,o.params=angular.copy(i),delete o.params.id,o.viewingOrder=!1,o.currentIndex=null,o.orderStatus=t.ORDER_STATUSES,o.logs=[],o.editingShippingDetails=!1,o.logsCollapsed=!1,o.refundFormVisible=!1,o.refunds={refundPayment:!0,amountToRefund:null,maxRefundableAmount:null,merchantNote:null},o.collapseLogs=function(){o.logsCollapsed=!0},o.reloadActiveProduct=function(e){var t=o.orders[e];o.viewOrder(t,e,!0),o.getOrdersList()},o.getOrdersList=function(){l.listProductOrders(o.product.id,o.params).then(function(e){o.orders=e.data,o.ordersMeta=e.meta,o.$broadcast("fetchedOrders")}).catch(function(){o.$broadcast("fetchedOrders",!1)})},o.getOrdersList(),o.viewOrder=function(t,e,n){!n&&_.isNumber(e)&&o.currentIndex===e||(o.logsCollapsed=!1,o.viewingOrder=!0,o.refundFormVisible=!1,o.currentIndex=e,a.$broadcast("resetView"),l.getOrder(t.order_id).then(function(e){o.activeOrder=e.data,o.activeOrderCopy=angular.copy(o.activeOrder),o.setActiveOrderStatus(o.activeOrderCopy),r(),o.refunds.amountToRefund=c.getRefundAmount(o.activeOrder.amount,o.activeOrder.shipping_fees,o.activeOrder.refunded_amount),o.refunds.maxRefundableAmount=angular.copy(o.refunds.amountToRefund),o.getLogs(t.order_id)}).catch(function(){}).finally(function(){o.loading=!1}))},o.setActiveOrderStatus=function(e){o.isActiveOrderDelivered="delivered"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderPaid="paid"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderCancelled="cancelled"===e.status.toLowerCase()&&!e.refunded,o.isActiveOrderRefunded=e.refunded,o.isActiveOrderNotFullyRefunded=e.refunded&&!e.fully_refunded,o.isActiveOrderFullyRefunded=e.refunded&&e.fully_refunded};var r=function(){o.refundButtonText=o.isActiveOrderNotFullyRefunded?"Complete refund":"Refund payment"};o.closeOrder=function(){o.viewingOrder=!1,o.currentIndex=null,o.refundFormVisible=!1},o.getLogs=function(e){l.listOrderLogs(e).then(function(e){var t=c.removeSameTimeLogs(e.data);o.logs=t,o.$broadcast("fetchedOrder")}).catch(function(){o.$broadcast("fetchedOrder",!1)}).finally(function(){o.loading=!1})},o.showExport=function(){s.open({template:"/modules/products/views/modals/orders-export.html",controller:"ProductOrdersExportCtrl",width:700,showClose:!0,trapFocus:!1,appendClassName:"export-orders-modal",resolve:{DefaultKeys:["LocalAPI",function(e){return e.all("transaction_export_keys").getList()}]}})},o.showResendDigitalDownloadDialog=function(){s.open({template:"/modules/products/views/modals/resend-digital-download-link.html",controller:"OrdersPopupCtrl",scope:o,data:{order:o.activeOrder}})},o.showCancelOrderModal=function(e){var t=angular.copy(e);t.status=o.orderStatus.cancelled_an_order.field,t.index=o.currentIndex,s.openConfirm({template:"modules/products/views/modals/cancel-order.html",scope:o,controller:"ProductPopupCtrl",data:{payload:t}}).then(function(){n.reload()})},o.showMarkOrderAsDeliveredModal=function(e){var t=angular.copy(e);t.status=o.orderStatus.delivered_an_order.field,t.index=o.currentIndex,s.openConfirm({template:"modules/products/views/modals/mark-order-delivered.html",scope:o,controller:"ProductPopupCtrl",data:{payload:t}}).then(function(){n.reload()})},o.showRefundOrderModal=function(e){var t=angular.copy(e);t.status=o.orderStatus.refunded_an_order.field,t.index=o.currentIndex,s.openConfirm({template:"modules/products/views/modals/refund-order.html",scope:o,controller:"ProductPopupCtrl",data:{payload:t}}).then(function(){n.reload()})},o.toggleRefundForm=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];o.refundFormVisible=e},o.refundOrder=function(){var e={id:o.activeOrder.id,status:"refunded",amount_to_refund:100*Number(o.refunds.amountToRefund)};l.updateOrderStatus(e).then(function(){d.success("Updated successfully","Order has been refunded successfully"),o.refundFormVisible=!1,o.reloadActiveProduct(o.currentIndex),o.$broadcast("orderRefunded"),o.logOrderRefund(e.amount_to_refund)}).catch(function(e){d.error("Could not refund this order",e),o.$broadcast("orderRefunded",!1)})},o.$watch("query.search",_.debounce(function(e,t){e!==t&&e!==o.searchOrder&&(o.reloadWithParams(o.query),o.$apply())},800)),o.clearOrderSearch=function(){o.query.search=""},o.filterOrders=function(e){o.$broadcast("$locationChangeSuccess");var t=u.filterOrders(e);o.reloadWithParams(t)},o.clearFilters=function(){n.go(n.current,{id:n.params.id},{reload:!0,inherit:!1})},o.populateOrdersFilters=function(){i.delivered&&"false"===i.delivered&&(o.query.status="false")},o.generateOrdersFilters=function(e){o.populateOrdersFilters();var t=u.generateOrdersFilters(e,i);a.$state.activeFilterValues=t},o.removeOrdersFilter=function(e){var t=u.removeFilterTag(e,o.query);o.reloadWithParams(t)},o.cancelShippingDetails=function(){o.editingShippingDetails=!1,o.activeOrderCopy=angular.copy(o.activeOrder)},o.saveShippingDetails=function(){o.editingShippingDetails=!1,o.activeOrderCopy.index=o.currentIndex,l.updateOrderShipment(o.activeOrderCopy).then(function(){d.success("Updated successfully","Shipment info changed"),o.reloadActiveProduct(o.currentIndex)}).catch(function(e){d.error("Shipment info could not be saved",e)}),f("Clicked save address fields button")},o.createVariantNameFromOrder=function(e){return p.createVariantNameFromOrder(e)},o.logOrderRefund=function(e){var t=o.activeOrder.shipping_fees||0,n=o.activeOrder.amount+t;f("Payment refunded",{FullRefund:n===e})},o.logOrderCancelled=function(e,t){var n={Refund:e};t&&(n.Note=t),f("Order cancelled",n)}}}]),ProductModule.controller("ProductOrdersExportCtrl",["$scope","Notification","$state","$stateParams","ProductExportService","ProductFactory","StorefrontOrdersFactory","AmplitudeService",function(n,t,e,r,o,a,i,s){var c=s.logEvent;n.availableKeys=o.getAvailableKeys(),n.selectedKeys=o.getSelectedKeys(),n.add=function(e,t){n.availableKeys.splice(t,1),n.selectedKeys.push(_.pick(e,["name","value"]))},n.remove=function(e,t){n.selectedKeys.splice(t,1),n.availableKeys.push(_.pick(e,["name","value"]))},n.reset=function(){n.availableKeys=o.getAvailableKeys(),n.selectedKeys=o.getSelectedKeys()};var u=function(e){return e.map(function(e){return[e.value]}).join("&export_columns=")};n.exportProductOrders=function(){var e=u(n.selectedKeys);a.exportProductOrdersToCsv(e,r).then(function(e){n.closeThisDialog(),c("Clicked export orders button"),e.data&&e.data.path&&o.saveCsv(e.data.path)}).catch(function(e){n.$broadcast("exported",!1),t.error("Could not export orders",e)})},n.exportStorefrontOrders=function(){var e=u(n.selectedKeys);i.exportStorefrontOrdersToCsv(e,r).then(function(e){n.closeThisDialog(),c("Clicked export orders button"),e.data&&e.data.path&&o.saveCsv(e.data.path)}).catch(function(e){n.$broadcast("exported",!1),t.error("Could not export orders",e)})},n.exportOrders=function(){var e=u(n.selectedKeys);a.exportOrdersToCsv(e,r).then(function(e){n.closeThisDialog(),e.data&&e.data.path&&o.saveCsv(e.data.path)}).catch(function(e){n.$broadcast("exported",!1),t.error("Could not export orders",e)})}}]),ProductModule.controller("ProductPopupCtrl",["$scope","Notification","$state","ProductFactory","AmplitudeService",function(r,o,t,a,e){r.toggleRefundCheckbox=function(){r.refunds.refundPayment||(r.refunds.amountToRefund=angular.copy(r.refunds.maxRefundableAmount))},r.deleteProduct=function(e){a.deleteProduct(e.id,function(){o.success("Deleted successfully","Product has been deleted successfully"),r.closeThisDialog(),t.go("products.list",{},{reload:!0})},function(e){r.$broadcast("productDelete",!1),o.error("Could not delete this product",e)})},r.markOrderAsDelivered=function(e){var t=e.id;a.updateOrderStatus({id:t,status:"delivered"}).then(function(){o.success("Updated successfully","Order has been marked as delivered"),r.reloadActiveProduct(r.currentIndex)}).catch(function(e){o.error("Could not mark as delivered",e)})},r.closeCancelOrderModal=function(){r.closeThisDialog(),r.refunds.amountToRefund=angular.copy(r.refunds.maxRefundableAmount)},r.cancelOrder=function(e){var t={id:e.id,status:"cancelled"},n="Order has been cancelled successfully";r.refunds.refundPayment&&(t.refund_customer=!0,t.amount_to_refund=100*Number(r.refunds.amountToRefund),n="Order has been cancelled and refunded successfully"),r.refunds.merchantNote&&(t.merchant_note=r.refunds.merchantNote),a.updateOrderStatus(t).then(function(){o.success("Updated successfully",n),r.logOrderCancelled(r.refunds.refundPayment,r.refunds.merchantNote),r.refunds.refundPayment&&r.logOrderRefund(t.amount_to_refund),r.reloadActiveProduct(r.currentIndex)}).catch(function(e){o.error("Could not cancel this order",e)})}}]),ProductModule.controller("ProductPostPurchaseCtrl",["$scope","$rootScope","Notification","subaccounts","ProductFactory","$state","ProductUtils","$timeout","ProductIntroService",function(r,e,n,t,o,a,i,s,c){r.userHasSubaccountPermission=e.User.hasPermission("subaccount-view"),r.editingPostPurchaseForm=!1,r.subaccounts=t&&t.data,r.selectedSubaccount={code:null,name:null},r.notificationEmail=null,r.notificationEmails=[];var u=function(){r.notificationEmails=r.copyProduct.notification_emails?angular.copy(r.copyProduct.notification_emails):[]},l=function(){r.selectedSubaccount.code=r.copyProduct.split_code||""},d=function(){if(r.userHasSubaccountPermission&&r.subaccounts.length&&r.copyProduct.split_code){var e=i.getSubaccountByProduct(r.subaccounts,r.copyProduct).business_name;r.selectedSubaccount.name=e}},p=function(){r.notificationEmail=null},f=function(){r.copyProduct=angular.copy(r.product),l(),d(),u(),p(),r.editPostPurchaseInfoForm.$setPristine()};r.toggleEditingPostPurchaseForm=function(){r.editingPostPurchaseForm=!r.editingPostPurchaseForm,f()},r.addNotificationEmail=function(e){var t;13===e.keyCode&&r.notificationEmail&&(t=r.notificationEmail,r.notificationEmails=[].concat(_toConsumableArray(r.notificationEmails),[t]),p())},r.removeNotificationEmail=function(n){r.notificationEmails=r.notificationEmails.filter(function(e,t){return t!==n})},r.savePostPurchaseInfo=function(){var e,t=(e=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return e&&(/^https?:\/\//i.test(e)?e.startsWith("http://")&&(e=e.replace("http://","https://")):e="https://".concat(e)),e}(r.copyProduct.redirect_url),{id:r.copyProduct.id,redirect_url:e,success_message:r.copyProduct.success_message||null,split_code:r.selectedSubaccount.code?r.selectedSubaccount.code:null,notification_emails:r.notificationEmails.length?angular.copy(r.notificationEmails):null});r.product=angular.copy(r.copyProduct),o.savePostPurchaseInfo(t).then(function(){r.toggleEditingPostPurchaseForm(),n.success("Updated successfully","After purchase info has been saved"),a.reload()}).catch(function(e){n.error("Could not update product",e)})};c.isAfterPurchaseTabTourFinished()||s(function(){var e=c.setupPostPurchaseTabSteps();introJs().addSteps(e).setOptions(c.options).start().oncomplete(function(){c.setAfterPurchaseTabTourAsFinished()})},100),l(),d(),u()}]),ProductModule.controller("ProductShippingCtrl",["$scope","$state","ngDialog","Notification","$timeout","ProductFactory","AmplitudeService","ProductUtils","ProductIntroService",function(c,i,e,s,r,u,t,n,o){var l=t.logEvent,d=/^0[0-9].*$/;c.copyProduct=angular.copy(c.product),c.addingRegion=!1,c.editingRegion=!1,c.deliveryAddress=c.copyProduct.is_shippable&&c.copyProduct.is_shippable.toString()||"false",c.deliveryNote=c.copyProduct.shipping_fields&&c.copyProduct.shipping_fields.delivery_note||"disabled",c.newRegion={region:"",fee:null},c.regions=c.copyProduct.shipping_fields&&c.copyProduct.shipping_fields.shipping_fees&&c.copyProduct.shipping_fields.shipping_fees.map(function(e){var t=e.fee;return t=d.test(t)?1:Number(t/100),_objectSpread(_objectSpread({},e),{},{fee:t})})||[],c.regionsRef=angular.copy(c.regions);c.editRegion=function(e,t,n){c.cancelRegion(),c.editingRegion=t,r(function(){var e=document.querySelectorAll(".js-region");e.length&&(e[t].focus(),e[t].select())})},c.addRegion=function(){r(function(){var e=document.getElementById("region");e.focus(),e.select()}),c.cancelRegion(),c.addingRegion=!0},c.saveShipping=function(e){var t={true:"required",false:"disabled"}[c.deliveryAddress],n=c.newRegion,r=n.region,o=n.fee;c.copyProduct.is_shippable="true"===c.deliveryAddress,c.copyProduct.shipping_fields=_objectSpread(_objectSpread({},c.copyProduct.shipping_fields),{},{shipping_address:t,delivery_note:c.deliveryNote}),r&&o&&(c.regions.push({region:r,fee:o}),c.newRegion={region:"",fee:null}),c.copyProduct.shipping_fields.shipping_fees=_toConsumableArray(c.regions.map(function(e){var t=e.fee;return d.test(e.fee)?t=1:t*=100,_objectSpread(_objectSpread({},e),{},{currency:c.copyProduct.currency,fee:t})})),c.addingRegion=!1;var a={id:c.copyProduct.id,is_shippable:c.copyProduct.is_shippable,shipping_fields:c.copyProduct.shipping_fields};u.updateProduct(a,function(){!function(e){if(!_.isNull(c.product.is_shippable)){var t=c.copyProduct.is_shippable!==c.product.is_shippable;t&&l("Updated delivery address",{Value:o})}var n=c.copyProduct.shipping_fields.delivery_note!==c.product.shipping_fields.delivery_note,r=c.regions.filter(function(t){return!c.regionsRef.some(function(e){return e.region===t.region})}),o=c.copyProduct.is_shippable?"Required":"Disabled";n&&l("Updated delivery note",{Value:c.copyProduct.shipping_fields.delivery_note});if(r.length){var a=r[0],i={Action:"Create",Region:a.region,Price:a.fee,Currency:c.product.currency};l("Set shipping fee",i)}if(e){var s={Action:"Update",Region:e.region,Price:e.fee,Currency:c.product.currency};l("Set shipping fee",s)}}(e),c.regionsRef=angular.copy(c.regions),s.success("Update successful","Delivery information saved"),i.reload()})},c.cancelRegion=function(){c.editingRegion=!1,c.addingRegion=!1,c.regions=angular.copy(c.regionsRef)},c.showDeleteShippingRegionModal=function(t){e.openConfirm({template:"modules/products/views/modals/delete-shipping-region.html",scope:c,controller:["$scope",function(e){e.deleteShippingRegion=function(){c.regions.splice(t,1),c.copyProduct.shipping_fields=_objectSpread(_objectSpread({},c.copyProduct.shipping_fields),{},{shipping_fees:_toConsumableArray(c.regions.map(function(e){return _objectSpread(_objectSpread({},e),{},{fee:100*Number(e.fee)})}))});var e={id:c.copyProduct.id,shipping_fields:c.copyProduct.shipping_fields};u.updateProduct(e,function(){i.reload()})}}],data:{index:t}})};o.isShippingTabTourFinished()||r(function(){var e=o.setupShippingTabSteps();introJs().addSteps(e).setOptions(o.options).start().oncomplete(function(){o.setShippingTabTourAsFinished()})},100)}]),ProductModule.controller("SingleProductCtrl",["$scope","product","ngDialog","$state","Notification","$timeout","clipboard","LocalAPI","$rootScope","ProductConstants","ProductFactory","AmplitudeService","$i18next",function(n,e,t,r,o,a,i,s,c,u,l,d,p){var f=d.logEvent;n.product=e.data;var m=n.product.slug||n.product.product_code;n.product.url="".concat(settings.landingPage,"/buy/").concat(m),n.copyProduct=angular.copy(n.product),n.loading=!1,n.editingProductName=Boolean(r.params.duplicated),n.countriesList=[],n.requiresDeliveryAddress=n.copyProduct.is_shippable&&n.copyProduct.is_shippable.toString()||!1,n.hasRegions=n.copyProduct.shipping_fields&&n.copyProduct.shipping_fields.shipping_fees&&0<n.copyProduct.shipping_fields.shipping_fees.length||!1;var g="digital"===n.product.type;n.physicalProductPublishable=!n.requiresDeliveryAddress||n.hasRegions,n.digitalProductPublishable=g&&n.product.digital_assets&&0<n.product.digital_assets.length,n.productPublishable=g?n.digitalProductPublishable:n.physicalProductPublishable,n.productActionsTooltip=g?p.t("digitalProducts.toAccessProductLinkUploadFile"):p.t("products.toAccessProductLinkAddDeliveryLocation"),n.clearFilter=function(){r.go(r.current,{id:n.product.id},{reload:!0,inherit:!1})},n.$watch("copyProduct.name",function(e,t){n.copyProduct.name||(n.copyProduct.name=""),n.copyProduct&&(n.copyProduct.name||""===n.copyProduct.name)&&(n.availableProductNameChars=u.MAX_PRODUCT_NAME_CHARACTERS-n.copyProduct.name.length,n.copyProduct.name.length>u.MAX_PRODUCT_NAME_CHARACTERS?n.editProductNameForm.productName.$setValidity("productName",!1):n.editProductNameForm.productName.$setValidity("productName",!0))});var h=function(){var e=document.getElementById("productName"),t=document.getElementById("productTitle"),n=300<t.clientWidth?t.clientWidth-50:300;a(function(){e.style.width=n+"px",e.focus(),e.select()})};n.editProductName=function(){n.editingProductName=!0,n.availableProductNameChars=u.MAX_PRODUCT_NAME_CHARACTERS-n.copyProduct.name.length,h()},n.saveProductName=function(){n.editingProductName=!1,r.params.duplicated=void 0;var e={id:n.copyProduct.id,name:n.copyProduct.name};l.updateProduct(e,function(){o.success("Update successful","Product name updated"),n.clearFilter()})},n.hideProductName=function(){n.copyProduct.name=angular.copy(n.product.name),n.editingProductName=!1},n.cancelProductName=function(){n.hideProductName(),r.params.duplicated=void 0,n.clearFilter()},n.previewProduct=function(){f("Clicked Preview button")},n.copyLink=function(e){var t=settings.landingPage+"/buy/"+n.copyProduct.slug;i.copyText(t),o.success("Product Link copied to the clipboard"),function(e){if(!e)return;var t=e.target.id;f("Copied Product Link",{From:{copyLinkButton:"Header",copyButton:"Body"}[t]})}(e)},n.showPublishModal=function(){t.openConfirm({template:"modules/products/views/modals/publish-product.html",scope:n,closeByDocument:!1}).then(function(){l.publishProduct(n.product.id).then(function(e){o.success("Published successfully","Your product is now in live mode"),c.switchState({state:"products.one",params:{id:e.data.id}})}).catch(function(e){c.$broadcast("publishSuccessful",!1),o.error("Could not publish this page",e)})})},n.archiveProduct=function(){n.copyProduct.active=!n.copyProduct.active;var e=n.copyProduct.active?"Product Link activated":"Product Link disabled";f(e);var t={id:n.copyProduct.id,active:n.copyProduct.active};l.updateProduct(t,function(){n.copyProduct.active?o.success("Update successful","Product has been restored successfully"):o.success("Update successful","Product has been archived successfully"),r.reload()})},n.duplicateProduct=function(e){l.duplicateProduct(e.id).then(function(e){o.success("Duplicated successfully","Product has been duplicated"),r.go("products.one.orders",{id:e.data.product.id,duplicated:!0})}).catch(function(e){o.error("Could not duplicate the product",e)})},n.showDeleteProductModal=function(){t.openConfirm({template:"modules/products/views/modals/delete-product.html",scope:n,controller:"ProductPopupCtrl",data:{product:n.product}}).then(function(){r.reload()})};n.editingProductName&&h(),s.one("countries.json").get().then(function(e){n.countriesList=e.map(function(e){return e.name})})}]);_excluded=["id"];function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ProductModule.controller("ProductVariantsCtrl",["$scope","$state","Notification","ProductFactory","AmplitudeService","ngDialog","utils","$rootScope","variants","variantOptions","ProductConstants","VariantUtils","$timeout",function(a,o,i,s,e,n,t,c,r,u,l,d,p){var f=e.logEvent,m=t.currencySubUnitToBaseUnit,g=t.currencyBaseUnitToSubUnit;a.inStockOptions=[{name:"Unlimited",value:!0},{name:"Limited",value:!1}],a.variants=d.formatVariants(r.data),a.variantsCopy=angular.copy(a.variants),a.variantsMeta=r.meta,a.MAX_VARIANT_OPTIONS=l.MAX_VARIANT_OPTIONS,a.MAX_VARIANT_OPTION_VALUES=l.MAX_VARIANT_OPTION_VALUES,a.price={priceToEdit:m(a.copyProduct.price)},a.options=[],a.optionValueToAdd={value:null},a.selectedOption={name:null,values:[]},a.optionValueEditingInProgress=!1,a.variantEditingInProgress=!1,a.allVariantsSelected=!1,a.atLeastOneVariantSelected=!1,a.selectedVariantCount=0,a.bulkUpdate={field:"price",value:null,statusValue:"enabled",unlimitedValue:"unlimited",quantityValue:0},a.variantToUpload=null,a.variantToUploadCopy=null,a.isUploading=!1,a.processing=!1,a.allVariantsInactive=!1,a.showingVariantsInactiveBanner=!1,a.isDigitalProduct=a.copyProduct.type&&"digital"===a.copyProduct.type,a.onEditVariant=function(){a.variantEditingInProgress=!0,f("Clicked edit inventory")},a.fetchVariants=function(){return s.getVariants().then(function(e){a.variants=d.formatVariants(e.data),a.variantsCopy=angular.copy(a.variants),a.variantsMeta=r.meta})},a.showAddOptionModal=function(){n.open({template:"/modules/products/views/modals/add-variant-option.html",controller:"ProductVariantsPopupCtrl",scope:a,closeByDocument:!1})},a.showEditOptionModal=function(e,t){a.selectedOption=angular.copy(e),n.open({template:"/modules/products/views/modals/edit-variant-option.html",controller:"ProductVariantsPopupCtrl",scope:a,closeByDocument:!1,data:{optionIndex:t}})},a.showDeleteOptionModal=function(e){n.open({template:"/modules/products/views/modals/delete-variant-option.html",controller:"ProductVariantsPopupCtrl",scope:a,closeByDocument:!1,data:{optionId:e}})},a.showUploadFileToVariantModal=function(e){a.variantToUpload=e,a.variantToUploadCopy=angular.copy(a.variantToUpload)},a.closeUploadModal=function(e){a.variantToUpload.files=angular.copy(a.variantToUploadCopy.files),e.closeThisDialog()},a.toggleLowStockAlert=function(){a.copyProduct.low_stock_alert=!a.copyProduct.low_stock_alert},a.checkVariant=function(){var e=a.variants.filter(function(e){return e.selected});a.atLeastOneVariantSelected=Boolean(e.length),a.selectedVariantCount=e.length},a.checkAllVariants=function(e){a.allVariantsSelected=e.target.checked,a.allVariantsSelected?(a.selectedVariantCount=a.filteredVariants.length,a.atLeastOneVariantSelected=!0,a.variants=d.toggleSelectAllVariants(a.filteredVariants,!0)):(a.selectedVariantCount=0,a.atLeastOneVariantSelected=!1,a.variants=d.toggleSelectAllVariants(a.filteredVariants,!1))},a.searchVariants=function(e){e||(a.variants=angular.copy(a.variantsCopy))},a.cancelVariant=function(){a.variantEditingInProgress=!1,a.copyProduct=angular.copy(a.product)},a.saveVariant=function(){a.copyProduct.price=g(Number(a.price.priceToEdit));var e=Number(a.copyProduct.minimum_orderable)||null,t=Number(a.copyProduct.maximum_orderable)||null,n=a.copyProduct.low_stock_alert?Number(a.copyProduct.stock_threshold):null,r={id:a.copyProduct.id,price:a.copyProduct.price,quantity:a.copyProduct.quantity,unlimited:a.copyProduct.unlimited,minimum_orderable:e,maximum_orderable:t,low_stock_alert:a.copyProduct.low_stock_alert,stock_threshold:n};s.updateProduct(r,function(){i.success("Update successful","Variant saved"),y(),a.product=angular.copy(a.copyProduct),o.reload().then(function(){a.variantEditingInProgress=!1,c.$broadcast("savedVariant",!0)})})};var h=function(){a.allVariantsInactive=a.variants.every(function(e){return!e.active}),a.showingVariantsInactiveBanner=a.variants.length&&a.allVariantsInactive};a.switchVariantActive=function(e,t){e.active=t,a.debounceUpdateVariant({id:e.id,active:t})},a.debounceUpdateVariant=function(e){a.variantEditingInProgress=!0,a.updateVariant(e)},a.updateVariant=_.debounce(function(r){p(function(){var e=r.id,t=_objectWithoutProperties(r,_excluded);if(d.checkValueValidity(t)){var n=d.formatUpdateParams(t);s.updateVariant(a.product.id,e,n).then(function(){i.success("Update successful","Variant updated"),d.checkIfUpdateNeedsRefetch(n)&&(a.selectedVariantCount=0,a.atLeastOneVariantSelected=!1,a.fetchVariants())}).catch(function(e){d.skipVariantUpdateErrorMessage(n)||i.error("Could not update variant",e),o.reload()}).finally(function(){a.variantEditingInProgress=!1,h()})}else a.variantEditingInProgress=!1})},800),a.bulkUpdateVariants=function(){a.variantEditingInProgress=!0;var t=a.variants.filter(function(e){return e.selected}).map(function(e){return e.id}),n=d.formatBulkUpdateParams(a.bulkUpdate);s.bulkUpdateVariants(a.product.id,t,n).then(function(){var e=d.updateTableFields(a.variants,t,n);a.variants=d.formatVariants(e),i.success("Updated successfully","Variants have been updated"),a.bulkUpdate.value=null}).catch(function(e){d.skipVariantUpdateErrorMessage(n)||i.error("Could not update variant",e)}).finally(function(){a.variantEditingInProgress=!1})},a.updateOptionRank=function(t,n,r,o){p(function(){if(a.options.length&&r!==o){var e=n.findIndex(function(e){return e.id===t.id});t.rank=e+1,a.generatingVariants=!0,s.updateOptionRank(a.copyProduct.id,t).then(function(){return a.fetchVariants()}).finally(function(){a.generatingVariants=!1})}})},a.removeSelectedValue=function(e,n){return e.filter(function(e,t){return t!==n})},a.showRemoveOptionValueModal=function(e,t){if(e.id)return n.open({template:"/modules/products/views/modals/delete-variant-option-value.html",controller:"ProductVariantsPopupCtrl",scope:a,closeByDocument:!1,data:{value:e,values:a.selectedOption.values,valueIndex:t}});a.selectedOption.values=a.removeSelectedValue(a.selectedOption.values,t)};var y=function(){var e=a.copyProduct.price!==a.product.price,t=a.product.unlimited!==a.copyProduct.unlimited,n=a.product.quantity!==a.copyProduct.quantity;f("Updated inventory",{Price:e,Stock:n||t})};a.resetSelectedOption=function(){a.selectedOption={name:null,values:[]},a.optionValueToAdd={value:null}},a.resetOptions=function(){u.data&&u.data.length&&(a.options=angular.copy(u.data))},a.resetOptions(),h()}]),ProductModule.controller("ProductVariantsPopupCtrl",["$scope","ProductFactory","Notification","$state","$timeout","$rootScope","ngDialog",function(o,a,i,s,c,u,n){var l=function(e){return e.filter(function(e){return null!==e||e&&e.trim().length})};o.addOptionValue=function(){o.selectedOption.values.length>=o.MAX_VARIANT_OPTION_VALUES||(o.selectedOption.values.push({name:o.optionValueToAdd.value}),o.optionValueToAdd.value=null,1===o.selectedOption.values.length&&o.selectedOption.values.push({name:o.optionValueToAdd.value}),c(function(){var e=document.querySelectorAll(".add-option");if(e.length){var t=e[e.length-1];t.focus(),t.select()}}))},o.debounceUpdateOptionValue=function(e){o.optionValueEditingInProgress=!0,o.updateOptionValue(e)},o.updateOptionValue=_.debounce(function(e){c(function(){e.id?a.updateOptionValue(o.product.id,o.selectedOption.id,e).catch(function(e){i.error("Could not update variant option value",e)}).finally(function(){o.optionValueEditingInProgress=!1}):o.optionValueEditingInProgress=!1})},800),o.cancelOption=function(){o.closeThisDialog(),o.resetSelectedOption(),o.resetOptions(),s.reload()},o.saveOption=function(){o.optionValueToAdd.value&&!o.selectedOption.values.length&&o.selectedOption.values.push({name:o.optionValueToAdd.value}),o.selectedOption.values=l(o.selectedOption.values);var e,t,n,r=(e=o.selectedOption,t=e.values.filter(function(e){return!e.id}),n=_objectSpread({},e),t.length&&(n.values=t),n);o.generatingVariants=!0,o.optionValueEditingInProgress=!0,a.saveOption(o.product,r).then(function(){c(function(){o.generatingVariants=!1,o.optionValueEditingInProgress=!1,u.$broadcast("addedVariant"),o.closeThisDialog(),o.resetSelectedOption(),i.success("Added successfully","Variant option has been added"),s.reload()},2e3)}).catch(function(e){o.generatingVariants=!1,o.optionValueEditingInProgress=!1,u.$broadcast("addedVariant",!1),i.error("Could not add variant option",e)})},o.updateOption=function(){o.selectedOption.values=l(o.selectedOption.values);var e=o.product.id;o.generatingVariants=!0,o.optionValueEditingInProgress=!0,a.updateOption(e,o.selectedOption).then(function(){c(function(){o.generatingVariants=!1,o.optionValueEditingInProgress=!1,u.$broadcast("updatedVariant"),o.closeThisDialog(),o.resetSelectedOption(),i.success("Updated successfully","Variant option has been updated"),s.reload()},2e3)}).catch(function(e){o.generatingVariants=!1,o.optionValueEditingInProgress=!1,u.$broadcast("updatedVariant",!1),i.error("Could not update variant option",e)})},o.deleteOption=function(e){a.deleteOption(o.product,e).then(function(){u.$broadcast("removedVariant"),o.closeThisDialog(),i.success("Removed successfully","Variant option has been removed"),s.reload()}).catch(function(e){u.$broadcast("removedVariant",!1),i.error("Could not remove variant option",e)})},o.updateOptionValueRank=function(t,n){c(function(){if(t.id){o.$broadcast("generatedVariants",!1);var e=n.findIndex(function(e){return e.id===t.id});t.rank=e+1,a.updateOptionValue(o.product.id,o.selectedOption.id,t).then(function(){o.$broadcast("generatedVariants")}).catch(function(){o.$broadcast("generatedVariants",!1)})}})},o.deleteOptionValue=function(e,t){a.deleteOptionValue(o.product.id,o.selectedOption.id,e).then(function(){if(o.selectedOption.values=o.removeSelectedValue(o.selectedOption.values,t),u.$broadcast("removedVariant"),o.closeThisDialog(),!o.selectedOption.values.length)return n.closeAll(),s.reload();o.fetchVariants()}).catch(function(e){i.error("Could not remove variant option value",e),u.$broadcast("removedVariant",!1)})}}]),ProductModule.controller("ProductVariantUploadCtrl",["$scope","ProductFactory","Notification","$state","$timeout","MediaUploadService","Upload","ProductUtils","AmplitudeService","ProductConstants",function(i,n,r,o,a,s,c,u,e,l){var d=e.logEvent;i.resetUploadedFiles=function(){i.uploadedFiles=[]},i.upload=function(e){i.resetUploadedFiles();var t=s.getValidFiles(e,"standard");t.length&&(i.files=s.removeUnnecessaryFiles(t,i.variantToUpload,{maxFileUploadCount:l.MAX_UPLOAD_COUNT,fileType:"standard"}),i.processing=!0,i.isUploading=!0,d("Media upload started"),s.getSignedUrls(i.files).then(function(e){var t,r;t=i.files,r=e,t.forEach(function(t,e){var n=r[e];t.upload=c.http({url:window.location.href.includes("localhost")?"https://cors-anywhere.herokuapp.com/".concat(n.signed_url):n.signed_url,method:"PUT",headers:{"Content-Type":t.type},data:t}),t.upload.then(function(e){return a(function(){t.result=e.data,t.status=e.status}),e},function(e){0<e.status&&(i.errorMsg="".concat(e.status,": ").concat(e.data))},function(e){t.progress=Math.min(100,parseInt(100*e.loaded/e.total))}).then(function(e){if(!e)return i.files=i.files.filter(function(e){return e!==t}),p();i.uploadedFiles.push(t),f(t,n),p()})})}))};var p=function(){i.uploadedFiles.length===i.files.length&&(i.isUploading=!1,i.processing=!1)},f=function(e,t){var n=t.key,r=t.path,o=u.getMediaType(e.type),a={key:n,path:r,original_filename:e.name,type:o};Array.isArray(i.variantToUpload.files)?i.variantToUpload.files.push(a):i.variantToUpload.files=[a]};i.saveUploadedFiles=function(e){var t={files:i.variantToUpload.files};n.updateVariant(i.product.id,i.variantToUpload.id,t).then(function(){r.success("Update successful","Files uploaded")}).catch(function(e){r.error("Could not update variant",e),o.reload()}).finally(function(){e.closeThisDialog(),i.variantEditingInProgress=!1})},i.deleteFile=function(e){var t=i.variantToUpload.files.slice(0,e).concat(i.variantToUpload.files.slice(e+1,i.variantToUpload.files.length));i.variantToUpload.files=t.length?t:null}}]),ProductModule.directive("digitalFile",["Notification","ProductUtils","ngDialog","ProductFactory","$state","$i18next",function(n,e,r,o,a,i){return{restrict:"E",replace:!0,scope:{product:"=",file:"=",sortable:"="},template:'\n    <div class="flex flex-align--center digital-product-upload__list-item">\n      <div ng-class="{\'digital-product-upload__disabled-sort\': !sortable}" sv-handle class="flex sort-handle"></div>\n      <div class="digital-product-upload__list-item-content w-full">\n        <div class="flex flex-item--fill flex-align--center ">\n          <div class="digital-product-upload__thumb-container">\n            <div ng-switch="file.file_type">\n              <div ng-switch-when="jpg">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-image.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="png">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-image.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="pdf">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-pdf.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="mobi">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-mobi.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="epub">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-epub.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="mp4">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-video.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="mp3">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-audio.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-when="wav">\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file-audio.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n              <div ng-switch-default>\n                <img\n                  alt="digital-file"\n                  src="/assets/svg/46/icon-file.svg"\n                  class="upload-modal__thumb"\n                />\n              </div>\n            </div>\n          </div>\n          <div class="flex-item--fill">\n            <div class="flex flex-direction--column" ng-if="digitalFileNameView === \'update\'">\n              <form name="updateDigitalFileNameForm" class="form-validation flex flex-align--center flex-justify--space-between">\n                <div class="form-group m-none flex-item--fill">\n                  <input\n                    type="text"\n                    class="form-control input-v2"\n                    ng-model="fileNameFormData.fileName"\n                    placeholder="{{ \'digitalProducts.digitalFile.nameOfProduct\' | i18next }}"\n                    required\n                    data-testid="digital-asset-name"\n                  />\n                </div>\n                <button type="button" class="button m-r-xs m-l-xs" ng-click="resetDigitalFileNameInput();">{{ \'digitalProducts.digitalFile.cancel\' | i18next }}</button>\n                <button \n                  class="button button--primary" \n                  ng-disabled="updateDigitalFileNameForm.$invalid"\n                  ng-click="updateDigitalFileName()"\n                  ng-loading="digitalFileNameUpdated"\n                  data-testid="update-digital-file-name">\n                  {{ \'digitalProducts.digitalFile.save\' | i18next }}\n                </button>\n              </form>\n            </div>\n            <div class="flex flex-justify--space-between" ng-show="digitalFileNameView === \'preview\'">\n              <div class="flex flex-direction--column">\n                <h6 class="v2-text v2-text-bold no-margin m-b-xs">\n                  {{fileCopy.original_name}}\n                </h6>\n                <div ng-switch="file.file_type" class="v2-text-muted text-xs no-margin">\n                  <span ng-switch-when="jpg">\n                    {{ file.file_type | uppercase}}, {{ fileSize }}, {{ file.meta.image_metadata.DPI }} {{ \'digitalProducts.digitalFile.metadata.dpi\' | i18next }}\n                  </span>\n                  <span ng-switch-when="png">\n                    {{ file.file_type | uppercase}}, {{ fileSize }}, {{ file.meta.image_metadata.DPI }} {{ \'digitalProducts.digitalFile.metadata.dpi\' | i18next }}\n                  </span>\n                  <span ng-switch-when="pdf">\n                    {{ file.file_type | uppercase}}, {{ fileSize }}, {{ \'digitalProducts.digitalFile.metadata.pages\' | i18next: { count: file.meta.pages } }}\n                  </span>\n                  <span ng-switch-when="mp4">\n                    {{ file.file_type | uppercase}}, {{ fileSize }}, {{ formatFileDuration(file.meta.duration) }}\n                  </span>\n                  <span ng-switch-when="wav">\n                    {{ file.file_type | uppercase}}, {{ fileSize }}, {{ formatFileDuration(file.meta.duration) }}\n                  </span>\n                  <span ng-switch-default>\n                    {{ file.file_type | uppercase}}, {{ fileSize }}\n                  </span>  \n                </div>              \n              </div>\n              <div class="flex flex-justify--end flex-align--center" style="flex-basis: 30%;">\n                <div uib-dropdown class="product-actions m-l-sm">\n                  <button type="button" class="button-icon" uib-dropdown-toggle>\n                    <span class="buttonicon-more"></span>\n                  </button>\n                  <ul class="uib-dropdown-menu flat dropdown-menu-right m-t-sm">\n                    <li>\n                      <a href ng-click="digitalFileNameView = \'update\'">{{ \'digitalProducts.digitalFile.menu.renameFile\' | i18next }}</a>\n                      <div class="product-options-divider"></div>\n                      <a href ng-click="showDeleteDigitalFileModal()" class="product-actions__delete">{{ \'digitalProducts.digitalFile.menu.deleteFile\' | i18next }}</a>\n                    </li>\n                  </ul>\n                </div>\n              </div>  \n            </div>\n          </div>\n        </div>\n        <div ng-if="file.file_type === \'pdf\'" class="flex flex-direction--column hidden" >\n          <div class="flex flex-justify--space-between m-t">\n            <p class="text-sm bold m-none">\n              {{ \'digitalProducts.digitalFile.stampPagesWithBuyerInformation\' | i18next }}\n            </p>\n            <div class="onoffswitch m-none" ng-click="shouldStampPages = !shouldStampPages">\n                <input type="checkbox" class="onoffswitch-checkbox" name="stamp-pages-toggle" ng-checked="shouldStampPages" data-testid="stamp-pages-toggle">\n                <label class="onoffswitch-label" for="stamp-pages-toggle"></label>\n            </div>\n          </div>\n          <img ng-if="shouldStampPages" class="digital-product-upload__pdf-preview m-t-md" ng-src="{{ renderPDFPreview() }}"  alt="pdf-preview"/>\n          <div ng-if="shouldStampPages" class="flex flex-justify--space-between m-t-md flex-align--center">\n            <p class="text-sm bold m-none">\n                {{ \'digitalProducts.digitalFile.watermarkPlacement\' | i18next }}\n            </p>\n            <div>\n              <span class="pill clickable" ng-click="updatePdfStampPosition(\'left\')" ng-class="pdfStampPosition === \'left\' ? \'pill-fill-green\' : \'pill-fill-white\'">{{ \'digitalProducts.digitalFile.left\' | i18next }}</span>\n              <span class="pill clickable m-l-xs m-r-xs" ng-click="updatePdfStampPosition(\'center\')" ng-class="pdfStampPosition === \'center\' ? \'pill-fill-green\' : \'pill-fill-white\'">{{ \'digitalProducts.digitalFile.center\' | i18next }}</span>\n              <span class="pill clickable" ng-click="updatePdfStampPosition(\'right\')" ng-class="pdfStampPosition === \'right\' ? \'pill-fill-green\' : \'pill-fill-white\'">{{ \'digitalProducts.digitalFile.right\' | i18next }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',link:function(t){t.fileCopy=angular.copy(t.file),t.fileNameFormData={fileName:t.fileCopy.original_name},t.digitalFileNameView="preview",t.shouldStampPages=!1,t.pdfStampPosition=null,t.fileSize=e.bytesToSize(t.file.file_size),t.resetDigitalFileNameInput=function(){t.digitalFileNameView="preview",t.fileNameFormData.fileName=t.fileCopy.original_name},t.updatePdfStampPosition=function(e){t.pdfStampPosition=e},t.updateDigitalFileName=function(){var e=t.fileNameFormData.fileName;o.updateDigitalFile(t.file.id,e).then(function(){n.success(i.t("digitalProducts.digitalFile.fileNameUpdated")),t.fileCopy.original_name=e,t.$broadcast("digitalFileNameUpdated"),t.digitalFileNameView="preview"}).catch(function(e){t.$broadcast("digitalFileNameUpdated",!1),n.error("Could not update the digital file's name",e)})},t.renderPDFPreview=function(){return"/assets/img/background.svg"},t.showDeleteDigitalFileModal=function(){r.openConfirm({template:"modules/products/views/modals/delete-digital-file.html",scope:t})},t.deleteDigitalProduct=function(){o.deleteDigitalFile(t.file.id).then(function(e){n.success("File successfully deleted"),t.$broadcast("digitalProductDeleted"),r.closeAll(),a.reload()}).catch(function(e){t.$broadcast("digitalProductDeleted",!1),n.error("Could not delete the digital file",e)})},t.formatFileDuration=function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60),o="";if(0<t){var a="".concat(n<10?"0":"");o+="".concat(t,":").concat(a)}var i="".concat(r<10?"0":"");return o+="".concat(n,":").concat(i),o+="".concat(r," min")}}}}]),ProductModule.directive("digitalFileUploading",["ProductUtils","$sanitize",function(e,n){return{restrict:"E",replace:!0,scope:{file:"="},template:'\n    <div class="digital-product-upload__list-item-processing">\n      <div class="c-media-uploader c-media-uploader--image">\n        <div class="c-media-uploader__body digital-product-upload__list-item-content">\n          <div class="c-media-uploader__progress">\n            <div class="flex flex-direction--column w-full">\n              <div class="flex flex-align--center">\n                <div class="padder-right-sm">\n                  <div class="flex flex-justify--space-around flex-align--center">\n                    <div class="digital-product-upload__thumb-container">\n                      <div ng-switch="file.type">\n                        <div ng-switch-when="image">\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file-image.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                        <div ng-switch-when="pdf">\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file-pdf.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                        <div ng-switch-when="mobi">\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file-mobi.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                        <div ng-switch-when="epub">\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file-epub.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                        <div ng-switch-when="mp4">\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file-video.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                        <div ng-switch-when="audio/wav">\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file-audio.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                        <div ng-switch-default>\n                          <img\n                            alt="digital-file"\n                            src="/assets/svg/46/icon-file.svg"\n                            class="upload-modal__thumb"\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div class="flex-item--fill">\n                  <div class="flex flex-justify--space-between">\n                    <div>\n                      <h6 class="v2-text v2-text-bold no-margin">\n                        {{fileName}}\n                      </h6>\n                      <p class="v2-text-muted no-margin">\n                        {{ \'digitalProducts.digitalFile.fileSize\' | i18next }} {{ fileSize }}\n                      </p>\n                    </div>\n                    <div ng-if="uploadState === \'uploading\'">\n                      <button class="c-media-uploader__cancel no-bg" ng-click="abortUpload()"></button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div ng-if="uploadState === \'uploading\'" class="c-media-uploader__progress-level-container m-t-md">\n                <div\n                  class="c-media-uploader__progress-level"\n                  ng-style="{ \'width\': file.progress + \'%\' }"\n                ></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',link:function(t){t.fileSize=e.bytesToSize(t.file.size),t.uploadState="uploading",t.fileName=n(t.file.name),t.$watch("file.progress",function(e){100===e&&(t.uploadState="upload-complete")}),t.abortUpload=function(){t.uploadState="aborted",t.file.upload.abort()}}}}]),ProductModule.directive("digitalFiles",["Notification","ProductFactory","$rootScope",function(t,e,r){return{restrict:"E",scope:{product:"=",totalProductVariantOptions:"="},template:'\n    <div>\n      <div class="col-sm-12 m-t-xl no-padder">\n        <div ng-if="totalProductVariantOptions > 0 && !acceptedProductHasVariants" class="padder-left-lg">\n          <div class="digital-upload-variant-warning">\n            <div class="digital-upload-variant-warning__header">\n              <svg width="17" height="15" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M8.57465 3.21733L1.51632 15.0007C1.37079 15.2527 1.29379 15.5384 1.29298 15.8294C1.29216 16.1204 1.36756 16.4066 1.51167 16.6594C1.65579 16.9123 1.86359 17.1229 2.11441 17.2705C2.36523 17.4181 2.65032 17.4975 2.94132 17.5007H17.058C17.349 17.4975 17.6341 17.4181 17.8849 17.2705C18.1357 17.1229 18.3435 16.9123 18.4876 16.6594C18.6317 16.4066 18.7071 16.1204 18.7063 15.8294C18.7055 15.5384 18.6285 15.2527 18.483 15.0007L11.4246 3.21733C11.2761 2.97241 11.0669 2.76993 10.8173 2.6294C10.5677 2.48887 10.2861 2.41504 9.99965 2.41504C9.7132 2.41504 9.43159 2.48887 9.18199 2.6294C8.93238 2.76993 8.72321 2.97241 8.57465 3.21733Z" fill="#FFAA22" stroke="#FFAA22" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M10 7.5V10.8333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M10 14.1667H10.0122" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n              <p class="text-base text-bold m-l-sm m-b-none">{{ \'digitalProducts.thisProductHasVariants\' | i18next }}</p>\n            </div>\n            <p class="text-base" ng-i18next="[html]digitalProducts.uploadingDigitalFilesWillRemoveVariants"></p>\n            <a ng-click="handleProceedToUploadClick();" class="text-bold m-t text-primary">{{ \'digitalProducts.proceedToUploadFiles\' | i18next }}</a>\n          </div>\n        </div>\n        <div ng-if="canRenderAddFileComponent()">\n          <div class="padder-left-lg">\n            <h4 class="title-v2 h6 text-bold">{{ \'digitalProducts.uploadFiles\' | i18next }}</h4>\n            <h6 class="h6 v2-text v2-text-muted m-r-xxl m-b-sm">\n              {{ \'digitalProducts.customersWhoPurchaseThisProduct\' | i18next }}\n              <a class="text-primary" href="https://support.paystack.com/hc/en-us/articles/360013714899-How-do-I-sell-my-digital-goods-on-Paystack" rel="noreferrer" target="_blank">\n                {{ \'digitalProducts.learnMore\' | i18next }}\n              </a>\n            </h6>\n          </div>\n          <digital-file-upload\n            data-testid="add-digital-files" \n            product="product">\n          </digital-file-upload>\n        </div>\n        <div class="m-t-lg" style="padding-bottom: 300px;">\n          <div class="flex flex-justify--space-between padder-left-lg padder-right-xl" ng-if="productExpiryVisible">\n            <p class="v2-text v2-text-bold m-none flex">\n              {{ \'digitalProducts.setDownloadLinksToExpire\' | i18next }}\n              <span class="m-l-xs" uib-tooltip="{{ \'digitalProducts.howLongShouldDownloadLinksLast\' | i18next }}">\n                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M9.24986 14.6786C12.8003 14.6786 15.6784 11.8004 15.6784 8.24998C15.6784 4.69958 12.8003 1.82141 9.24986 1.82141C5.69946 1.82141 2.82129 4.69958 2.82129 8.24998C2.82129 11.8004 5.69946 14.6786 9.24986 14.6786Z" stroke="#C1C1C1" stroke-linecap="round" stroke-linejoin="round"/>\n                  <path d="M7.35206 5.80211C7.5002 5.39323 7.79259 5.04845 8.17746 4.82883C8.4841 4.65386 8.83367 4.56733 9.18565 4.57645C9.27544 4.57877 9.36538 4.58732 9.45481 4.60221C9.89479 4.67549 10.2939 4.89759 10.5814 5.22919C10.8688 5.56078 11.0262 5.98046 11.0255 6.4139C11.0255 7.63747 9.13524 8.24926 9.13524 8.24926" stroke="#C1C1C1" stroke-linecap="round" stroke-linejoin="round"/>\n                  <path d="M9.73235 11.3036C9.73235 11.5698 9.51649 11.7857 9.25021 11.7857C8.98393 11.7857 8.76807 11.5698 8.76807 11.3036C8.76807 11.0373 8.98393 10.8214 9.25021 10.8214C9.51649 10.8214 9.73235 11.0373 9.73235 11.3036Z" stroke="#C1C1C1" stroke-width="0.75"/>\n                </svg>\n              </span>\n            </p>\n            <div class="onoffswitch m-none" ng-click="toggleDigitalProductExpiry()">\n              <input type="checkbox" class="onoffswitch-checkbox" name="digital-product-expiry-toggle" ng-checked="expiryActive" data-testid="digital-product-expiry-toggle">\n              <label class="onoffswitch-label" for="digital-product-expiry-toggle"></label>\n            </div>\n          </div>\n          <div class="padder-left-lg padder-right-xl" ng-show="expiryActive === true">\n            <form name="productExpiryForm" class="form-validation" ng-if="expiryFormVisible">\n              <div class="form-group flex flex-align--center m-b-none">\n                <div class="flex flex-direction--column">\n                  <p class="v2-text v2-text-muted m-b">\n                    {{ \'digitalProducts.expiryForm.expireAfter\' | i18next }}\n                  </p>\n                  <div class="flex flex-align--center">\n                    <input\n                      type="number"\n                      class="form-control input-v2"\n                      ng-model="expiryFormValues.daysTillExpired"\n                      placeholder="0"\n                      ng-pattern="/^(0*[1-9]+0*)+$/"\n                      max="365"\n                      required\n                      data-testid="product-days-till-expired"\n                      style="width: 137px;"\n                    />\n                    <span class="m-sm v2-text">{{ \'digitalProducts.expiryForm.days\' | i18next }}</span>\n                  </div>\n                </div>\n              </div>\n              <p class="text-xs text-muted m-t-xs m-b-md">{{ \'digitalProducts.expiryForm.maxExpiryDuration\' | i18next }}</p>\n              <button type="button" class="button m-r-xs" ng-click="resetExpiryForm();">{{ \'digitalProducts.expiryForm.cancel\' | i18next }}</button>\n              <button \n                class="button button--primary" \n                ng-disabled="productExpiryForm.$invalid"\n                ng-click="updateProductExpiry()"\n                ng-loading="productExpiryUpdated"\n                data-testid="save-digital-product-expiry">\n                {{ \'digitalProducts.expiryForm.save\' | i18next }}\n              </button>\n            </form>\n            <div ng-if="productExpiryVisible">\n              <div ng-if="expiryFormValues.daysTillExpired && !expiryFormVisible">\n                <p class="v2-text v2-text-muted m-b">{{ \'digitalProducts.daysTillExpiry\' | i18next: { count: productCopy.expires_in } }}</p>\n                <button type="button" class="button m-r-lg" ng-click="toggleExpiryForm()">\n                  {{ \'digitalProducts.expiryForm.edit\' | i18next }}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',link:function(n){n.productExpiryVisible=n.product.digital_assets.length,n.productCopy=angular.copy(n.product),n.expiryActive=null!==n.productCopy.expires_in,n.expiryFormValues={daysTillExpired:n.productCopy.expires_in},n.expiryFormVisible=!1,n.acceptedProductHasVariants=!1,n.handleProceedToUploadClick=function(){n.acceptedProductHasVariants=!0},n.canRenderAddFileComponent=function(){return 0===n.totalProductVariantOptions||0<n.totalProductVariantOptions&&n.acceptedProductHasVariants},n.toggleExpiryForm=function(){n.expiryFormVisible=!n.expiryFormVisible},n.resetExpiryForm=function(){n.expiryFormVisible=!1,n.expiryFormValues.daysTillExpired=n.productCopy.expires_in},r.$on("productDigitalFilesUpdated",function(e,t){n.productExpiryVisible=0<t.length}),n.toggleDigitalProductExpiry=function(){n.expiryActive=!n.expiryActive,n.expiryActive?n.expiryFormValues.daysTillExpired=7:n.expiryFormValues.daysTillExpired=null,e.updateProduct(_objectSpread(_objectSpread({},n.productCopy),{},{expires_in:n.expiryFormValues.daysTillExpired})).then(function(e){n.productCopy.expires_in=n.expiryFormValues.daysTillExpired,n.$broadcast("productExpiryUpdated"),n.expiryFormVisible=!1}).catch(function(e){t.error("Could not toggle digital product expiry",e)})},n.updateProductExpiry=function(){e.updateProduct(_objectSpread(_objectSpread({},n.productCopy),{},{expires_in:n.expiryFormValues.daysTillExpired})).then(function(e){n.productCopy.expires_in=n.expiryFormValues.daysTillExpired,t.success("Digital product file expiry has been updated"),n.$broadcast("productExpiryUpdated"),n.expiryFormVisible=!1}).catch(function(e){t.error("Could not update digital product expiry",e)})}}}}]),ProductModule.directive("onlyNumbers",[function(){return{restrict:"A",link:function(e,t,n,r){t.on("keydown",function(e){return e.shiftKey?(e.preventDefault(),!1):-1<[8,13,27,37,38,39,40].indexOf(e.which)||(48<=e.which&&e.which<=57||(96<=e.which&&e.which<=105||(e.preventDefault(),!1)))})}}}]).directive("autoExpandTextarea",[function(){return{restrict:"A",link:function(e,t,n,r){t.bind("keydown",function(){var e=this;setTimeout(function(){e.style.cssText="height:auto; padding:0",e.style.cssText="height:"+(e.scrollHeight+15)+"px"},0)})}}}]).directive("focusSiblingOnClick",[function(){return{restrict:"A",link:function(e,t){t.bind("click",function(){var e=t.parent().find("input");if(!e.length)return;e[0].focus()})}}}]).directive("infiniteScroll",[function(){return{restrict:"A",link:function(e,t,n){var r=t[0];t.bind("scroll",function(){r.scrollTop>=r.scrollHeight-parseInt(n.scrollReQueryHeight)&&e.$apply(n.infiniteScroll)})}}}]).directive("quillEditor",["$compile",function(i){return{restrict:"E",scope:{onChange:"&"},link:function(n,e,t){var r='<div id="editor">'.concat(t.quillData,"</div>"),o=i(r)(n);e.append(o);var a=new Quill("#editor",{modules:{toolbar:[["bold","italic",{list:"ordered"},{list:"bullet"},"blockquote","link",{header:[2,3,!1]}]]},placeholder:"",theme:"snow"});a.on("text-change",function(){var e=a.getText(),t=a.root.innerHTML;n.onChange({quillDataText:e,quillDataHTML:t})})}}}]),ProductModule.factory("ProductExportService",["LocalService","Session",function(t,e){return{getAvailableKeys:function(){return[{name:"Order Fee",value:"amount"},{name:"Shipping Fee",value:"shipping_fee"},{name:"Shipping Region",value:"region"},{name:"Paid Date",value:"paid_at"},{name:"Storefront Slug",value:"storefront_slug"},{name:"Variant Options",value:"variant_options"}]},getSelectedKeys:function(){return[{name:"Product Name",value:"product_name"},{name:"Product Price",value:"price"},{name:"Order Status",value:"status"},{name:"Order ID",value:"order_id"},{name:"Order Code",value:"order_code"},{name:"Order Date",value:"created_at"},{name:"Customer First Name",value:"first_name"},{name:"Customer Last Name",value:"last_name"},{name:"Customer Phone Number",value:"phone"},{name:"Customer Email Address",value:"email"},{name:"Currency",value:"currency"},{name:"Amount Paid",value:"amount_paid"},{name:"Quantity Purchased",value:"quantity"},{name:"Delivery Address",value:"shipping_address"},{name:"Delivery Note",value:"delivery_note"}]},saveCsv:function(e){var t=document.createElement("a");t.href=e,t.style.display="none",document.body.appendChild(t),t.click(),t.parentNode.removeChild(t)},getPreferenceKey:function(){return"product-orders-export-preferences-"+e.get("account").id},getExportPreferences:function(){var e=this.getPreferenceKey();return t.get(e)}}}]);_excluded=["id"],_excluded2=["id"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ProductModule.factory("ProductFactory",["API","$rootScope","Notification","ProductConstants","ProductUtils","$stateParams","utils",function(i,a,s,c,e,t,n){var r=n.currencyBaseUnitToSubUnit;return{listProducts:function(){return i.one("product").get()},createProduct:function(e){return e.unlimited&&_.has(e,"quantity")&&delete e.quantity,i.all("product").post(_objectSpread(_objectSpread({},e),{},{price:r(e.price)}))},updateProduct:function(e,t){var n=_objectSpread({},e);if(delete n.url,n.unlimited&&_.has(n,"quantity")&&delete n.quantity,n.description){var r=window.striptags(n.description,c.DESCRIPTION_AVAILABLE_TAGS);n.description=r}var o=Array.isArray(n.files)&&n.files.length&&n.files.map(function(e){return{key:e.key,type:e.type,path:e.path,original_filename:e.original_filename||e.key}});return n.files=o||n.files,i.one("product",n.id).customPUT(n).then(function(e){if(t&&"function"==typeof t)return t(null,e)},function(e){return a.$broadcast("productUpdated",!1),s.error("Could not update this product",e),t(e,null)})},deleteProduct:function(e,t){i.one("product",e).customDELETE().then(t)},restoreProduct:function(e,t){var n=_objectSpread({},e);n.active=!0,i.one("product",n.id).customPUT(n).then(t)},publishProduct:function(e){return i.one("product/".concat(e,"/migrate")).post()},duplicateProduct:function(e){return i.one("product/".concat(e,"/duplicate")).post()},saveOption:function(e,t){var n=e.id;return i.all("product/".concat(n,"/option")).post(t)},updateOption:function(e,t){var n=t.id,r=_objectWithoutProperties(t,_excluded);return i.one("product/".concat(e,"/option/").concat(n)).customPUT(r)},deleteOption:function(e,t){var n=e.id;return i.one("product/".concat(n,"/option/").concat(t)).customDELETE()},updateOptionRank:function(e,t){var n=t.id,r=t.rank;return i.one("product/".concat(e,"/option/").concat(n)).customPUT({rank:r})},updateOptionValue:function(e,t,n){var r=n.id;return i.one("product/".concat(e,"/option/").concat(t,"/value/").concat(r)).customPUT(n)},deleteOptionValue:function(e,t,n){var r=n.id;return i.one("product/".concat(e,"/option/").concat(t,"/value/").concat(r)).customDELETE()},getVariants:function(){return i.one("product/".concat(t.id,"/variant")).get(t)},getVariantOptions:function(){return i.one("product/".concat(t.id,"/option")).get()},updateVariant:function(e,t,n){return i.one("product/".concat(e,"/variant/").concat(t)).customPUT(n)},bulkUpdateVariants:function(e,t,n){return i.one("product/".concat(e,"/variant/bulk-update")).customPUT(_objectSpread({variant_ids:t},n))},listProductOrders:function(e,t){return i.one("order/product/".concat(e)).get(_objectSpread({},t))},updateOrderShipment:function(e){var t={};return t.shipping=_objectSpread({},e.shipping),t.shipping_method=_objectSpread({},e.shipping_method),i.one("order",e.id).customPUT(t)},preloadOrder:function(e){return a.$broadcast("resetView"),i.one("order/".concat(e)).get()},getOrder:function(e){return i.one("order/".concat(e)).get()},updateOrderStatus:function(e){return delete e.index,i.one("order",e.id).customPUT(e)},listOrderLogs:function(e){return i.one("order/".concat(e,"/log")).get()},checkSlug:function(e,t){return i.one("product/slug/".concat(e,"/status")).withHttpConfig({timeout:t.promise}).get()},exportProductOrdersToCsv:function(e,t){var n=t.id,r=_objectWithoutProperties(t,_excluded2);return i.one("order/product/".concat(n,"/export?export_columns=").concat(e)).get(_objectSpread({},r))},exportOrdersToCsv:function(e,t){return i.one("order/export?export_columns=".concat(e)).get(_objectSpread({},t))},savePostPurchaseInfo:function(e){var t=e.id,n=e.redirect_url,r=e.success_message,o=e.split_code,a=e.notification_emails;return i.one("product",t).customPUT({redirect_url:n,success_message:r,split_code:o,notification_emails:a})},addProductDigitalFiles:function(e,t){return i.all("product/".concat(e,"/digital/assets")).post(t)},updateDigitalFile:function(e,t){return i.one("product/digital/assets/".concat(e)).customPUT({original_name:t})},deleteDigitalFile:function(e){return i.one("product/digital/assets/".concat(e)).customDELETE()}}}]),ProductModule.factory("ProductIntroService",["LocalService","$timeout","utils",function(e,t,n){var r=n.getElementOffset,o=function(e){var t=document.getElementById(e);return t&&window.innerHeight/2<r(t).top?"top":"bottom"};return{isFirstProductCreated:function(){return e.get("firstProductCreated")},setFirstProductIsCreated:function(){e.set("firstProductCreated",!0)},isOrdersTabTourFinished:function(){return e.get("product_orders_tab_visited")},isInventoryTabTourFinished:function(){return e.get("product_inventory_tab_visited")},isShippingTabTourFinished:function(){return e.get("product_shipping_tab_visited")},isProductLinkTabTourFinished:function(){return e.get("product_link_tab_visited")},isAfterPurchaseTabTourFinished:function(){return e.get("product_after_purchase_tab_visited")},setOrdersTabTourAsFinished:function(){e.set("product_orders_tab_visited",!0)},setInventoryTabTourAsFinished:function(){e.set("product_inventory_tab_visited",!0)},setShippingTabTourAsFinished:function(){e.set("product_shipping_tab_visited",!0)},setProductLinkTabTourAsFinished:function(){e.set("product_link_tab_visited",!0)},setAfterPurchaseTabTourAsFinished:function(){e.set("product_after_purchase_tab_visited",!0)},options:{showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!1,exitOnEsc:!1,tooltipClass:"product-intro",highlightClass:"product-intro-highlight",nextLabel:"Next",prevLabel:"Back",skipLabel:"Close",doneLabel:"Got it"},calculateIntroElementPosition:o,ordersTabSteps:[{element:"#navOrders",intro:'<div class="introjs-title">Orders tab</div><div class="introjs-body">Track and manage all orders.</div>',position:"bottom"}],setupPostPurchaseTabSteps:function(){return[{element:"#navPostPurchase",intro:'<div class="introjs-title">After Purchase tab</div><div class="introjs-body">Optimize your customers\' after purchase experience with a delightful success message and more.</div>',position:o("navPostPurchase")}]},setupInventoryTabSteps:function(){return[{element:"#variantName",intro:'<div class="introjs-title">Inventory overview</div><div class="introjs-body">Update product price, quantity in stock, and more</div>',position:o("variantName")}]},setupShippingTabSteps:function(){return[{element:"#shippingFields",intro:'<div class="introjs-title">Delivery fields</div><div class="introjs-body">Enable delivery address for delivery and let customers leave a note on their orders.</div>',position:o("shippingFields")},{element:"#addShippingFee",intro:'<div class="introjs-title">Delivery fees</div><div class="introjs-body">Add delivery fees based on delivery locations</div>',position:o("addShippingFee")}]},setupProductLinkTabSteps:function(){var e=o("shareableLink");return[{element:"#descriptionButton",intro:'<div class="introjs-title">Product description</div><div class="introjs-body">Write a compelling description for your product</div>',position:o("descriptionButton")},{element:"#shareableLink",intro:'<div class="introjs-title">Shareable link</div><div class="introjs-body">Customize your Product Link to something memorable.</div>',position:e},{element:"#media",intro:'<div class="introjs-title">Media</div><div class="introjs-body">Personalize your Product Link with a background colour, photos and videos</div>',position:o("descriptionButton")}]}}}]),ProductModule.factory("ProductListFilters",["ProductUtils",function(c){return{removeFilter:function(e,t){return"true"===e.active&&(e.active=void 0),e.quantity&&(e.unlimited=void 0),"quantity"!==t.original&&"false"!==t.unlimited||(e.unlimited=void 0),"from"===t.original&&(e.from=void 0,e.to=void 0),e[t.original]=void 0,e},filterProducts:function(e){return"true"===e.active&&(e.active=void 0),"false"===e.unlimited?e.unlimited=void 0:"true"===e.unlimited?(e.quantity=void 0,e.quantity_condition=void 0,e.quantity_amount=void 0):""===e.unlimited&&(e.quantity_condition=void 0,e.quantity_amount=void 0),""===e.quantity_display&&(e.quantity_sold_condition=void 0,e.quantity_sold_amount=void 0,e.quantity_sold=void 0),(e.quantity_condition||e.quantity_amount)&&(e.quantity_amount||(e.quantity_amount=1),e.quantity='{"'.concat(e.quantity_condition,'":').concat(e.quantity_amount,"}"),e.quantity_condition=void 0,e.quantity_amount=void 0),(e.quantity_sold_condition||e.quantity_sold_amount)&&(e.quantity_sold_amount||(e.quantity_sold_amount=1),e.quantity_sold='{"'.concat(e.quantity_sold_condition,'":').concat(e.quantity_sold_amount,"}"),e.quantity_sold_condition=void 0,e.quantity_sold_amount=void 0),""===e.price_display&&(e.price_condition=void 0,e.price_amount=void 0,e.price=void 0,e.currency=void 0),(e.price_condition||e.price_amount)&&(e.price_amount&&(e.price='{"'.concat(e.price_condition,'":').concat(e.price_amount,"}"),e.price_condition=void 0),e.price_amount=void 0),e.page=1,e},populateFilters:function(e,t){return t.quantity&&(e.quantity_condition=t.quantity.includes("lt")?"lt":"gt",e.quantity_amount=t.quantity.replace(/[^0-9]/g,""),e.unlimited="false"),t.quantity_sold&&(e.quantity_display="enter",t.quantity_sold.includes("lt")?e.quantity_sold_condition="lt":t.quantity_sold.includes("gt")?e.quantity_sold_condition="gt":t.quantity_sold.includes("eq")&&(e.quantity_sold_condition="eq"),e.quantity_sold_amount=t.quantity_sold.replace(/[^0-9]/g,"")),(t.price||t.currency)&&(e.price_display="enter",t.price&&(t.price.includes("lt")?e.price_condition="lt":t.price.includes("gt")?e.price_condition="gt":t.price.includes("eq")&&(e.price_condition="eq"),e.price_amount=t.price.replace(/[^0-9]/g,""))),{query:e,$stateParams:t}},generateProductFilters:function(e,t){var n=_.map(e,function(e){return"object"===_typeof(e)?e.key:e}),r=_.pick(t,n),s=_.pick(r,_.identity);return"true"===s.unlimited&&s.quantity&&delete s.quantity,Object.keys(s).map(function(e){var t="";if(t=s[e].includes("lt")?"<":s[e].includes("gt")?">":s[e].includes("eq")?"=":":","quantity"===e)return{key:"Stock",original:"quantity",condition:t,value:s[e].replace(/[^0-9]/g,"")};if("quantity_sold"===e)return{key:"Quantity Sold",original:"quantity_sold",condition:t,value:s[e].replace(/[^0-9]/g,"")};if("unlimited"===e)return{key:"Stock",original:"unlimited",condition:t,value:"Unlimited"};if("price"===e)return{key:"Price",original:"price",condition:t,value:s[e].replace(/[^0-9]/g,"")};if("currency"===e)return{key:"Currency",original:"currency",condition:t,value:s[e]};if("from"===e){var n=c.formatTagDate(s.from),r="From ".concat(n),o="",a="";return s.to&&(r=n,o="-",a=c.formatTagDate(s.to)),{key:r,original:"from",condition:o,value:a}}if("to"!==e)return"active"===e?{key:"Archived",original:"active",condititon:"",value:""}:void 0;if(!s.from){var i=c.formatTagDate(s.to);return{key:"",original:"from",condition:"",value:"Until ".concat(i)}}}).filter(Boolean)}}}]),ProductModule.factory("MediaUploadService",["API","ProductConstants","DigitalProductConstants","utils","Notification","validateService",function(n,r,o,a,i,t){var s=a.pipe,c=function(e){return t.process(e,{formats:r.AVAILABLE_FORMATS}).is_valid},u=function(e){return t.process(e,{formats:o.AVAILABLE_FORMATS,maxSize:o.MAX_FILE_SIZE_KB}).is_valid},l=function(e,t){var n="digital"===t?e.filter(function(e){return e.size<=o.MAX_FILE_SIZE_BYTES}):e.filter(function(e){return e.size<=r.MAX_FILE_SIZE});return n.length!==e.length&&i.error("Could not upload file","One or more files are too large. Allowed maximum file size is 20 MB"),n},d=function(e){return n.all("upload_url").post({upload_filename:e.name||"image-".concat(uuidv4()),upload_path:"/products"}).then(function(e){return e.data})},p=function(e){return e.files&&e.files.length?e.files:[]},f=function(e){var t=e.fileList,n=e.maxFileUploadCount;return t.length>n&&(t=t.slice(0,n),i.error("Could not upload all files","You can only add ".concat(n," media files"))),t},m=function(e,t,n){if(n.length+e.length>t){var r=Math.max(0,t-n.length);e=e.slice(0,r),i.error("Could not upload all files","You can only add ".concat(t," media files"))}return e};return{validateFileTypes:c,validateFileSizes:l,getValidFiles:function(e,t){var n=Array.from(e);return("digital"===t?u(n):c(n))?l(n,t):i.error("Could not upload file","One or more file types are not valid")},validateDigitalFileTypes:u,uploadFile:d,getSignedUrls:function(e){return Promise.all(e.map(function(e){return d(e)}))},getProductFiles:p,removeFilesAboveTotalLimit:f,removeFilesAboveCurrentLimit:m,removeUnnecessaryFiles:function(e,t,n){var r=n.maxFileUploadCount,o="digital"===n.productFileType?t.digital_assets||[]:p(t);return s(f,function(e){return m(e,r,o)})({fileList:e,maxFileUploadCount:r,files:o})},getDigitalProductSignedFileUrls:function(e){return Promise.all(e.map(function(e){return t=e,n.all("product/digital/upload_url").post({upload_filename:t.name||"image-".concat(a.uuid())}).then(function(e){return e.data});var t}))}}}]),ProductModule.factory("ProductOrdersService",["utils",function(r){return{getRefundAmount:function(e,t,n){return r.currencySubUnitToBaseUnit(e+t-n)},parseLogsDelta:function(e){var t=e.data,n=void 0===t?[]:t;return n.length?n.map(function(e){if(e.delta){var t=JSON.parse(e.delta);e.delta=t}return e}):[]},removeSameTimeLogs:function(a){return a.filter(function(e,t){if(e.action&&"refunded_an_order"===e.action){var n=a.slice(t+1).find(function(e){return"order_has_been_refunded"===e.action||"order_has_been_partially_refunded"===e.action});if(!n)return e;var r=moment(e.performed_at),o=moment(n.performed_at);return 0<r.diff(o)}return e})}}}]),ProductModule.factory("ProductOrdersFilters",["ProductUtils",function(s){function t(e){e.refunded=void 0,e.status=void 0,e.delivered=void 0,e.is_viewed=void 0}return{getProductIds:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return e.id})},getProductIdsFromFilters:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return"product"===e.original.toLowerCase()}).map(function(e){return e.id})},filterOrders:function(e){return e.status&&("false"===e.status?(t(e),e.delivered=!1):"refunded"===e.status?(t(e),e.refunded=!0):"new"===e.status?(t(e),e.is_viewed=!1):"false"===e.status&&"refunded"===e.status&&"new"===e.status||(e.refunded=void 0,e.delivered=void 0,e.is_viewed=void 0)),e.page=void 0,e.current=void 0,e.index=void 0,e},generateProductFilters:function(e){return e.products?(Array.isArray(e.products)||(e.products=[e.products]),e.products.map(function(e){return{key:"Product",original:"product",condition:"",value:e,id:Number(e)}})):[]},generateOrdersFilters:function(e,t){var n=_.map(e,function(e){return"object"===_typeof(e)?e.key:e}),r=_.pick(t,n),i=_.pick(r,_.identity);return Object.keys(i).map(function(e){if("status"!==e||"false"!==i[e]){if("region"===e)return{key:"Region",original:"region",condition:":",value:i[e]};if("status"===e)return{key:"Status",original:"status",condition:":",value:"paid"===i[e]?"Pending":s.capitalize(i[e])};if("New"===e)return{key:"Status",original:"new",condition:":",value:"New"};if("delivered"===e)return{key:"Status",original:"delivered",condition:":",value:"Pending"};if("refunded"===e)return{key:"Status",original:"refunded",condition:":",value:"Refunded"};if("delivered_at"===e)return{key:"Delivered at",original:"delivered_at",condition:":",value:i[e]};if("from"===e){var t=s.formatTagDate(i.from),n="From ".concat(t),r="",o="";return i.to&&(n=t,r="-",o=s.formatTagDate(i.to)),{key:n,original:"from",condition:r,value:o}}if("to"===e){if(i.from)return;var a=s.formatTagDate(i.to);return{key:"",original:"from",condition:"",value:"Until ".concat(a)}}}}).filter(Boolean)},generateSearchedProductFilters:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return e.products&&e.products.length?t.map(function(e){return{key:e.name,original:"product",condition:"",value:"",id:e.item}}):[]},removeFilterTag:function(e,t){var n,r;return"delivered"!==e.original&&"refunded"!==e.original&&"status"!==e.original&&"is_viewed"!==e.original||(t.status=void 0,t.delivered=void 0,t.refunded=void 0,t.is_viewed=void 0),"from"===e.original&&(t.from=void 0,t.to=void 0),"product"===e.original&&(t.products=(n=e.id.toString(),r=t.products,Array.isArray(r)?r.filter(function(e){return n!==e}):void 0)),t[e.original]=void 0,t},filterOrderIdsByProducts:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.length?e.map(function(e){return e.id}):[]},replaceProductFilterNames:function(e,t){var n=e.data,r=n.id,o=n.name,a=t.findIndex(function(e){return e.id===r});return t[a].key=o,t[a].value="",t}}}]),ProductModule.factory("ProductUtils",["LocalService",function(e){return{checkColor:function(e){e=e.substring(1);var t=parseInt(e,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)<150?"#ffffff":"#57584E"},isAnyFileUploadedBefore:function(){return e.get("firstFileUploaded")},capitalize:function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},getMediaType:function(e){return e.includes("image")?"image":"video"},isFilesChanged:function(e,t){var n=angular.copy(e.files),r=angular.copy(t.files);return JSON.stringify(n)!==JSON.stringify(r)},formatTagDate:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"MMMM D, YYYY";return moment(e).format(t)},getSubaccountByProduct:function(e,t){return e.find(function(e){return e.subaccount_code===t.split_code})},bytesToSize:function(e){var t=Math.floor(Math.log(e)/Math.log(1024)),n=1*(e/Math.pow(1024,t)).toFixed(2),r=["B","KB","MB","GB","TB"][t];return"".concat(n," ").concat(r)}}}]),ProductModule.factory("VariantUtils",["utils",function(r){return{skipVariantUpdateErrorMessage:function(e){var t=Object.keys(e)[0];return 0===Number(e[t])&&["stock_threshold","maximum_orderable"].includes(t)},formatVariants:function(e){return e.map(function(e){return _objectSpread(_objectSpread({},e),{},{priceToShow:r.currencySubUnitToBaseUnit(e.price)})})},toggleSelectAllVariants:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return e.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:t})})},formatUpdateParams:function(e){var t=Object.keys(e)[0];if(e.price){var n=r.currencyBaseUnitToSubUnit(e.price);return _objectSpread(_objectSpread({},e),{},{price:n})}return["stock_threshold","maximum_orderable"].includes(t)&&0===Number(e[t])?_objectSpread(_objectSpread({},e),{},_defineProperty({},t,null)):e},formatBulkUpdateParams:function(e){var t=e.field;return"price"===t?{price:r.currencyBaseUnitToSubUnit(e.value)}:"active"===t?{active:"enabled"===e.statusValue}:"quantity"===t?"unlimited"===e.unlimitedValue?{unlimited:!0}:{unlimited:!1,quantity:e.value||e.quantityValue}:["stock_threshold","minimum_orderable","maximum_orderable"].includes(t)&&0===Number(e.value)?_defineProperty({},t,"minimum_orderable"===t?0:null):_defineProperty({},t,e.value)},checkIfUpdateNeedsRefetch:function(e){var t=Object.keys(e)[0];return void 0!==e[t]&&(0===Number(e[t])||null===e[t])},checkValueValidity:function(t){var n=Object.keys(t);return["price","quantity"].every(function(e){return!(n.includes(e)&&!t[e])})},updateTableFields:function(e,t,n){return e.map(function(e){return t.includes(e.id)?_objectSpread(_objectSpread({},e),n):e})}}}]),ProductModule.filter("trustUrl",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]).filter("truncateText",[function(){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:60;return e?e.length>=t?"".concat(e.substring(0,t),"..."):e:""}}]).filter("generateThumbnail",[function(){return function(e){var t=e.lastIndexOf("."),n=e.split(".").pop();return(e.substr(0,t<0?e.length:t)+"."+n).replace("upload/","upload/w_250/")}}]).filter("generateThumbnailForList",[function(){return function(e){var t=e.lastIndexOf("."),n=e.split(".").pop().toLowerCase(),r=["png","jpg","jpeg"].includes(n)?".".concat(n):".jpeg";return(e.substr(0,t<0?e.length:t)+r).replace("upload/","upload/w_250/")}}]).filter("generateThumbnailForCarousel",[function(){return function(e){var t=e.lastIndexOf("."),n=e.split(".").pop();return(e.substr(0,t<0?e.length:t)+"."+n).replace("upload/","upload/if_iw_gt_1000,w_1000/if_else,w_iw/")}}]),ProductModule.directive("digitalFileUpload",["Notification","$state","$rootScope","ProductIntroService","$timeout","ProductFactory","ngDialog","MediaUploadService","AmplitudeService","Upload","$sanitize","DigitalProductConstants",function(r,t,o,e,c,a,n,u,i,l,d,p){return{restrict:"AE",replace:!0,scope:{required:"@?",product:"="},template:'\n      <div class="digital-product-upload">\n        <form name="productForm" class="form-validation">\n          <div\n            class="m-l-lg digital-product-upload__wrapper"\n            ng-disabled="fileUploadState !== \'pending\'"\n            ng-click="handleClickUpload()"\n            ngf-drop="upload($files)"\n            ngf-select="upload($files)"\n            ngf-multiple="true"\n            accept="{{acceptableFileTypes}}"\n            ngf-pattern="DigitalProductConstants.AVAILABLE_FORMATS"\n            ng-model="digitalFilesToUpload"\n            ngf-max-files="{{DigitalProductConstants.MAX_FILE_UPLOAD_COUNT}}"\n            ngf-stop-propagation="true"\n          >\n            <div class="c-media-uploader c-media-uploader--image">\n              <div class="c-media-uploader__body">\n                <div class="c-media-uploader__trigger">\n                  <button class="button button&#45;&#45;primary m-t-xs" ng-disabled="fileUploadState !== \'pending\'">\n                    <div class="flex" ng-hide="fileUploadState === \'pending\'">\n                      <div class="digital-upload-button-spinner"></div>\n                      {{ \'digitalProducts.uploading\' | i18next }}\n                    </div>\n                    <span ng-show="fileUploadState === \'pending\'">{{ \'digitalProducts.addFiles\' | i18next }}</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="form-group m-b-none clear" sv-root sv-part="productCopy.digital_assets">\n            <div sv-placeholder>\n              <div class="row sort-placeholder"></div>\n            </div>\n            <div id="sortableFileList">\n              <digital-file \n                index="$index" \n                sv-element="{containment: \'#sortableFileList\'}" ng-repeat="file in productCopy.digital_assets" \n                sortable="productCopy.digital_assets.length > 1"\n                file="file"\n                product="product">\n              </digital-file>\n            </div>\n          </div>\n          <digital-file-uploading\n            index="$index" \n            ng-repeat="digitalFile in digitalFilesToUpload" \n            file="digitalFile">\n          </digital-file-uploading>\n        </form>\n      </div>\n    ',link:function(i){i.productCopy=angular.copy(i.product),i.acceptableFileTypes=p.AVAILABLE_FORMATS.toString(),i.uploadedDigitalFiles=[],i.digitalFilesToUpload=null,i.fileUploadState="pending",o.$on("digitalFileUploading",function(e,t){i.fileUploadState=t?"uploading":"pending"}),i.clearUploadedDigitalFiles=function(){i.uploadedDigitalFiles=[]},i.cancelUpload=function(e){e.upload.abort()};var s=function(){i.uploadedDigitalFiles.length===i.digitalFilesToUpload.length&&e()},n=function(e,t){e.forEach(function(o,e){var a=t[e];o.upload=l.http({url:a.signed_url,method:"PUT",headers:{"Content-Type":o.type},data:o}),o.upload.then(function(e){return c(function(){o.result=e.data,o.status=e.status}),e},function(e){if(0<e.status){var t="".concat(e.status,": ").concat(e.data);r.error(t)}},function(e){o.progress=Math.min(100,parseInt(100*e.loaded/e.total))}).then(function(e){if(!e)return i.digitalFilesToUpload=i.digitalFilesToUpload.filter(function(e){return e!==o}),s();var t,n,r;n=(t=a).original_filename,r=t.path,i.uploadedDigitalFiles.push({file_url:r,original_name:d(n)}),s()}).catch(function(e){r.error(e)})})};i.upload=function(e){i.clearUploadedDigitalFiles();var t=u.getValidFiles(e,"digital");t.length&&(i.digitalFilesToUpload=u.removeUnnecessaryFiles(t,i.productCopy,{maxFileUploadCount:p.MAX_FILE_UPLOAD_COUNT,fileType:"digital"}),i.fileUploadState="processing",o.$broadcast("digitalFileUploading",!0),u.getDigitalProductSignedFileUrls(i.digitalFilesToUpload).then(function(e){n(i.digitalFilesToUpload,e)}))};var e=function(){a.addProductDigitalFiles(i.productCopy.id,{digital_assets:i.uploadedDigitalFiles}).then(function(e){i.digitalFilesToUpload=[],i.productCopy.digital_assets=i.productCopy.digital_assets.concat(e.data),o.$broadcast("productDigitalFilesUpdated",i.productCopy.digital_assets),o.$broadcast("digitalFileUploading",!1),i.fileUploadState="pending",t.reload()})}}}}]),angular.module("app.settings").controller("ComplianceCtrl",["$scope","Session","$rootScope","AddressService","AmplitudeService","ComplianceProfile","ComplianceContact","ComplianceAccount","RegistrationDocuments","Notification","GoogleMapsService","BankService","ComplianceStatus","$state",function(d,e,t,n,r,o,a,i,s,c,p,u,l,f){r.logEvent;var m=n.stringifyAddress;d.account=e.get("account"),d.attributes=d.account.attributes;var g=t.Business.default_currency,h=[l.getComplianceStatus(),o.fetchSavedBusinessProfile()],y=[a.fetchContact(),i.fetchPayoutAccount(),s.fetchOwners(),u.init({currency:g})],b=[s.fetchDirectors(),s.fetchDocuments()],v="app.compliance.profile";Promise.all(h).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1],o=n&&n.modules.find(function(e){return"PROFILE"===e.code});if(o&&o.completed){var a=(d.profileData=r)&&"registered"===r.businessType;Promise.all([].concat(y,_toConsumableArray(a?b:[]))).then(function(e){var t=_slicedToArray(e,6),n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5];d.contactData=n;var c=r.data;d.payoutAccount=c,d.owners=o,d.directors=i||[];var u=(s||{}).data;d.submittedDocuments=u&&u.filter(function(e){return!!e.submitted}),d.payoutBank=a.find(function(e){return e.code===c.bankCode});var l=m(n.address.main);p.init().then(function(){p.geocodeAddress(l)}).catch(function(){}),d.$watch("i18nextReady",function(e){e&&d.$broadcast("compliancePageReady")})}).catch(function(e){c.error("Could not fetch KYC documents",e)})}else f.go(v)}).catch(function(e){c.error("Could not fetch business status",e),f.go(v)}),d.extractNamesFromPeople=function(e){return e&&e.length&&Array.isArray(e)?e.map(function(e){var t=e.firstName,n=e.lastName;return"".concat(t," ").concat(n)}).reduce(function(e,t,n,r){return e+(n<r.length-1?", ":" and ")+t}):"-"}}]),angular.module("app.settings").factory("Addresses",["API",function(n){var r,o={};return{fetchCountries:function(){return r?Promise.resolve(r):n.one("address/country").get().then(function(e){return r=e.data,e.data})},fetchStates:function(t){if(o[t])return Promise.resolve(o[t]);if(!r)return Promise.reject();var e=(r.find(function(e){return e.iso2===t||e.name===t})||{}).id;return e?n.one("address/country/".concat(e,"/state")).get().then(function(e){return o[t]=_toConsumableArray(new Set(e.data.sort(function(e,t){return e.name.localeCompare(t.name)}))),o[t]}):Promise.reject()}}}]),StorefrontsModule.constant("StorefrontConstants",{DEFAULT_FG_COLOR:"#c1c1c1",DEFAULT_BG_COLOR:"#f5f5f5",MAX_DESCRIPTION_CHARACTERS:8e3,DESCRIPTION_CHARACTERS_WARNING_AT:8e3}),StorefrontsModule.controller("StorefrontsContactsController",["$state","$scope","StorefrontFactory","Notification",function(t,a,n,r){var o,e,i=a.contactTypes.reduce(function(e,t){return e[t.name.toLowerCase()]=_objectSpread({},t),e},{}),s=function(t){var e=a.storefront.contacts.find(function(e){return e.type===t.id});if(!e||!e.value)return{countryCode:null,phone:null,value:null,type:t.id,id:null};var n=libphonenumber.parsePhoneNumber(e.value),r=n.countryCallingCode,o=n.nationalNumber;return{countryCode:"+".concat(r),phone:o,value:r+o,type:t.id,id:e.id}};a.contacts={phone:s(i.phone),whatsapp:s(i.whatsapp),email:(o=i.email,e=a.storefront.contacts.find(function(e){return e.type===o.id}),e&&e.value?{value:e.value,type:o.id,id:e.id}:{value:null,type:o.id,id:null})},a.contactsCopy=angular.copy(a.contacts),a.$watch("contacts.whatsapp.phone",function(){a.contacts.whatsapp.countryCode&&(a.contacts.whatsapp.phone?a.contacts.whatsapp.value=a.contacts.whatsapp.countryCode+a.contacts.whatsapp.phone:a.contacts.whatsapp.value=null)}),a.$watch("contacts.whatsapp.countryCode",function(){a.contacts.whatsapp.phone?a.contacts.whatsapp.value=a.contacts.whatsapp.countryCode+a.contacts.whatsapp.phone:a.contacts.whatsapp.value=null}),a.$watch("contacts.phone.phone",function(){a.contacts.phone.countryCode&&(a.contacts.phone.phone?a.contacts.phone.value=a.contacts.phone.countryCode+a.contacts.phone.phone:a.contacts.phone.value=null)}),a.$watch("contacts.phone.countryCode",function(){a.contacts.phone.phone?a.contacts.phone.value=a.contacts.phone.countryCode+a.contacts.phone.phone:a.contacts.phone.value=null});a.saveContacts=function(){var e=Object.keys(a.contacts).map(function(e){var t=a.contacts[e].type,n=a.contacts[e].id,r=a.contacts[e].value;return"phone"!==e&&"whatsapp"!==e||!r||"+"===r.charAt(0)||(r="+".concat(r)),{type:t,value:r,id:n}});Promise.all(e.map(function(e){return e.id?e.value?n.updateContact(a.storefront.id,e.id,{value:e.value}):n.deleteContact(a.storefront.id,e.id):e.id||e.value?n.createContact(a.storefront.id,{type:e.type,value:e.value}):void 0})).then(function(){a.storefrontCopy=angular.copy(a.storefront),a.editingContact=!1,a.checkContactsHasAValidValue(),a.$broadcast("savingStorefrontInfo",!0),r.success("Update successful","Storefront contact information has been updated"),t.reload()}).catch(function(e){a.$broadcast("savingStorefrontInfo",!1),r.error("Could not update storefront contact information",e)})},a.cancelContacts=function(){a.editingContact=!1,a.contacts=angular.copy(a.contactsCopy)},a.checkContactsHasAValidValue=function(){a.contactsContainsAValidValue=[a.contacts.whatsapp.phone,a.contacts.phone.phone,a.contacts.email.value].some(function(e){return e&&0<e.length})},a.checkContactsHasAValidValue(),a.clearContact=function(e,t){e.stopPropagation(),"phone"!==t&&"whatsapp"!==t||(a.contacts[t].phone=""),a.contacts[t].value="",a.saveContacts()}}]),StorefrontsModule.controller("StorefrontsLinkCtrl",["$state","$scope","StorefrontFactory","Notification","StorefrontUtils","$timeout","StorefrontConstants","StorefrontIntroService",function(n,r,o,a,i,s,e,t){var c=document.getElementById("business-description-editor");r.descriptionTextLength=c.innerText.length,r.maxDescriptionCharacters=e.MAX_DESCRIPTION_CHARACTERS,r.descriptionCharactersWarningLimit=e.DESCRIPTION_CHARACTERS_WARNING_AT,r.foregroundColor=i.updateAssetColors(r.storefront.background_color),r.hasValidDigitalProducts=r.storefront.products.some(function(e){return"digital"===e.type&&!0===e.active&&"inactive"!==e.status}),r.digitalFileExpiryActive=null!==r.storefront.digital_product_expiry,r.digitalDownloadExpiryFormValues={digitalProductExpiry:r.storefront.digital_product_expiry},r.digitalProductExpiryFormVisible=!1,r.toggleDigitalProductExpiryForm=function(){r.digitalProductExpiryFormVisible=!r.digitalProductExpiryFormVisible},r.resetDigitalProductExpiryForm=function(){r.digitalProductExpiryFormVisible=!1,r.digitalDownloadExpiryFormValues.digitalProductExpiry=r.storefront.digital_product_expiry},r.$on("colorpicker-selected",function(e,t){r.storefront.background_color=t.value,r.foregroundColor=i.updateAssetColors(r.storefront.background_color)}),r.updateDescription=function(e,t){r.storefront.description=t},r.$watch("storefront.description",function(){r.storefront&&"string"==typeof r.storefront.description&&(r.descriptionTextLength=c.innerText.length,r.availableDescChars=e.MAX_DESCRIPTION_CHARACTERS-c.innerText.length)}),r.$on("colorpicker-closed",function(e,t){t.value!==r.storefrontCopy.background_color&&(r.storefront.background_color=t.value,r.storefrontCopy.background_color=t.value,o.updateStorefront(r.storefront.id,{background_color:t.value}).then(function(){s(function(){r.foregroundColor=i.updateAssetColors(r.storefront.background_color)})}))}),r.changeBgColor=function(e){e!==r.storefrontCopy.background_color&&(r.storefront.background_color=e,r.storefrontCopy.background_color=e,s(function(){r.foregroundColor=i.updateAssetColors(r.storefront.background_color)}),o.updateStorefront(r.storefront.id,{background_color:e}))},r.toggleBgColorPalette=function(){r.showBgColor=!r.showBgColor},r.closeColorPicker=function(){r.showBgColor=!1},r.toggleStorefrontStatus=function(e){var t="active"===e.status?"inactive":"active";o.updateStorefront(e.id,{status:t}).then(function(){var e="active"===t?"Storefront is now on":"Storefront is now off";a.success("Updated successfully",e),n.reload()}).catch(function(e){a.error("Could not update storefront",e)})},r.toggleStorefrontDigitalProductExpiry=function(){r.digitalFileExpiryActive=!r.digitalFileExpiryActive,r.digitalFileExpiryActive?r.digitalDownloadExpiryFormValues.digitalProductExpiry=7:r.digitalDownloadExpiryFormValues.digitalProductExpiry=null,o.updateStorefront(r.storefront.id,{digital_product_expiry:r.digitalDownloadExpiryFormValues.digitalProductExpiry}).then(function(){r.storefront.digital_product_expiry=r.digitalDownloadExpiryFormValues.digitalProductExpiry,r.$broadcast("storefrontDigitalFileExpiryUpdated"),r.digitalProductExpiryFormVisible=!1}).catch(function(e){a.error("Could not toggle Storefront digital product expiry",e)})},r.updateStorefrontDigitalDownloadExpiry=function(){var e=r.digitalDownloadExpiryFormValues.digitalProductExpiry;o.updateStorefront(r.storefront.id,{digital_product_expiry:e}).then(function(){r.storefront.digital_product_expiry=e,a.success("Storefront digital product expiry has been updated"),r.$broadcast("storefrontDigitalFileExpiryUpdated"),r.digitalProductExpiryFormVisible=!1}).catch(function(e){a.error("Could not update Storefront digital product expiry",e)})},r.saveShareableLink=function(){o.updateStorefront(r.storefront.id,{slug:r.storefront.slug}).then(function(){r.storefrontCopy=angular.copy(r.storefront),r.editingShareableLink=!1,r.$broadcast("savingStorefrontInfo",!0),a.success("Update successful","Storefront link has been updated")}).catch(function(e){r.$broadcast("savingStorefrontInfo",!1),a.error("Could not update storefront link",e)})},r.cancelShareableLink=function(){r.editingShareableLink=!1,r.storefront=angular.copy(r.storefrontCopy)},r.saveWelcomeMessage=function(){o.updateStorefront(r.storefront.id,{welcome_message:r.storefront.welcome_message||null}).then(function(){r.storefrontCopy=angular.copy(r.storefront),r.editingWelcomeMessage=!1,r.$broadcast("savingStorefrontInfo",!0),a.success("Update successful","Storefront welcome message has been updated")}).catch(function(e){r.$broadcast("savingStorefrontInfo",!1),a.error("Could not update storefront welcome message",e)})},r.cancelWelcomeMessage=function(){r.editingWelcomeMessage=!1,r.storefront=angular.copy(r.storefrontCopy)},r.saveAboutBusinessText=function(){o.updateStorefront(r.storefront.id,{description:r.storefront.description||null}).then(function(){r.storefrontCopy=angular.copy(r.storefront),r.editingAboutBusiness=!1,r.$broadcast("savingStorefrontInfo",!0),a.success("Update successful","Storefront description has been updated")}).catch(function(e){r.$broadcast("savingStorefrontInfo",!1),a.error("Could not update storefront description",e)})},r.cancelAboutBusinessText=function(){r.editingAboutBusiness=!1,r.storefront=angular.copy(r.storefrontCopy)};t.isCustomizeStorefrontTabVisited()||s(function(){introJs().addSteps(t.customizeStorefrontTabIntroSteps).setOptions(t.introOptions).start().oncomplete(function(){t.setCustomizeStorefrontTabVisited()})},100)}]),StorefrontsModule.controller("StorefrontsListCtrl",["$state","$scope","$rootScope","ngDialog","storefronts","StorefrontFactory","StorefrontUtils","ProductFactory","Notification","StorefrontListFilters","$stateParams","DEFAULTS",function(n,o,r,t,e,a,i,s,c,u,l,d){o.storefronts=e.data,o.newStorefront={name:null,currency:r.Business.default_currency||"NGN",link:null},o.storefront=null,o.products=[],o.allProductsSelected=!1,o.baseStorefrontURL=d.baseStorefrontURL,o.baseStorefrontURLWithoutProtocol=d.baseStorefrontURL.replace("https://",""),o.query=_objectSpread(_objectSpread({},o.query),{},{total_order_quantity_display:"",total_order_condition:"gte",total_revenue_amount_display:"",total_revenue_condition:"gte"}),o.$watch("newStorefront.name",function(e){if(e){var t=e.replace(/'/g,"");o.newStorefront.link=null==t?"":t.trim().replace(/\s+/g,"-").toLowerCase()}}),o.showCreateStorefrontModal=function(){t.open({template:"/modules/storefronts/views/modals/create-storefront.html",controller:"StorefrontsPopupCtrl",scope:o,closeByDocument:!1})},o.removeFilter=function(e){var t=u.removeFilter(o.query,e);o.reloadWithParams(t)};var p=function(){t.open({template:"/modules/storefronts/views/modals/select-products.html",controller:"StorefrontsPopupCtrl",scope:o,closeByDocument:!1,width:800})};o.showSelectProductsModal=function(){if(!o.products.length)return s.listProducts().then(function(e){var t=o.storefront,n=t.currency,r=t.products.map(function(e){return e.id});o.products=i.filterSelectableProducts(e.data,n,r),p()});p()},o.deselectAllProducts=function(){o.products=o.products.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:!1})})},o.clearSearch=function(){o.searchStorefront=""},o.toggleStorefrontStatus=function(e){var t="active"===e.status?"inactive":"active";a.updateStorefront(e.id,{status:t}).then(function(){var e="active"===t?"Storefront is now on":"Storefront is now off";c.success("Updated successfully",e),n.reload()}).catch(function(e){c.error("Could not update storefront",e)})},o.duplicateStorefront=function(e){a.duplicateStorefront(e).then(function(){c.success("Duplicated successfullu","Storefront has been duplicated"),n.reload()}).catch(function(e){c.error("Could not duplicate storefront",e)})},o.showDeleteStorefrontModal=function(e){t.open({template:"/modules/storefronts/views/modals/delete-storefront.html",controller:"StorefrontsPopupCtrl",scope:o,closeByDocument:!1,data:{storefrontId:e}})},o.populateFilters=function(){var e=u.populateFilters(o.query,l).query;o.query=e},o.generateStorefrontFilters=function(e){o.populateFilters();var t=u.generateStorefrontFilters(e,l);r.$state.activeFilterValues=t},o.filterStorefronts=function(e){o.$broadcast("$locationChangeSuccess");var t=u.filterStorefronts(e);n.go(n.current,t,{reload:!0,inherit:!0,notify:!0})}}]),StorefrontsModule.controller("StorefrontsPopupCtrl",["$state","$scope","StorefrontFactory","Notification","ngDialog","$stateParams","API",function(t,r,n,o,e,a,i){r.storefrontId=a.id,r.product={unlimited:!0,description:""},r.productPaginationList=[],r.meta={perPage:50,page:1},r.closeCreateStorefrontModal=function(){r.closeThisDialog(),t.reload()},r.closeSelectProductsModal=function(){r.deselectAllProducts(),r.closeThisDialog(),t.reload()},r.createStorefront=function(){n.createStorefront({name:r.newStorefront.name,currency:r.newStorefront.currency,slug:r.newStorefront.link}).then(function(e){return r.$parent.storefront=e.data,o.success("Created successfully","Storefront has been created successfully"),n.listStorefronts()}).then(function(e){r.$parent.storefronts=e.data,r.$broadcast("storefrontCreated",!0),r.closeThisDialog(),r.showSelectProductsModal()}).catch(function(e){r.$broadcast("storefrontCreated",!1),o.error("Could not create the storefront",e)})},r.deleteStorefront=function(e){n.deleteStorefront(e).then(function(){r.closeThisDialog(),r.$broadcast("deletedStorefront",!0),o.success("Deleted successfully","Storefront has been deleted"),"storefronts.list"===t.current.name?t.reload():t.go("storefronts.list")}).catch(function(e){r.$broadcast("deletedStorefront",!1),o.error("Could not remove storefront",e)})},r.getCountOfSelectedProducts=function(){return r.productPaginationList.filter(function(e){return e.selected}).length},r.getAllSelectedProductIds=function(){return r.productPaginationList.filter(function(e){return e.selected}).map(function(e){return e.id})},r.addProductsToStorefront=function(){var e=r.getAllSelectedProductIds();n.addProductsToStorefront(r.storefront.id,{products:e}).then(function(){r.deselectAllProducts(),r.closeThisDialog(),"storefronts.list"===t.current.name?t.go("storefronts.one.products",{id:r.storefront.id}):(o.success("Product added","Product has been added to this storefront"),t.reload())}).catch(function(e){o.error("Could not add product",e)})},r.removeProductFromStorefront=function(e){n.updateStorefrontProduct(r.storefront.id,e,{status:"delete"}).then(function(){r.closeThisDialog(),r.$broadcast("removedProduct",!0),o.success("Product removed","Product has been removed from this Storefront"),t.reload()}).catch(function(e){r.$broadcast("removedProduct",!1),o.error("Could not remove product",e)})},r.handleDeselectAllProducts=function(){r.deselectAllProducts()},r.deleteShippingFee=function(e){n.deleteShippingFee(r.storefront.id,e).then(function(){r.closeThisDialog(),r.$broadcast("deletedShippingFee",!0),o.success("Delivery fee removed","Delivery fee has been removed from this Storefront"),t.reload()}).catch(function(e){r.$broadcast("deletedShippingFee",!1),o.error("Could not remove shipping fee",e)})},r.toggleSelectAllProducts=function(e){r.allProductsSelected=e.target.checked,r.productPaginationList=r.productPaginationList.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:r.allProductsSelected})})},r.showNewProductModal=function(){r.closeThisDialog(),e.open({template:"/modules/storefronts/views/modals/create-product.html",controller:"CreateProductCtrl",scope:r.$parent,closeByDocument:!1,data:{storefront:r.storefront}})};var s=function(e){return e.storefront=r.storefrontId,i.one("product").withHttpConfig({ignoreLoadingBar:!1}).get(e).then(function(e){return e}).catch(function(e){o.error("Could not fetch products",e)})};r.fetchMorePaginatedProducts=function(){if(r.isLoadingProductList=!0,r.meta.page<=r.meta.pageCount)return s(_objectSpread(_objectSpread({},r.meta),{},{page:r.meta.page})).then(c)};var c=function(e){var t=e.data,n=e.meta;r.productPaginationList=[].concat(_toConsumableArray(r.productPaginationList),_toConsumableArray(t)),r.meta=n,r.meta.page=r.meta.page+1,r.isLoadingProductList=!1};s(r.meta).then(c)}]),StorefrontsModule.controller("StorefrontsPostPurchaseCtrl",["$state","$scope","StorefrontFactory","Notification","$timeout","StorefrontIntroService",function(t,n,r,o,e,a){n.editingPostPurchaseForm=!1,n.totalActiveDigitalFiles=n.storefront.products.reduce(function(e,t){return e+("active"===t.status&&t.digital_assets&&t.digital_assets.length||0)},0);var i=function(){n.storefront=angular.copy(n.storefrontCopy),n.editPostPurchaseInfoForm.$setPristine()};n.toggleEditingPostPurchaseForm=function(){n.editingPostPurchaseForm=!n.editingPostPurchaseForm,i()},n.savePostPurchaseInfo=function(){var e={redirect_url:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return e&&(/^https?:\/\//i.test(e)?e.startsWith("http://")&&(e=e.replace("http://","https://")):e="https://".concat(e)),e}(n.storefront.redirect_url)||null,success_message:n.storefront.success_message||null};n.storefrontCopy=angular.copy(n.storefront),r.updateStorefront(n.storefront.id,e).then(function(){n.toggleEditingPostPurchaseForm(),o.success("Updated successfully","After purchase info has been saved"),t.reload()}).catch(function(e){o.error("Could not update after purchase info",e)})};a.isPostPurchaseTabVisited()||e(function(){introJs().addSteps(a.postPurchaseTabIntroSteps).setOptions(a.introOptions).start().oncomplete(function(){a.setPostPurchaseTabVisited()})},100)}]);_excluded=["page"];function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}StorefrontsModule.controller("StorefrontsProductsCtrl",["$state","$scope","ngDialog","LocalService","StorefrontUtils","ProductFactory","StorefrontFactory","Notification","$timeout","StorefrontIntroService","API","products","$stateParams",function(o,a,n,t,i,e,s,c,u,r,l,d,p){a.meta=d.meta,a.products=[],a.storefrontProducts=d.data,a.search=p.search||"",a.listDisplayStyle=t.get("storefrontProductListDisplayStyle")||"grid";var f=function(){n.open({template:"/modules/storefronts/views/modals/select-products.html",controller:"StorefrontsPopupCtrl",scope:a,closeByDocument:!1,width:800})};a.$watch("search",function(e,t){if(e!==t){p.page;var n=_objectWithoutProperties(p,_excluded);o.go("storefronts.one.products",_objectSpread(_objectSpread({},n),{},{search:e}),{reload:!0,inherit:!1})}}),a.clearSearch=function(){a.search=""},a.showSelectProductsModal=function(){if(!a.products.length)return e.listProducts().then(function(e){var t=a.storefront,n=t.currency,r=t.products.map(function(e){return e.id});a.products=i.filterSelectableProducts(e.data,n,r),f()});f()},a.reorderList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"list";a.listDisplayStyle=e,t.set("storefrontProductListDisplayStyle",e)},a.deselectAllProducts=function(){a.products=a.products.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:!1})})},a.toggleProductStatus=function(e){var t=a.storefront.id,n=e.id,r="inactive"===e.status?"active":"inactive";s.updateStorefrontProduct(t,n,{status:r}).then(function(){var e="active"===r?"Product is visible":"Product is hidden";c.success("Updated successfully",e),o.reload()}).catch(function(e){c.error("Could not update product",e)})},a.showRemoveProductModal=function(e,t){n.open({template:"/modules/storefronts/views/modals/remove-product-from-storefront.html",controller:"StorefrontsPopupCtrl",scope:a,closeByDocument:!1,data:{productId:e,productName:t}})},a.updateProductRank=function(t,e,n,r){u(function(){var e=r+1;n+1!==e&&s.updateStorefrontProduct(a.storefront.id,t.id,{rank:e})})};r.isProductsTabVisited()||u(function(){introJs().addSteps(r.productsTabIntroSteps).setOptions(r.introOptions).start().oncomplete(function(){r.setProductsTabVisited()})},100)}]),StorefrontsModule.controller("StorefrontsShippingCtrl",["$state","$scope","StorefrontFactory","Notification","$timeout","utils","ngDialog","StorefrontIntroService",function(t,n,r,o,a,e,i,s){var c=e.currencyBaseUnitToSubUnit,u=e.currencySubUnitToBaseUnit;n.shippable=n.storefront.shippable,n.deliveryNote=n.storefront.delivery_note||"optional",n.addingRegion=!1,n.editingRegion=!1,n.regionToAdd={fee:null,name:""};var l=function(){n.regionToAdd={fee:null,name:""}};n.updateDeliveryAddress=function(){r.updateStorefront(n.storefront.id,{shippable:n.shippable}).then(function(){o.success("Update successful","Delivery information saved"),t.reload()}).catch(function(e){o.error("Could not update storefront",e)})},n.updateDeliveryNote=function(){r.updateStorefront(n.storefront.id,{delivery_note:n.deliveryNote}).then(function(){o.success("Update successful","Delivery information saved"),t.reload()}).catch(function(e){o.error("Could not update storefront",e)})},n.cancelAddRegion=function(){n.editingRegion=!1,n.addingRegion=!1,l()},n.addRegion=function(){a(function(){l(),n.editingRegion=!1,n.addingRegion=!0})},n.editRegion=function(e,t){n.regionToAdd={fee:u(e.fee),name:e.name,id:e.id},n.addingRegion=!1,n.editingRegion=t,a(function(){var e=document.querySelectorAll(".js-region");e.length&&(e[t].focus(),e[t].select())})},n.saveShippingFee=function(){var e=c(Number(n.regionToAdd.fee));r.createShippingFee(n.storefront.id,{fee:e,name:n.regionToAdd.name}).then(function(){n.$broadcast("savingShippingFee",!0),o.success("Update successful","Delivery information saved"),n.cancelAddRegion(),t.reload()}).catch(function(e){n.$broadcast("savingShippingFee",!1),o.error("Could not add shipping fee",e)})},n.updateShippingFee=function(){r.updateShippingFee(n.storefront.id,n.regionToAdd.id,{name:n.regionToAdd.name,fee:c(n.regionToAdd.fee)}).then(function(){n.$broadcast("savingShippingFee",!0),o.success("Update successful","Delivery information updated"),n.cancelAddRegion(),t.reload()}).catch(function(e){n.$broadcast("savingShippingFee",!1),o.error("Could not add shipping fee",e)})},n.showDeleteShippingFeeModal=function(e){i.open({template:"/modules/storefronts/views/modals/delete-shipping-region.html",controller:"StorefrontsPopupCtrl",scope:n,closeByDocument:!1,data:{shippingFeeId:e}})};s.isDeliveryTabVisited()||a(function(){introJs().addSteps(s.deliveryTabIntroSteps).setOptions(s.introOptions).start().oncomplete(function(){s.setDeliveryTabVisited()})},100)}]),StorefrontsModule.controller("SingleStorefrontCtrl",["$state","$scope","$rootScope","storefront","contactTypes","socialMediaTypes","ProductConstants","$timeout","StorefrontFactory","Notification","ngDialog","clipboard","DEFAULTS",function(e,r,t,n,o,a,i,s,c,u,l,d,p){r.storefront=n.data,r.storefrontCopy=angular.copy(r.storefront),r.contactTypes=o.data,r.socialMediaTypes=a.data,r.storefrontURL="".concat(p.baseStorefrontURL,"/").concat(r.storefront.slug),r.baseStorefrontURLWithoutProtocol=p.baseStorefrontURL.replace("https://",""),r.shippable=r.storefront.shippable,r.hasShippingFees=r.storefront.shipping_fees&&0<r.storefront.shipping_fees.length,r.canBePublished=!r.shippable||r.hasShippingFees;r.clearFilter=function(){e.go(e.current,{reload:!0,inherit:!1})},r.$watch("storefront.name",function(){r.storefront.name||(r.storefront.name=""),r.storefront&&(r.storefront.name||""===r.storefront.name)&&(r.availableStorefrontNameChars=i.MAX_PRODUCT_NAME_CHARACTERS-r.storefront.name.length,r.storefront.name.length>i.MAX_PRODUCT_NAME_CHARACTERS?r.editStorefrontNameForm.storefrontName.$setValidity("storefrontName",!1):r.editStorefrontNameForm.storefrontName.$setValidity("storefrontName",!0))}),r.editStorefrontName=function(){var e,t,n;r.editingStorefrontName=!0,r.availableStorefrontNameChars=i.MAX_PRODUCT_NAME_CHARACTERS-r.storefrontCopy.name.length,e=document.getElementById("storefrontName"),t=document.getElementById("storefrontTitle"),n=300<t.clientWidth?t.clientWidth-50:300,s(function(){e.style.width=n+"px",e.focus(),e.select()})},r.cancelStorefrontName=function(){r.storefront.name=angular.copy(r.storefrontCopy.name),r.editingStorefrontName=!1,r.clearFilter()},r.saveStorefrontName=function(){c.updateStorefront(r.storefront.id,{name:r.storefront.name}).then(function(){r.storefrontCopy.name=angular.copy(r.storefront.name),r.editingStorefrontName=!1,r.$broadcast("savingStorefrontName",!0),u.success("Update successful","Storefront name updated")}).catch(function(e){r.$broadcast("savingStorefrontName",!1),u.error("Could not update storefront name",e)})},r.copyLink=function(){d.copyText(r.storefrontURL),u.success("Storefront link copied to the clipboard")},r.archiveStorefront=function(){c.updateStorefront(r.storefront.id,{status:"inactive"}).then(function(){u.success("Updated successfully","Storefront is now off"),e.reload()})},r.restoreStorefront=function(){c.updateStorefront(r.storefront.id,{status:"active"}).then(function(){u.success("Updated successfully","Storefront is now on"),e.reload()})},r.showDeleteStorefrontModal=function(){l.open({template:"/modules/storefronts/views/modals/delete-storefront.html",controller:"StorefrontsPopupCtrl",scope:r,closeByDocument:!1,data:{storefrontId:r.storefront.id}})},r.showPublishStorefrontModal=function(){l.openConfirm({template:"modules/storefronts/views/modals/publish-storefront-modal.html",scope:r,closeByDocument:!1}).then(function(){c.publishStorefront(r.storefront.id).then(function(e){u.success("Published successfully","Your Storefront is now in Live Mode"),t.switchState({state:"storefronts.one",params:{id:e.data.id}})}).catch(function(e){t.$broadcast("publishSuccessful",!1),u.error("Could not publish this Storefront",e)})})}}]),StorefrontsModule.controller("StorefrontsSocialMediaController",["$state","$scope","StorefrontFactory","StorefrontUtils","Notification",function(t,a,i,s,n){a.socialMedia=a.socialMediaTypes.reduce(function(e,t){var n=a.storefront.social_media.length&&a.storefront.social_media.find(function(e){return e.type===t.id}),r=n&&n.handle||"",o=n&&n.id||null;return e[t.name.toLowerCase()]={type:t.id,name:t.name,id:o,value:r},e},{}),a.socialMediaCopy=angular.copy(a.socialMedia);a.cancelEditSocialMediaContact=function(){a.editingSocialMediaContact=!1},a.saveSocialMediaContact=function(){var e=Object.keys(a.socialMedia);Promise.all(e.map(function(e){var t,n,r=(t=a.socialMedia[e],n=a.socialMediaCopy[e],{isSocialMediaContactNew:s.isSocialMediaContactNew(t,n),isSocialMediaContactChanged:s.isSocialMediaContactChanged(t,n),isSocialMediaContactDeleted:s.isSocialMediaContactDeleted(t,n),isSocialMediaContactNotChanged:s.isSocialMediaContactNotChanged(t,n)}),o=r.isSocialMediaContactChanged;if(!r.isSocialMediaContactNotChanged)return r.isSocialMediaContactNew?i.createSocialMediaContact(a.storefront.id,{type:a.socialMedia[e].type,handle:a.socialMedia[e].value}):o?i.updateSocialMediaContact(a.storefront.id,a.socialMedia[e].id,{handle:a.socialMedia[e].value}):i.deleteSocialMediaContact(a.storefront.id,a.socialMedia[e].id)})).then(function(){a.storefrontCopy=angular.copy(a.storefront),a.editingSocialMediaContact=!1,a.checkSocialMediaContainsAValidValue(),a.$broadcast("savingStorefrontInfo",!0),n.success("Update successful","Storefront social media information has been updated"),t.reload()}).catch(function(e){a.$broadcast("savingStorefrontInfo",!1),n.error("Could not update storefront social media information",e)})},a.checkSocialMediaContainsAValidValue=function(){a.socialMediaContainsAValidValue=[a.socialMedia.facebook.value,a.socialMedia.twitter.value,a.socialMedia.instagram.value].some(function(e){return e&&0<e.length})},a.checkSocialMediaContainsAValidValue(),a.clearSocialMediaContact=function(e,t){e.stopPropagation(),a.socialMedia[t].value="",a.saveSocialMediaContact()}}]),StorefrontsModule.factory("StorefrontIntroService",["LocalService",function(e){return{introOptions:{showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!1,exitOnEsc:!1,tooltipClass:"product-intro",highlightClass:"product-intro-highlight",nextLabel:"Next",prevLabel:"Back",skipLabel:"Close",doneLabel:"Got it"},ordersTabIntroSteps:[{element:"#navOrders",intro:'<div class="introjs-title">View orders</div><div class="introjs-body">This is where you\'ll see all orders made through this Storefront.</div>',position:"bottom"}],productsTabIntroSteps:[{element:"#navProducts",intro:'<div class="introjs-title">Manage product inventory</div><div class="introjs-body">Choose which products will display on this Storefront.</div>',position:"bottom"}],customizeStorefrontTabIntroSteps:[{element:"#navCustomizeStorefront",intro:'<div class="introjs-title">Update your look</div><div class="introjs-body">Make your Storefront pop with custom brand colours, welcome message, contact details, and more.</div>',position:"bottom"}],deliveryTabIntroSteps:[{element:"#navDelivery",intro:'<div class="introjs-title">Update Delivery Settings</div><div class="introjs-body">Set your shipping fees and update delivery requirements.</div>',position:"bottom"}],postPurchaseTabIntroSteps:[{element:"#navPostPurchase",intro:'<div class="introjs-title">After Purchase</div><div class="introjs-body">Choose what happens after your customer places an order.</div>',position:"bottom"}],isOrdersTabVisited:function(){return e.get("storefront_orders_tab_visited")},isProductsTabVisited:function(){return e.get("storefront_products_tab_visited")},isCustomizeStorefrontTabVisited:function(){return e.get("storefront_customize_tab_visited")},isDeliveryTabVisited:function(){return e.get("storefront_delivery_tab_visited")},isPostPurchaseTabVisited:function(){return e.get("storefront_post_purchase_tab_visited")},setOrdersTabVisited:function(){e.set("storefront_orders_tab_visited",!0)},setProductsTabVisited:function(){e.set("storefront_products_tab_visited",!0)},setCustomizeStorefrontTabVisited:function(){e.set("storefront_customize_tab_visited",!0)},setDeliveryTabVisited:function(){e.set("storefront_delivery_tab_visited",!0)},setPostPurchaseTabVisited:function(){e.set("storefront_post_purchase_tab_visited",!0)}}}]),StorefrontsModule.factory("StorefrontListFilters",[function(){return{removeFilter:function(e,t){return"active"===e.status&&(e.status=void 0),e[t.original]=void 0,e},filterStorefronts:function(e){return"active"===e.status&&(e.status=void 0),""===e.total_order_quantity_display&&(e.total_order_condition=void 0,e.quantity_total_orders=void 0,e.orders_count=void 0),(e.total_order_condition||e.quantity_total_orders)&&(e.quantity_total_orders||(e.quantity_total_orders=1),e.orders_count='{"'.concat(e.total_order_condition,'":').concat(e.quantity_total_orders,"}"),e.total_order_condition=void 0,e.quantity_total_orders=void 0),""===e.total_revenue_amount_display&&(e.total_revenue_condition=void 0,e.amount_total_revenue=void 0,e.revenue=void 0),(e.total_revenue_condition||e.amount_total_revenue)&&(e.amount_total_revenue||(e.amount_total_revenue=1),e.revenue='{"'.concat(e.total_revenue_condition,'":').concat(e.amount_total_revenue,"}"),e.total_revenue_condition=void 0,e.amount_total_revenue=void 0),e.page=1,e},populateFilters:function(e,t){return t.orders_count&&(e.total_order_quantity_display="enter",t.orders_count.includes("lte")?e.total_order_condition="lte":t.orders_count.includes("gte")?e.total_order_condition="gte":t.orders_count.includes("eq")&&(e.total_order_condition="eq"),e.quantity_total_orders=t.orders_count.replace(/[^0-9]/g,"")),t.revenue&&(e.total_revenue_amount_display="enter",t.revenue.includes("lte")?e.total_revenue_condition="lte":t.revenue.includes("gte")?e.total_revenue_condition="gte":t.revenue.includes("eq")&&(e.total_revenue_condition="eq"),e.amount_total_revenue=t.revenue.replace(/[^0-9]/g,"")),{query:e,$stateParams:t}},generateStorefrontFilters:function(e,t){var n=e.map(function(e){return e&&"object"===_typeof(e)?e.key:e}),r=_.pick(t,n),o=_.pick(r,_.identity);return Object.keys(o).map(function(e){var t="";return t=o[e].includes("lte")?"=<":o[e].includes("gte")?">=":o[e].includes("eq")?"=":":","orders_count"===e?{key:"Orders",original:"orders_count",condition:t,value:o[e].replace(/[^0-9]/g,"")}:"revenue"===e?{key:"Revenue",original:"revenue",condition:t,value:o[e].replace(/[^0-9]/g,"")}:"status"===e?{key:"Inactive",original:"status",condititon:"",value:""}:void 0}).filter(Boolean)}}}]),StorefrontsModule.factory("StorefrontFactory",["API",function(r){return{createStorefront:function(e){return r.all("storefront").post(e)},listStorefronts:function(){return r.one("storefront").get()},duplicateStorefront:function(e){return r.all("storefront/".concat(e,"/duplicate")).post()},updateStorefront:function(e,t){return r.one("storefront",e).customPUT(t)},deleteStorefront:function(e){return r.one("storefront",e).customDELETE()},addProductsToStorefront:function(e,t){return r.all("storefront/".concat(e,"/product")).post(t)},updateStorefrontProduct:function(e,t,n){return r.one("storefront/".concat(e,"/product/").concat(t)).customPUT(n)},createContact:function(e,t){return r.all("storefront/".concat(e,"/contact")).post(t)},updateContact:function(e,t,n){return r.one("storefront/".concat(e,"/contact/").concat(t)).customPUT(n)},deleteContact:function(e,t){return r.one("storefront/".concat(e,"/contact/").concat(t)).customDELETE()},createSocialMediaContact:function(e,t){return r.all("storefront/".concat(e,"/social-media")).post(t)},updateSocialMediaContact:function(e,t,n){return r.one("storefront/".concat(e,"/social-media/").concat(t)).customPUT(n)},deleteSocialMediaContact:function(e,t){return r.one("storefront/".concat(e,"/social-media/").concat(t)).customDELETE()},createShippingFee:function(e,t){return r.all("storefront/".concat(e,"/shipping-fee")).post(t)},updateShippingFee:function(e,t,n){return r.one("storefront/".concat(e,"/shipping-fee/").concat(t)).customPUT(n)},deleteShippingFee:function(e,t){return r.one("storefront/".concat(e,"/shipping-fee/").concat(t)).customDELETE()},createProduct:function(e){return r.all("product").post(e)},publishStorefront:function(e){return r.all("storefront/".concat(e,"/publish")).post()}}}]),StorefrontsModule.factory("StorefrontUtils",["ProductUtils","StorefrontConstants","$timeout",function(n,r,e){return{updateAssetColors:function(e){if(!e)return r.DEFAULT_FG_COLOR;var t=e||r.DEFAULT_BG_COLOR;return n.checkColor(t)},filterSelectableProducts:function(e,t,n){return e.filter(function(e){return e.currency===t&&!n.includes(e.id)})},isSocialMediaContactNew:function(e,t){return e.value&&!t.value||!1},isSocialMediaContactChanged:function(e,t){return!!e.value&&e.value!==t.value},isSocialMediaContactDeleted:function(e,t){return!e.value&&""===e.value&&""!==t.value},isSocialMediaContactNotChanged:function(e,t){return e.value===t.value}}}]);_excluded=["page"],_excluded2=["page"];function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}SubscribersModule.controller("SubscriberListCtrl",["$scope","$state","$stateParams","subscribers","SubscriptionFilterUtils","SubscriberFilters","SubscriptionFactory","SubscriberUtils","PlansData","PlanFactory",function(o,a,e,t,n,r,i,s,c,u){i.fetchSubscriptionMetrics().then(function(e){o.subscriptionMetrics=e.data}).catch(function(){}),u.fetchPlans().then(function(e){o.plans=e.data,o.filteredPlan=r.formatPlanFilter(o.filters,o.plans)}).catch(function(){}),o.subscribers=t.data,o.subscribersMeta=t.meta,o.revenues=o.subscribersMeta.revenue,o.filters=angular.copy(e),o.numberOfSubscriptionsFilter=r.formatNumberOfSubscriptionsFilter(o.filters),o.lifetimeValueFilter=r.formatLifetimeValueFilter(o.filters),o.planSearchResults=[],o.filterTags=r.getFilterTags(o.filters,{numberOfSubscriptionsFilter:o.numberOfSubscriptionsFilter,lifetimeValueFilter:o.lifetimeValueFilter,planFilter:o.filteredPlan}),o.noSubscribers=!o.subscribers.length&&!a.activeParams,o.noSubscribersFound=!o.subscribers.length&&a.activeParams,o.getLifetimeValue=function(e){return s.getSubscriberLifetimeValueInDefaultCurrency(e)},o.showCardsExpiringThisMonth=function(){a.go("subscriptions.list",{cards_expiry_date:n.getFormattedCurrentMonthAndYear()},{reload:!0,inherit:!1})},o.reloadList=function(){var e=o.filters,t=(e.page,_objectWithoutProperties(e,_excluded)),n=r.formatFiltersForApi(t,{numberOfSubscriptionsFilter:o.numberOfSubscriptionsFilter,lifetimeValueFilter:o.lifetimeValueFilter,planFilter:o.filteredPlan});a.go("subscribers.list",n,{reload:!0,inherit:!1})},o.removeFilterTag=function(e){var t=o.filters,n=(t[e],_objectWithoutProperties(t,[e].map(_toPropertyKey)));a.go("subscribers.list",n,{reload:!0,inherit:!1})},o.clearFilters=function(){a.go("subscribers.list",{},{reload:!0,inherit:!1})},o.$watch("filters.search",function(e,t){if(e!==t){var n=o.filters,r=(n.page,_objectWithoutProperties(n,_excluded2));a.go("subscribers.list",{restFilters:r,search:e},{reload:!0,inherit:!1})}}),o.clearSearch=function(){o.filters.search=""},o.clearSubscriptionSearch=function(){o.filters.search=""},o.resetPlanSearchForm=function(){o.planSearchStatus="idle"},o.setFilteredPlan=function(e){o.filteredPlan=e},o.unsetFilteredPlan=function(){o.filteredPlan=null,o.filters.plan=void 0},o.searchPlans=function(e){o.planSearchStatus="searching",c.search(e).then(function(e){o.planSearchStatus="searched",o.planSearchResults=e.data}).catch(function(e){Notification.error("Could not search subaccounts",e)})},o.selectAllSubscribers=function(e){o.subscribers=s.toggleSubscribersSelection(o.subscribers,e.target.checked)},o.export=function(){s.exportCsv(o.subscribers)}}]),SubscribersModule.controller("SubscriberCtrl",["$scope","subscriber","SubscriptionUtils","SubscriptionConstants",function(e,t,n,r){e.subscriber=t.data,e.firstLetterOfSubscriberName=n.capitalizeInitial(e.subscriber.subscriber_name),e.subscriberPhone=n.getSubscriberPhone(e.subscriber.phone),e.cardExpiresThisMonth=function(e){var t=n.getSubscriptionAttentionReason(e);return t===r.STATUSES.CARD_EXPIRES_THIS_MONTH||t===r.STATUSES.OTHER_ATTENTION},e.lastPaymentAttemptFailed=function(e){return n.getSubscriptionAttentionReason(e)===r.STATUSES.LAST_PAYMENT_ATTEMPT_FAILED}}]),SubscribersModule.service("SubscriberFilterUtils",["utils",function(r){return{comparisonOperatorMapping:{gte:">",lte:"<",eq:"="},parseSubscriptionsCountFilter:function(e){var t=JSON.parse(e.subscriptions_count),n=Object.keys(t)[0];return{operator:n,subscriptionsCount:t[n]}},parseLifetimeValueFilter:function(e){var t=JSON.parse(e.lifetime_value),n=Object.keys(t)[0];return{operator:n,amount:r.currencySubUnitToBaseUnit(t[n]),currency:t.currency}},mapFiltersToFilterTags:function(t){return Object.keys(t).map(function(e){return{filter:e,tagLabel:e,tagOperator:": ",tagValue:t[e]}})}}}]);_excluded=["page","index","subscriptions_count","lifetime_value","plan"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}SubscribersModule.service("SubscriberFilters",["$i18next","SubscriberFilterUtils","$rootScope","utils",function(s,c,i,u){return{formatFiltersForApi:function(e,t){var n=t.numberOfSubscriptionsFilter,r=t.lifetimeValueFilter,o=t.planFilter,a=Object.assign({},e);if(e.plan&&o&&(a.plan=o?o.id:void 0),n.isSelected){var i='{"'.concat(n.filterOperator,'": "').concat(n.filterValue,'"}');a.subscriptions_count=i}else a.subscriptions_count=void 0;if(r.isSelected){var s=u.currencyBaseUnitToSubUnit(r.filterValue),c='{"'.concat(r.filterOperator,'": "').concat(s,'", "currency": "').concat(r.currency,'"}');a.lifetime_value=c}else a.lifetime_value=void 0;return a},formatNumberOfSubscriptionsFilter:function(e){var t=s.t("subscribers.filters.noOfSubscriptions");if(e.subscriptions_count){var n=c.parseSubscriptionsCountFilter(e),r=n.operator,o=n.subscriptionsCount;return{isSelected:"selected",filter:"subscriptions_count",filterOperator:r,tagLabel:t,tagOperator:" ".concat(c.comparisonOperatorMapping[r]," "),filterValue:o,tagValue:o}}return{isSelected:"",filter:"subscriptions_count",filterOperator:"gte",tagLabel:t,tagOperator:" > ",filterValue:"5",tagValue:"5"}},formatLifetimeValueFilter:function(e){if(e.lifetime_value){var t=c.parseLifetimeValueFilter(e),n=t.operator,r=t.amount,o=t.currency;return{isSelected:"selected",filter:"lifetime_value",filterOperator:n,tagLabel:s.t("subscribers.filters.lifetimeValue"),tagOperator:" ".concat(c.comparisonOperatorMapping[n]," "),currency:o,filterValue:r,tagValue:"".concat(o," ").concat(r)}}var a=i.Business.default_currency;return{isSelected:"",filter:"lifetime_value",filterOperator:"gte",tagLabel:s.t("subscribers.filters.lifetimeValue"),tagOperator:" > ",currency:a,filterValue:100,tagValue:"".concat(a," ").concat(100)}},formatPlanFilter:function(t,e){return t.plan?e.find(function(e){return e.id==t.plan}):null},getFilterTags:function(e,t){var n=t.numberOfSubscriptionsFilter,r=t.lifetimeValueFilter,o=t.planFilter,a=(e.page,e.index,e.subscriptions_count,e.lifetime_value,e.plan,_objectWithoutProperties(e,_excluded)),i=c.mapFiltersToFilterTags(a);return e.subscriptions_count&&i.push(n),e.lifetime_value&&i.push(r),e.plan&&o&&i.push({filter:"plan",tagLabel:s.t("subscribers.filters.plan"),tagOperator:": ",tagValue:o.name}),i}}}]),SubscribersModule.service("SubscriberUtils",["API","Notification","$rootScope","SubscriptionUtils","$stateParams",function(r,o,n,a,e){return{toggleSubscribersSelection:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return e.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:t})})},exportCsv:function(e){var t=e.filter(function(e){return e.selected}).map(function(e){return e.customer_code}),n=t.length?"subscriber/export?customer_code=".concat(t.join("&customer_code=")):"subscriber/export";r.one(n).get().then(function(e){e.data&&e.data.path&&a.downloadCsvFile(e.data.path)}).catch(function(e){o.error("Could not export subscribers",e)})},getSubscriberLifetimeValueInDefaultCurrency:function(e){var t=e.lifetime_value.find(function(e){return e.currency===n.Business.default_currency});return t||e.lifetime_value[0]}}}]);_excluded=["page"],_excluded2=["page"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}SubscriptionsModule.controller("SubscriptionListCtrl",["$scope","$state","$stateParams","subscriptions","SubscriptionFactory","SubscriptionUtils","SubscriptionFilters","SubscriptionFilterUtils","SubscriptionConstants","ngDialog","Notification","PlansData","PlanFactory",function(o,a,t,e,n,r,i,s,c,u,l,d,p){var f=i.formatSelectedFiltersForFilterModal(angular.copy(t)),m=f.filters,g=f.cardExpiryFilters;n.fetchSubscriptionMetrics().then(function(e){o.subscriptionMetrics=e.data}).catch(function(){}),p.fetchPlans().then(function(e){o.plans=e.data,o.selectedFilters=i.formatSelectedFiltersForTags(o.filters,{plans:o.plans,amountFilter:o.amountFilter}),o.filteredPlan=o.filters.plan?o.plans.find(function(e){return e.id==o.filters.plan}):null}).catch(function(){}),o.subscriptions=e.data,o.meta=e.meta,o.statusFilter=t.status||"",o.statusDescriptions=c.STATUS_DESCRIPTIONS,o.filters=m,o.cardExpiryFilters=g,o.amountFilter=i.formatAmountFilter(o.filters),o.availableMonthsToFilter=i.getAvailableMonthsToFilter(),o.availableYearsToFilter=i.getAvailableYearsToFilter(),o.planSearchStatus="idle",o.selectedSubscriptions=null,o.allSubscriptionsSelected=!1,o.notCancellableSubscriptions=null,o.cancellableSubscriptions=null,o.planSearchResults=[];var h=Object.keys(o.filters).filter(function(e){return null!=o.filters[e]});o.noSubscriptions=!o.subscriptions.length&&(!h.length||1===h.length&&"active"===o.statusFilter),o.noSubscriptionsFound=!o.noSubscriptions&&!o.subscriptions.length&&a.activeParams&&1<=h.length,o.appendSubscriptionIdToStateParams=function(e){return _objectSpread(_objectSpread({},t),{},{id:e})},o.getCustomerName=function(e,t){return r.getSubscriberFullName(e,t)},o.getInterval=function(e){return" / ".concat(e.interval)},o.cardExpiresThisMonth=function(e){return r.getSubscriptionAttentionReason(e)===c.STATUSES.CARD_EXPIRES_THIS_MONTH},o.lastPaymentAttemptFailed=function(e){return r.getSubscriptionAttentionReason(e)===c.STATUSES.LAST_PAYMENT_ATTEMPT_FAILED},o.$watch("filters.search",function(e,t){if(e!==t){var n=o.filters,r=(n.page,_objectWithoutProperties(n,_excluded));a.go("subscriptions.list",{restFilters:r,search:e},{reload:!0,inherit:!1})}}),o.clearSubscriptionSearch=function(){o.filters.search=""},o.resetPlanSearchForm=function(){o.planSearchStatus="idle"},o.setFilteredPlan=function(e){o.filteredPlan=e},o.unsetFilteredPlan=function(){o.filteredPlan=null,o.filters.plan=void 0},o.searchPlans=function(e){o.planSearchStatus="searching",d.search(e).then(function(e){o.planSearchStatus="searched",o.planSearchResults=e.data}).catch(function(e){l.error("Could not search subaccounts",e)})},o.clearFilters=function(){a.go("subscriptions.list",{},{reload:!0,inherit:!1})},o.reloadList=function(){var e=o.filters,t=(e.page,_objectWithoutProperties(e,_excluded2)),n=i.formatSelectedFiltersForApi(t,{cardExpiryFilters:o.cardExpiryFilters,amountFilter:o.amountFilter,planFilter:o.filteredPlan});a.go("subscriptions.list",n,{reload:!0,inherit:!1})},o.removeFilterTag=function(e){var t=i.removeFilterTag(o.filters,e);a.go("subscriptions.list",t,{reload:!0,inherit:!1})},o.showCardsExpiringThisMonth=function(){var e=s.getFormattedCurrentMonthAndYear();a.go("subscriptions.list",{cards_expiry_date:e},{reload:!0,inherit:!1})},o.setSelectedSubscriptions=function(){o.selectedSubscriptions=r.getSelectedSubscriptions(o.subscriptions),o.cancellableSubscriptions=r.getCancellableSubscriptions(o.selectedSubscriptions),o.notCancellableSubscriptions=r.getNotCancellableSubscriptions(o.selectedSubscriptions)},o.selectAllSubscriptions=function(e){o.allSubscriptionsSelected=e.target.checked,o.allSubscriptionsSelected?o.subscriptions=r.toggleAllSubscriptions(o.subscriptions):o.subscriptions=r.toggleAllSubscriptions(o.subscriptions,!1),o.setSelectedSubscriptions()},o.showCancelBulkSubscriptionsModal=function(){var e=o.notCancellableSubscriptions&&o.notCancellableSubscriptions.length||0;u.openConfirm({template:"modules/subscriptions/views/modals/bulk-cancel-subscriptions.html",scope:o,controller:"SubscriptionPopupCtrl",showClose:!1,closeByDocument:!1,data:{selectedSubscriptions:o.selectedSubscriptions,cancellableSubscriptionsCount:o.selectedSubscriptions.length-e,notCancellableSubscriptionsCount:e}}).then(function(){a.reload()})},o.showSendBulkUpdateCardModal=function(){u.openConfirm({template:"modules/subscriptions/views/modals/bulk-update-card-email.html",scope:o,controller:"SubscriptionPopupCtrl",showClose:!1,closeByDocument:!1,data:{subscriptions:o.selectedSubscriptions}}).then(function(){a.reload()})},o.export=function(){r.exportCsv(o.subscriptions)}}]),SubscriptionsModule.controller("SubscriptionCtrl",["$scope","$state","ngDialog","subscription","SubscriptionUtils","SubscriptionConstants","$i18next","SubscriptionFactory","Notification",function(r,o,a,e,t,n,i,s,c){r.subscription=e.data,r.subscriptionConstants=n,r.firstLetterOfSubscriberName=t.capitalizeInitial(r.subscription.customer.first_name),r.subscriberFullName=t.getSubscriberFullName(r.subscription.customer.first_name,r.subscription.customer.last_name),r.subscriberPhone=t.getSubscriberPhone(r.subscription.customer.phone),r.cardExpireDate=t.getCardExpireDateLabel(r.subscription.authorization),r.subscriptionType=r.subscription.authorization.channel.toLowerCase(),r.isSubscriptionCancellable=["active","attention"].includes(r.subscription.status),r.subscriptionCreationDate=t.getFormattedDate(r.subscription.createdAt),r.subscriptionNextPaymentDate=t.getFormattedDate(r.subscription.next_payment_date),r.subscriptionDuration=t.getSubscriptionDuration(r.subscription);var u=t.getSubscriptionAttentionReason(r.subscription);r.cardExpiresThisMonth=u===n.STATUSES.CARD_EXPIRES_THIS_MONTH,r.lastPaymentAttemptFailed=u===n.STATUSES.LAST_PAYMENT_ATTEMPT_FAILED,r.subscriptionPlanInterval=0<r.subscriptionDuration?n.PLAN_INTERVAL[r.subscription.plan.interval].plural:n.PLAN_INTERVAL[r.subscription.plan.interval].singular,r.getFailedDate=function(){return t.getFormattedDate(r.subscription.most_recent_invoice.createdAt)},r.showCancelSubscriptionModal=function(){a.openConfirm({template:"modules/subscriptions/views/modals/cancel-subscription.html",scope:r,controller:"SubscriptionPopupCtrl",showClose:!1,closeByDocument:!1,data:{subscription:r.subscription}}).then(function(){o.reload()})};r.fetchUpdateCardLink=function(){r.updateCardLinkStatus="loading";var n=r.subscription.subscription_code;s.fetchUpdateCardEmailLastSentDate(n).then(function(e){var t=e.data;return r.hoursSinceUpdateMailLastSent=function(e){if(!e)return 0;var t=new Date(e).getTime();return moment().diff(moment(t),"hours")}(t),r.showResendMailError=!!t&&r.hoursSinceUpdateMailLastSent<24,s.fetchManageCardLink(n)}).then(function(e){var t=e.data;r.updateCardUrl=t.link,r.updateCardLinkStatus="success",a.openConfirm({template:"modules/subscriptions/views/modals/share-update-card-link.html",scope:r,controller:"SubscriptionUpdateCardCtrl",showClose:!1,closeByDocument:!1,data:{subscription:r.subscription,updateCardUrl:r.updateCardUrl}}).then(function(){o.reload()})}).catch(function(e){c.error("Could not fetch Card Link",e),r.updateCardLinkStatus="error"})},r.daysTillCardExpires=moment().set({year:e.data.authorization.exp_year,month:parseInt(e.data.authorization.exp_month)-1}).endOf("month").utc().diff(new Date,"days")}]).controller("SubscriptionPopupCtrl",["$scope","$state","$stateParams","Notification","SubscriptionUtils","SubscriptionFactory",function(o,a,e,i,r,s){o.cancelSubscription=function(){s.cancelSubscription(o.subscription.subscription_code,o.subscription.email_token).then(function(){o.closeThisDialog(),i.success("Subscription cancelled",o.subscription.customer.email+" has been unsubscribed"),a.go("subscriptions.list",e,{reload:!0,inherit:!1})}).catch(function(e){o.$broadcast("subscriptionCancelled",!1),i.error("Could not cancel this subscription",e)})},o.bulkCancelSubscriptions=function(e,t){var n=r.getCancelSubscriptionsPayload(e);s.bulkCancelSubscriptions(n).then(function(){o.closeThisDialog(),i.success("Subscriptions cancelled","".concat(t," subscriptions have been cancelled")),a.reload()}).catch(function(e){i.error("Could not cancel these subscriptions",e)})},o.sendBulkUpdateCardEmails=function(r){var e={subscription_codes:r.map(function(e){return e.subscription_code})};s.sendBulkUpdateCardEmail(e).then(function(e){var t=e.data,n=e.message;t.invalid.length?(o.sendBulkUpdateCardErrors=t.invalid,o.$broadcast("sendBulkUpdateCardEmails",!1)):(o.closeThisDialog(),a.reload()),i.success(n,"".concat(t.valid.length," out of ").concat(r.length," emails were sent."))}).catch(function(e){o.closeThisDialog(),i.error("Could not send bulk update card emails",e)})}}]).controller("SubscriptionUpdateCardCtrl",["$scope","$state","Notification","SubscriptionUtils","SubscriptionFactory",function(n,e,r,t,o){n.subscription=n.ngDialogData.subscription,n.updateCardLinkStatus="loading";var a=n.subscription.subscription_code;n.sendUpdateCardEmail=function(){o.sendUpdateCardEmail(a).then(function(e){var t=e.message;n.$broadcast("updateCardEmailSent"),n.updateCardLinkStatus="mail_sent",r.success(t),n.hoursSinceUpdateMailLastSent=0,n.showResendMailError=!0}).catch(function(e){n.$broadcast("updateCardEmailSent",!1),r.error("Could not send email",e)})}}]),SubscriptionsModule.factory("SubscriptionFactory",["API","$stateParams",function(n,e){return{cancelSubscription:function(e,t){return n.all("subscription/disable").post({code:e,token:t})},bulkCancelSubscriptions:function(e){return n.all("subscription/bulk-disable").post({status:"cancelled",subscriptions:e})},fetchManageCardLink:function(e){return n.one("subscription/".concat(e,"/manage/link")).get()},sendUpdateCardEmail:function(e){return n.all("subscription/".concat(e,"/manage/email")).post()},fetchUpdateCardEmailLastSentDate:function(e){return n.one("subscription/".concat(e,"/manage/last-sent-date")).get()},sendBulkUpdateCardEmail:function(e){return n.all("subscription/manage/send-bulk-email").post(e)},fetchSubscriptionMetrics:function(){return n.one("subscription/metrics").get(e)}}}]),SubscriptionsModule.constant("SubscriptionConstants",{STATUSES:{CARD_EXPIRES_THIS_MONTH:"Card expires this month",LAST_PAYMENT_ATTEMPT_FAILED:"Last payment attempt failed",OTHER_ATTENTION:""},EARLIEST_CARD_EXPIRY_YEAR:2016,AVAILABLE_YEARS_TO_FILTER:12,PLAN_INTERVAL:{hourly:{singular:"hour",plural:"hours"},daily:{singular:"day",plural:"days"},weekly:{singular:"week",plural:"weeks"},monthly:{singular:"month",plural:"months"},quarterly:{singular:"month",plural:"months"},annually:{singular:"month",plural:"months"},biannually:{singular:"month",plural:"months"}},CANCELLABLE_SUBSCRIPTION_STATUSES:["active","attention"],NOT_CANCELLABLE_SUBSCRIPTION_STATUSES:["cancelled","complete","non-renewing"],STATUS_DESCRIPTIONS:{active:"Active Subscriptions","active-renewing":"Active Recurring Subscriptions","active-non-renewing":"Active Non-recurring Subscriptions",complete:"Completed Subscriptions",cancelled:"Cancelled Subscriptions",attention:"Subscriptions Requiring Attention"}}),SubscriptionsModule.service("SubscriptionFilterUtils",[function(){var b=function(e){var t=e.date,n=e.dateType,r=e.formatter;return moment(t,n).format(r)};return{getFormattedCurrentMonthAndYear:function(){return'{"eq": "'.concat(moment().format("MM"),"/").concat(moment().format("YYYY"),'"}')},formatFilterText:function(e){if(e){var t=e.split("/"),n=_slicedToArray(t,2),r=n[0],o=n[1];return"".concat(b({date:r,dateType:"MM",formatter:"MMM"})," ").concat(b({date:o,dateType:"YYYY",formatter:"YYYY"}))}},getCardExpiryFilters:function(e,t){var n,r,o,a,i,s,c=(n=e,r=t,o=moment().format("M"),a=moment().add(1,"M").format("M"),i=moment("2020").format("YYYY"),s=moment().format("YYYY"),{filterStartDate:n&&n.split("/")||[o,i],filterEndDate:r&&r.split("/")||[a,s]}),u=_slicedToArray(c.filterStartDate,2),l=u[0],d=u[1],p=_slicedToArray(c.filterEndDate,2),f=p[0],m=p[1],g=b({date:l,dateType:"MM",formatter:"MMMM"}),h=b({date:l,dateType:"M",formatter:"M"}),y=b({date:d,dateType:"YYYY",formatter:"YYYY"});return{specificMonthFilter:{name:g,value:h},specificYearFilter:{name:y,value:d},startDateFilter:{month:{name:g,value:h},year:{name:y,value:d}},endDateFilter:{month:{name:b({date:f,dateType:"MM",formatter:"MMMM"}),value:b({date:f,dateType:"M",formatter:"M"})},year:{name:b({date:m,dateType:"YYYY",formatter:"YYYY"}),value:m}}}},parseAmountFilter:function(e){var t=JSON.parse(e.amount),n=Object.keys(t)[0],r=t.currency;return{operator:n,amount:t[n]/100,currency:r}}}}]),SubscriptionsModule.service("SubscriptionFilters",["SubscriptionConstants","SubscriptionFilterUtils","SubscriberFilterUtils","utils","$rootScope",function(t,s,i,c,u){return{getAvailableMonthsToFilter:function(){return moment.months().map(function(e,t){return{name:e,value:(t+1).toString()}})},getAvailableYearsToFilter:function(){var r=moment(t.EARLIEST_CARD_EXPIRY_YEAR.toString()),e=(new Date).getFullYear()-t.EARLIEST_CARD_EXPIRY_YEAR+t.AVAILABLE_YEARS_TO_FILTER;return Array.from(Array(e).keys()).map(function(e,t){0!==t&&r.add(1,"year");var n=r.format("YYYY");return{name:n,value:n}})},formatAmountFilter:function(e){if(e.amount){var t=s.parseAmountFilter(e),n=t.operator,r=t.amount,o=t.currency;return{isSelected:"selected",currency:o,filter:"amount",filterOperator:n,filterValue:r,tagLabel:"Amount",tagOperator:" ".concat(i.comparisonOperatorMapping[n]," "),tagValue:"".concat(o," ").concat(r)}}var a=u.Business.default_currency;return{isSelected:"",currency:a,filter:"amount",filterOperator:"gte",filterValue:"1000",tagLabel:"Amount",tagOperator:" > ",tagValue:"".concat(a," 1000")}},removeFilterTag:function(e,t){return"period"===t.key?(e.from=void 0,e.to=void 0):"Expiring Cards"===t.key?e.cards_expiry_date=void 0:e[t.key]=void 0,e},formatSelectedFiltersForFilterModal:function(e){var t;if(e.cards_expiry_date){var n=JSON.parse(e.cards_expiry_date);n.eq?(t=s.getCardExpiryFilters(n.eq),e.expiringCards="specificDate"):(t=s.getCardExpiryFilters(n.gte,n.lte),e.expiringCards="customPeriod")}else t=s.getCardExpiryFilters();return{filters:e,cardExpiryFilters:t}},formatSelectedFiltersForApi:function(e,t){var n=t.cardExpiryFilters,r=t.amountFilter,o=t.planFilter,a=angular.copy(e);if(e.plan&&o&&(o?a.plan=o.id:e.plan=void 0),r.isSelected){var i=c.currencyBaseUnitToSubUnit(r.filterValue);a.amount='{"'.concat(r.filterOperator,'": "').concat(i,'", "currency": "').concat(r.currency,'"}')}return"thisMonth"===e.expiringCards&&(a.cards_expiry_date=s.getFormattedCurrentMonthAndYear()),"specificDate"===e.expiringCards&&(a.cards_expiry_date='{"eq": "'.concat(n.specificMonthFilter.value,"/").concat(n.specificYearFilter.value,'"}')),"customPeriod"===e.expiringCards&&(a.cards_expiry_date='{ "gte": "'.concat(n.startDateFilter.month.value,"/").concat(n.startDateFilter.year.value,'", "lte": "').concat(n.endDateFilter.month.value,"/").concat(n.endDateFilter.year.value,'"}')),e.expiringCards||(a.cards_expiry_date=void 0),a},formatSelectedFiltersForTags:function(e,t){var n=t.plans,r=t.amountFilter,o=angular.copy(e);if(o.page=void 0,o.expiringCards=void 0,o.from&&o.to&&(o.period="".concat(o.from," - ").concat(o.to),o.from=void 0,o.to=void 0),o.plan){var a=n.find(function(e){return e.id==o.plan});a&&(o.plan=a.name)}if(o.cards_expiry_date){var i=JSON.parse(o.cards_expiry_date);o.cardsExpiryDate=s.formatFilterText(i.eq)||"".concat(s.formatFilterText(i.gte)," - ").concat(s.formatFilterText(i.lte)),o.cards_expiry_date=void 0}return Object.keys(o).filter(function(e){return null!=o[e]}).map(function(e){if("cardsExpiryDate"===e)return{key:"Expiring Cards",operator:": ",value:o[e]};if("status"===e){if("active-non-renewing"===o[e])return{key:e,operator:": ",value:"Active - Non-Renewing"};if("active-renewing"===o[e])return{key:e,operator:": ",value:"Active - Renewing"};if("complete"===o[e])return{key:e,operator:": ",value:"Completed"}}return"amount"===e?{key:e,operator:r.tagOperator,value:r.tagValue}:{key:e,operator:": ",value:o[e]}})}}}]),SubscriptionsModule.service("SubscriptionUtils",["SubscriptionConstants","API","$stateParams",function(u,o,a){var c=function(e){var t=e.exp_month,n=e.exp_year,r=new Date(parseInt(n),parseInt(t),0).getDate();return moment("".concat(n,"/").concat(t,"/").concat(r," "))},i=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.selected})},t=function(e){return e.filter(function(e){return u.CANCELLABLE_SUBSCRIPTION_STATUSES.includes(e.status)})},s=function(e){var t=document.createElement("a");t.href=e,t.style.display="none",document.body.appendChild(t),t.click(),t.parentNode.removeChild(t)};return{getNextMonthIndex:function(){return moment().month()+1},capitalizeInitial:function(e){return null!=e&&e.trim().length?e.substring(0,1).toUpperCase():""},getSubscriberFullName:function(e,t){return t=t||"","".concat(e=e||""," ").concat(t)},getSubscriberPhone:function(e){if(e)return"+"===e.charAt(0)?e:"+".concat(e)},getCardExpireDate:c,getCardExpireDateLabel:function(e){var t=moment(),n=c(e),r=n.format("MMMM DD, YYYY"),o=n.isBefore(t);return{date:r,status:"".concat(o?"expired on":"expires"," ").concat(r)}},getFormattedDate:function(e){if(e)return moment(e).format("MMMM DD, YYYY")},getSubscriptionAttentionReason:function(e){var t=e.status,n=e.authorization,r=e.most_recent_invoice;if("attention"===t&&r){var o=moment(),a=c(n),i=moment(a).isSame(o,"month"),s="failed"===r.status;return i?u.STATUSES.CARD_EXPIRES_THIS_MONTH:s?u.STATUSES.LAST_PAYMENT_ATTEMPT_FAILED:u.STATUSES.OTHER_ATTENTION}},getSubscriptionDuration:function(e){var t=e.status,n=e.createdAt,r=e.cancelledAt,o=e.most_recent_invoice,a=e.plan.interval;if(o){var i=moment(n),s=moment(o.createdAt),c=u.PLAN_INTERVAL[a].plural||"months";return"cancelled"===t?moment(r).diff(i,c):"active"===t?moment().diff(i,c):s.diff(i,c)}},findPlanByPlanName:function(e,t){return e.find(function(e){return e.name===t})},getSelectedSubscriptions:i,getSelectedSubscriptionsCount:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return i(e).length},toggleAllSubscriptions:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return e.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:t})})},getCancellableSubscriptions:t,getNotCancellableSubscriptions:function(e){return e.filter(function(e){return u.NOT_CANCELLABLE_SUBSCRIPTION_STATUSES.includes(e.status)})},getCancelSubscriptionsPayload:function(e){return t(e).map(function(e){return{code:e.subscription_code,token:e.email_token}})},downloadCsvFile:s,exportCsv:function(e){var t=i(e).map(function(e){return e.subscription_code}),n=a.status?"status=".concat(a.status):"",r=t.length?"subscription/export?subscription_code=".concat(t.join("&subscription_code=")).concat(n&&"&".concat(n)):"subscription/export".concat(n&&"?".concat(n));o.one(r).get().then(function(e){e.data&&e.data.path&&s(e.data.path)}).catch(function(e){Notification.error("Could not export subscriptions",e)})}}}]),angular.module("app.support").directive("supportButton",["AmplitudeService","$timeout",function(n,r){return{restrict:"E",template:'\n    <div class="support-dropup dropup" uib-dropdown ng-show="zendeskReady">\n        <div class="support-button" uib-dropdown-toggle>\n          <button class="support-button__front" data-testid="support-button">\n            <i class="icon-question"></i> {{ \'support.button.default\' | i18next }}\n          </button>\n          <button class="support-button__back">\n            <i class="icon-close"></i> {{ \'support.button.close\' | i18next }}\n          </button>\n        </div>\n        <ul class="dropdown-menu dropdown-menu-right no-arrow animated fadeInUp" uib-dropdown-menu>\n            <li>\n                <a ng-click="openHelpDesk({ position: \'bottom-right\' }); onClick(\'Find answers\');" data-testid="find-answers">\n                  {{ \'support.button.findAnswers\' | i18next }}\n                </a>\n            </li>\n            <li>\n                <a ng-click="openHelpDesk({ tab: \'contact\', position: \'bottom-right\' }); onClick(\'Contact us\')" data-testid="contact-us">\n                  {{ \'support.button.contactUs\' | i18next }}\n                </a>\n            </li>\n            <li ng-if="isLoggedIn()">\n                <a ng-click="onClick(\'Suggest an improvement\');" ng-dialog="modules/support/feature-request.html" ng-dialog-controller="FeatureRequestCtrl">\n                  {{ \'support.button.suggestImprovement\' | i18next }}\n                </a>\n            </li>\n            <li ng-if="isLoggedIn()">\n                <a ng-click="onClick(\'Support page\');" ui-sref="support.home">\n                  {{ \'support.button.supportPage\' | i18next }}\n                </a>\n            </li>\n        </ul>\n    </div>\n  ',link:function(e){var t=n.logEvent;e.$on("zendeskReady",function(){r(function(){e.zendeskReady=!0})}),e.onClick=function(e){t("Used support button",{Clicked:e})}}}}]),angular.module("app.support").service("SnapcallService",function(){var r=settings.snapcallButtonId;return{init:function(){return new Promise(function(n){var e=function(){window.snapcallAPI.widgetIsSupported(function(t){window.snapcallAPI.widgetIsAvailable(r,function(e){n(t&&t.hasWebRTC&&t.hasMicrophone&&e)})})};if(window.window.snapcallAPI)e();else{var t=document.createElement("script");t.setAttribute("btn-bid",r),t.setAttribute("src","https://snap.snapcall.io/snapapp.min.js"),t.setAttribute("noWidget","true"),t.onload=function(){return e()},document.body.appendChild(t)}})},call:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};snapcallAPI.initWidget(r,{noWidget:!1},function(e){e&&(window.snapcallExtraContext=function(e){e(t)},window.snapcallAPI.startCall(r),window.addEventListener("snapcallEvent_callStarting",function(){window.snapcallAPI.showWidget()}),window.addEventListener("snapcallEvent_callEnd",function(){window.snapcallAPI.hideWidget()}))})}}}),TransactionSplitsModule.factory("TransactionSplitsData",["API","$rootScope",function(r,e){var t=e.Business.id;return{fetch:function(e){return r.one("split").get(e)},createSplit:function(e){return r.all("split").post(e)},updateSplit:function(e,t){return r.one("split/".concat(e)).customPUT(t)},activateSplit:function(e){return r.one("split/".concat(e)).customPUT({active:!0})},deactivateSplit:function(e){return r.one("split/".concat(e)).customPUT({active:!1})},fetchSingleSplit:function(e){return r.one("split",e).get()},fetchTransactionsBySplitCode:function(e){return r.one("transaction").get({split_code:e,perPage:10})},fetchSettlementAccount:function(){return r.one("integration/view_settlement_accounts",t).get()},fetchSubaccount:function(e){return r.one("subaccount",e).get()},searchSubaccounts:function(e){return r.one("subaccount").get({search:e,perPage:25})},createSubaccount:function(e){return r.all("subaccount").post(e)},updateSubaccount:function(e,t){return r.one("subaccount",e).customPUT(t)},addSubaccountToSplit:function(e){var t=e.splitId,n=e.payload;return r.all("split/".concat(t,"/subaccount/add")).post(n)},removeSubaccountFromSplit:function(e){var t=e.splitId,n=e.payload;return r.all("split/".concat(t,"/subaccount/remove")).post(n)}}}]),TransactionSplitsModule.service("TransactionSplitsService",["$timeout","utils","$i18next","$stateParams",function(n,a,r,t){var u={subaccount:void 0,is_dynamic:void 0,active:void 0,type:void 0},l={subaccount:r.t("transactionSplits.list.filters.subaccount"),is_dynamic:r.t("transactionSplits.list.filters.category.label"),active:r.t("transactionSplits.list.filters.status.label"),type:r.t("transactionSplits.list.filters.splitType.label")},e=[{name:r.t("transactionSplits.list.filters.status.all"),value:void 0},{name:r.t("transactionSplits.list.filters.status.active"),value:"true"},{name:r.t("transactionSplits.list.filters.status.disabled"),value:"false"}],o=[{name:r.t("transactionSplits.list.filters.splitType.all"),value:void 0},{name:r.t("transactionSplits.list.filters.splitType.flat"),value:"flat"},{name:r.t("transactionSplits.list.filters.splitType.percentage"),value:"percentage"}],i=[{name:r.t("transactionSplits.list.filters.category.all"),value:void 0},{name:r.t("transactionSplits.list.filters.category.static"),value:"false"},{name:r.t("transactionSplits.list.filters.category.dynamic"),value:"true"}],s=function(e){var t=e.splitType,n=e.share,r=e.formatTo,o=parseFloat(n);return"percentage"===t?n:"kobo"===r?a.toKobo({amount:o}).amount:"naira"===r?a.toNaira({amount:o}).amount:void 0};return{showIntroJS:function(){var e=new introJs,t={showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!0,tooltipClass:"w-md",highlightClass:"product-intro-highlight",exitOnEsc:!0,doneLabel:r.t("transactionSplits.accounts.introJS.actionButtonText")};e.addSteps([{element:"#add-existing-subaccount-input-wrapper",intro:'\n            <div class="introjs-title text-mid">'.concat(r.t("transactionSplits.accounts.introJS.title"),'</div>\n            <div class="introjs-body">').concat(r.t("transactionSplits.accounts.introJS.body"),"</div>\n          "),position:"left"}]),e.setOptions(t),n(function(){e.start()},500)},filterStatuses:e,defaultFilters:u,filterSplitTypes:o,filterCategories:i,formatPillFilters:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).subaccount,s=void 0===e?null:e,c=a.stripPropertiesWithoutValues(t);return Object.keys(c).reduce(function(e,t){if(u.hasOwnProperty(t)){var n=l[t],r=(a=c[o=t],i=s,"subaccount"===o?i&&i.business_name||a:"active"===o?"true"===a?"active":"disabled":"is_dynamic"===o?"true"===a?"dynamic":"static":a);return[].concat(_toConsumableArray(e),[{key:t,name:n,value:r}])}var o,a,i;return e},[])},isStateParamsEmpty:function(){return 0===Object.keys(a.stripPropertiesWithoutValues(t)).length},focusOnElementBySelector:function(t){n(function(){var e=document.querySelector(t);e&&e.focus()},0)},appendSplitIdToStateParams:function(e){return _objectSpread(_objectSpread({},t),{},{id:e})},computeTransactionSplitTableHeight:function(){var e=document.querySelector(".view-header"),t=document.querySelector("#transaction-split-filter-container");return"calc(100vh - ".concat(e&&e.offsetHeight||0,"px - ").concat(t&&t.offsetHeight||0,"px)")},formatAccountShareBySplitType:s,formatTransactionSplitResponse:function(e){var t=e.data,n=t.type,r=t.subaccounts||[];return _objectSpread(_objectSpread({},t),{},{subaccounts:r.map(function(e){return _objectSpread(_objectSpread({},e.subaccount),{},{share:s({splitType:n,share:e.share,formatTo:"naira"})})})})}}}]),angular.module("app.transfers").config(["$stateProvider",function(e){e.state("transfers.bulk-upload",{url:"^/transfer/bulk-upload",template:"<ui-view></ui-view>",redirectTo:"transfers.bulk-upload.view",data:{permission:"transfer-*",authenticable:!0}}).state("transfers.bulk-upload.view",{title:"Bulk Upload Transfers",templateUrl:"modules/transfers/bulk-upload/view.html",controller:"BulkTransferViewCtrl",resolve:{balances:["API",function(e){return e.one("balance").get()}]}}).state("transfers.bulk-upload.start",{title:"Bulk Upload Transfers",templateUrl:"modules/transfers/bulk-upload/start.html",controller:"BulkTransferStartCtrl",url:"/:id"}).state("transfers.bulk-upload.progress",{url:"/:id",title:"Bulk Upload Transfers",templateUrl:"modules/transfers/bulk-upload/progress.html",controller:"BulkTransferProgressCtrl"})}]);